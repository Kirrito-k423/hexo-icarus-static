<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-08T12:01:51.000Z" title="9/8/2022, 12:01:51 PM">2022-09-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.653Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 506 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/08/Work/network/0-basic/DNS/">DNS</a></p><div class="content"><h2 id="DNS污染"><a href="#DNS污染" class="headerlink" title="DNS污染"></a>DNS污染</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><img src="https://pic.shaojiemike.top/img/20220908200452.png"></p>
<h3 id="查看DNS地址"><a href="#查看DNS地址" class="headerlink" title="查看DNS地址"></a>查看DNS地址</h3><p>在<a target="_blank" rel="noopener" href="https://dnschecker.org/#A/api.themoviedb.org">DNS索引网站</a>查看域名的中国服务器IP地址</p>
<p>实际ping速度，修改win10的hosts文件在<code>C:\WINDOWS\system32\drivers\etc</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br><span class="line"></span><br><span class="line">Ethernet adapter 以太网:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : ustc.edu.cn</span><br><span class="line">   Description . . . . . . . . . . . : Realtek PCIe GbE Family Controller</span><br><span class="line">   Physical Address. . . . . . . . . : 00-2B-67-7D-A7-93</span><br><span class="line">   DHCP Enabled. . . . . . . . . . . : Yes</span><br><span class="line">   Autoconfiguration Enabled . . . . : Yes</span><br><span class="line">   IPv6 Address. . . . . . . . . . . : 2001:da8:d800:336:c9a6:8e7f:7035:cd(Preferred)</span><br><span class="line">   Link-local IPv6 Address . . . . . : fe80::c9a6:8e7f:7035:cd%5(Preferred)</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 202.38.78.133(Preferred)</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Lease Obtained. . . . . . . . . . : 2022年9月3日 15:03:56</span><br><span class="line">   Lease Expires . . . . . . . . . . : 2022年9月11日 19:58:06</span><br><span class="line">   Default Gateway . . . . . . . . . : fe80::e683:26ff:fea3:e107%5</span><br><span class="line">                                       202.38.78.254</span><br><span class="line">   DHCP Server . . . . . . . . . . . : 202.38.64.7</span><br><span class="line">   DHCPv6 IAID . . . . . . . . . . . : 100674407</span><br><span class="line">   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-26-96-E5-7D-00-2B-67-7D-A7-93</span><br><span class="line">   DNS Servers . . . . . . . . . . . : 8.8.8.8</span><br><span class="line">   NetBIOS over Tcpip. . . . . . . . : Enabled</span><br></pre></td></tr></table></figure>
<p>ping 百度 B站没有问题</p>
<h3 id="浏览器F12"><a href="#浏览器F12" class="headerlink" title="浏览器F12"></a>浏览器F12</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unchecked runtime.lastError: The message port closed before a response was received.</span><br><span class="line">Failed to load resource: net::ERR_PROXY_CONNECTION_FAILED</span><br><span class="line">Failed to load resource: net::ERR_CONNECTION_CLOSED</span><br><span class="line">Failed to load resource: net::ERR_CONNECTION_RESET</span><br></pre></td></tr></table></figure>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>网络重置<img src="https://pic.shaojiemike.top/img/20220908204210.png"></p>
<h2 id="github-com无法访问"><a href="#github-com无法访问" class="headerlink" title="github.com无法访问"></a>github.com无法访问</h2><p>ping失败,原因是某些github关闭了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//Windows</span><br><span class="line">D:\PowerShell&gt; nslookup github.com 223.5.5.5</span><br><span class="line">Server:  public1.alidns.com</span><br><span class="line">Address:  223.5.5.5</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:    github.com</span><br><span class="line">Address:  20.205.243.166</span><br></pre></td></tr></table></figure>
<p>最不济修改host文件，<a target="_blank" rel="noopener" href="https://ipaddress.com/website/github.com">https://ipaddress.com/website/github.com</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">\\Ubuntu</span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:39]</span><br><span class="line">$ cat /run/systemd/resolve/resolv.conf</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 8.8.4.4</span><br><span class="line">nameserver 202.38.64.1</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:12]      </span><br><span class="line">$ cat /etc/resolv.conf     </span><br><span class="line">nameserver 127.0.0.53</span><br><span class="line">options edns0 trust-ad</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:16]</span><br><span class="line">$ nmcli device show eno0</span><br><span class="line">GENERAL.DEVICE:                         eno0</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         AC:1F:6B:8A:E4:BA</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.STATE:                          10 (unmanaged)</span><br><span class="line">GENERAL.CONNECTION:                     --</span><br><span class="line">GENERAL.CON-PATH:                       --</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               on</span><br><span class="line">IP4.ADDRESS[1]:                         202.38.73.217/24</span><br><span class="line">IP4.GATEWAY:                            --</span><br><span class="line">IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 202.38.73.254, mt = 0, table=1</span><br><span class="line">IP4.ROUTE[2]:                           dst = 202.38.73.0/24, nh = 0.0.0.0, mt = 0</span><br><span class="line">IP6.ADDRESS[1]:                         2001:da8:d800:730::217/64</span><br><span class="line">IP6.ADDRESS[2]:                         fe80::ae1f:6bff:fe8a:e4ba/64</span><br><span class="line">IP6.GATEWAY:                            2001:da8:d800:730::1</span><br><span class="line">IP6.ROUTE[1]:                           dst = 2001:da8:d800:112::23/128, nh = 2001:da8:d800:730::1, mt = 1024</span><br><span class="line">IP6.ROUTE[2]:                           dst = 2001:da8:d800:730::/64, nh = ::, mt = 256</span><br><span class="line">IP6.ROUTE[3]:                           dst = fe80::/64, nh = ::, mt = 256</span><br><span class="line">IP6.ROUTE[4]:                           dst = ::/0, nh = 2001:da8:d800:730::1, mt = 1024</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:41:53]</span><br><span class="line">$ dig www.baidu.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.baidu.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 47773</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 65494</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.baidu.com.                 IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.baidu.com.          604     IN      CNAME   www.a.shifen.com.</span><br><span class="line">www.a.shifen.com.       159     IN      A       14.215.177.39</span><br><span class="line">www.a.shifen.com.       159     IN      A       14.215.177.38</span><br><span class="line"></span><br><span class="line">;; Query time: 91 msec</span><br><span class="line">;; SERVER: 127.0.0.53#53(127.0.0.53)</span><br><span class="line">;; WHEN: Mon Oct 10 19:43:01 CST 2022</span><br><span class="line">;; MSG SIZE  rcvd: 101</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-02T09:07:34.000Z" title="9/2/2022, 9:07:34 AM">2022-09-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.657Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">6 minutes read (About 825 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/02/Work/software/linux/ubuntu/">Ubuntu server reInstall</a></p><div class="content"><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li>写U盘（见<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dbe64ce09b74">网上教程</a>，注意备份U盘文件）</li>
<li>插U盘，开机前根据机器型号使用命令(F2，F4, F12或者Del)进入boit manager，选择从U盘boot<ol>
<li>改引导启动顺序，把U盘启动改到最前面<img src="https://pic.shaojiemike.top/img/20220902174441.png"></li>
</ol>
</li>
<li>根据提示安装ubuntu(服务器不用分区，默认就行，如果自己电脑双系统则需要根据内存设置分区)</li>
<li>设置root密码并进入root <code>sudo passwd root</code></li>
<li>配置实验室网络</li>
</ol>
<h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><p><a target="_blank" rel="noopener" href="https://ubuntu.com/download/server">官网下载</a></p>
<h2 id="重装系统怎么保留原本的磁盘文件"><a href="#重装系统怎么保留原本的磁盘文件" class="headerlink" title="重装系统怎么保留原本的磁盘文件"></a>重装系统怎么保留原本的磁盘文件</h2><p>只要在安装系统时分出一个&#x2F;home分区。你可以把Ubuntu的“&#x2F;”分区看为Windows的C盘，重装Ubuntu时只格式化“&#x2F;”分区，不格式化“&#x2F;home”，这样就可以保留“&#x2F;home”中的数据了。使用的时候就挂载就行</p>
<p>但是假如一开始没分区:</p>
<ol>
<li>可以插块新盘当作系统盘，系统安装好之后，把旧的文件系统挂载到新系统的某个目录下</li>
<li>从旧的文件系统里划出一块区域，安装新系统。<ol>
<li>在你要安装的目标磁盘中，通过删除卷和删除分区操作腾出一块未分配的磁盘空间作为安装区</li>
</ol>
</li>
</ol>
<h2 id="从已有分区中提取空间"><a href="#从已有分区中提取空间" class="headerlink" title="从已有分区中提取空间"></a>从已有分区中提取空间</h2><p>xfs类型不可以直接缩减，只扩不减。如果是ext2，ext3，ext4可以在线缩减，如果xfs盘要缩小就要删除后重新添加</p>
<p><a target="_blank" rel="noopener" href="https://www.ywbj.cc/?p=712">https://www.ywbj.cc/?p=712</a></p>
<h3 id="非系统根分区LVM缩容"><a href="#非系统根分区LVM缩容" class="headerlink" title="非系统根分区LVM缩容"></a>非系统根分区LVM缩容</h3><ol>
<li>取消挂载<br>系统根分区无法在线取消挂载，所以这时请勿对系统根分区执行任何缩容操作   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /lv/ #取消挂载目录</span><br></pre></td></tr></table></figure></li>
<li>e2fsck检查修复磁盘完整性   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2fsck -f /dev/vg0/lv0</span><br></pre></td></tr></table></figure></li>
<li>缩小系统文件空间，即<code>df -h</code>查看的空间<br>不取消挂载，这步会报错，注：一定先减文件系统，再减逻辑卷   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs /dev/vg0/lv0 10G</span><br></pre></td></tr></table></figure></li>
<li>缩小磁盘空间，即lsblk查看的空间<br>不执行上面的操作，直接执行这步，虽然成功，但是会操作数据丢失，系统无法启动。   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvreduce -L 10G /dev/vg0/lv0</span><br></pre></td></tr></table></figure></li>
<li>重新挂载   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br></pre></td></tr></table></figure>
最后查看lvs空间</li>
</ol>
<h3 id="系统根分区LVM缩容（救援模式）"><a href="#系统根分区LVM缩容（救援模式）" class="headerlink" title="系统根分区LVM缩容（救援模式）"></a>系统根分区LVM缩容（救援模式）</h3><p>正常启动系统进入救援模式 ：启动按shift键，出现选择系统界面，按e。找到以单词 linux 开头的行，并在该行的末尾添加以下内容（要到达末尾，只需按下 CTRL+e 或使用 END 键或左右箭头键）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd.unit=rescue.target</span><br></pre></td></tr></table></figure>
<p>添加完成后，只需按下 <code>CTRL+x</code> 或 <code>F10</code> 即可继续启动救援模式。几秒钟后，你将以 root 用户身份进入救援模式（单用户模式）<br><img src="https://pic.shaojiemike.top/img/20220902182623.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40018873/article/details/109537532">https://blog.csdn.net/weixin_40018873/article/details/109537532</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ywbj.cc/?p=712">https://www.ywbj.cc/?p=712</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.629Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a few seconds read (About 98 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/OutOfWork/3-homepage/SSL/3-QiNiuSSL/">QiNiuSSL</a></p><div class="content"><h2 id="SSL证书的几种申请"><a href="#SSL证书的几种申请" class="headerlink" title="SSL证书的几种申请"></a>SSL证书的几种申请</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate">七牛免费证书</a><br><img src="http://pic.shaojiemike.top/PicGo20210712100907.png"><br><img src="http://pic.shaojiemike.top/PicGo20210712101204.png"></li>
<li>chivier自动更新免费脚本 </li>
<li>GitHub 教育优惠免费一年ssl证书</li>
</ol>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p> <a target="_blank" rel="noopener" href="https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate">https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.641Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">5 minutes read (About 753 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/HPC/MPI_OMP/MPICompilers/">MPI Compilers</a></p><div class="content"><h2 id="mpicc-vs-gcc"><a href="#mpicc-vs-gcc" class="headerlink" title="mpicc vs gcc"></a>mpicc vs gcc</h2><h3 id="OpenMPI"><a href="#OpenMPI" class="headerlink" title="OpenMPI"></a>OpenMPI</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shaojiemike @ node5 <span class="keyword">in</span> ~ [7:20:31]</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mpicc -showme</span></span><br><span class="line">gcc -I/usr/lib/x86_64-linux-gnu/openmpi/include/openmpi -I/usr/lib/x86_64-linux-gnu/openmpi/include -pthread -L/usr/lib/x86_64-linux-gnu/openmpi/lib -lmpi</span><br></pre></td></tr></table></figure>
<h3 id="IntelMPI"><a href="#IntelMPI" class="headerlink" title="IntelMPI"></a>IntelMPI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">source /opt/intel/oneapi/setvars.sh</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:45:06] C:1</span><br><span class="line">$ mpicc -compile_info</span><br><span class="line">gcc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -lrt -lpthread -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -Xlinker --enable-new-dtags -ldl</span><br><span class="line"></span><br><span class="line">&gt; mpicc -v                  </span><br><span class="line">mpigcc for the Intel(R) MPI Library 2021.5 for Linux*                                                                      </span><br><span class="line">Copyright Intel Corporation.</span><br><span class="line">Using built-in specs.       </span><br><span class="line">COLLECT_GCC=gcc             </span><br><span class="line">COLLECT_LTO_WRAPPER=/public1/soft/gcc/8.1.0/libexec/gcc/x86_64-pc-linux-gnu/8.1.0/lto-wrapper                              </span><br><span class="line">Target: x86_64-pc-linux-gnu </span><br><span class="line">Configured with: ./configure --prefix=/public1/soft/gcc/8.1.0 --enable-languages=c,c++,fortran --disable-multilib          </span><br><span class="line">Thread model: posix         </span><br><span class="line">gcc version 8.1.0 (GCC) </span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:45:16]</span><br><span class="line">$ mpiicc -compile_info</span><br><span class="line">icc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -ldl -lrt -lpthread</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:50:09] C:255</span><br><span class="line">$ mpiicc -show</span><br><span class="line">icc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -ldl -lrt -lpthread</span><br></pre></td></tr></table></figure>

<h3 id="MPICH"><a href="#MPICH" class="headerlink" title="MPICH"></a>MPICH</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/github/IPCC2022-preliminary/run (float_trick*) [10:49:48]</span><br><span class="line">&gt; mpicc -show         </span><br><span class="line">gcc -I/public1/soft/mpich/3.1.4-gcc8.1.0/include -L/public1/soft/mpich/3.1.4-gcc8.1.0/lib -Wl,-rpath -Wl,/public1/soft/mpich/3.1.4-gcc8.1.0/lib -Wl,--enable-new-dtags -lmpi</span><br></pre></td></tr></table></figure>
<p>For MPICH, according to the mpicc man pages, <strong>mpicc -compile_info</strong> shows the flags for compiling a program, and <strong>mpicc -link_info</strong> shows the flags for linking a program.</p>
<p><strong>-showme</strong> (Open MPI) or <strong>-show</strong> (Open MPI, MPICH and derivates) use <strong>-showme:compile</strong> and <strong>-showme:link</strong> to obtain the options automatically</p>
<h2 id="安装选项查看"><a href="#安装选项查看" class="headerlink" title="安装选项查看"></a>安装选项查看</h2><h3 id="intelmpi"><a href="#intelmpi" class="headerlink" title="intelmpi"></a>intelmpi</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; mpirun -info</span><br><span class="line">HYDRA build details:</span><br><span class="line">    Version:                                 2021.5</span><br><span class="line">    Release Date:                            20211102 (id: 9279b7d62)</span><br><span class="line">    Process Manager:                         pmi</span><br><span class="line">    Bootstrap servers available:             ssh slurm rsh ll sge pbs pbsdsh pdsh srun lsf blaunch qrsh fork</span><br><span class="line">    Resource management kernels available:   slurm ll lsf sge pbs cobalt</span><br></pre></td></tr></table></figure>
<h3 id="MPICH-1"><a href="#MPICH-1" class="headerlink" title="MPICH"></a>MPICH</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~  [11:55:08]</span><br><span class="line">&gt; mpiexec --version               </span><br><span class="line">HYDRA build details:</span><br><span class="line">    Version:                                 3.1.4</span><br><span class="line">    Release Date:                            Fri Feb 20 15:02:56 CST 2015</span><br><span class="line">    CC:                              gcc    </span><br><span class="line">    CXX:                             g++    </span><br><span class="line">    F77:                             gfortran   </span><br><span class="line">    F90:                             gfortran   </span><br><span class="line">    Configure options:                       &#x27;--disable-option-checking&#x27; &#x27;--prefix=/public1/soft/mpich/3.1.4-gcc8.1.0&#x27; &#x27;CC=gcc&#x27; &#x27;CXX=g++&#x27; &#x27;FC=gfortran&#x27; &#x27;--cache-file=/dev/null&#x27; &#x27;--srcdir=.&#x27; &#x27;CFLAGS= -O2&#x27; &#x27;LDFLAGS= &#x27; &#x27;LIBS=-lpthread &#x27; &#x27;CPPFLAGS= -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpl/include -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpl/include -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/openpa/src -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/openpa/src -D_REENTRANT -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpi/romio/include&#x27;</span><br><span class="line">    Process Manager:                         pmi</span><br><span class="line">    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist</span><br><span class="line">    Topology libraries available:            hwloc</span><br><span class="line">    Resource management kernels available:   user slurm ll lsf sge pbs cobalt</span><br><span class="line">    Checkpointing libraries available:       </span><br><span class="line">    Demux engines available:                 poll select</span><br><span class="line"></span><br><span class="line">ipcc22_0029@ln121 ~  [11:55:31]</span><br><span class="line">&gt; mpichversion</span><br><span class="line">MPICH Version:          3.1.4</span><br><span class="line">MPICH Release date:     Fri Feb 20 15:02:56 CST 2015</span><br><span class="line">MPICH Device:           ch3:nemesis</span><br><span class="line">MPICH configure:        --prefix=/public1/soft/mpich/3.1.4-gcc8.1.0/ CC=gcc CXX=g++ FC=gfortran</span><br><span class="line">MPICH CC:       gcc    -O2</span><br><span class="line">MPICH CXX:      g++   -O2</span><br><span class="line">MPICH F77:      gfortran   -O2</span><br><span class="line">MPICH FC:       gfortran   -O2</span><br></pre></td></tr></table></figure>
<h3 id="OpenMPI-1"><a href="#OpenMPI-1" class="headerlink" title="OpenMPI"></a>OpenMPI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">## 安装了IB支持</span><br><span class="line">&gt; ompi_info | grep openib</span><br><span class="line">                 MCA btl: openib (MCA v2.1.0, API v3.0.0, Component v3.1.6)</span><br><span class="line"></span><br><span class="line">&gt; mpiexec --version      </span><br><span class="line">mpiexec (OpenRTE) 4.1.1</span><br><span class="line"></span><br><span class="line">Report bugs to http://www.open-mpi.org/community/help/</span><br><span class="line"></span><br><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [12:24:19]</span><br><span class="line">&gt; module load mpi/openmpi/4.1.1-gcc7.3.0 </span><br><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [12:24:51]</span><br><span class="line">&gt; mpicc -v                              </span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=/public1/soft/gcc/7.3.0/bin/gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/public1/soft/gcc/7.3.0/libexec/gcc/x86_64-pc-linux-gnu/7.3.0/lto-wrapper</span><br><span class="line">Target: x86_64-pc-linux-gnu</span><br><span class="line">Configured with: ./configure --prefix=/public1/soft/gcc/7.3.0 --disable-multilib</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 7.3.0 (GCC) </span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11312719/how-to-compile-mpi-with-gcc">https://stackoverflow.com/questions/11312719/how-to-compile-mpi-with-gcc</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.641Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">4 minutes read (About 537 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/HPC/MPI_OMP/MPI_InitSlowReason/">Why MPI_Init is slow</a></p><div class="content"><h2 id="MPI-Init的作用"><a href="#MPI-Init的作用" class="headerlink" title="MPI_Init的作用"></a>MPI_Init的作用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Init(&amp;argc, &amp;argv);</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11691870/what-happens-to-memory-after-i-call-mpi-init">StackOverflow的回答</a>是,Init在调用过程中初始化MPI库,并且在进程间建立通讯和编号。</p>
<p>知乎的回答: OpenMPI会在调用MPI_Init时按照你<strong>传递给mpirun的指令新建进程</strong>，而你传递给MPI_Init的参数，会被传递给新建的进程。</p>
<p>这似乎在暗示，两个进程不是同时产生和运行的。</p>
<h3 id="猜想1"><a href="#猜想1" class="headerlink" title="猜想1"></a>猜想1</h3><p>有顺序的观点是不成立的<br><img src="https://pic.shaojiemike.top/img/20220816231254.png"></p>
<p>即使有顺序 malloc的时间也没这么长。</p>
<h3 id="猜想2"><a href="#猜想2" class="headerlink" title="猜想2"></a>猜想2</h3><p>难道是malloc的数据需要MPI_Init复制一遍？</p>
<p>简单将MPI_Init提前到最开始，时间也基本没变，也不对。</p>
<p><img src="https://pic.shaojiemike.top/img/20220816231909.png"></p>
<p>如果单独写一个只有MPI_Init的程序,IntelMPI还是要耗时800ms</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [11:42:32]</span><br><span class="line">&gt; srun -p IPCC -N 2 -n 2 -c 64 -t 1  MPI</span><br><span class="line">MPIInit          took 882.110047 ms</span><br><span class="line">MPIInit          took 892.112269 ms</span><br></pre></td></tr></table></figure>

<h2 id="测试比较超算上MPI-Init的时间"><a href="#测试比较超算上MPI-Init的时间" class="headerlink" title="测试比较超算上MPI_Init的时间"></a>测试比较超算上MPI_Init的时间</h2><p>以IPCC2022初赛的北京超算云 AMD机器举例</p>
<table>
<thead>
<tr>
<th>mpirun的选择</th>
<th>mpi版本</th>
<th>GCC或者ICC的选择版本</th>
<th>超算运行</th>
<th>MPI_Init时间(ms)</th>
</tr>
</thead>
<tbody><tr>
<td>IntelMPI</td>
<td>mpi&#x2F;intel&#x2F;2022.1</td>
<td>gcc&#x2F;10.2.0</td>
<td>只能sbatch,不能srun</td>
<td>1282.24 ~ 1678.59</td>
</tr>
<tr>
<td>OpenMPI</td>
<td>mpi&#x2F;openmpi&#x2F;4.1.1-gcc7.3.0</td>
<td></td>
<td></td>
<td>2706ms~3235ms</td>
</tr>
<tr>
<td>MPICH</td>
<td>mpich&#x2F;3.1.4-gcc8.1.0</td>
<td></td>
<td></td>
<td>17ms</td>
</tr>
<tr>
<td></td>
<td>mpich&#x2F;3.4.2</td>
<td>gcc&#x2F;10.2.0</td>
<td></td>
<td>107ms</td>
</tr>
</tbody></table>
<h3 id="不能srun-IntelMPI的问题"><a href="#不能srun-IntelMPI的问题" class="headerlink" title="不能srun IntelMPI的问题"></a>不能srun IntelMPI的问题</h3><p><a target="_blank" rel="noopener" href="https://github.com/hpc-unibe-ch/ubelix-easyconfigs/issues/16">缺少一个环境变量</a></p>
<p>需要<code>export I_MPI_PMI_LIBRARY=libpmi2.so</code></p>
<h2 id="VTune-分析MPI的程序"><a href="#VTune-分析MPI的程序" class="headerlink" title="VTune 分析MPI的程序"></a>VTune 分析MPI的程序</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/vtune-help/top/analyze-performance/code-profiling-scenarios/mpi-code-analysis.html">https://www.intel.com/content/www/us/en/develop/documentation/vtune-help/top/analyze-performance/code-profiling-scenarios/mpi-code-analysis.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/vtune-cookbook/top/configuration-recipes/profiling-mpi-applications.html">https://www.intel.com/content/www/us/en/develop/documentation/vtune-cookbook/top/configuration-recipes/profiling-mpi-applications.html</a></p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>设置这个Intel mpi 1200 -&gt; 1100</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PMI_TIME=1</span><br><span class="line">export SLURM_PMI_KVS_NO_DUP_KEYS=yes</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>实在是弄不懂，为什么不同的实现，时间差别这么大。可能慢是因为额外的通路设置，是为了之后的快速传输？？</p>
<p>3.1.4的安装选项也看不到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mpiexec --version     </span><br><span class="line">mpiexec: error while loading shared libraries: libslurm.so.35: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T03:18:15.000Z" title="8/16/2022, 3:18:15 AM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.645Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">2 minutes read (About 339 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/Programming/1-env/c/oneapi/">oneApi</a></p><div class="content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/installation/install-with-command-line.html#install-with-command-line">命令行安装</a></p>
<h3 id="Intel-OneAPI-base-toolkit"><a href="#Intel-OneAPI-base-toolkit" class="headerlink" title="Intel OneAPI base toolkit"></a>Intel OneAPI base toolkit</h3><p>必须先安装base，可以看到默认安装的内容</p>
<p><img src="https://pic.shaojiemike.top/img/20220816113819.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220816113912.png"></p>
<p>这个<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/debugging-dpcpp-linux/top.html">GDB</a>好像可以分析多进程</p>
<p><img src="https://pic.shaojiemike.top/img/20220816114248.png"></p>
<h3 id="Intel-OneAPI-HPC-toolkit"><a href="#Intel-OneAPI-HPC-toolkit" class="headerlink" title="Intel OneAPI HPC toolkit"></a>Intel OneAPI HPC toolkit</h3><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit.html">Intel OneAPI HPC toolkit</a>包括了icc,icpc,ifort和OpenMP,IntelMPI还有MKL(Intel® oneAPI Math Kernel Library (oneMKL))</p>
<p>在<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html">Download界面选择版本</a>, 选择online或者offline会有推荐指令,如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18679/l_HPCKit_p_2022.2.0.191.sh</span><br><span class="line"></span><br><span class="line">sudo sh ./l_HPCKit_p_2022.2.0.191.sh</span><br></pre></td></tr></table></figure>
<h2 id="icx-icpx"><a href="#icx-icpx" class="headerlink" title="icx icpx"></a>icx icpx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; icx -v</span><br><span class="line">Intel(R) oneAPI DPC++/C++ Compiler 2022.0.0 (2022.0.0.20211123)</span><br><span class="line">Target: x86_64-unknown-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /opt/intel/oneapi/compiler/2022.0.2/linux/bin-llvm</span><br><span class="line">Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/8</span><br><span class="line">Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9</span><br><span class="line">Selected GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9</span><br><span class="line">Candidate multilib: .;@m64</span><br><span class="line">Selected multilib: .;@m64</span><br><span class="line">Found CUDA installation: /usr/local/cuda-11.5, version</span><br><span class="line"></span><br><span class="line">&gt; icpx --help</span><br><span class="line">OVERVIEW: Intel(R) oneAPI DPC++/C++ Compiler</span><br><span class="line"></span><br><span class="line">USAGE: clang++ [options] file...</span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/prerequisites/install-intel-gpu-drivers.html">https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/prerequisites/install-intel-gpu-drivers.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-15T12:35:22.000Z" title="8/15/2022, 12:35:22 PM">2022-08-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.645Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">17 minutes read (About 2592 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/15/Work/Programming/2.1-Assembly/assemblyInline/">Inline Assembly</a></p><div class="content"><h2 id="GCC内联汇编"><a href="#GCC内联汇编" class="headerlink" title="GCC内联汇编"></a>GCC内联汇编</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__asm__　__volatile__(&quot;Instruction List&quot; : Output : Input : Clobber/Modify);</span><br></pre></td></tr></table></figure>

<ol>
<li><code>__asm__</code>或asm 用来声明一个内联汇编表达式，所以任何一个内联汇编表达式都是以它开头的，是必不可少的。</li>
<li><code>__volatile__</code>或volatile 是可选的。如果用了它，则是向GCC 声明不允许对该内联汇编优化，否则当 使用了优化选项(-O)进行编译时，GCC 将会根据自己的判断决定是否将这个内联汇编表达式中的指令优化掉。</li>
<li>Instruction List 是汇编指令序列。它可以是空的，比如：<code>__asm__ __volatile__(&quot;&quot;)</code>; 或 <code>__asm__ (&quot;&quot;)</code>;都是完全合法的内联汇编表达式，只不过这两条语句没有什么意义。<ol>
<li>但并非所有Instruction List 为空的内联汇编表达式都是没有意义的，比如：<code>__asm__ (&quot;&quot;:::&quot;memory&quot;)</code>;就非常有意义，它向GCC 声明：“内存作了改动”，GCC 在编译的时候，会将此因素考虑进去。</li>
<li>当在”Instruction List”中有多条指令的时候，需要用分号（；）或换行符（\n）将它们分开。</li>
<li>指令中的操作数可以使用占位符引用C语言变量,<strong>操作数占位符</strong>最多10个,名称如下:<code>%0,%1,…,%9</code>。指令中使用占位符表示的操作数,总被视为long型(4个字节),<ol>
<li>但对其施加的操作根据指令可以是字或者字节,当把操作数当作字或者字节使用时,<strong>默认为低字或者低字节</strong>。</li>
<li>对字节操作可以显式的<strong>指明是低字节还是次字节</strong>。方法是在%和序号之间插入一个字母,”b”代表低字节,”h”代表高字节,例如:<code>%h1</code>。</li>
</ol>
</li>
</ol>
</li>
<li>Output&#x2F;Input <ol>
<li>格式为形如<code>&quot;constraint&quot;(variable)</code>的列表（逗号分隔)。按照出现的顺序分别与指令操作数”%0”，”%1”对应</li>
<li>每个输出操作数的限定字符串必须包含”&#x3D;”表示他是一个输出操作数。例子<code>&quot;=r&quot; (value)</code></li>
</ol>
</li>
<li>Clobber&#x2F;Modify(由逗号格开的字符串组成)<ol>
<li>在Input&#x2F;Output操作表达式所指定的寄存器，或当你为一些Input&#x2F;Output操作表达式使用”r”约束，让GCC为你选择一个寄存器时，GCC知道这些寄存器是被修改的，你根本不需要在Clobber&#x2F;Modify域再声明它们。</li>
<li>但是对于”Instruction List”中的临时寄存器，需要在Clobber&#x2F;Modify域声明这些寄存器或内存，让GCC知道修改了他们<ol>
<li>例子:<code>__asm__ (&quot;mov R0, #0x34&quot; : : : &quot;R0&quot;);</code>寄存器R0出现在”Instruction List中”，并且被mov指令修改，但却未被任何Input&#x2F;Output操作表达式指定，所以你需要在Clobber&#x2F;Modify域指定”R0”，以让GCC知道这一点。</li>
</ol>
</li>
<li>Clobber&#x2F;Modify域存在”memory”，那么GCC会保证在此内联汇编之前，如果某个内存的内容被装入了寄存器，那么在这个内联汇编之后，如果需要使用这个内存处的内容，就会<strong>直接到这个内存处重新读取，而不是使用被存放在寄存器中的拷贝</strong>。因为这个 时候寄存器中的拷贝已经很可能和内存处的内容不一致了。</li>
</ol>
</li>
</ol>
<h2 id="输入输出与指令的对应关系"><a href="#输入输出与指令的对应关系" class="headerlink" title="输入输出与指令的对应关系"></a>输入输出与指令的对应关系</h2><h3 id="寄存器约束符Operation-Constraint"><a href="#寄存器约束符Operation-Constraint" class="headerlink" title="寄存器约束符Operation Constraint"></a>寄存器约束符Operation Constraint</h3><p>每一个Input和Output表达式都必须指定自己的操作约束Operation Constraint，这里将讨论在80386平台上所可能使用的操作约束。</p>
<p>当前的输入或输出需要借助一个寄存器时，需要为其指定一个寄存器约束，可以直接指定一个寄存器的名字。</p>
<p>常用的寄存器约束的缩写 </p>
<table>
<thead>
<tr>
<th>约束</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>表示使用一个通用寄存器，由 GCC  在%eax&#x2F;%ax&#x2F;%al,%ebx&#x2F;%bx&#x2F;%bl,%ecx&#x2F;%cx&#x2F;%cl,%edx&#x2F;%dx&#x2F;%dl中选取一个GCC认为合适的。</td>
</tr>
<tr>
<td>g</td>
<td>表示使用任意一个寄存器，由GCC在所有的可以使用的寄存器中选取一个GCC认为合适的。</td>
</tr>
<tr>
<td>q</td>
<td>表示使用一个通用寄存器，和约束r的意义相同。</td>
</tr>
<tr>
<td>a</td>
<td>表示使用%eax&#x2F;%ax&#x2F;%al</td>
</tr>
<tr>
<td>b</td>
<td>表示使用%ebx&#x2F;%bx&#x2F;%bl</td>
</tr>
<tr>
<td>c</td>
<td>表示使用%ecx&#x2F;%cx&#x2F;%cl</td>
</tr>
<tr>
<td>d</td>
<td>表示使用%edx&#x2F;%dx&#x2F;%dl</td>
</tr>
<tr>
<td>D</td>
<td>表示使用%edi&#x2F;%di</td>
</tr>
<tr>
<td>S</td>
<td>表示使用%esi&#x2F;%si</td>
</tr>
<tr>
<td>f</td>
<td>表示使用浮点寄存器</td>
</tr>
<tr>
<td>t</td>
<td>表示使用第一个浮点寄存器</td>
</tr>
<tr>
<td>u</td>
<td>表示使用第二个浮点寄存器</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>分类</th>
<th>限定符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>通用寄存器</td>
<td>“a”</td>
<td>将输入变量放入eax 这里有一个问题:假设eax已经被使用,那怎么办?其实很简单:因为GCC 知道eax 已经被使用,它在这段汇编代码的起始处插入一条语句pushl %eax,将eax 内容保存到堆栈,然 后在这段代码结束处再增加一条语句popl %eax,恢复eax的内容</td>
</tr>
<tr>
<td></td>
<td>“b”</td>
<td>将输入变量放入ebx</td>
</tr>
<tr>
<td></td>
<td>“c”</td>
<td>将输入变量放入ecx</td>
</tr>
<tr>
<td></td>
<td>“d”</td>
<td>将输入变量放入edx</td>
</tr>
<tr>
<td></td>
<td>“s”</td>
<td>将输入变量放入esi</td>
</tr>
<tr>
<td></td>
<td>“d”</td>
<td>将输入变量放入edi</td>
</tr>
<tr>
<td></td>
<td>“q”</td>
<td>将输入变量放入eax,ebx,ecx,edx中的一个</td>
</tr>
<tr>
<td></td>
<td>“r”</td>
<td>将输入变量放入通用寄存器,也就是eax,ebx,ecx,edx,esi,edi中的一个</td>
</tr>
<tr>
<td></td>
<td>“A”</td>
<td>把eax和edx合成一个64 位的寄存器(use long longs)</td>
</tr>
<tr>
<td>内存</td>
<td>“m”</td>
<td>内存变量</td>
</tr>
<tr>
<td></td>
<td>“o”</td>
<td>操作数为内存变量,但是其寻址方式是偏移量类型, 也即是基址寻址,或者是基址加变址寻址</td>
</tr>
<tr>
<td></td>
<td>“V”</td>
<td>操作数为内存变量,但寻址方式不是偏移量类型</td>
</tr>
<tr>
<td></td>
<td>“ “</td>
<td>操作数为内存变量,但寻址方式为自动增量</td>
</tr>
<tr>
<td></td>
<td>“p”</td>
<td>操作数是一个合法的内存地址(指针)</td>
</tr>
<tr>
<td>寄存器或内存</td>
<td>“g”</td>
<td>将输入变量放入eax,ebx,ecx,edx中的一个 或者作为内存变量</td>
</tr>
<tr>
<td></td>
<td>“X”</td>
<td>操作数可以是任何类型</td>
</tr>
<tr>
<td>立即数</td>
<td>“I”</td>
<td>0-31之间的立即数(用于32位移位指令)</td>
</tr>
<tr>
<td></td>
<td>“J”</td>
<td>0-63之间的立即数(用于64位移位指令)</td>
</tr>
<tr>
<td></td>
<td>“N”</td>
<td>0-255之间的立即数(用于out指令)</td>
</tr>
<tr>
<td></td>
<td>“i”</td>
<td>立即数</td>
</tr>
<tr>
<td></td>
<td>“n”</td>
<td>立即数,有些系统不支持除字以外的立即数, 这些系统应该使用”n”而不是”i”</td>
</tr>
<tr>
<td>匹配</td>
<td>“ 0 “,“1” …“9”</td>
<td>,	表示用它限制的操作数与某个指定的操作数匹配,也即该操作数就是指定的那个操作数,例如”0”去描述”%1”操作数,那么”%1”引用的其实就是”%0”操作数,注意作为限定符字母的0-9 与 指令中的”%0”-“%9”的区别,前者描述操作数,后者代表操作数。</td>
</tr>
<tr>
<td></td>
<td>&amp;;</td>
<td>该输出操作数不能使用过和输入操作数相同的寄存器</td>
</tr>
<tr>
<td>操作数类型</td>
<td>“&#x3D;”</td>
<td>操作数在指令中是只写的(输出操作数)</td>
</tr>
<tr>
<td></td>
<td>“+”</td>
<td>操作数在指令中是读写类型的(输入输出操作数)</td>
</tr>
<tr>
<td>浮点数</td>
<td>“f”</td>
<td>浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“t”</td>
<td>第一个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“u”</td>
<td>第二个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“G”</td>
<td>标准的80387浮点常数</td>
</tr>
<tr>
<td></td>
<td>%</td>
<td>该操作数可以和下一个操作数交换位置.例如addl的两个操作数可以交换顺序 (当然两个操作数都不能是立即数)</td>
</tr>
<tr>
<td></td>
<td>#</td>
<td>部分注释,从该字符到其后的逗号之间所有字母被忽略</td>
</tr>
<tr>
<td></td>
<td>*</td>
<td>表示如果选用寄存器,则其后的字母被忽略</td>
</tr>
</tbody></table>
<h3 id="内存约束"><a href="#内存约束" class="headerlink" title="内存约束"></a>内存约束</h3><p>如果一个Input&#x2F;Output  操作表达式的C&#x2F;C++表达式表现为一个内存地址，不想借助于任何寄存器，则可以使用内存约束。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__asm__(&quot;lidt%0&quot;:&quot;=m&quot;(__idt_addr));</span><br><span class="line">__asm__(&quot;lidt%0&quot;::&quot;m&quot;(__idt_addr));</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>修饰符</th>
<th>输入&#x2F;输出</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>O</td>
<td>表示此Output操作表达式是Write-Only的。</td>
</tr>
</tbody></table>
<ul>
<li><pre><code>           | O               |表示此Output操作表达式是Read-Write的。
</code></pre>
</li>
</ul>
<p>&amp;                | O               |表示此Output操作表达式独占为其指定的寄存器。<br>%               | I                 |表示此Input  操作表达式中的C&#x2F;C++表达式可以和下一 个Input操作表达式中的C&#x2F;C++表达式互换</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Static __inline__ void __set_bit(int nr, volatile void * addr)</span><br><span class="line">&#123;</span><br><span class="line">         __asm__(</span><br><span class="line">                         &quot;btsl %1,%0&quot;</span><br><span class="line">                         :&quot;=m&quot; (ADDR)</span><br><span class="line">                         :&quot;Ir&quot; (nr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个占位符%0与C 语言变量ADDR对应,第二个占位符%1与C语言变量nr对应。因此上面的汇编语句代码与下面的伪代码等价:btsl nr, ADDR</p>
<h2 id="Clobber-Modify域存在”memory”的其他影响"><a href="#Clobber-Modify域存在”memory”的其他影响" class="headerlink" title="Clobber&#x2F;Modify域存在”memory”的其他影响"></a>Clobber&#x2F;Modify域存在”memory”的其他影响</h2><p>使用”memory”是向GCC声明内存发生了变化，而内存发生变化带来的影响并不止这一点。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int main(int __argc, char* __argv[]) </span><br><span class="line">&#123; </span><br><span class="line">    int* __p = (int*)__argc; </span><br><span class="line">    (*__p) = 9999; </span><br><span class="line">    __asm__(&quot;&quot;:::&quot;memory&quot;); </span><br><span class="line">    if((*__p) == 9999) </span><br><span class="line">        return 5; </span><br><span class="line">    return (*__p); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本例中，如果没有那条内联汇编语句，那个if语句的判断条件就完全是一句废话。GCC在优化时会意识到这一点，而直接只生成return 5的汇编代码，而不会再生成if语句的相关代码，而不会生成return (*__p)的相关代码。</p>
<p>但你加上了这条内联汇编语句，它除了声明内存变化之外，什么都没有做。</p>
<p>但GCC此时就不能简单的认为它不需要判断都知道 (*__p)一定与9999相等，它只有老老实实生成这条if语句的汇编代码，一起相关的两个return语句相关代码。</p>
<p>另外在linux内核中内存屏障也是基于它实现的include&#x2F;asm&#x2F;system.h中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># define barrier() _asm__volatile_(&quot;&quot;: : :&quot;memory&quot;)</span><br></pre></td></tr></table></figure>
<p>主要是保证程序的执行遵循顺序一致性。呵呵，有的时候你写代码的顺序，不一定是终执行的顺序，这个是处理器有关的。</p>
<h2 id="Linux-源码例子"><a href="#Linux-源码例子" class="headerlink" title="Linux 源码例子"></a>Linux 源码例子</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static inline char * strcpy(char * dest, const char *src)</span><br><span class="line">&#123;</span><br><span class="line">	char *xdest = dest;</span><br><span class="line">	__asm__ __volatile__</span><br><span class="line">	(&quot;1: \tmoeb %1@+, %0@+\n\t&quot;   &quot;jne 1b&quot;  //这个冒号不是分隔符</span><br><span class="line">	: &quot;=a&quot; (dest) , &quot;=a&quot; (stc)</span><br><span class="line">	: &quot;0&quot;(dest), &quot;1&quot; (src)</span><br><span class="line">	 : &quot;memory&quot;);</span><br><span class="line">	return xdest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yi412/article/details/80846083">https://blog.csdn.net/yi412/article/details/80846083</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/elnino/p/4313340.html">https://www.cnblogs.com/elnino/p/4313340.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-13T16:00:00.000Z" title="8/13/2022, 4:00:00 PM">2022-08-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.653Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">2 minutes read (About 355 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/13/Work/software/linux-apps/tarZipRar/">Tar Zip Rar</a></p><div class="content"><h2 id="各种指令的对比"><a href="#各种指令的对比" class="headerlink" title="各种指令的对比"></a>各种指令的对比</h2><table>
<thead>
<tr>
<th>命令</th>
<th>压缩空间效果</th>
<th>压缩时间效果</th>
<th>解压时间</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>tar -cf</td>
<td>2.9G</td>
<td>13.8s</td>
<td>3.3s</td>
<td><code>tar -cf archive.tar foo</code>归档文件，没有压缩功能</td>
</tr>
<tr>
<td>tar -zcf</td>
<td>823M</td>
<td>1:44</td>
<td>19s</td>
<td><code>tar -zcf archive.tar.gz foo</code>归档并使用gzip压缩文件，gzip是zip的GNU实现，是最老的公开压缩方法</td>
</tr>
<tr>
<td>zip -1r</td>
<td>856M</td>
<td>48.6s</td>
<td>23.3s</td>
<td><code>zip -1qr intel.zip intel</code>, <code>-1</code> compress faster，<code>unzip</code>解压</td>
</tr>
<tr>
<td>zip -9r</td>
<td>824M</td>
<td>11:19</td>
<td>24s</td>
<td>压缩这也太慢了吧</td>
</tr>
<tr>
<td>rar a</td>
<td>683M</td>
<td>2:02</td>
<td>46s</td>
<td><code>unrar x</code>解压</td>
</tr>
</tbody></table>
<p>上述测试基于大小3GB的文件夹</p>
<h2 id="关于rar"><a href="#关于rar" class="headerlink" title="关于rar"></a>关于rar</h2><p>虽然说好像有<a target="_blank" rel="noopener" href="https://www.rarlab.com/download.htm">专利的软件</a>，但是<code>sudo apt install rar</code>貌似就可以安装。但是空间效果确实还行多压1&#x2F;3,但是时间要多两倍。</p>
<h2 id="还是建议tar-gz"><a href="#还是建议tar-gz" class="headerlink" title="还是建议tar.gz"></a>还是建议tar.gz</h2><p>因为 7z 和 zip 压缩格式都不能保留 unix 风格的文件权限，比如解压出个<strong>可执行文件</strong>要重新 chmod chown 才能恢复正常。而 tar 格式可以。而 tar 本身不提供压缩，无非就是把包括所有文件的內容和权限拼成一个文件而己，所以用另外如 gzip 格式压缩。为什么是 gzip，因为几乎所有 linux 都支持而已。</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-13T16:00:00.000Z" title="8/13/2022, 4:00:00 PM">2022-08-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.657Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">15 minutes read (About 2203 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/13/Work/software/perf/vtuneAssembly/">Vtune Assembly Analysis</a></p><div class="content"><h2 id="超算机器用vtune的命令行文件分析"><a href="#超算机器用vtune的命令行文件分析" class="headerlink" title="超算机器用vtune的命令行文件分析"></a>超算机器用vtune的命令行文件分析</h2><ol>
<li><p>首先找到vtune程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; module load intel/2022.1                                    </span><br><span class="line">&gt; <span class="built_in">which</span> icc                                                        </span><br><span class="line">/public1/soft/oneAPI/2022.1/compiler/latest/linux/bin/intel64/icc                          </span><br><span class="line">&gt; <span class="built_in">cd</span> /public1/soft/oneAPI/2022.1  </span><br><span class="line">&gt; find . -executable -<span class="built_in">type</span> f -name <span class="string">&quot;*vtune*&quot;</span></span><br><span class="line">./vtune/2022.0.0/bin64/vtune-worker-crash-reporter</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-gui.desktop</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-gui</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-agent</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-self-checker.sh</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-backend</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-worker</span><br><span class="line">./vtune/2022.0.0/bin64/vtune</span><br><span class="line">./vtune/2022.0.0/bin64/vtune-set-perf-caps.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>vtune-gui</code>获取可执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/intel/oneapi/vtune/2021.1.1/bin64/vtune -collect hotspots -knob enable-stack-collection=<span class="literal">true</span> -knob stack-size=4096 -data-limit=1024000 -app-working-dir /home/shaojiemike/github/IPCC2022first/build/bin -- /home/shaojiemike/github/IPCC2022first/build/bin/pivot /home/shaojiemike/github/IPCC2022first/src/uniformvector-2dim-5h.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写<code>sbatch_vtune.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#SBATCH -o ./slurmlog/job_%j_rank%t_%N_%n.out</span></span><br><span class="line"><span class="comment">#SBATCH -p IPCC</span></span><br><span class="line"><span class="comment">#SBATCH -t 15:00</span></span><br><span class="line"><span class="comment">#SBATCH --nodes=1</span></span><br><span class="line"><span class="comment">#SBATCH --exclude=</span></span><br><span class="line"><span class="comment">#SBATCH --cpus-per-task=64</span></span><br><span class="line"><span class="comment">#SBATCH --mail-type=FAIL</span></span><br><span class="line"><span class="comment">#SBATCH --mail-user=ta1ly@mail.ustc.edu.cn</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /public1/soft/modules/module.sh</span><br><span class="line">module purge</span><br><span class="line"></span><br><span class="line">module load intel/2022.1</span><br><span class="line"></span><br><span class="line"><span class="built_in">logname</span>=vtune</span><br><span class="line"><span class="built_in">export</span> OMP_PROC_BIND=close; <span class="built_in">export</span> OMP_PLACES=cores</span><br><span class="line"><span class="comment"># ./pivot |tee ./log/$logname</span></span><br><span class="line">/public1/soft/oneAPI/2022.1/vtune/2022.0.0/bin64/vtune -collect hotspots -knob enable-stack-collection=<span class="literal">true</span> -knob stack-size=4096 -data-limit=1024000 -app-working-dir /public1/home/ipcc22_0029/shaojiemike/slurm -- /public1/home/ipcc22_0029/shaojiemike/slurm/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/uniformvector-2dim-5h.txt |<span class="built_in">tee</span> ./log/<span class="variable">$logname</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>log文件如下，但是将生成的trace文件<code>r000hs</code>导入识别不了AMD</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> <span class="built_in">log</span>/vtune</span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 452.232000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line">Elapsed Time: 0.486s</span><br><span class="line">   CPU Time: 3.540s</span><br><span class="line">      Effective Time: 3.540s</span><br><span class="line">      Spin Time: 0s</span><br><span class="line">      Overhead Time: 0s</span><br><span class="line">   Total Thread Count: 8</span><br><span class="line">   Paused Time: 0s</span><br><span class="line"></span><br><span class="line">Top Hotspots</span><br><span class="line">Function         Module  CPU Time  % of CPU Time(%)</span><br><span class="line">---------------  ------  --------  ----------------</span><br><span class="line">SumDistance      pivot     0.940s             26.6%</span><br><span class="line">_mm256_add_pd    pivot     0.540s             15.3%</span><br><span class="line">_mm256_and_pd    pivot     0.320s              9.0%</span><br><span class="line">_mm256_loadu_pd  pivot     0.300s              8.5%</span><br><span class="line">Combination      pivot     0.250s              7.1%</span><br><span class="line">[Others]         N/A       1.190s             33.6%</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.shaojiemike.top/img/20220731223945.png"></p>
</li>
</ol>
<h3 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objdump -Sd ../build/bin/pivot &gt; pivot1.s</span><br><span class="line">gcc -S -O3 -fverbose-asm ../src/pivot.c -o pivot_O1.s</span><br></pre></td></tr></table></figure>

<h2 id="汇编分析技巧"><a href="#汇编分析技巧" class="headerlink" title="汇编分析技巧"></a>汇编分析技巧</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/thisinnocence/article/details/80767776">https://blog.csdn.net/thisinnocence/article/details/80767776</a></p>
<h2 id="如何设置GNU和Intel汇编语法"><a href="#如何设置GNU和Intel汇编语法" class="headerlink" title="如何设置GNU和Intel汇编语法"></a>如何设置GNU和Intel汇编语法</h2><p><img src="https://pic.shaojiemike.top/img/20220725221103.png"><br><img src="https://pic.shaojiemike.top/img/20220725221213.png"></p>
<h2 id="vtune汇编实例"><a href="#vtune汇编实例" class="headerlink" title="vtune汇编实例"></a>vtune汇编实例</h2><p>(没有开O3，默认值)</p>
<p><img src="https://pic.shaojiemike.top/img/20220725220142.png"><br>偏移 -64 是k</p>
<p>-50 是ki</p>
<p><img src="https://pic.shaojiemike.top/img/20220725220301.png"><br>CDQE复制EAX寄存器双字的符号位(bit 31)到RAX的高32位。</p>
<p><img src="https://pic.shaojiemike.top/img/20220725220351.png"></p>
<p>这里的movsdq的q在intel里的64位，相当于使用了128位的寄存器，做了64位的事情，并没有自动向量化。</p>
<p><img src="https://pic.shaojiemike.top/img/20220725215938.png"></p>
<h2 id="生成带代码注释的O3汇编代码"><a href="#生成带代码注释的O3汇编代码" class="headerlink" title="生成带代码注释的O3汇编代码"></a>生成带代码注释的O3汇编代码</h2><p>如果想把 C 语言变量的名称作为汇编语言语句中的注释，可以加上 <code>-fverbose-asm</code> 选项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S -O3 -fverbose-asm ../src/pivot.c -o pivot_O1.s</span><br></pre></td></tr></table></figure>

<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.L15:</span></span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">38</span>:                 double dis = <span class="keyword">fabs</span>(rebuiltCoordFirst - rebuiltCoordSecond)<span class="comment">;</span></span><br><span class="line">   <span class="keyword">movsd</span> (%rax), %xmm0 # MEM[base: _15, offset: <span class="number">0B</span>], MEM[base: _15, offset: <span class="number">0B</span>]</span><br><span class="line">   <span class="keyword">subsd</span> (%rax,%rdx,<span class="number">8</span>), %xmm0 # MEM[base: _15, index: _21, step: <span class="number">8</span>, offset: <span class="number">0B</span>], tmp226</span><br><span class="line">   addq <span class="number">$8</span>, %rax #, ivtmp<span class="number">.66</span></span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">38</span>:                 double dis = <span class="keyword">fabs</span>(rebuiltCoordFirst - rebuiltCoordSecond)<span class="comment">;</span></span><br><span class="line">   <span class="keyword">andpd</span> %xmm2, %xmm0 # tmp235, dis</span><br><span class="line">   <span class="keyword">maxsd</span> %xmm1, %xmm0 # chebyshev, dis</span><br><span class="line">   <span class="keyword">movapd</span> %xmm0, %xmm1 # dis, chebyshev</span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">35</span>:             for(ki=<span class="number">0</span><span class="comment">; ki&lt;k; ki++)&#123;</span></span><br><span class="line">   cmpq %rax, %rcx # ivtmp<span class="number">.66</span>, _115</span><br><span class="line">   <span class="keyword">jne</span> .L15 #,</span><br><span class="line"><span class="symbol">.L19:</span></span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">32</span>:         for(j=i+<span class="number">1</span><span class="comment">; j&lt;n; j++)&#123;</span></span><br><span class="line">   addl <span class="number">$1</span>, %esi #, j</span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">41</span>:             chebyshevSum += chebyshev<span class="comment">;</span></span><br><span class="line">   <span class="keyword">addsd</span> %xmm1, %xmm4 # chebyshev, &lt;retval&gt;</span><br><span class="line">   addl %r14d, %edi # k, ivtmp<span class="number">.75</span></span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">32</span>:         for(j=i+<span class="number">1</span><span class="comment">; j&lt;n; j++)&#123;</span></span><br><span class="line">   cmpl %esi, %r15d # j, n</span><br><span class="line">   <span class="keyword">jg</span> .L13 #,</span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">32</span>:         for(j=i+<span class="number">1</span><span class="comment">; j&lt;n; j++)&#123;</span></span><br><span class="line">   addl <span class="number">$1</span>, %r10d #, j</span><br><span class="line"># ../src/pivot<span class="number">.</span>c:<span class="number">32</span>:         for(j=i+<span class="number">1</span><span class="comment">; j&lt;n; j++)&#123;</span></span><br><span class="line">   cmpl %r10d, %r15d # j, n</span><br><span class="line">   <span class="keyword">jne</span> .L16 #,</span><br></pre></td></tr></table></figure>

<h2 id="vtune-O3汇编分析"><a href="#vtune-O3汇编分析" class="headerlink" title="vtune O3汇编分析"></a>vtune O3汇编分析</h2><p>原本以为O3是看不了原代码与汇编的对应关系的，但实际可以<code>-g -O3</code> 是不冲突的。</p>
<h3 id="指令的精简合并"><a href="#指令的精简合并" class="headerlink" title="指令的精简合并"></a>指令的精简合并</h3><ol>
<li>访存指令的合并</li>
<li><img src="https://pic.shaojiemike.top/img/20220726131315.png"><ol>
<li>将<code>r9</code> mov到 <code>rax</code>里，<ol>
<li>又<code>leaq (%r12,%r8,8), %r9</code>。其中<code>r12</code>是<code>rebuiltCoord</code>,所以<code>r8</code>原本存储的是<code>[i*k]</code>的值</li>
<li><code>rax</code>是<code>rebuiltCoord+[i*k]</code>的地址，由于和i有关，index的计算在外层就计算好了。</li>
</ol>
</li>
<li><code>rdx</code>的值减去<code>r8</code>存储在<code>rdx</code>里<ol>
<li><code>rdx</code>原本存储的是<code>[j*k]</code>的地址</li>
<li><code>r8</code>原本存储的是<code>[i*k]</code>的值</li>
<li><code>rdx</code>之后存储的是<code>[(j-i)*k]</code>的地址</li>
</ol>
</li>
<li><code>data16 nop</code>是为了对齐插入的nop</li>
</ol>
</li>
<li><img src="https://pic.shaojiemike.top/img/20220726135136.png"><ol>
<li>值得注意的是取最大值操作，这里变成了<code>maxsd</code></li>
<li><code>xmm0</code>是<code>缓存值</code></li>
<li><code>xmm1</code>是<code>chebyshev</code></li>
<li><code>xmm2</code>是<code>fabs的掩码</code></li>
<li><code>xmm4</code>是<code>chebyshevSum</code></li>
</ol>
</li>
</ol>
<h3 id="自动循环展开形成流水"><a href="#自动循环展开形成流水" class="headerlink" title="自动循环展开形成流水"></a>自动循环展开形成流水</h3><ol>
<li><img src="https://pic.shaojiemike.top/img/20220726140445.png"><ol>
<li><code>r14d</code>存储<code>k</code>的值，所以<code>edi</code>存储<code>j*k</code>值</li>
<li>Block22后的指令验证了<code>rdx</code>原本存储的是<code>[j*k]</code>的地址</li>
</ol>
</li>
<li><img src="https://pic.shaojiemike.top/img/20220726141434.png"><ol>
<li>最外层循环</li>
<li>因为<code>r14d</code>存储<code>k</code>的值，<code>r8</code>和<code>r11d</code>存储了<code>i*k</code>的值</li>
</ol>
</li>
</ol>
<p>从汇编看不出有该操作，需要开启编译选项</p>
<h3 id="自动向量化"><a href="#自动向量化" class="headerlink" title="自动向量化"></a>自动向量化</h3><p>从汇编看不出有该操作，需要开启编译选项</p>
<h3 id="自动数据预取"><a href="#自动数据预取" class="headerlink" title="自动数据预取"></a>自动数据预取</h3><p>从汇编看不出有该操作，需要开启编译选项</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>为什么求和耗时这么多<br><img src="https://pic.shaojiemike.top/img/20220726142524.png"></p>
<h2 id="添加向量化选项"><a href="#添加向量化选项" class="headerlink" title="添加向量化选项"></a>添加向量化选项</h2><p>gcc</p>
<h3 id="Baseline"><a href="#Baseline" class="headerlink" title="Baseline"></a>Baseline</h3><p><img src="https://pic.shaojiemike.top/img/20220726190206.png"></p>
<h3 id="mavx2-march-core-avx2"><a href="#mavx2-march-core-avx2" class="headerlink" title="-mavx2 -march&#x3D;core-avx2"></a>-mavx2 -march&#x3D;core-avx2</h3><p><img src="https://pic.shaojiemike.top/img/20220726190342.png"></p>
<ol>
<li>阅读文档, 虽然全部变成了<code>vmov，vadd</code>的操作，但是实际还是64位的工作。<ol>
<li>这点<code>add rax, 0x8</code>没有变成<code>add rax, 0x16</code>可以体现</li>
<li>但是avx2不是256位的向量化吗？用的还是xmm0这类的寄存器。</li>
</ol>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">VADDSD (VEX.128 encoded version)</span><br><span class="line">DEST[63:0] := SRC1[63:0] + SRC2[63:0]</span><br><span class="line">DEST[127:64] := SRC1[127:64]</span><br><span class="line">DEST[MAXVL-1:128] := 0</span><br><span class="line"></span><br><span class="line">ADDSD (128-bit Legacy SSE version)</span><br><span class="line">DEST[63:0] := DEST[63:0] + SRC[63:0]</span><br><span class="line">DEST[MAXVL-1:64] (Unmodified)</span><br></pre></td></tr></table></figure>

<h3 id="march-skylake-avx512"><a href="#march-skylake-avx512" class="headerlink" title="-march&#x3D;skylake-avx512"></a>-march&#x3D;skylake-avx512</h3><p>汇编代码表面没变，但是快了10s(49s - 39s)</p>
<p>下图是avx2的<br><img src="https://pic.shaojiemike.top/img/20220726194928.png"><br>下图是avx512的<br><img src="https://pic.shaojiemike.top/img/20220726193836.png"></p>
<p>猜测注意原因是</p>
<ol>
<li>nop指令导致代码没对齐</li>
<li>不太可能和红框里的代码顺序有关</li>
</ol>
<h2 id="添加数据预取选项"><a href="#添加数据预取选项" class="headerlink" title="添加数据预取选项"></a>添加数据预取选项</h2><h3 id="判断机器是否支持"><a href="#判断机器是否支持" class="headerlink" title="判断机器是否支持"></a>判断机器是否支持</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lscpu|grep pref</span><br><span class="line">3dnowprefetch //3DNow prefetch instructions</span><br></pre></td></tr></table></figure>

<p>应该是支持的</p>
<h3 id="汇编分析"><a href="#汇编分析" class="headerlink" title="汇编分析"></a>汇编分析</h3><p>虽然时间基本没变，主要是对主体循环没有进行预取操作，对其余循环(热点占比少的)有重新调整。如下图增加了预取指令<br><img src="https://pic.shaojiemike.top/img/20220726201240.png"></p>
<h2 id="添加循环展开选项"><a href="#添加循环展开选项" class="headerlink" title="添加循环展开选项"></a>添加循环展开选项</h2><p>变慢很多(39s -&gt; 55s)</p>
<h3 id="funroll-loops"><a href="#funroll-loops" class="headerlink" title="-funroll-loops"></a>-funroll-loops</h3><p>汇编实现，在最内层循环根据k的值直接跳转到对应的展开块，这里k是2。<br><img src="https://pic.shaojiemike.top/img/20220726214111.png"><br>默认是展开了8层，这应该和xmm寄存器总数有关<br><img src="https://pic.shaojiemike.top/img/20220726214335.png"></p>
<h3 id="分析原因"><a href="#分析原因" class="headerlink" title="分析原因"></a>分析原因</h3><ol>
<li>循环展开的核心是形成计算和访存的流水<ol>
<li>不是简单的少几个跳转指令</li>
<li>这种简单堆叠循环核心的循环展开，并不能形成流水。所以时间不会减少</li>
</ol>
</li>
<li>但是完全无法解释循环控制的时间增加<ol>
<li><img src="https://pic.shaojiemike.top/img/20220726221451.png"></li>
<li>比如图中cmp的次数应该减半了，时间反而翻倍了</li>
</ol>
</li>
</ol>
<h2 id="手动分块"><a href="#手动分块" class="headerlink" title="手动分块"></a>手动分块</h2><p>由于数据L1能全部存储下，没有提升</p>
<h2 id="手动数据预取"><a href="#手动数据预取" class="headerlink" title="手动数据预取"></a>手动数据预取</h2><p>并没有形成想象中预取的流水。每512位取，还有重复。</p>
<p><img src="https://pic.shaojiemike.top/img/20220727162255.png"><br>每次预取一个Cache Line，后面两条指令预取的数据还有重复部分(导致时间增加 39s-&gt;61s)</p>
<p><img src="https://pic.shaojiemike.top/img/20220727163228.png"><br>想预取全部，循环每次预取了512位&#x3D;64字节</p>
<h2 id="手动向量化"><a href="#手动向量化" class="headerlink" title="手动向量化"></a>手动向量化</h2><h3 id="avx2"><a href="#avx2" class="headerlink" title="avx2"></a>avx2</h3><p>（能便于编译器自动展开来使用所有的向量寄存器,avx2</p>
<p>39s -&gt; 10s -&gt; 8.4s 编译器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">for(i=0; i&lt;n-blockSize; i+=blockSize)&#123;</span><br><span class="line">   for(j=i+blockSize; j&lt;n-blockSize; j+=blockSize)&#123;</span><br><span class="line">      for(ii=i; ii&lt;i+blockSize; ii++)&#123;</span><br><span class="line">            __m256d vi1 = _mm256_broadcast_sd(&amp;rebuiltCoord[0*n+ii]);</span><br><span class="line">            __m256d vi2 = _mm256_broadcast_sd(&amp;rebuiltCoord[1*n+ii]);</span><br><span class="line">               </span><br><span class="line">            __m256d vj11 = _mm256_loadu_pd(&amp;rebuiltCoord[0*n+j]); //读取4个点</span><br><span class="line">            __m256d vj12 = _mm256_loadu_pd(&amp;rebuiltCoord[1*n+j]);</span><br><span class="line"></span><br><span class="line">            __m256d vj21 = _mm256_loadu_pd(&amp;rebuiltCoord[0*n+j+4]); //读取4个点</span><br><span class="line">            __m256d vj22 = _mm256_loadu_pd(&amp;rebuiltCoord[1*n+j+4]);</span><br><span class="line"></span><br><span class="line">            vj11 = _mm256_and_pd(_mm256_sub_pd(vi1,vj11), vDP_SIGN_Mask);</span><br><span class="line">            vj12 = _mm256_and_pd(_mm256_sub_pd(vi2,vj12), vDP_SIGN_Mask);</span><br><span class="line"></span><br><span class="line">            vj21 = _mm256_and_pd(_mm256_sub_pd(vi1,vj21), vDP_SIGN_Mask);</span><br><span class="line">            vj22 = _mm256_and_pd(_mm256_sub_pd(vi2,vj22), vDP_SIGN_Mask);</span><br><span class="line"></span><br><span class="line">            __m256d tmp = _mm256_add_pd(_mm256_max_pd(vj11,vj12), _mm256_max_pd(vj21,vj22));</span><br><span class="line">            _mm256_storeu_pd(vchebyshev1, tmp);</span><br><span class="line"></span><br><span class="line">            chebyshevSum += vchebyshev1[0] + vchebyshev1[1] + vchebyshev1[2] + vchebyshev1[3];</span><br><span class="line"></span><br><span class="line">            // for(jj=j; jj&lt;j+blockSize; jj++)&#123;</span><br><span class="line">            //     double chebyshev = 0;</span><br><span class="line">            //     int ki;</span><br><span class="line">            //     for(ki=0; ki&lt;k; ki++)&#123;</span><br><span class="line">            //         double dis = fabs(rebuiltCoord[ki*n + ii] - rebuiltCoord[ki*n + jj]);</span><br><span class="line">            //         chebyshev = dis&gt;chebyshev ? dis : chebyshev;</span><br><span class="line">            //     &#125;</span><br><span class="line">            //     chebyshevSum += chebyshev;</span><br><span class="line">            // &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>明明展开了一次，但是编译器继续展开了，总共8次。用满了YMM 16个向量寄存器。</p>
<p>下图是avx512，都出现寄存器<code>ymm26</code>了。<br><img src="https://pic.shaojiemike.top/img/20220728204812.png"></p>
<p><code>vhaddpd</code>是水平的向量内加法指令</p>
<h3 id="avx512"><a href="#avx512" class="headerlink" title="avx512"></a>avx512</h3><p>当在avx512的情况下展开4次，形成了相当工整的代码。</p>
<ol>
<li>向量用到了寄存器<code>ymm18</code>，估计只能展开到6次了。<ol>
<li>avx2 应该寄存器不够<br><img src="https://pic.shaojiemike.top/img/20220729102432.png"></li>
</ol>
</li>
</ol>
<p>最后求和的处理，编译器首先识别出了，不需要实际store。还是在寄存器层面完成了计算。并且通过三次add和两次数据 移动指令自动实现了二叉树型求和。<br><img src="https://pic.shaojiemike.top/img/490591d3247248b05ab6a4c9ac79929.jpg"></p>
<p>avx2 寄存器不够会出现下面的情况。</p>
<h2 id="avx求和的更快速归约"><a href="#avx求和的更快速归约" class="headerlink" title="avx求和的更快速归约"></a>avx求和的更快速归约</h2><p>假如硬件存在四个一起归约的就好了，但是对于底层元件可能过于复杂了。</p>
<p><img src="https://pic.shaojiemike.top/img/20220729132206.png"><br><img src="https://pic.shaojiemike.top/img/20220729133155.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__m256d _mm256_hadd_pd (__m256d a, __m256d b);</span><br><span class="line">VEXTRACTF128 __m128d _mm256_extractf128_pd (__m256d a, int offset);</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/c4bbaddb021d23d7be7b92dfa448bc7.jpg"><br>如果可以实现会节约一次数据移动和一次数据add。没有分析两种情况的寄存器依赖。可能依赖长度是一样的，导致优化后时间反而增加一点。</p>
<p><img src="https://pic.shaojiemike.top/img/20220729144311.png"></p>
<p>对于int还有这种实现<br><img src="https://pic.shaojiemike.top/img/20220729132834.png"><br><img src="https://pic.shaojiemike.top/img/20220729133019.png"></p>
<h3 id="将横向归约全部提取到外面"><a href="#将横向归约全部提取到外面" class="headerlink" title="将横向归约全部提取到外面"></a>将横向归约全部提取到外面</h3><p>并且将j的循环展开变成i的循环展开</p>
<p><img src="https://pic.shaojiemike.top/img/20220729190050.png"></p>
<h2 id="手动向量化-手动循环展开？"><a href="#手动向量化-手动循环展开？" class="headerlink" title="手动向量化+手动循环展开？"></a>手动向量化+手动循环展开？</h2><p>支持的理由：打破了循环间的壁垒，编译器会识别出无效中间变量，在for的jump指令划出的基本块内指令会乱序执行，并通过寄存器重命名来形成最密集的计算访存流水。</p>
<p>不支持的理由：如果编译器为了形成某一指令的流水，占用了太多资源。导致需要缓存其他结果（比如，向量寄存器不够，反而需要额外的指令来写回，和产生延迟。</p>
<p>理想的平衡: 在不会达到资源瓶颈的情况下展开。</p>
<h3 id="支持的分析例子"><a href="#支持的分析例子" class="headerlink" title="支持的分析例子"></a>支持的分析例子</h3><p>手动展开后，识别出来了连续的访存应该在一起进行，并自动调度。将+1的偏移编译器提前计算了。<br><img src="https://pic.shaojiemike.top/img/20220806153455.png"></p>
<p>如果写成macro define,可以发现编译器自动重排了汇编。<br><img src="https://pic.shaojiemike.top/img/20220808183850.png"></p>
<h3 id="不支持的分析例子"><a href="#不支持的分析例子" class="headerlink" title="不支持的分析例子"></a>不支持的分析例子</h3><p>avx2可以看出有写回的操作，把值从内存读出来压入栈中。<br><img src="https://pic.shaojiemike.top/img/20220806155318.png"></p>
<p>寄存器足够时没有这种问题<br><img src="https://pic.shaojiemike.top/img/20220806155437.png"></p>
<h3 id="寻找理想的展开次数"><a href="#寻找理想的展开次数" class="headerlink" title="寻找理想的展开次数"></a>寻找理想的展开次数</h3><p>由于不同代码对向量寄存器的使用次数不同，不同机器的向量寄存器个数和其他资源数不同。汇编也难以分析。在写好单次循环之后，最佳的展开次数需要手动测量。如下图，6次应该是在不会达到资源瓶颈的情况下展开来获得最大流水。<br><img src="https://pic.shaojiemike.top/img/20220806190954.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for(j=beginJ; j&lt;n-jBlockSize; j+=jBlockSize)&#123;  /</span><br><span class="line">//展开jBlockSize次</span><br><span class="line">&#125;</span><br><span class="line">for(jj=j; jj&lt;n; jj++)&#123;  //j初始值继承自上面的循环</span><br><span class="line">//正常单次</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于基本块内乱序执行，代码的顺序也不重要。<br>加上寄存器重命名来形成流水的存在，寄存器名也不重要。当然数据依赖还是要正确。</p>
<h3 id="对于两层循环的双层手动展开"><a href="#对于两层循环的双层手动展开" class="headerlink" title="对于两层循环的双层手动展开"></a>对于两层循环的双层手动展开</h3><p>思路： 外层多load数据到寄存器，但是运行的任何时候也不要超过寄存器数量的上限（特别注意在内层循环运行一遍到末尾时）。<br><img src="https://pic.shaojiemike.top/img/20220806204942.png"><br>左图外层load了8个寄存器，但是右边只有2个。</p>
<p>特别注意在内层循环运行一遍到末尾时：<br><img src="https://pic.shaojiemike.top/img/20220806210453.png"><br>如图，黄框就有16个了。</p>
<h3 id="注意load的速度也有区别"><a href="#注意load的速度也有区别" class="headerlink" title="注意load的速度也有区别"></a>注意load的速度也有区别</h3><p>所以内层调用次数多，尽量用快的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_mm256_loadu_ps &gt;&gt; _mm256_broadcast_ss &gt; _mm256_set_epi16</span><br><span class="line">0.04 &gt;&gt; 0.5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vsub  vmax    ps 0.02      Latency 4</span><br><span class="line">vand                       Latency 1</span><br><span class="line"></span><br><span class="line">vadd              ps 0.80              Throughput 0.5</span><br><span class="line">vhadd                      Latency 7</span><br><span class="line">vcvtps2pd            2.00  Latency 7</span><br><span class="line">vextractf128         0.50  Latency 3</span><br></pre></td></tr></table></figure>

<p>|指令|精度|时间(吞吐延迟和实际依赖导致)|Latency|Throughput<br>|-|-|-|-|-|-|<br>|_mm256_loadu_ps &#x2F;_mm256_broadcast_ss|||7|0.5<br>|vsub vmax |     ps| 0.02   |   4|0.5<br>vand      ||0.02|                1|0.33<br>vadd              |ps |0.80   |4| 0.5<br>vhadd              ||0.8| 7|2<br>vcvtps2pd         ||   2.00  | 7|1<br>vextractf128        || 0.50  | 3|1</p>
<h3 id="向量化double变单精度没有提升"><a href="#向量化double变单精度没有提升" class="headerlink" title="向量化double变单精度没有提升"></a>向量化double变单精度没有提升</h3><p><img src="https://pic.shaojiemike.top/img/20220811011442.png"></p>
<p>17条avx计算 5load 2cvt 2extract</p>
<p><img src="https://pic.shaojiemike.top/img/20220811012833.png"></p>
<table>
<thead>
<tr>
<th>单位时间</th>
<th>avx计算</th>
<th>load</th>
<th>cvt</th>
<th>extract</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>2.33</td>
<td>3.68</td>
<td>12.875</td>
<td>4.1</td>
</tr>
</tbody></table>
<p>可见类型转换相当耗费时间，最好在循环外，精度不够，每几次循环做一次转换。</p>
<h2 id="GCC编译器优化"><a href="#GCC编译器优化" class="headerlink" title="GCC编译器优化"></a>GCC编译器优化</h2><p>-march&#x3D;skylake-avx512是一条指令<br><img src="https://pic.shaojiemike.top/img/20220806154101.png"></p>
<p>-mavx2 是两条指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vmovupd xmm7, xmmword ptr [rdx+rsi*8]</span><br><span class="line">vinsertf128 ymm1, ymm7, xmmword ptr [rdx+rsi*8+0x10], 0x1</span><br></pre></td></tr></table></figure>

<p>原因是<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/52626726/why-doesnt-gcc-resolve-mm256-loadu-pd-as-single-vmovupd">不对齐的访存在老架构上可能更快</a></p>
<h2 id="O3对于核心已经向量化的代码还有加速吗？"><a href="#O3对于核心已经向量化的代码还有加速吗？" class="headerlink" title="O3对于核心已经向量化的代码还有加速吗？"></a>O3对于核心已经向量化的代码还有加速吗？</h2><p>将IPCC初赛的代码去掉O3发现还是慢了10倍。</p>
<p><img src="https://pic.shaojiemike.top/img/20220814195555.png"></p>
<p>为什么连汇编函数调用也慢这么多呢？</p>
<p>这个不开O3的编译器所属有点弱智了，一条指令的两个操作数竟然在<code>rbp</code>的栈里存来存去的。<br><img src="https://pic.shaojiemike.top/img/20220814200435.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-01T01:08:17.000Z" title="8/1/2022, 1:08:17 AM">2022-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-15T11:19:20.637Z" title="1/15/2024, 11:19:20 AM">2024-01-15</time></span><span class="level-item"><a class="link-muted" href="/categories/Artificial-Intelligence/">Artificial Intelligence</a></span><span class="level-item">3 minutes read (About 450 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/01/Work/HPC/HPCAI/">HPCAI</a></p><div class="content"><h2 id="HPC-AI-在第一性原理分子动力学中的应用（中科院计算所）10-10规模"><a href="#HPC-AI-在第一性原理分子动力学中的应用（中科院计算所）10-10规模" class="headerlink" title="HPC - AI 在第一性原理分子动力学中的应用（中科院计算所）10^10规模"></a>HPC - AI 在第一性原理分子动力学中的应用（中科院计算所）10^10规模</h2><p>一块铁 10^22个原子</p>
<p>高性能计算每年翻一倍 &#x3D; 超算规模 + Chip摩尔定律</p>
<p>但是由于分子动力学的方法是O^3, 问题规模增大，每一步迭代反而变慢了（2011年GB是3天一步）。</p>
<p>一百万内规模6次方内的专用机器 anton？ ，比一般超算快100倍。</p>
<ol>
<li>通讯精度压缩，</li>
<li>专用网络和通讯协议设计。</li>
</ol>
<p>compute is cheap，memory and bandwidth are expansive， latency is  physics.</p>
<p>18GB: AI图片处理大气模拟问题</p>
<p>AI ： 高纬度函数的逼近（解空间相对于输入维度）</p>
<ol>
<li>通过物理信息如何设计网络，来避免local minimal</li>
<li>其余技巧<ol>
<li>10步AI，一步DFT<ol>
<li>大哈密顿量矩阵的切片法，融合在纯粹的数据AI里。</li>
</ol>
</li>
<li>预测误差</li>
</ol>
</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20220801094338.png"></p>
<ol>
<li>低精度相乘法，高精度相加</li>
<li>单精度相对于双精度<ol>
<li>速度提升可能没有2倍</li>
<li>但是内存需求变成一半了，规模可以两倍</li>
</ol>
</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20220801095451.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220801095524.png"></p>
<p>将epoch从几百变几个</p>
<h2 id="字节量子计算机上的量子化学模拟-Dingshun-Li"><a href="#字节量子计算机上的量子化学模拟-Dingshun-Li" class="headerlink" title="字节量子计算机上的量子化学模拟 Dingshun Li"></a>字节量子计算机上的量子化学模拟 Dingshun Li</h2><p>基于薛定谔方程和经典电子结构</p>
<p>digist + analog</p>
<p>量子计算的a killer app</p>
<p>当前问题：</p>
<ol>
<li>量子规模 50～100</li>
<li>量子计算机运行时间有限</li>
<li>纠错机制还需要相位纠错</li>
<li>由于叠加态连续性，导致的误差</li>
</ol>
<p>量子计算缺乏复杂度分析？</p>
<p>UCC Ansatz </p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/26/">Previous</a></div><div class="pagination-next"><a href="/page/28/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/26/">26</a></li><li><a class="pagination-link is-current" href="/page/27/">27</a></li><li><a class="pagination-link" href="/page/28/">28</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/39/">39</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">386</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Thinking/"><span class="level-start"><span class="level-item">Thinking</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T14:32:40.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Thinking/2-courage2move/SocialScience/">Social Science</a></p><p class="categories"><a href="/categories/Thinking/">Thinking</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T12:15:22.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/FPGA/">FPGA</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T08:02:52.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/workloadPriority/">Workload Characterization &amp; Priority &amp; Scheduler to CPU/GPU/PIM</a></p><p class="categories"><a href="/categories/Architecture/">Architecture</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-12T12:16:43.000Z">2024-01-12</time></p><p class="title"><a href="/2024/01/12/OutOfWork/5-VideoEntertainment/AutoFreePTDownloadRSS/">Auto Free PT Download using RSS and Flexget</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-10T12:00:31.000Z">2024-01-10</time></p><p class="title"><a href="/2024/01/10/Work/Programming/2-languageGrammar/OpenCLBasic/">OpenCL Basic</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>