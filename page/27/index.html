<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-10-05T16:00:00.000Z" title="10/5/2022, 4:00:00 PM">2022-10-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.855Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Network/">Network</a></span><span class="level-item">15 minutes read (About 2194 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/05/Work/software/linux-apps/SSHForward/">SSHForward</a></p><div class="content"><h2 id="四类ssh转发"><a href="#四类ssh转发" class="headerlink" title="四类ssh转发"></a>四类ssh转发</h2><p>SSH 端口转发自然需要 SSH 连接，而<strong>SSH 连接是有方向</strong>的，从 SSH Client 到 SSH Server 。</p>
<p>而我们所要<strong>访问的应用也是有方向</strong>的，应用连接的方向也是从应用的 Client 端连接到应用的 Server 端。比如需要我们要访问Internet上的Web站点时，Http应用的方向就是从我们自己这台主机(Client)到远处的Web Server。</p>
<h3 id="本地转发Local-Forward"><a href="#本地转发Local-Forward" class="headerlink" title="本地转发Local Forward"></a>本地转发Local Forward</h3><p>如果SSH连接和应用的连接这两个连接的<strong>方向一致</strong>，那我们就说它是本地转发。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh -L [bind_address:]port:host:hostport &lt;SSH hostname&gt;</span><br><span class="line">ssh -L 3333:127.0.0.1:2333 -vN -f -l shaojiemike 222.195.72.218</span><br><span class="line">debug1: Local connections to LOCALHOST:3333 forwarded to remote address(222.195.72.218) 127.0.0.1:2333</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/LocalForward-new.jpg"><br>本地转发在本地这台机器上监听一个端口，然后所有访问这个端口的数据都会通过ssh 隧道传输到远端的对应端口上。命令中的 host 和 <code>&lt;SSH hostname&gt;</code> 可以是不同的主机。</p>
<p><img src="https://pic.shaojiemike.top/img/LocalForward.jpg"></p>
<h3 id="远程转发Remote-Forward"><a href="#远程转发Remote-Forward" class="headerlink" title="远程转发Remote Forward"></a>远程转发Remote Forward</h3><p>如果SSH连接和应用的连接这两个连接的<strong>方向不同</strong>，那我们就说它是远程转发。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R [bind_address:]port:host:hostport &lt;SSH hostname&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/RemoteForward-new.jpg"></p>
<p>远程转发与本地转发正好相反，打开ssh隧道以后，在远端服务器监听一个端口，所有访问远端服务器指定端口都会通过隧道传输到本地的对应端口上，下面是例子。</p>
<p><img src="https://pic.shaojiemike.top/img/InkedRemoteForward_LI.jpg"></p>
<h3 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h3><p>有待学习。</p>
<h3 id="X转发"><a href="#X转发" class="headerlink" title="X转发"></a>X转发</h3><p>有待学习。</p>
<h2 id="实用参数"><a href="#实用参数" class="headerlink" title="实用参数"></a>实用参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-C：压缩数据传输。</span><br><span class="line">-f ：后台认证用户/密码，通常和-N连用，不用登录到远程主机。</span><br><span class="line">-N ：不执行脚本或命令，通常与-f连用。</span><br><span class="line">-g ：在-L/-R/-D参数中，允许远程主机连接到建立的转发的端口，如果不加这个参数，只允许本地主机建立连接。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-f      Requests ssh to go to background just before command execution.  This is useful if ssh is going to ask for passwords or</span><br><span class="line">             passphrases, but the user wants it in the background.  This implies -n.  The recommended way to start X11 programs at a remote</span><br><span class="line">             site is with something like ssh -f host xterm.</span><br><span class="line"></span><br><span class="line">             If the ExitOnForwardFailure configuration option is set to &quot;yes&quot;, then a client started with -f will wait for all remote port</span><br><span class="line">             forwards to be successfully established before placing itself in the background.</span><br></pre></td></tr></table></figure>

<h2 id="常见例子"><a href="#常见例子" class="headerlink" title="常见例子"></a>常见例子</h2><h3 id="将发往本机的80端口访问转发到174-139-9-66的8080端口"><a href="#将发往本机的80端口访问转发到174-139-9-66的8080端口" class="headerlink" title="将发往本机的80端口访问转发到174.139.9.66的8080端口"></a>将发往本机的80端口访问转发到174.139.9.66的8080端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C -f -N -g -L 80:174.139.9.66:8080 master@174.139.9.66</span><br></pre></td></tr></table></figure>

<h3 id="将发往174-139-9-66的8080访问转发到本机的80端口"><a href="#将发往174-139-9-66的8080访问转发到本机的80端口" class="headerlink" title="将发往174.139.9.66的8080访问转发到本机的80端口"></a>将发往174.139.9.66的8080访问转发到本机的80端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C -f -N -g -R 80:174.139.9.66:8080 master@174.139.9.66</span><br></pre></td></tr></table></figure>

<h3 id="使用远程管理服务器上的MySQL"><a href="#使用远程管理服务器上的MySQL" class="headerlink" title="使用远程管理服务器上的MySQL"></a>使用远程管理服务器上的MySQL</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -C -f -N -g -L 80:174.139.9.66:8080 master@174.139.9.66</span><br></pre></td></tr></table></figure>

<h3 id="一次同时映射多个端口"><a href="#一次同时映射多个端口" class="headerlink" title="一次同时映射多个端口"></a>一次同时映射多个端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8888:www.host.com:80 -L 110:mail.host.com:110 -L    25:mail.host.com:25 user@host -N  </span><br></pre></td></tr></table></figure>

<h3 id="反向隧道技术-节假日需要回公司加班。但是公司是内网，使用NAT，所以没办法连回去。"><a href="#反向隧道技术-节假日需要回公司加班。但是公司是内网，使用NAT，所以没办法连回去。" class="headerlink" title="反向隧道技术:节假日需要回公司加班。但是公司是内网，使用NAT，所以没办法连回去。"></a>反向隧道技术:节假日需要回公司加班。但是公司是内网，使用NAT，所以没办法连回去。</h3><ol>
<li>先在公司机器(LAN_ip)上执行<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -NfR 2222:localhost:22 home_ip</span><br></pre></td></tr></table></figure>

-R : 建立反向连接 将 home_ip port转发</li>
<li>然后到home_ip上面<br>ssh localhost -p 2222</li>
</ol>
<h3 id="端口转发-本机不允许访问www-xxx-com这个网站，但是远程主机-remote-ip-可以。"><a href="#端口转发-本机不允许访问www-xxx-com这个网站，但是远程主机-remote-ip-可以。" class="headerlink" title="端口转发:本机不允许访问www.xxx.com这个网站，但是远程主机(remote_ip)可以。"></a>端口转发:本机不允许访问<a target="_blank" rel="noopener" href="http://www.xxx.com这个网站,但是远程主机(remote_ip)可以./">www.xxx.com这个网站，但是远程主机(remote_ip)可以。</a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -L 31609:www.xxx.com:80 user@remote_ip</span><br></pre></td></tr></table></figure>

<p>现在我们就可以在本地打开 <a target="_blank" rel="noopener" href="http://localhost:31609/">http://localhost:31609</a> 访问<a target="_blank" rel="noopener" href="http://www.xxx.com了./">www.xxx.com了。</a></p>
<h3 id="SOCKS代理-本机不允许访问某些网站，但是远程主机-remote-ip-可以，并且公司没有组织你连接remote-ip。"><a href="#SOCKS代理-本机不允许访问某些网站，但是远程主机-remote-ip-可以，并且公司没有组织你连接remote-ip。" class="headerlink" title="SOCKS代理:本机不允许访问某些网站，但是远程主机(remote_ip)可以，并且公司没有组织你连接remote_ip。"></a>SOCKS代理:本机不允许访问某些网站，但是远程主机(remote_ip)可以，并且公司没有组织你连接remote_ip。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -NfD 8888 user@remote_ip</span><br></pre></td></tr></table></figure>

<p>现在在浏览器socks 5 proxy设置为localhost:8888,所有之前无法访问的网站现在都可以访问了。</p>
<h3 id="假设本地主机A提供了HTTP服务，主机B无网络"><a href="#假设本地主机A提供了HTTP服务，主机B无网络" class="headerlink" title="假设本地主机A提供了HTTP服务，主机B无网络"></a>假设本地主机A提供了HTTP服务，主机B无网络</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fNgR 80:localhost:80 root@host-B</span><br></pre></td></tr></table></figure>

<p>通过访问 <a target="_blank" rel="noopener" href="http://host-b/">http://host-B</a> 来访问主机A上的HTTP服务了。</p>
<p>如果没有主机B的root账号，则只能远程转发到1024以后的端口号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fNgR 8080:localhost:80 lige@host-B</span><br></pre></td></tr></table></figure>

<p>通过访问<a target="_blank" rel="noopener" href="http://host-b:8080/">http://host-B:8080</a> 来访问主机A上的HTTP服务</p>
<h3 id="假设本地主机A无网络，主机B提供了HTTP服务"><a href="#假设本地主机A无网络，主机B提供了HTTP服务" class="headerlink" title="假设本地主机A无网络，主机B提供了HTTP服务"></a>假设本地主机A无网络，主机B提供了HTTP服务</h3><p>但是由于怕防火墙屏蔽，而不想直接访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -fNgL 80:localhost:80 root@host-B</span><br></pre></td></tr></table></figure>

<h2 id="ssh-config设置技巧"><a href="#ssh-config设置技巧" class="headerlink" title="ssh_config设置技巧"></a>ssh_config设置技巧</h2><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p><code>.ssh/config</code>修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">    ControlPersist yes</span><br><span class="line">    ControlMaster auto</span><br><span class="line">    ControlPath /tmp/sshcontrol-%C</span><br><span class="line">    ControlPersist 1d</span><br><span class="line">    # 以上四条配合使用，实现多条ssh连接共享，而且保持1天内ssh存在。再次执行ssh命令几乎秒连</span><br><span class="line">    TCPKeepAlive=yes</span><br><span class="line">    # 发送空TCP包来保持连接，但是可能被防火墙过滤</span><br><span class="line">    ServerAliveInterval 30</span><br><span class="line">    # 表示每隔多少秒（30秒），从客户端向服务器发送一次心跳（alive检测）</span><br><span class="line">    # 心跳具体格式： debug1: client_input_global_request: rtype keepalive@openssh.com want_reply 1</span><br><span class="line">    ServerAliveCountMax 240 </span><br><span class="line">    # 表示服务端多少次（240次）心跳无响应后， 客户端才会认为与服务器到SSH链接已经断开，然后断开连接。</span><br><span class="line">  </span><br><span class="line">    Port 443</span><br><span class="line"></span><br><span class="line">Host *</span><br><span class="line">   ForwardAgent yes</span><br><span class="line">   # 可以讓本地的 SSH Key 在遠端 Server 上進行轉送，也就是经过跳板机Server1，使用本地key访问Server2，不用把key传到Server1上导致泄露</span><br><span class="line">   # 虽然Server1不会获得key，但是可以使用key。所以该选项不宜用于Host *，应该只添加您信任的服务器以及打算用于代理转发的服务器。</span><br><span class="line">   # 注意跳板机需要设置允许代理转发， /etc/ssh/sshd_config 将AllowAgentForwarding的值设置为yes， 并重启服务</span><br><span class="line">   AddKeysToAgent yes</span><br><span class="line">   ForwardX11 yes</span><br><span class="line">   ForwardX11Trusted yes</span><br><span class="line">   Compression yes</span><br><span class="line">   # 压缩，加快数据传输速度</span><br></pre></td></tr></table></figure>

<h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>更改ssh服务器的配置文件&#x2F;etc&#x2F;ssh&#x2F;sshd_config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ClientAliveInterval 60</span><br><span class="line"># 默认是0，不发送</span><br><span class="line">ClientAliveCountMax 3</span><br></pre></td></tr></table></figure>

<p>原理同上<br>重启ssh服务以使配置生效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br></pre></td></tr></table></figure>

<h3 id="服务器端如何将端口绑定到外部地址上"><a href="#服务器端如何将端口绑定到外部地址上" class="headerlink" title="服务器端如何将端口绑定到外部地址上"></a>服务器端如何将端口绑定到外部地址上</h3><p>我们可以把这个映射的端口绑定在0.0.0.0的接口上，方法是加上参数-b 0.0.0.0。</p>
<p>同时修改SSH服务器端 <code>/etc/sshd_config</code>中 <code>GatewayPorts no</code>为 <code>GatewayPorts yes</code>来打开它。</p>
<h3 id="自动重连-保持长时间连接"><a href="#自动重连-保持长时间连接" class="headerlink" title="自动重连&#x2F;保持长时间连接"></a>自动重连&#x2F;保持长时间连接</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Host *</span><br><span class="line">  ServerAliveInterval 60</span><br></pre></td></tr></table></figure>

<h3 id="检查隧道状态"><a href="#检查隧道状态" class="headerlink" title="检查隧道状态"></a>检查隧道状态</h3><p><a target="_blank" rel="noopener" href="https://www.wenjiangs.com/group/topic-788198.html">https://www.wenjiangs.com/group/topic-788198.html</a></p>
<ol>
<li>netstat</li>
<li>ps</li>
<li>autossh</li>
</ol>
<h2 id="服务器网站端口转发到本地"><a href="#服务器网站端口转发到本地" class="headerlink" title="服务器网站端口转发到本地"></a>服务器网站端口转发到本地</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 6006:127.0.0.1:6006 -N -f -l acsacom snode6.swangeese.fun</span><br></pre></td></tr></table></figure>
<h2 id="姜师兄本地网络代理到服务器"><a href="#姜师兄本地网络代理到服务器" class="headerlink" title="姜师兄本地网络代理到服务器"></a>姜师兄本地网络代理到服务器</h2><p>服务器git下载设置代理端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=http://127.0.0.1:7333</span><br><span class="line"># wget 正常使用</span><br><span class="line">export all_proxy=socks5://127.0.0.1:7333</span><br><span class="line"># git 正常使用</span><br><span class="line">unset http_proxy</span><br><span class="line">unset all_proxy</span><br></pre></td></tr></table></figure>

<p>本地</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -fNgR 7333:127.0.0.1:7890 shaojiemike@222.195.72.218</span><br><span class="line">ssh -fNgR 7333:127.0.0.1:80 shaojiemike@222.195.72.218</span><br></pre></td></tr></table></figure>

<p>7333数字不要太小，以免冲突。7890是本地clash端口，80也可以。</p>
<p>两个都是7890最稳，其余的有时候不行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#YJH proxy</span><br><span class="line">export proxy_addr=localhost</span><br><span class="line">export proxy_http_port=7890</span><br><span class="line">export proxy_socks_port=7890</span><br><span class="line">function set_proxy() &#123;</span><br><span class="line">    export http_proxy=http://$proxy_addr:$proxy_http_port #如果使用git 不行，这两个http和https改成socks5就行</span><br><span class="line">    export https_proxy=http://$proxy_addr:$proxy_http_port</span><br><span class="line">    export all_proxy=socks5://$proxy_addr:$proxy_socks_port</span><br><span class="line">&#125;</span><br><span class="line">function unset_proxy() &#123;</span><br><span class="line">    unset http_proxy</span><br><span class="line">    unset https_proxy</span><br><span class="line">    unset all_proxy</span><br><span class="line">&#125;</span><br><span class="line">function test_proxy() &#123;</span><br><span class="line">   curl -v -x http://$proxy_addr:$proxy_http_port https://www.google.com | egrep &#x27;HTTP/(2|1.1) 200&#x27;</span><br><span class="line">   # socks5h://$proxy_addr:$proxy_socks_port</span><br><span class="line">&#125;</span><br><span class="line"># set_proxy # 如果要登陆时默认启用代理则取消注释这句</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可能需要软件设置代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git config --global https.proxy http://127.0.0.1:1080</span><br><span class="line">git config --global https.proxy https://127.0.0.1:1080</span><br><span class="line">git config --global http.proxy &#x27;socks5://127.0.0.1:1080&#x27;</span><br><span class="line">git config --global https.proxy &#x27;socks5://127.0.0.1:1080&#x27;</span><br><span class="line"></span><br><span class="line">git config --global --unset http.proxy</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure>

<h2 id="Debug-mac上转发失败"><a href="#Debug-mac上转发失败" class="headerlink" title="Debug: mac上转发失败"></a>Debug: mac上转发失败</h2><h3 id="首先看看Windows上的输出"><a href="#首先看看Windows上的输出" class="headerlink" title="首先看看Windows上的输出"></a>首先看看Windows上的输出</h3><p><img src="https://pic.shaojiemike.top/img/20220331151947.png"><br><img src="https://pic.shaojiemike.top/img/20220331152133.png"></p>
<h3 id="Mac的错误"><a href="#Mac的错误" class="headerlink" title="Mac的错误"></a>Mac的错误</h3><p><img src="https://pic.shaojiemike.top/img/20220331162843.png"><br>在完成windows所有输出后，</p>
<ol>
<li>首先调用了shell</li>
<li>错误</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">debug1: Remote: Forwarding listen address &quot;localhost&quot; overridden by server GatewayPorts</span><br><span class="line">debug1: remote forward failure for: listen 7890, connect 127.0.0.1:7890</span><br><span class="line">Warning: remote port forwarding failed for listen port 7890</span><br></pre></td></tr></table></figure>

<h3 id="应该是已经端口占用了"><a href="#应该是已经端口占用了" class="headerlink" title="应该是已经端口占用了"></a>应该是已经端口占用了</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -nat |grep -i &#x27;7233&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.shaojiemike.top/img/20220331163621.png"></p>
<h3 id="1-可以选择换端口"><a href="#1-可以选择换端口" class="headerlink" title="1 可以选择换端口"></a>1 可以选择换端口</h3><p>换成 7233<br><img src="https://pic.shaojiemike.top/img/20220331170136.png"><br>success</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i TCP:7233</span><br></pre></td></tr></table></figure>
<ol>
<li>进程验证<br><img src="https://pic.shaojiemike.top/img/20220331170226.png"></li>
<li>wget验证<br><img src="https://pic.shaojiemike.top/img/20220331170529.png"></li>
<li>curl验证（原本会走WLT）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redirecting to http://wlt.ustc.edu.cn</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/20220331171005.png"><br><img src="https://pic.shaojiemike.top/img/20220331171159.png"></p>
<h3 id="2-Kill掉相关进程"><a href="#2-Kill掉相关进程" class="headerlink" title="2 Kill掉相关进程"></a>2 Kill掉相关进程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i TCP:7890</span><br><span class="line">sudo kill -9 process_id_1 process_id_2 process_id_3</span><br><span class="line">sudo ps -ef | grep &#x27;nc -X&#x27; | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | sudo xargs -r kill -9</span><br><span class="line">sudo lsof -i TCP:7233 |grep shaojiemike| awk &#x27;&#123;print $2&#125;&#x27;|sudo xargs -r kill -9</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/20220331164212.png"><br>FD: File Descriptor number of</p>
<p><strong>不敢kill师兄的，然后发现并没有用，寄</strong></p>
<p>kill掉师兄的之后就行了，嘻嘻~~ 师兄不要怪我</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><p>服务器没网，姜师兄说可以转发网络请求到本地windows</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_704836f40100lwxh.html">http://blog.sina.com.cn/s/blog_704836f40100lwxh.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xyyangkun/article/details/7025854?utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1.no_search_link&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~default-1.no_search_link">https://blog.csdn.net/xyyangkun/article/details/7025854?utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.no_search_link</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-20T09:13:47.000Z" title="9/20/2022, 9:13:47 AM">2022-09-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.835Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">23 minutes read (About 3454 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/20/Work/Architecture/microHardware/RAM/">RAM</a></p><div class="content"><h2 id="RAM"><a href="#RAM" class="headerlink" title="RAM"></a>RAM</h2><p>RAM (random access memory), 中文名叫随机存储器， 随机是什么意思呢？ 意思是， 给定一个地址， 可以立即访问到数据（访问时间和位置无关）</p>
<p>而不像咱们熟悉的磁带， 知道最后一首歌在最后的位置， 却没法直接一下子跳到磁带的最后部门， 所以磁带不是随机存储器， 而是顺序存储器。</p>
<h2 id="SRAM-vs-DRAM"><a href="#SRAM-vs-DRAM" class="headerlink" title="SRAM vs DRAM"></a>SRAM vs DRAM</h2><p>SRAM (Static Random Access Memory) and DRAM (Dynamic Random Access Memory)</p>
<table>
<thead>
<tr>
<th>BASIS FOR COMPARISON</th>
<th>SRAM</th>
<th>DRAM</th>
</tr>
</thead>
<tbody><tr>
<td>Speed</td>
<td>Faster</td>
<td>Slower</td>
</tr>
<tr>
<td>Size</td>
<td>Small</td>
<td>Large</td>
</tr>
<tr>
<td>Cost</td>
<td>Expensive</td>
<td>Cheap</td>
</tr>
<tr>
<td>Used in</td>
<td>Cache memory</td>
<td>Main memory</td>
</tr>
<tr>
<td>Density</td>
<td>Less dense</td>
<td>Highly dense</td>
</tr>
<tr>
<td>Construction</td>
<td>Complex and uses transistors and latches.</td>
<td>Simple and uses capacitors and very few transistors.</td>
</tr>
<tr>
<td>Single block of memory requires</td>
<td>6 transistors</td>
<td>Only one transistor.</td>
</tr>
<tr>
<td>Charge leakage property</td>
<td>Not present</td>
<td>Present hence require power refresh circuitry</td>
</tr>
<tr>
<td>Power consumption</td>
<td>Low</td>
<td>High</td>
</tr>
</tbody></table>
<h3 id="基本电路实现"><a href="#基本电路实现" class="headerlink" title="基本电路实现"></a>基本电路实现</h3><p><img src="https://pic.shaojiemike.top/img/20220920172352.png"></p>
<p>左边的是静态的，右边的是dynamic的。</p>
<p>SRAM，保存一个bit需要6个晶体管。</p>
<p>DRAM 存储一个bit的DRAM只需要一个电容和一个晶体管。 DRAM的数据实际上是存在于电容里面的， 电容会有电的泄露， 损失状态， 故需要对电容状态进行保持和刷新处理， 以维持持久状态， 而这是需要时间的， 所以就慢了。而且很耗电。</p>
<p>DRAM内存实现的存储是通过晶体管实现的一个电路 门控D锁存器，其更简化的形式是 SR锁存器，电路结构如下图:</p>
<p><img src="https://pic.shaojiemike.top/img/20221009181818.png"></p>
<p>但是bank矩阵的一个点(基本存储单元， <strong>寻址能力</strong>, 内存颗粒（Chip）的位宽)一般是8bit.</p>
<p>8个 门控D锁存器 组成内存的基本（最小）存储单元，他们共用一个行&#x2F;列 地址线。在一次寻址中每个内存颗粒返回 8 bit的数据 8个内存可以同时寻址 最终得到的是 8 * 8（8个chip） &#x3D; 64 bit 的连续数据 也就是说 内存一次寻址可以读取 8 Byte 的数据，这里也能说明在C语言中的内存不齐的原因(减少寻址次数)。</p>
<h2 id="SDRAM"><a href="#SDRAM" class="headerlink" title="SDRAM"></a>SDRAM</h2><p>现在的DRAM一般都是SDRAM，即Synchronous Dynamic Random Access Memory，同步且能自由指定地址进行数据读写。其结构一般由许多个bank组成并利用以达到自由寻址。</p>
<p><img src="https://pic.shaojiemike.top/img/20220920194315.png"></p>
<p>chip的多 Bank 的设计允许向每个Bank 发出不同的命令。同一时刻，不同的bank可以处理不同的行地址。当然，不可能同时读取或者写入多个 Bank，因为读写通道只有 1 个，当时可以在 1 个 Bank 读写时，向另一个 Bank 发出 Precharge 或者 Active 命令。</p>
<p><img src="https://pic.shaojiemike.top/img/20220920194330.png"></p>
<h2 id="DRAM基本术语"><a href="#DRAM基本术语" class="headerlink" title="DRAM基本术语"></a>DRAM基本术语</h2><table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>dual inline memory modules (DIMMs).</td>
<td>每个channel可以连接多个DIMM，每个DIMM与多个DRAM chip相联</td>
</tr>
<tr>
<td>Cell：</td>
<td>颗粒中的一个数据存储单元叫做一个Cell，由一个电容和一个N沟道MOSFET组成。</td>
</tr>
<tr>
<td>chip：</td>
<td>一个颗粒叫做一个chip。一根内存的内存带宽是64bit，如果是单面就是8个8bit颗粒，如果是双面，那就是16个4bit的颗粒分别在两面，不算ECC颗粒(Error Checking and Correcting错误校验芯片)。</td>
</tr>
<tr>
<td>Bank</td>
<td>每个chip有4~8个bank，每个bank可以看作一个行列矩阵，每个点存储4~16bit的信息。</td>
</tr>
<tr>
<td>Rank：</td>
<td>内存PCB的一面所有颗粒叫做一个rank，目前在Unbuffered台式机内存上，通常一面是8个颗粒，所以单面内存就是1个rank，8个chip</td>
</tr>
<tr>
<td><strong>寻址空间</strong></td>
<td>是指内存总共可以存储多少个地址，比如一个2G DDR3内存 ，每个Rank是2&#x2F;1&#x3D;1G ，每个内存颗粒是1&#x2F;8&#x3D;128M 每个Bank是 128&#x2F;8&#x3D;16M 16M &#x3D; 2^4 * 2^10 &#x3D; 2^14 也就是地址线需要14根 正对应地址线的 A0-A13</td>
</tr>
</tbody></table>
<h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p><img src="https://pic.shaojiemike.top/img/20221010170938.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20221009171018.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20221009191635.png">{ width&#x3D;80% }</p>
<p><img src="https://pic.shaojiemike.top/img/20221009192231.png"></p>
<h3 id="CRC-Error-Detection"><a href="#CRC-Error-Detection" class="headerlink" title="CRC Error Detection"></a>CRC Error Detection</h3><p><img src="https://pic.shaojiemike.top/img/20221009183456.png"></p>
<h2 id="DDR4-chip-内bank-bank-group设计"><a href="#DDR4-chip-内bank-bank-group设计" class="headerlink" title="DDR4 chip 内bank &amp; bank group设计"></a>DDR4 chip 内bank &amp; bank group设计</h2><p><img src="https://pic.shaojiemike.top/img/20221009183919.png"></p>
<p>每個DRAM裏有4個bank選取位元可用來選取多達16個bank單元：兩個bank位址位元（BA0、BA1），和兩個bank群組位元（BG0、BG1）。當在同一個bank群組中存取不同的bank單元時會有另外的時間限制；在不同的bank群組中，存取一個bank比以往的更快。</p>
<p>另外，3個晶片層選取信號（C0、C1、C2），允許最多8個堆疊式晶片層封裝於一塊DRAM封裝上。這可以更有效地充當3個以上的bank單元選取位元，使選取總數達到7（可以定位128個bank單元）。</p>
<h2 id="内存控制器-Memory-Controller"><a href="#内存控制器-Memory-Controller" class="headerlink" title="内存控制器(Memory Controller)"></a>内存控制器(Memory Controller)</h2><p><img src="https://pic.shaojiemike.top/img/20221009171106.png"></p>
<p>我们知道cache的存在导致访存是按照cache line(32或者64字节)来进行的，但是内存一般只会处理连续64bits数据，导致需要控制器和总线分多周期(memory burst概念)来实现cache的更新。</p>
<p>SNB CPU的内存控制器可以实现和处理:</p>
<ul>
<li>对读写操作命令进行有效地<strong>重新分配</strong>，以使得行地址激活命中率最大化（如果重复激活一个已经处于激活状态的行地址，那就是RAS激活命令未命中）</li>
<li>比如说open page policy情况下，row hit就不用发activate命令，直接发column就可以了，</li>
<li>比如说两个地址连续mem_read命令，中间插有其他命令的时候是不是要乱序执行</li>
</ul>
<p>!!! example “reduction in DRAM row buffer conflicts”</p>
<pre><code>![](https://pic.shaojiemike.top/shaojiemike/2023/11/c86a06269bd173a7bd2554c57b727884.png)[^1]
</code></pre>
<h3 id="CPU集成内存控制器技术"><a href="#CPU集成内存控制器技术" class="headerlink" title="CPU集成内存控制器技术"></a>CPU集成内存控制器技术</h3><p>AMD公司提高CPU与内存性能的一项技术，将北桥的内存控制器集成到CPU，使得原来CPU－北桥－内存三方传输数据的过程简化成CPU与内存之间的单向传输技术，降低了延迟。</p>
<h2 id="DRAM-寻址模式"><a href="#DRAM-寻址模式" class="headerlink" title="DRAM 寻址模式"></a>DRAM 寻址模式</h2><p><img src="https://pic.shaojiemike.top/img/20221009191027.png"></p>
<ul>
<li>列数一般是1024，主要是因为功耗的原因</li>
</ul>
<p>以2GB DDR3为例子，编码如上,</p>
<ol>
<li>确定好rank面后</li>
<li>对该rank面的所有内存颗粒(chip),使用相同的Bank层 、行地址 、列地址 这些选址信息后，各自产生8bits数据，总共64bits<ol>
<li>单个 Bank 只有一个 Sense Amps，只能缓存单个行的内容。因此在激活某行后，访问同一 Bank 不同行之前，需要使用 PRECHARGE 命令关闭（de-activate）当前激活行。PRECHARGE 命令好比关上当前打开的文件柜抽屉，命令发出后当前 Sense Amps 中缓存的行会被写回原地址。</li>
</ol>
</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20221009190714.png"></p>
<h2 id="Burst"><a href="#Burst" class="headerlink" title="Burst"></a>Burst</h2><p>DDR中的Burst(突发长度)指的是，当收到了一个读请求和地址后，会<strong>连续</strong>取出这个地址周围几个连续地址上的数据，具体取几个就叫BL(Burst Length)，是可以随地址信号配置的。(原因是：次次等待Address和Enable信号再读写有些浪费时间)</p>
<p>Burst的实现是通过Prefetch完成的，Prefetch就是一次从Array上取出多bit的过程，而Burst则是根据规则发送这些预取的数据的过程。<img src="https://pic.shaojiemike.top/shaojiemike/2023/11/a0a658e210e160b964bd2ca9336e4067.png"></p>
<p>Burst Length(BL)是可以配置的，比如8Bit预取可以支持<strong>BL8</strong>的Burst或者<strong>BC4</strong>(Burst Length Chopped)的Burst。</p>
<h2 id="Prefetch-Request-Pipelining"><a href="#Prefetch-Request-Pipelining" class="headerlink" title="Prefetch (Request Pipelining)"></a>Prefetch (Request Pipelining)</h2><p>Prefetch数量也是前几代DDR的主要区别。<img src="https://pic.shaojiemike.top/img/20221122164127.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220314235509.png"></p>
<p>红框标出的DRAM的核心频率基本不变，传输速度的提高是通过增加prefetch的位数（黄框）来做到的。</p>
<p>DDR 有两项主要的技术 2n-prefetch （2 倍预取），和 DLL （延迟锁相环）。这在之后历代 DDR 协议中都是一脉相承的。所谓 2 倍预取，即在一个时钟的上升边沿读取当前地址单元的数据，并同时读取下一个地址单元的数据。</p>
<p>??? example “例如同样是100MHz的核心频率”</p>
<pre><code>  1. SDRAM一周期取一次，它和内存控制器的速度是`100MT/s`（这里的T是传输的意思）；
  2. DDR上升沿下降沿各取一次，相当于2次prefetch，Bus速度变成200；
  3. DDR2变成4n prefetch，Bus speed变成400；
  4. DDR3，照此办理，8n带来了800。DDR3/4 采用的是 8 倍预取，8n-prefetch，同时也设计有 DLL。
</code></pre>
<h3 id="DDR3"><a href="#DDR3" class="headerlink" title="DDR3"></a>DDR3</h3><p>DDRx的核心频率一直维持在100Mhz到266MHz的水平上，每代速度的提升都是靠倍增Prefetch的个数来达到的。</p>
<h3 id="DDR4"><a href="#DDR4" class="headerlink" title="DDR4"></a>DDR4</h3><p>DDR4和DDR3一样，只有8n的prefetch，但为了提升前端Front End的总线速度，不得不在核心频率上动起了手脚：</p>
<p>核心频率不在徘徊在100～266HMz，直接200起跳，到400Mhz。因为核心频率提高，8bit的prefetch不变，总线速度才得以提升。</p>
<p>除此之外，引入了Bank Group。DDR4 新增了4 個Bank Group 資料組的設計，各個Bank Group具備獨立啟動操作讀、寫等動作特性，Bank Group 資料組可套用多工的觀念來想像，亦可解釋為DDR4 在同一時脈工作周期內，至多可以處理4 筆資料，效率明顯好過於DDR3。</p>
<h4 id="为什么DDR4不能进一步提高prefetch到16n的问题"><a href="#为什么DDR4不能进一步提高prefetch到16n的问题" class="headerlink" title="为什么DDR4不能进一步提高prefetch到16n的问题"></a>为什么DDR4不能进一步提高prefetch到16n的问题</h4><p>我们都知道memory控制器实际上很大程度受cache操纵。X86 cache line 64B，而每次操作是64bit。所以一个cache line刷新是通过联系8个读操作实现的，这8个操作不是分别完成，而是一次burst操作，所以BL(burst line)是8。BL8的64B cache line只需要64个Bytes，如果prefetch是16，DIMM那边所有chip会准备</p>
<p>64 X 16 &#x3D; 128 Byte</p>
<p>的数据。多出来的数据就变成了垃圾数据，空耗能而对速度帮助不大，所以DDR4到16 prefetch。</p>
<h3 id="DDR5-为啥变成16n-prefetch呢？"><a href="#DDR5-为啥变成16n-prefetch呢？" class="headerlink" title="DDR5 为啥变成16n prefetch呢？"></a>DDR5 为啥变成16n prefetch呢？</h3><p>是不是CPU的cache line变长了呢？并不是，CPU的cache line还是64B，变化的是DIMM端增加了个新东西：Sub Channel。</p>
<p>Sub Channel，顾名思义，就是子通道，它是把DDR5 DIMM的72bit位宽（包括64bit数据+8bit ECC码）拆分成两个40bit的sub Channel。包括32bit的数据，+8bit的ECC：</p>
<p>这两个sub channel是相互独立的，既可以独立使用，也可以如前面合并使用。所以prefetch就可以提高到16n，当然也支持8n。</p>
<p>聪明的设计让DDR5在同样3200MT&#x2F;s的传输率上，可以提高带宽1.36倍。再加上可以支持更高的频率，才能保证DDR5的传输速度。</p>
<p>DDR5的prefetch是16，那么怎么解决我们前面提到的cache line大小的问题呢？DDR5采取的方式是减少DIMM data lane的数量，从64个data lane降低到32个data lane，从而继续保持64 Byte的cache line大小。</p>
<h2 id="访存时序知识"><a href="#访存时序知识" class="headerlink" title="访存时序知识"></a>访存时序知识</h2><p>CL-tRCD-tRP-tRAS-CR</p>
<table>
<thead>
<tr>
<th>名词</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>CL(CAS Latency)</td>
<td>列信号延迟: 在读取命令发出后到数据读出到IO接口的间隔时间(时钟周期数)</td>
</tr>
<tr>
<td>tCAS(tCL?)</td>
<td>实际延迟时间tCAS（ns）&#x3D;（CAS*2000）&#x2F;内存等效频率</td>
</tr>
<tr>
<td>tRAS(Row Active Time)</td>
<td>行地址激活的时间。从一个行地址预充电之后，从激活到寻址再到读取完成所经过的整个时间 tRCD+tCL</td>
</tr>
<tr>
<td>tRCD(Read-to-Column Delay)</td>
<td>行地址激活（Active）命令发出之后，内存对行地址的操作所需要的时间。内存中某一行地址被激活时，我们称它为“open page”</td>
</tr>
<tr>
<td>tRCDR(Read-to-Column Command Delay)</td>
<td>行地址激活（Active）命令发出之后，内存对行地址的<strong>读操作</strong>所需要的时间。</td>
</tr>
<tr>
<td>tRCDW(Write-to-Column Command Delay)</td>
<td>行地址激活（Active）命令发出之后，内存对行地址的<strong>写操作</strong>所需要的时间。</td>
</tr>
<tr>
<td>nWR (Write Recovery Time)</td>
<td>time delay between successive write commands to the same row.</td>
</tr>
<tr>
<td>tRP(RAS Precharge Time)</td>
<td>前一个行地址操作完成并在行地址关闭（page close）命令发出之后，准备对同一个bank中下一个行地址进行Active操作需要的时间(在对同一个bank的多个不同的行地址进行操作时影响才大)</td>
</tr>
<tr>
<td>CR(Command Rate)</td>
<td>首命令延迟。是指从选定bank之后到可以发出行地址激活命令所经过的时间。(如果CPU所需要的数据都在内存的一个行地址上，就不需要进行重复多次的bank选择，CR的影响就很小)</td>
</tr>
<tr>
<td>Tccd</td>
<td>is the minimum amount of time between column operations</td>
</tr>
<tr>
<td>tRPRE</td>
<td>The minimum pulse width of READ preamble</td>
</tr>
<tr>
<td>tRPST</td>
<td>The minimum pulse width of READ postamble</td>
</tr>
</tbody></table>
<p>XMP时序都没有介绍</p>
<p>不同的DRAM。随着频率提升，CL周期也同步提升，但是最后算出来的CL延迟时间却差不多(5~15ns)。其实当下memory的频率宽度过剩，integrated memory controller (IMC)才是瓶颈</p>
<p>在列信号之前还有行信号<br><img src="https://pic.shaojiemike.top/img/20221122164331.png"></p>
<p>如何连续两次访问同一行的不同列，则之间不需要额外的切换行信号。<br><img src="https://pic.shaojiemike.top/img/20221122162826.png"></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/52272990">https://zhuanlan.zhihu.com/p/52272990</a></p>
<p><a target="_blank" rel="noopener" href="https://fantiq.github.io/2019/03/14/%E5%86%85%E5%AD%98-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">https://fantiq.github.io/2019/03/14/%E5%86%85%E5%AD%98-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</a></p>
<p><a target="_blank" rel="noopener" href="https://people.inf.ethz.ch/omutlu/pub/stfm_micro07.pdf">https://people.inf.ethz.ch/omutlu/pub/stfm_micro07.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://www.micron.com/-/media/client/global/documents/products/data-sheet/dram/ddr4/4gb_ddr4_dram_2e0d.pdf">https://www.micron.com/-/media/client/global/documents/products/data-sheet/dram/ddr4/4gb_ddr4_dram_2e0d.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/420994258">https://zhuanlan.zhihu.com/p/420994258</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-14T00:32:02.000Z" title="9/14/2022, 12:32:02 AM">2022-09-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.831Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Algorithms/">Algorithms</a></span><span class="level-item">8 minutes read (About 1261 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/14/Work/Algorithms/datastructure/hashmap/">Hash map</a></p><div class="content"><h2 id="hash的相关基本知识"><a href="#hash的相关基本知识" class="headerlink" title="hash的相关基本知识"></a>hash的相关基本知识</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/guoben/p/13339280.html">https://www.cnblogs.com/guoben/p/13339280.html</a></p>
<p>散列表的装填因子定义为：α&#x3D; 填入表中的元素个数 &#x2F; 散列表的长度</p>
<p>α是散列表装满程度的标志因子。由于表长是定值，α与“填入表中的元素个数”成正比，所以，α越大，填入表中的元素较多，产生冲突的可能性就越大；α越小，填入表中的元素较少，产生冲突的可能性就越小。</p>
<h2 id="unordered-map定义"><a href="#unordered-map定义" class="headerlink" title="unordered_map定义"></a>unordered_map定义</h2><p>在<strong>插入</strong>元素时,根据待插入元素的关键码,以hashfunc计算出该元素的存储位置,在结构中按此位置进行存放</p>
<p>在<strong>搜索</strong>元素时,对关键码进行同样的计算,把求得的函数值当做元素的存储位置,在结构中按此位置去元素比较,若关键码相等,则搜索成功</p>
<p>C++11 定义了std::hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">template&lt;</span><br><span class="line">    class Key,</span><br><span class="line">    class T,</span><br><span class="line">    class Hash = std::hash&lt;Key&gt;,</span><br><span class="line">    class KeyEqual = std::equal_to&lt;Key&gt;,</span><br><span class="line">    class Allocator = std::allocator&lt; std::pair&lt;const Key, T&gt; &gt;</span><br><span class="line">&gt; class unordered_map;</span><br></pre></td></tr></table></figure>
<p>很明显可以reserve设置大小<br><img src="https://pic.shaojiemike.top/img/20220914084929.png"></p>
<h2 id="unordered-map详解"><a href="#unordered-map详解" class="headerlink" title="unordered_map详解"></a>unordered_map详解</h2><p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/7231.html">http://c.biancheng.net/view/7231.html</a></p>
<h2 id="自定义结构体hash函数"><a href="#自定义结构体hash函数" class="headerlink" title="自定义结构体hash函数"></a>自定义结构体hash函数</h2><h3 id="hashfunc设计原则"><a href="#hashfunc设计原则" class="headerlink" title="hashfunc设计原则"></a>hashfunc设计原则</h3><p>哈希函数的定义域必须包括需要存储的全部关键码,而如果散列表允许m个地址时,其值域必须在0-(m-1)之间</p>
<p>哈希函数计算出来的地址能均匀分布在整个空间中</p>
<p>哈希函数应该比较简单</p>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/HappyKocola/article/details/74188452">https://blog.csdn.net/HappyKocola/article/details/74188452</a></p>
<p>如果想让自定义的class作为key（unordered_map&lt;key,value&gt;）来使用unordered_map，需要实现：</p>
<ol>
<li>哈希函数，需要实现一个class重载operator()，将自定义class变量映射到一个size_t类型的数。一般常用std::hash模板来实现。<ol>
<li>For two parameters k1 and k2 that are <strong>equal</strong>, <code>std::hash&lt;Key&gt;()(k1) == std::hash&lt;Key&gt;()(k2).</code></li>
<li>For two different parameters k1 and k2 that are <strong>not equal</strong>, the probability that <code>std::hash&lt;Key&gt;()(k1) == std::hash&lt;Key&gt;()(k2)</code> should <strong>be very small</strong>, approaching <code>1.0/std::numeric_limits&lt;std::size_t&gt;::max()</code>.</li>
</ol>
</li>
<li>判断两个自定义class类型的key变量是否相等的函数，一般在自定义class里重载operator&#x3D;&#x3D;。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">template &lt;&gt;</span><br><span class="line">   struct hash&lt;Myclass&gt;</span><br><span class="line">   &#123;</span><br><span class="line">       size_t operator()(const Myclass &amp;k) const</span><br><span class="line">       &#123;</span><br><span class="line">           int h = k.first;</span><br><span class="line">           for (auto x : k.second)</span><br><span class="line">           &#123;</span><br><span class="line">               h ^= x;</span><br><span class="line">           &#125;</span><br><span class="line">           return h;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct MyHash</span><br><span class="line">&#123;</span><br><span class="line">  size_t operator() (const pair&lt;int,int&gt;&amp; p) const</span><br><span class="line">  &#123;</span><br><span class="line">    return hash&lt;long long&gt;()( (static_cast&lt;long long&gt;(x.first) ) </span><br><span class="line">    ^ ( (static_cast&lt;long long&gt;(x.first))&lt;&lt;32) );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="防止冲突的自定义hash"><a href="#防止冲突的自定义hash" class="headerlink" title="防止冲突的自定义hash"></a>防止冲突的自定义hash</h3><p>防止黑客攻击</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21433411/article/details/88365164">https://blog.csdn.net/qq_21433411/article/details/88365164</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct custom_hash &#123;</span><br><span class="line">    static uint64_t splitmix64(uint64_t x) &#123;</span><br><span class="line">        // http://xorshift.di.unimi.it/splitmix64.c</span><br><span class="line">        x += 0x9e3779b97f4a7c15;</span><br><span class="line">        x = (x ^ (x &gt;&gt; 30)) * 0xbf58476d1ce4e5b9;</span><br><span class="line">        x = (x ^ (x &gt;&gt; 27)) * 0x94d049bb133111eb;</span><br><span class="line">        return x ^ (x &gt;&gt; 31);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size_t operator()(uint64_t x) const &#123;</span><br><span class="line">        static const uint64_t FIXED_RANDOM = chrono::steady_clock::now().time_since_epoch().count();</span><br><span class="line">        return splitmix64(x + FIXED_RANDOM);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="结构体万能hash"><a href="#结构体万能hash" class="headerlink" title="结构体万能hash"></a>结构体万能hash</h3><p><a target="_blank" rel="noopener" href="https://supwills.com/post/hash-function-strategy/#%E4%B8%87%E7%94%A8-hash-function">解释见转载的作者</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">template &lt;typename T&gt;</span><br><span class="line">inline void hash_combine(size_t&amp; seed, const T&amp; val)</span><br><span class="line">&#123;</span><br><span class="line">    seed ^= std::hash&lt;T&gt;()(val) + 0X9E3779B9 + (seed &lt;&lt; 6) + (seed &gt;&gt; 2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line">inline void hash_val(size_t&amp; seed, const T&amp; val)</span><br><span class="line">&#123;</span><br><span class="line">    hash_combine(seed, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template &lt;typename T, typename... Types&gt;</span><br><span class="line">inline void hash_val(size_t&amp; seed, const T&amp; val, const Types&amp;... args)</span><br><span class="line">&#123;</span><br><span class="line">    hash_combine(seed, val);</span><br><span class="line">    hash_val(seed, args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template &lt;typename... Types&gt;</span><br><span class="line">inline size_t hash_val(const Types&amp;... args)</span><br><span class="line">&#123;</span><br><span class="line">    size_t seed = 0;</span><br><span class="line">    hash_val(seed, args...);</span><br><span class="line">    return seed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyObject&#123;</span><br><span class="line">public:</span><br><span class="line">    string a;</span><br><span class="line">    char b;</span><br><span class="line">    unsigned c;</span><br><span class="line">    bool operator==(const MyObject&amp; rhs) const</span><br><span class="line">    &#123;</span><br><span class="line">        return a == rhs.a &amp;&amp; b == rhs.b &amp;&amp; c == rhs.c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    bool operator!=(const MyObject&amp; rhs) const</span><br><span class="line">    &#123;</span><br><span class="line">        return !operator==(rhs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    friend ostream&amp; operator&lt;&lt;(ostream&amp; os, const MyObject&amp; ptr)</span><br><span class="line">    &#123;</span><br><span class="line">        return os &lt;&lt; ptr.a &lt;&lt; &quot;   &quot; &lt;&lt; ptr.b &lt;&lt; &quot;   &quot; &lt;&lt; ptr.c &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class MyHashFunction&#123;</span><br><span class="line">public:</span><br><span class="line">    std::size_t operator()(const MyObject&amp; obj) const &#123;</span><br><span class="line">        return hash_val(obj.a, obj.b, obj.c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="unordered-map性能"><a href="#unordered-map性能" class="headerlink" title="unordered_map性能"></a>unordered_map性能</h2><h3 id="加快-std-unorderd-map-的速度"><a href="#加快-std-unorderd-map-的速度" class="headerlink" title="加快 std::unorderd_map 的速度"></a>加快 std::unorderd_map 的速度</h3><p>为了避免动态改变哈希表的大小，可以预估容器中带插入元素的数量，并且预先申请好内存空间，避免动态分配过程中造成的 rehash 现象。当容器中的总元素超出了填充因子时，容器会重新申请更大的内存扩充桶的数量，然后重新哈希。</p>
<p>例如，我会预先调用 reverse 成员函数预先分配内存空间，以及设置好最大填充因子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;int,int&gt; hash;</span><br><span class="line">mp.reserve(1024);</span><br><span class="line">mp.max_load_factor(0.25);</span><br></pre></td></tr></table></figure>

<p>但是没什么用？</p>
<h3 id="Google-开源的-abesil-flat-hash-map"><a href="#Google-开源的-abesil-flat-hash-map" class="headerlink" title="Google 开源的 abesil flat hash map"></a>Google 开源的 abesil flat hash map</h3><p>Google 则采用了开放寻址法中最简单的线性探测方法来解决哈希碰撞，取得了更快的速度。</p>
<p>开放定址法,当哈希表未满,在插入同义字时,可以把<strong>key值</strong>存放在下一个空位置(线性探测)<br>线性探测: 从发生冲突的位置开始,依次向后探测,直到寻找下一个空位置为止.</p>
<p>更快，<a target="_blank" rel="noopener" href="https://supwills.com/post/hash-function-strategy/#stdunordered_map-%E7%9A%84%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98">解释开发寻址法，cache更优秀</a></p>
<h2 id="高性能"><a href="#高性能" class="headerlink" title="高性能"></a>高性能</h2><p><a target="_blank" rel="noopener" href="https://github.com/greg7mdp/parallel-hashmap">https://github.com/greg7mdp/parallel-hashmap</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/greg7mdp/sparsepp">https://github.com/greg7mdp/sparsepp</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>IPCC比赛的时候，发现用hash map会比红黑树的map慢。感觉不对劲，我hash空间声明大，冲突不就低了吗？</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-08T12:01:51.000Z" title="9/8/2022, 12:01:51 PM">2022-09-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.851Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 506 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/08/Work/network/0-basic/DNS/">DNS</a></p><div class="content"><h2 id="DNS污染"><a href="#DNS污染" class="headerlink" title="DNS污染"></a>DNS污染</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><img src="https://pic.shaojiemike.top/img/20220908200452.png"></p>
<h3 id="查看DNS地址"><a href="#查看DNS地址" class="headerlink" title="查看DNS地址"></a>查看DNS地址</h3><p>在<a target="_blank" rel="noopener" href="https://dnschecker.org/#A/api.themoviedb.org">DNS索引网站</a>查看域名的中国服务器IP地址</p>
<p>实际ping速度，修改win10的hosts文件在<code>C:\WINDOWS\system32\drivers\etc</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ipconfig /all</span><br><span class="line"></span><br><span class="line">Ethernet adapter 以太网:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : ustc.edu.cn</span><br><span class="line">   Description . . . . . . . . . . . : Realtek PCIe GbE Family Controller</span><br><span class="line">   Physical Address. . . . . . . . . : 00-2B-67-7D-A7-93</span><br><span class="line">   DHCP Enabled. . . . . . . . . . . : Yes</span><br><span class="line">   Autoconfiguration Enabled . . . . : Yes</span><br><span class="line">   IPv6 Address. . . . . . . . . . . : 2001:da8:d800:336:c9a6:8e7f:7035:cd(Preferred)</span><br><span class="line">   Link-local IPv6 Address . . . . . : fe80::c9a6:8e7f:7035:cd%5(Preferred)</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 202.38.78.133(Preferred)</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Lease Obtained. . . . . . . . . . : 2022年9月3日 15:03:56</span><br><span class="line">   Lease Expires . . . . . . . . . . : 2022年9月11日 19:58:06</span><br><span class="line">   Default Gateway . . . . . . . . . : fe80::e683:26ff:fea3:e107%5</span><br><span class="line">                                       202.38.78.254</span><br><span class="line">   DHCP Server . . . . . . . . . . . : 202.38.64.7</span><br><span class="line">   DHCPv6 IAID . . . . . . . . . . . : 100674407</span><br><span class="line">   DHCPv6 Client DUID. . . . . . . . : 00-01-00-01-26-96-E5-7D-00-2B-67-7D-A7-93</span><br><span class="line">   DNS Servers . . . . . . . . . . . : 8.8.8.8</span><br><span class="line">   NetBIOS over Tcpip. . . . . . . . : Enabled</span><br></pre></td></tr></table></figure>
<p>ping 百度 B站没有问题</p>
<h3 id="浏览器F12"><a href="#浏览器F12" class="headerlink" title="浏览器F12"></a>浏览器F12</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Unchecked runtime.lastError: The message port closed before a response was received.</span><br><span class="line">Failed to load resource: net::ERR_PROXY_CONNECTION_FAILED</span><br><span class="line">Failed to load resource: net::ERR_CONNECTION_CLOSED</span><br><span class="line">Failed to load resource: net::ERR_CONNECTION_RESET</span><br></pre></td></tr></table></figure>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>网络重置<img src="https://pic.shaojiemike.top/img/20220908204210.png"></p>
<h2 id="github-com无法访问"><a href="#github-com无法访问" class="headerlink" title="github.com无法访问"></a>github.com无法访问</h2><p>ping失败,原因是某些github关闭了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//Windows</span><br><span class="line">D:\PowerShell&gt; nslookup github.com 223.5.5.5</span><br><span class="line">Server:  public1.alidns.com</span><br><span class="line">Address:  223.5.5.5</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:    github.com</span><br><span class="line">Address:  20.205.243.166</span><br></pre></td></tr></table></figure>
<p>最不济修改host文件，<a target="_blank" rel="noopener" href="https://ipaddress.com/website/github.com">https://ipaddress.com/website/github.com</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">\\Ubuntu</span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:39]</span><br><span class="line">$ cat /run/systemd/resolve/resolv.conf</span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 8.8.4.4</span><br><span class="line">nameserver 202.38.64.1</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:12]      </span><br><span class="line">$ cat /etc/resolv.conf     </span><br><span class="line">nameserver 127.0.0.53</span><br><span class="line">options edns0 trust-ad</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:30:16]</span><br><span class="line">$ nmcli device show eno0</span><br><span class="line">GENERAL.DEVICE:                         eno0</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         AC:1F:6B:8A:E4:BA</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.STATE:                          10 (unmanaged)</span><br><span class="line">GENERAL.CONNECTION:                     --</span><br><span class="line">GENERAL.CON-PATH:                       --</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               on</span><br><span class="line">IP4.ADDRESS[1]:                         202.38.73.217/24</span><br><span class="line">IP4.GATEWAY:                            --</span><br><span class="line">IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 202.38.73.254, mt = 0, table=1</span><br><span class="line">IP4.ROUTE[2]:                           dst = 202.38.73.0/24, nh = 0.0.0.0, mt = 0</span><br><span class="line">IP6.ADDRESS[1]:                         2001:da8:d800:730::217/64</span><br><span class="line">IP6.ADDRESS[2]:                         fe80::ae1f:6bff:fe8a:e4ba/64</span><br><span class="line">IP6.GATEWAY:                            2001:da8:d800:730::1</span><br><span class="line">IP6.ROUTE[1]:                           dst = 2001:da8:d800:112::23/128, nh = 2001:da8:d800:730::1, mt = 1024</span><br><span class="line">IP6.ROUTE[2]:                           dst = 2001:da8:d800:730::/64, nh = ::, mt = 256</span><br><span class="line">IP6.ROUTE[3]:                           dst = fe80::/64, nh = ::, mt = 256</span><br><span class="line">IP6.ROUTE[4]:                           dst = ::/0, nh = 2001:da8:d800:730::1, mt = 1024</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~ [19:41:53]</span><br><span class="line">$ dig www.baidu.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.baidu.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 47773</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; OPT PSEUDOSECTION:</span><br><span class="line">; EDNS: version: 0, flags:; udp: 65494</span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.baidu.com.                 IN      A</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.baidu.com.          604     IN      CNAME   www.a.shifen.com.</span><br><span class="line">www.a.shifen.com.       159     IN      A       14.215.177.39</span><br><span class="line">www.a.shifen.com.       159     IN      A       14.215.177.38</span><br><span class="line"></span><br><span class="line">;; Query time: 91 msec</span><br><span class="line">;; SERVER: 127.0.0.53#53(127.0.0.53)</span><br><span class="line">;; WHEN: Mon Oct 10 19:43:01 CST 2022</span><br><span class="line">;; MSG SIZE  rcvd: 101</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-09-02T09:07:34.000Z" title="9/2/2022, 9:07:34 AM">2022-09-02</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.855Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">6 minutes read (About 825 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/09/02/Work/software/linux/ubuntu/">Ubuntu server reInstall</a></p><div class="content"><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li>写U盘（见<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dbe64ce09b74">网上教程</a>，注意备份U盘文件）</li>
<li>插U盘，开机前根据机器型号使用命令(F2，F4, F12或者Del)进入boit manager，选择从U盘boot<ol>
<li>改引导启动顺序，把U盘启动改到最前面<img src="https://pic.shaojiemike.top/img/20220902174441.png"></li>
</ol>
</li>
<li>根据提示安装ubuntu(服务器不用分区，默认就行，如果自己电脑双系统则需要根据内存设置分区)</li>
<li>设置root密码并进入root <code>sudo passwd root</code></li>
<li>配置实验室网络</li>
</ol>
<h3 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h3><p><a target="_blank" rel="noopener" href="https://ubuntu.com/download/server">官网下载</a></p>
<h2 id="重装系统怎么保留原本的磁盘文件"><a href="#重装系统怎么保留原本的磁盘文件" class="headerlink" title="重装系统怎么保留原本的磁盘文件"></a>重装系统怎么保留原本的磁盘文件</h2><p>只要在安装系统时分出一个&#x2F;home分区。你可以把Ubuntu的“&#x2F;”分区看为Windows的C盘，重装Ubuntu时只格式化“&#x2F;”分区，不格式化“&#x2F;home”，这样就可以保留“&#x2F;home”中的数据了。使用的时候就挂载就行</p>
<p>但是假如一开始没分区:</p>
<ol>
<li>可以插块新盘当作系统盘，系统安装好之后，把旧的文件系统挂载到新系统的某个目录下</li>
<li>从旧的文件系统里划出一块区域，安装新系统。<ol>
<li>在你要安装的目标磁盘中，通过删除卷和删除分区操作腾出一块未分配的磁盘空间作为安装区</li>
</ol>
</li>
</ol>
<h2 id="从已有分区中提取空间"><a href="#从已有分区中提取空间" class="headerlink" title="从已有分区中提取空间"></a>从已有分区中提取空间</h2><p>xfs类型不可以直接缩减，只扩不减。如果是ext2，ext3，ext4可以在线缩减，如果xfs盘要缩小就要删除后重新添加</p>
<p><a target="_blank" rel="noopener" href="https://www.ywbj.cc/?p=712">https://www.ywbj.cc/?p=712</a></p>
<h3 id="非系统根分区LVM缩容"><a href="#非系统根分区LVM缩容" class="headerlink" title="非系统根分区LVM缩容"></a>非系统根分区LVM缩容</h3><ol>
<li>取消挂载<br>系统根分区无法在线取消挂载，所以这时请勿对系统根分区执行任何缩容操作   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount /lv/ #取消挂载目录</span><br></pre></td></tr></table></figure></li>
<li>e2fsck检查修复磁盘完整性   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e2fsck -f /dev/vg0/lv0</span><br></pre></td></tr></table></figure></li>
<li>缩小系统文件空间，即<code>df -h</code>查看的空间<br>不取消挂载，这步会报错，注：一定先减文件系统，再减逻辑卷   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resize2fs /dev/vg0/lv0 10G</span><br></pre></td></tr></table></figure></li>
<li>缩小磁盘空间，即lsblk查看的空间<br>不执行上面的操作，直接执行这步，虽然成功，但是会操作数据丢失，系统无法启动。   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvreduce -L 10G /dev/vg0/lv0</span><br></pre></td></tr></table></figure></li>
<li>重新挂载   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a</span><br></pre></td></tr></table></figure>
最后查看lvs空间</li>
</ol>
<h3 id="系统根分区LVM缩容（救援模式）"><a href="#系统根分区LVM缩容（救援模式）" class="headerlink" title="系统根分区LVM缩容（救援模式）"></a>系统根分区LVM缩容（救援模式）</h3><p>正常启动系统进入救援模式 ：启动按shift键，出现选择系统界面，按e。找到以单词 linux 开头的行，并在该行的末尾添加以下内容（要到达末尾，只需按下 CTRL+e 或使用 END 键或左右箭头键）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemd.unit=rescue.target</span><br></pre></td></tr></table></figure>
<p>添加完成后，只需按下 <code>CTRL+x</code> 或 <code>F10</code> 即可继续启动救援模式。几秒钟后，你将以 root 用户身份进入救援模式（单用户模式）<br><img src="https://pic.shaojiemike.top/img/20220902182623.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40018873/article/details/109537532">https://blog.csdn.net/weixin_40018873/article/details/109537532</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ywbj.cc/?p=712">https://www.ywbj.cc/?p=712</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.827Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a few seconds read (About 98 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/OutOfWork/3-homepage/SSL/3-QiNiuSSL/">QiNiuSSL</a></p><div class="content"><h2 id="SSL证书的几种申请"><a href="#SSL证书的几种申请" class="headerlink" title="SSL证书的几种申请"></a>SSL证书的几种申请</h2><ol>
<li><a target="_blank" rel="noopener" href="https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate">七牛免费证书</a><br><img src="http://pic.shaojiemike.top/PicGo20210712100907.png"><br><img src="http://pic.shaojiemike.top/PicGo20210712101204.png"></li>
<li>chivier自动更新免费脚本 </li>
<li>GitHub 教育优惠免费一年ssl证书</li>
</ol>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p> <a target="_blank" rel="noopener" href="https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate">https://developer.qiniu.com/fusion/kb/3725/how-to-apply-for-and-use-free-certificate</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.839Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">5 minutes read (About 753 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/HPC/MPI_OMP/MPICompilers/">MPI Compilers</a></p><div class="content"><h2 id="mpicc-vs-gcc"><a href="#mpicc-vs-gcc" class="headerlink" title="mpicc vs gcc"></a>mpicc vs gcc</h2><h3 id="OpenMPI"><a href="#OpenMPI" class="headerlink" title="OpenMPI"></a>OpenMPI</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">shaojiemike @ node5 <span class="keyword">in</span> ~ [7:20:31]</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">mpicc -showme</span></span><br><span class="line">gcc -I/usr/lib/x86_64-linux-gnu/openmpi/include/openmpi -I/usr/lib/x86_64-linux-gnu/openmpi/include -pthread -L/usr/lib/x86_64-linux-gnu/openmpi/lib -lmpi</span><br></pre></td></tr></table></figure>
<h3 id="IntelMPI"><a href="#IntelMPI" class="headerlink" title="IntelMPI"></a>IntelMPI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">source /opt/intel/oneapi/setvars.sh</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:45:06] C:1</span><br><span class="line">$ mpicc -compile_info</span><br><span class="line">gcc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -lrt -lpthread -Wl,-z,now -Wl,-z,relro -Wl,-z,noexecstack -Xlinker --enable-new-dtags -ldl</span><br><span class="line"></span><br><span class="line">&gt; mpicc -v                  </span><br><span class="line">mpigcc for the Intel(R) MPI Library 2021.5 for Linux*                                                                      </span><br><span class="line">Copyright Intel Corporation.</span><br><span class="line">Using built-in specs.       </span><br><span class="line">COLLECT_GCC=gcc             </span><br><span class="line">COLLECT_LTO_WRAPPER=/public1/soft/gcc/8.1.0/libexec/gcc/x86_64-pc-linux-gnu/8.1.0/lto-wrapper                              </span><br><span class="line">Target: x86_64-pc-linux-gnu </span><br><span class="line">Configured with: ./configure --prefix=/public1/soft/gcc/8.1.0 --enable-languages=c,c++,fortran --disable-multilib          </span><br><span class="line">Thread model: posix         </span><br><span class="line">gcc version 8.1.0 (GCC) </span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:45:16]</span><br><span class="line">$ mpiicc -compile_info</span><br><span class="line">icc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -ldl -lrt -lpthread</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC/SLIC on git:main x [15:50:09] C:255</span><br><span class="line">$ mpiicc -show</span><br><span class="line">icc -I&#x27;/opt/intel/oneapi/mpi/2021.1.1/include&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -L&#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -Xlinker --enable-new-dtags -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib/release&#x27; -Xlinker -rpath -Xlinker &#x27;/opt/intel/oneapi/mpi/2021.1.1/lib&#x27; -lmpifort -lmpi -ldl -lrt -lpthread</span><br></pre></td></tr></table></figure>

<h3 id="MPICH"><a href="#MPICH" class="headerlink" title="MPICH"></a>MPICH</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/github/IPCC2022-preliminary/run (float_trick*) [10:49:48]</span><br><span class="line">&gt; mpicc -show         </span><br><span class="line">gcc -I/public1/soft/mpich/3.1.4-gcc8.1.0/include -L/public1/soft/mpich/3.1.4-gcc8.1.0/lib -Wl,-rpath -Wl,/public1/soft/mpich/3.1.4-gcc8.1.0/lib -Wl,--enable-new-dtags -lmpi</span><br></pre></td></tr></table></figure>
<p>For MPICH, according to the mpicc man pages, <strong>mpicc -compile_info</strong> shows the flags for compiling a program, and <strong>mpicc -link_info</strong> shows the flags for linking a program.</p>
<p><strong>-showme</strong> (Open MPI) or <strong>-show</strong> (Open MPI, MPICH and derivates) use <strong>-showme:compile</strong> and <strong>-showme:link</strong> to obtain the options automatically</p>
<h2 id="安装选项查看"><a href="#安装选项查看" class="headerlink" title="安装选项查看"></a>安装选项查看</h2><h3 id="intelmpi"><a href="#intelmpi" class="headerlink" title="intelmpi"></a>intelmpi</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; mpirun -info</span><br><span class="line">HYDRA build details:</span><br><span class="line">    Version:                                 2021.5</span><br><span class="line">    Release Date:                            20211102 (id: 9279b7d62)</span><br><span class="line">    Process Manager:                         pmi</span><br><span class="line">    Bootstrap servers available:             ssh slurm rsh ll sge pbs pbsdsh pdsh srun lsf blaunch qrsh fork</span><br><span class="line">    Resource management kernels available:   slurm ll lsf sge pbs cobalt</span><br></pre></td></tr></table></figure>
<h3 id="MPICH-1"><a href="#MPICH-1" class="headerlink" title="MPICH"></a>MPICH</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~  [11:55:08]</span><br><span class="line">&gt; mpiexec --version               </span><br><span class="line">HYDRA build details:</span><br><span class="line">    Version:                                 3.1.4</span><br><span class="line">    Release Date:                            Fri Feb 20 15:02:56 CST 2015</span><br><span class="line">    CC:                              gcc    </span><br><span class="line">    CXX:                             g++    </span><br><span class="line">    F77:                             gfortran   </span><br><span class="line">    F90:                             gfortran   </span><br><span class="line">    Configure options:                       &#x27;--disable-option-checking&#x27; &#x27;--prefix=/public1/soft/mpich/3.1.4-gcc8.1.0&#x27; &#x27;CC=gcc&#x27; &#x27;CXX=g++&#x27; &#x27;FC=gfortran&#x27; &#x27;--cache-file=/dev/null&#x27; &#x27;--srcdir=.&#x27; &#x27;CFLAGS= -O2&#x27; &#x27;LDFLAGS= &#x27; &#x27;LIBS=-lpthread &#x27; &#x27;CPPFLAGS= -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpl/include -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpl/include -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/openpa/src -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/openpa/src -D_REENTRANT -I/public1/home/deploy/amd-mpich/mpich-3.1.4/src/mpi/romio/include&#x27;</span><br><span class="line">    Process Manager:                         pmi</span><br><span class="line">    Launchers available:                     ssh rsh fork slurm ll lsf sge manual persist</span><br><span class="line">    Topology libraries available:            hwloc</span><br><span class="line">    Resource management kernels available:   user slurm ll lsf sge pbs cobalt</span><br><span class="line">    Checkpointing libraries available:       </span><br><span class="line">    Demux engines available:                 poll select</span><br><span class="line"></span><br><span class="line">ipcc22_0029@ln121 ~  [11:55:31]</span><br><span class="line">&gt; mpichversion</span><br><span class="line">MPICH Version:          3.1.4</span><br><span class="line">MPICH Release date:     Fri Feb 20 15:02:56 CST 2015</span><br><span class="line">MPICH Device:           ch3:nemesis</span><br><span class="line">MPICH configure:        --prefix=/public1/soft/mpich/3.1.4-gcc8.1.0/ CC=gcc CXX=g++ FC=gfortran</span><br><span class="line">MPICH CC:       gcc    -O2</span><br><span class="line">MPICH CXX:      g++   -O2</span><br><span class="line">MPICH F77:      gfortran   -O2</span><br><span class="line">MPICH FC:       gfortran   -O2</span><br></pre></td></tr></table></figure>
<h3 id="OpenMPI-1"><a href="#OpenMPI-1" class="headerlink" title="OpenMPI"></a>OpenMPI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">## 安装了IB支持</span><br><span class="line">&gt; ompi_info | grep openib</span><br><span class="line">                 MCA btl: openib (MCA v2.1.0, API v3.0.0, Component v3.1.6)</span><br><span class="line"></span><br><span class="line">&gt; mpiexec --version      </span><br><span class="line">mpiexec (OpenRTE) 4.1.1</span><br><span class="line"></span><br><span class="line">Report bugs to http://www.open-mpi.org/community/help/</span><br><span class="line"></span><br><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [12:24:19]</span><br><span class="line">&gt; module load mpi/openmpi/4.1.1-gcc7.3.0 </span><br><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [12:24:51]</span><br><span class="line">&gt; mpicc -v                              </span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=/public1/soft/gcc/7.3.0/bin/gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/public1/soft/gcc/7.3.0/libexec/gcc/x86_64-pc-linux-gnu/7.3.0/lto-wrapper</span><br><span class="line">Target: x86_64-pc-linux-gnu</span><br><span class="line">Configured with: ./configure --prefix=/public1/soft/gcc/7.3.0 --disable-multilib</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 7.3.0 (GCC) </span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11312719/how-to-compile-mpi-with-gcc">https://stackoverflow.com/questions/11312719/how-to-compile-mpi-with-gcc</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T16:00:00.000Z" title="8/16/2022, 4:00:00 PM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.839Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">4 minutes read (About 537 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/HPC/MPI_OMP/MPI_InitSlowReason/">Why MPI_Init is slow</a></p><div class="content"><h2 id="MPI-Init的作用"><a href="#MPI-Init的作用" class="headerlink" title="MPI_Init的作用"></a>MPI_Init的作用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Init(&amp;argc, &amp;argv);</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11691870/what-happens-to-memory-after-i-call-mpi-init">StackOverflow的回答</a>是,Init在调用过程中初始化MPI库,并且在进程间建立通讯和编号。</p>
<p>知乎的回答: OpenMPI会在调用MPI_Init时按照你<strong>传递给mpirun的指令新建进程</strong>，而你传递给MPI_Init的参数，会被传递给新建的进程。</p>
<p>这似乎在暗示，两个进程不是同时产生和运行的。</p>
<h3 id="猜想1"><a href="#猜想1" class="headerlink" title="猜想1"></a>猜想1</h3><p>有顺序的观点是不成立的<br><img src="https://pic.shaojiemike.top/img/20220816231254.png"></p>
<p>即使有顺序 malloc的时间也没这么长。</p>
<h3 id="猜想2"><a href="#猜想2" class="headerlink" title="猜想2"></a>猜想2</h3><p>难道是malloc的数据需要MPI_Init复制一遍？</p>
<p>简单将MPI_Init提前到最开始，时间也基本没变，也不对。</p>
<p><img src="https://pic.shaojiemike.top/img/20220816231909.png"></p>
<p>如果单独写一个只有MPI_Init的程序,IntelMPI还是要耗时800ms</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/slurm/MPIInit  [11:42:32]</span><br><span class="line">&gt; srun -p IPCC -N 2 -n 2 -c 64 -t 1  MPI</span><br><span class="line">MPIInit          took 882.110047 ms</span><br><span class="line">MPIInit          took 892.112269 ms</span><br></pre></td></tr></table></figure>

<h2 id="测试比较超算上MPI-Init的时间"><a href="#测试比较超算上MPI-Init的时间" class="headerlink" title="测试比较超算上MPI_Init的时间"></a>测试比较超算上MPI_Init的时间</h2><p>以IPCC2022初赛的北京超算云 AMD机器举例</p>
<table>
<thead>
<tr>
<th>mpirun的选择</th>
<th>mpi版本</th>
<th>GCC或者ICC的选择版本</th>
<th>超算运行</th>
<th>MPI_Init时间(ms)</th>
</tr>
</thead>
<tbody><tr>
<td>IntelMPI</td>
<td>mpi&#x2F;intel&#x2F;2022.1</td>
<td>gcc&#x2F;10.2.0</td>
<td>只能sbatch,不能srun</td>
<td>1282.24 ~ 1678.59</td>
</tr>
<tr>
<td>OpenMPI</td>
<td>mpi&#x2F;openmpi&#x2F;4.1.1-gcc7.3.0</td>
<td></td>
<td></td>
<td>2706ms~3235ms</td>
</tr>
<tr>
<td>MPICH</td>
<td>mpich&#x2F;3.1.4-gcc8.1.0</td>
<td></td>
<td></td>
<td>17ms</td>
</tr>
<tr>
<td></td>
<td>mpich&#x2F;3.4.2</td>
<td>gcc&#x2F;10.2.0</td>
<td></td>
<td>107ms</td>
</tr>
</tbody></table>
<h3 id="不能srun-IntelMPI的问题"><a href="#不能srun-IntelMPI的问题" class="headerlink" title="不能srun IntelMPI的问题"></a>不能srun IntelMPI的问题</h3><p><a target="_blank" rel="noopener" href="https://github.com/hpc-unibe-ch/ubelix-easyconfigs/issues/16">缺少一个环境变量</a></p>
<p>需要<code>export I_MPI_PMI_LIBRARY=libpmi2.so</code></p>
<h2 id="VTune-分析MPI的程序"><a href="#VTune-分析MPI的程序" class="headerlink" title="VTune 分析MPI的程序"></a>VTune 分析MPI的程序</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/vtune-help/top/analyze-performance/code-profiling-scenarios/mpi-code-analysis.html">https://www.intel.com/content/www/us/en/develop/documentation/vtune-help/top/analyze-performance/code-profiling-scenarios/mpi-code-analysis.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/vtune-cookbook/top/configuration-recipes/profiling-mpi-applications.html">https://www.intel.com/content/www/us/en/develop/documentation/vtune-cookbook/top/configuration-recipes/profiling-mpi-applications.html</a></p>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>设置这个Intel mpi 1200 -&gt; 1100</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PMI_TIME=1</span><br><span class="line">export SLURM_PMI_KVS_NO_DUP_KEYS=yes</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>实在是弄不懂，为什么不同的实现，时间差别这么大。可能慢是因为额外的通路设置，是为了之后的快速传输？？</p>
<p>3.1.4的安装选项也看不到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; mpiexec --version     </span><br><span class="line">mpiexec: error while loading shared libraries: libslurm.so.35: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-16T03:18:15.000Z" title="8/16/2022, 3:18:15 AM">2022-08-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.843Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">2 minutes read (About 339 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/16/Work/Programming/1-env/c/oneapi/">oneApi</a></p><div class="content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/installation/install-with-command-line.html#install-with-command-line">命令行安装</a></p>
<h3 id="Intel-OneAPI-base-toolkit"><a href="#Intel-OneAPI-base-toolkit" class="headerlink" title="Intel OneAPI base toolkit"></a>Intel OneAPI base toolkit</h3><p>必须先安装base，可以看到默认安装的内容</p>
<p><img src="https://pic.shaojiemike.top/img/20220816113819.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220816113912.png"></p>
<p>这个<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/debugging-dpcpp-linux/top.html">GDB</a>好像可以分析多进程</p>
<p><img src="https://pic.shaojiemike.top/img/20220816114248.png"></p>
<h3 id="Intel-OneAPI-HPC-toolkit"><a href="#Intel-OneAPI-HPC-toolkit" class="headerlink" title="Intel OneAPI HPC toolkit"></a>Intel OneAPI HPC toolkit</h3><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit.html">Intel OneAPI HPC toolkit</a>包括了icc,icpc,ifort和OpenMP,IntelMPI还有MKL(Intel® oneAPI Math Kernel Library (oneMKL))</p>
<p>在<a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/hpc-toolkit-download.html">Download界面选择版本</a>, 选择online或者offline会有推荐指令,如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18679/l_HPCKit_p_2022.2.0.191.sh</span><br><span class="line"></span><br><span class="line">sudo sh ./l_HPCKit_p_2022.2.0.191.sh</span><br></pre></td></tr></table></figure>
<h2 id="icx-icpx"><a href="#icx-icpx" class="headerlink" title="icx icpx"></a>icx icpx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; icx -v</span><br><span class="line">Intel(R) oneAPI DPC++/C++ Compiler 2022.0.0 (2022.0.0.20211123)</span><br><span class="line">Target: x86_64-unknown-linux-gnu</span><br><span class="line">Thread model: posix</span><br><span class="line">InstalledDir: /opt/intel/oneapi/compiler/2022.0.2/linux/bin-llvm</span><br><span class="line">Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/8</span><br><span class="line">Found candidate GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9</span><br><span class="line">Selected GCC installation: /usr/lib/gcc/x86_64-linux-gnu/9</span><br><span class="line">Candidate multilib: .;@m64</span><br><span class="line">Selected multilib: .;@m64</span><br><span class="line">Found CUDA installation: /usr/local/cuda-11.5, version</span><br><span class="line"></span><br><span class="line">&gt; icpx --help</span><br><span class="line">OVERVIEW: Intel(R) oneAPI DPC++/C++ Compiler</span><br><span class="line"></span><br><span class="line">USAGE: clang++ [options] file...</span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/prerequisites/install-intel-gpu-drivers.html">https://www.intel.com/content/www/us/en/develop/documentation/installation-guide-for-intel-oneapi-toolkits-linux/top/prerequisites/install-intel-gpu-drivers.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-15T12:35:22.000Z" title="8/15/2022, 12:35:22 PM">2022-08-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-02-14T12:30:12.843Z" title="2/14/2024, 12:30:12 PM">2024-02-14</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">17 minutes read (About 2592 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/15/Work/Programming/2.1-Assembly/assemblyInline/">Inline Assembly</a></p><div class="content"><h2 id="GCC内联汇编"><a href="#GCC内联汇编" class="headerlink" title="GCC内联汇编"></a>GCC内联汇编</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__asm__　__volatile__(&quot;Instruction List&quot; : Output : Input : Clobber/Modify);</span><br></pre></td></tr></table></figure>

<ol>
<li><code>__asm__</code>或asm 用来声明一个内联汇编表达式，所以任何一个内联汇编表达式都是以它开头的，是必不可少的。</li>
<li><code>__volatile__</code>或volatile 是可选的。如果用了它，则是向GCC 声明不允许对该内联汇编优化，否则当 使用了优化选项(-O)进行编译时，GCC 将会根据自己的判断决定是否将这个内联汇编表达式中的指令优化掉。</li>
<li>Instruction List 是汇编指令序列。它可以是空的，比如：<code>__asm__ __volatile__(&quot;&quot;)</code>; 或 <code>__asm__ (&quot;&quot;)</code>;都是完全合法的内联汇编表达式，只不过这两条语句没有什么意义。<ol>
<li>但并非所有Instruction List 为空的内联汇编表达式都是没有意义的，比如：<code>__asm__ (&quot;&quot;:::&quot;memory&quot;)</code>;就非常有意义，它向GCC 声明：“内存作了改动”，GCC 在编译的时候，会将此因素考虑进去。</li>
<li>当在”Instruction List”中有多条指令的时候，需要用分号（；）或换行符（\n）将它们分开。</li>
<li>指令中的操作数可以使用占位符引用C语言变量,<strong>操作数占位符</strong>最多10个,名称如下:<code>%0,%1,…,%9</code>。指令中使用占位符表示的操作数,总被视为long型(4个字节),<ol>
<li>但对其施加的操作根据指令可以是字或者字节,当把操作数当作字或者字节使用时,<strong>默认为低字或者低字节</strong>。</li>
<li>对字节操作可以显式的<strong>指明是低字节还是次字节</strong>。方法是在%和序号之间插入一个字母,”b”代表低字节,”h”代表高字节,例如:<code>%h1</code>。</li>
</ol>
</li>
</ol>
</li>
<li>Output&#x2F;Input <ol>
<li>格式为形如<code>&quot;constraint&quot;(variable)</code>的列表（逗号分隔)。按照出现的顺序分别与指令操作数”%0”，”%1”对应</li>
<li>每个输出操作数的限定字符串必须包含”&#x3D;”表示他是一个输出操作数。例子<code>&quot;=r&quot; (value)</code></li>
</ol>
</li>
<li>Clobber&#x2F;Modify(由逗号格开的字符串组成)<ol>
<li>在Input&#x2F;Output操作表达式所指定的寄存器，或当你为一些Input&#x2F;Output操作表达式使用”r”约束，让GCC为你选择一个寄存器时，GCC知道这些寄存器是被修改的，你根本不需要在Clobber&#x2F;Modify域再声明它们。</li>
<li>但是对于”Instruction List”中的临时寄存器，需要在Clobber&#x2F;Modify域声明这些寄存器或内存，让GCC知道修改了他们<ol>
<li>例子:<code>__asm__ (&quot;mov R0, #0x34&quot; : : : &quot;R0&quot;);</code>寄存器R0出现在”Instruction List中”，并且被mov指令修改，但却未被任何Input&#x2F;Output操作表达式指定，所以你需要在Clobber&#x2F;Modify域指定”R0”，以让GCC知道这一点。</li>
</ol>
</li>
<li>Clobber&#x2F;Modify域存在”memory”，那么GCC会保证在此内联汇编之前，如果某个内存的内容被装入了寄存器，那么在这个内联汇编之后，如果需要使用这个内存处的内容，就会<strong>直接到这个内存处重新读取，而不是使用被存放在寄存器中的拷贝</strong>。因为这个 时候寄存器中的拷贝已经很可能和内存处的内容不一致了。</li>
</ol>
</li>
</ol>
<h2 id="输入输出与指令的对应关系"><a href="#输入输出与指令的对应关系" class="headerlink" title="输入输出与指令的对应关系"></a>输入输出与指令的对应关系</h2><h3 id="寄存器约束符Operation-Constraint"><a href="#寄存器约束符Operation-Constraint" class="headerlink" title="寄存器约束符Operation Constraint"></a>寄存器约束符Operation Constraint</h3><p>每一个Input和Output表达式都必须指定自己的操作约束Operation Constraint，这里将讨论在80386平台上所可能使用的操作约束。</p>
<p>当前的输入或输出需要借助一个寄存器时，需要为其指定一个寄存器约束，可以直接指定一个寄存器的名字。</p>
<p>常用的寄存器约束的缩写 </p>
<table>
<thead>
<tr>
<th>约束</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>表示使用一个通用寄存器，由 GCC  在%eax&#x2F;%ax&#x2F;%al,%ebx&#x2F;%bx&#x2F;%bl,%ecx&#x2F;%cx&#x2F;%cl,%edx&#x2F;%dx&#x2F;%dl中选取一个GCC认为合适的。</td>
</tr>
<tr>
<td>g</td>
<td>表示使用任意一个寄存器，由GCC在所有的可以使用的寄存器中选取一个GCC认为合适的。</td>
</tr>
<tr>
<td>q</td>
<td>表示使用一个通用寄存器，和约束r的意义相同。</td>
</tr>
<tr>
<td>a</td>
<td>表示使用%eax&#x2F;%ax&#x2F;%al</td>
</tr>
<tr>
<td>b</td>
<td>表示使用%ebx&#x2F;%bx&#x2F;%bl</td>
</tr>
<tr>
<td>c</td>
<td>表示使用%ecx&#x2F;%cx&#x2F;%cl</td>
</tr>
<tr>
<td>d</td>
<td>表示使用%edx&#x2F;%dx&#x2F;%dl</td>
</tr>
<tr>
<td>D</td>
<td>表示使用%edi&#x2F;%di</td>
</tr>
<tr>
<td>S</td>
<td>表示使用%esi&#x2F;%si</td>
</tr>
<tr>
<td>f</td>
<td>表示使用浮点寄存器</td>
</tr>
<tr>
<td>t</td>
<td>表示使用第一个浮点寄存器</td>
</tr>
<tr>
<td>u</td>
<td>表示使用第二个浮点寄存器</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>分类</th>
<th>限定符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>通用寄存器</td>
<td>“a”</td>
<td>将输入变量放入eax 这里有一个问题:假设eax已经被使用,那怎么办?其实很简单:因为GCC 知道eax 已经被使用,它在这段汇编代码的起始处插入一条语句pushl %eax,将eax 内容保存到堆栈,然 后在这段代码结束处再增加一条语句popl %eax,恢复eax的内容</td>
</tr>
<tr>
<td></td>
<td>“b”</td>
<td>将输入变量放入ebx</td>
</tr>
<tr>
<td></td>
<td>“c”</td>
<td>将输入变量放入ecx</td>
</tr>
<tr>
<td></td>
<td>“d”</td>
<td>将输入变量放入edx</td>
</tr>
<tr>
<td></td>
<td>“s”</td>
<td>将输入变量放入esi</td>
</tr>
<tr>
<td></td>
<td>“d”</td>
<td>将输入变量放入edi</td>
</tr>
<tr>
<td></td>
<td>“q”</td>
<td>将输入变量放入eax,ebx,ecx,edx中的一个</td>
</tr>
<tr>
<td></td>
<td>“r”</td>
<td>将输入变量放入通用寄存器,也就是eax,ebx,ecx,edx,esi,edi中的一个</td>
</tr>
<tr>
<td></td>
<td>“A”</td>
<td>把eax和edx合成一个64 位的寄存器(use long longs)</td>
</tr>
<tr>
<td>内存</td>
<td>“m”</td>
<td>内存变量</td>
</tr>
<tr>
<td></td>
<td>“o”</td>
<td>操作数为内存变量,但是其寻址方式是偏移量类型, 也即是基址寻址,或者是基址加变址寻址</td>
</tr>
<tr>
<td></td>
<td>“V”</td>
<td>操作数为内存变量,但寻址方式不是偏移量类型</td>
</tr>
<tr>
<td></td>
<td>“ “</td>
<td>操作数为内存变量,但寻址方式为自动增量</td>
</tr>
<tr>
<td></td>
<td>“p”</td>
<td>操作数是一个合法的内存地址(指针)</td>
</tr>
<tr>
<td>寄存器或内存</td>
<td>“g”</td>
<td>将输入变量放入eax,ebx,ecx,edx中的一个 或者作为内存变量</td>
</tr>
<tr>
<td></td>
<td>“X”</td>
<td>操作数可以是任何类型</td>
</tr>
<tr>
<td>立即数</td>
<td>“I”</td>
<td>0-31之间的立即数(用于32位移位指令)</td>
</tr>
<tr>
<td></td>
<td>“J”</td>
<td>0-63之间的立即数(用于64位移位指令)</td>
</tr>
<tr>
<td></td>
<td>“N”</td>
<td>0-255之间的立即数(用于out指令)</td>
</tr>
<tr>
<td></td>
<td>“i”</td>
<td>立即数</td>
</tr>
<tr>
<td></td>
<td>“n”</td>
<td>立即数,有些系统不支持除字以外的立即数, 这些系统应该使用”n”而不是”i”</td>
</tr>
<tr>
<td>匹配</td>
<td>“ 0 “,“1” …“9”</td>
<td>,	表示用它限制的操作数与某个指定的操作数匹配,也即该操作数就是指定的那个操作数,例如”0”去描述”%1”操作数,那么”%1”引用的其实就是”%0”操作数,注意作为限定符字母的0-9 与 指令中的”%0”-“%9”的区别,前者描述操作数,后者代表操作数。</td>
</tr>
<tr>
<td></td>
<td>&amp;;</td>
<td>该输出操作数不能使用过和输入操作数相同的寄存器</td>
</tr>
<tr>
<td>操作数类型</td>
<td>“&#x3D;”</td>
<td>操作数在指令中是只写的(输出操作数)</td>
</tr>
<tr>
<td></td>
<td>“+”</td>
<td>操作数在指令中是读写类型的(输入输出操作数)</td>
</tr>
<tr>
<td>浮点数</td>
<td>“f”</td>
<td>浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“t”</td>
<td>第一个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“u”</td>
<td>第二个浮点寄存器</td>
</tr>
<tr>
<td></td>
<td>“G”</td>
<td>标准的80387浮点常数</td>
</tr>
<tr>
<td></td>
<td>%</td>
<td>该操作数可以和下一个操作数交换位置.例如addl的两个操作数可以交换顺序 (当然两个操作数都不能是立即数)</td>
</tr>
<tr>
<td></td>
<td>#</td>
<td>部分注释,从该字符到其后的逗号之间所有字母被忽略</td>
</tr>
<tr>
<td></td>
<td>*</td>
<td>表示如果选用寄存器,则其后的字母被忽略</td>
</tr>
</tbody></table>
<h3 id="内存约束"><a href="#内存约束" class="headerlink" title="内存约束"></a>内存约束</h3><p>如果一个Input&#x2F;Output  操作表达式的C&#x2F;C++表达式表现为一个内存地址，不想借助于任何寄存器，则可以使用内存约束。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__asm__(&quot;lidt%0&quot;:&quot;=m&quot;(__idt_addr));</span><br><span class="line">__asm__(&quot;lidt%0&quot;::&quot;m&quot;(__idt_addr));</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>修饰符</th>
<th>输入&#x2F;输出</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;</td>
<td>O</td>
<td>表示此Output操作表达式是Write-Only的。</td>
</tr>
</tbody></table>
<ul>
<li><pre><code>           | O               |表示此Output操作表达式是Read-Write的。
</code></pre>
</li>
</ul>
<p>&amp;                | O               |表示此Output操作表达式独占为其指定的寄存器。<br>%               | I                 |表示此Input  操作表达式中的C&#x2F;C++表达式可以和下一 个Input操作表达式中的C&#x2F;C++表达式互换</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Static __inline__ void __set_bit(int nr, volatile void * addr)</span><br><span class="line">&#123;</span><br><span class="line">         __asm__(</span><br><span class="line">                         &quot;btsl %1,%0&quot;</span><br><span class="line">                         :&quot;=m&quot; (ADDR)</span><br><span class="line">                         :&quot;Ir&quot; (nr));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个占位符%0与C 语言变量ADDR对应,第二个占位符%1与C语言变量nr对应。因此上面的汇编语句代码与下面的伪代码等价:btsl nr, ADDR</p>
<h2 id="Clobber-Modify域存在”memory”的其他影响"><a href="#Clobber-Modify域存在”memory”的其他影响" class="headerlink" title="Clobber&#x2F;Modify域存在”memory”的其他影响"></a>Clobber&#x2F;Modify域存在”memory”的其他影响</h2><p>使用”memory”是向GCC声明内存发生了变化，而内存发生变化带来的影响并不止这一点。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int main(int __argc, char* __argv[]) </span><br><span class="line">&#123; </span><br><span class="line">    int* __p = (int*)__argc; </span><br><span class="line">    (*__p) = 9999; </span><br><span class="line">    __asm__(&quot;&quot;:::&quot;memory&quot;); </span><br><span class="line">    if((*__p) == 9999) </span><br><span class="line">        return 5; </span><br><span class="line">    return (*__p); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本例中，如果没有那条内联汇编语句，那个if语句的判断条件就完全是一句废话。GCC在优化时会意识到这一点，而直接只生成return 5的汇编代码，而不会再生成if语句的相关代码，而不会生成return (*__p)的相关代码。</p>
<p>但你加上了这条内联汇编语句，它除了声明内存变化之外，什么都没有做。</p>
<p>但GCC此时就不能简单的认为它不需要判断都知道 (*__p)一定与9999相等，它只有老老实实生成这条if语句的汇编代码，一起相关的两个return语句相关代码。</p>
<p>另外在linux内核中内存屏障也是基于它实现的include&#x2F;asm&#x2F;system.h中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># define barrier() _asm__volatile_(&quot;&quot;: : :&quot;memory&quot;)</span><br></pre></td></tr></table></figure>
<p>主要是保证程序的执行遵循顺序一致性。呵呵，有的时候你写代码的顺序，不一定是终执行的顺序，这个是处理器有关的。</p>
<h2 id="Linux-源码例子"><a href="#Linux-源码例子" class="headerlink" title="Linux 源码例子"></a>Linux 源码例子</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">static inline char * strcpy(char * dest, const char *src)</span><br><span class="line">&#123;</span><br><span class="line">	char *xdest = dest;</span><br><span class="line">	__asm__ __volatile__</span><br><span class="line">	(&quot;1: \tmoeb %1@+, %0@+\n\t&quot;   &quot;jne 1b&quot;  //这个冒号不是分隔符</span><br><span class="line">	: &quot;=a&quot; (dest) , &quot;=a&quot; (stc)</span><br><span class="line">	: &quot;0&quot;(dest), &quot;1&quot; (src)</span><br><span class="line">	 : &quot;memory&quot;);</span><br><span class="line">	return xdest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yi412/article/details/80846083">https://blog.csdn.net/yi412/article/details/80846083</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/elnino/p/4313340.html">https://www.cnblogs.com/elnino/p/4313340.html</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/26/">Previous</a></div><div class="pagination-next"><a href="/page/28/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/26/">26</a></li><li><a class="pagination-link is-current" href="/page/27/">27</a></li><li><a class="pagination-link" href="/page/28/">28</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/39/">39</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">389</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Thinking/"><span class="level-start"><span class="level-item">Thinking</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">52</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-02-14T06:49:13.000Z">2024-02-14</time></p><p class="title"><a href="/2024/02/14/OutOfWork/2.2-japanese/japanese/">Japanese</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-29T12:58:53.000Z">2024-01-29</time></p><p class="title"><a href="/2024/01/29/OutOfWork/5-VideoEntertainment/AnimeAutoChineseSubtitle/">Anime Auto add Chinese Subtitle</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-25T03:20:42.000Z">2024-01-25</time></p><p class="title"><a href="/2024/01/25/OutOfWork/5-VideoEntertainment/AnimeSuperResolutionFrame/">Anime Super Resolution to 4K &amp; Interpolation to 120 fps</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T14:32:40.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Thinking/2-courage2move/SocialScience/">Social Science</a></p><p class="categories"><a href="/categories/Thinking/">Thinking</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T12:15:22.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/FPGA/">FPGA</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>