<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-30T16:00:00.000Z" title="8/30/2023, 4:00:00 PM">2023-08-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.052Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Operating-system/">Operating system</a></span><span class="level-item">6 minutes read (About 886 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/30/Work/Architecture/microHardware/tlb/">TLB: real pagewalk overhead</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>TLB的介绍，请看</p>
<h2 id="页表相关"><a href="#页表相关" class="headerlink" title="页表相关"></a>页表相关</h2><h2 id="理论基础"><a href="#理论基础" class="headerlink" title="理论基础"></a>理论基础</h2><p>大体上是应用访问越随机， 数据量越大，pgw开销越大。</p>
<p>ISCA 2013 shows the pgw overhead in big memory servers.</p>
<p><img src="https://pic.shaojiemike.top/img/20230818104019.png" alt="Basu 等 - Efficient Virtual Memory for Big Memory Servers.pdf"></p>
<p>or ISCA 2020 Guvenilir 和 Patt - 2020 - Tailored Page Sizes.pdf</p>
<p><img src="https://pic.shaojiemike.top/img/20230818112628.png"></p>
<h2 id="机器配置"><a href="#机器配置" class="headerlink" title="机器配置"></a>机器配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shaojiemike @ snode6 in ~/github/hugoMinos on git:main x [11:17:05]</span></span><br><span class="line">$ cpuid -1 -l 2</span><br><span class="line">CPU:</span><br><span class="line">      0x63: data TLB: 2M/4M pages, 4-way, 32 entries</span><br><span class="line">            data TLB: 1G pages, 4-way, 4 entries</span><br><span class="line">      0x03: data TLB: 4K pages, 4-way, 64 entries</span><br><span class="line">      0x76: instruction TLB: 2M/4M pages, fully, 8 entries</span><br><span class="line">      0xff: cache data is <span class="keyword">in</span> CPUID leaf 4</span><br><span class="line">      0xb5: instruction TLB: 4K, 8-way, 64 entries</span><br><span class="line">      0xf0: 64 byte prefetching</span><br><span class="line">      0xc3: L2 TLB: 4K/2M pages, 6-way, 1536 entries</span><br><span class="line"><span class="comment"># if above command turns out empty</span></span><br><span class="line">cpuid -1 |grep TLB -A 10 -B 5</span><br><span class="line"><span class="comment"># will show sth like</span></span><br><span class="line"></span><br><span class="line">L1 TLB/cache information: 2M/4M pages &amp; L1 TLB (0x80000005/eax):</span><br><span class="line">    instruction <span class="comment"># entries     = 0x40 (64)</span></span><br><span class="line">    instruction associativity = 0xff (255)</span><br><span class="line">    data <span class="comment"># entries            = 0x40 (64)</span></span><br><span class="line">    data associativity        = 0xff (255)</span><br><span class="line">L1 TLB/cache information: 4K pages &amp; L1 TLB (0x80000005/ebx):</span><br><span class="line">    instruction <span class="comment"># entries     = 0x40 (64)</span></span><br><span class="line">    instruction associativity = 0xff (255)</span><br><span class="line">    data <span class="comment"># entries            = 0x40 (64)</span></span><br><span class="line">    data associativity        = 0xff (255)</span><br><span class="line">L2 TLB/cache information: 2M/4M pages &amp; L2 TLB (0x80000006/eax):</span><br><span class="line">    instruction <span class="comment"># entries     = 0x200 (512)</span></span><br><span class="line">    instruction associativity = 2-way (2)</span><br><span class="line">    data <span class="comment"># entries            = 0x800 (2048)</span></span><br><span class="line">    data associativity        = 4-way (4)</span><br><span class="line">L2 TLB/cache information: 4K pages &amp; L2 TLB (0x80000006/ebx):</span><br><span class="line">    instruction <span class="comment"># entries     = 0x200 (512)</span></span><br><span class="line">    instruction associativity = 4-way (4)</span><br><span class="line">    data <span class="comment"># entries            = 0x800 (2048)</span></span><br><span class="line">    data associativity        = 8-way (6)</span><br></pre></td></tr></table></figure>

<h2 id="OS-config"><a href="#OS-config" class="headerlink" title="OS config"></a>OS config</h2><p>default there is no hugopage(usually 4MB) to use.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/meminfo | grep huge -i</span><br><span class="line">AnonHugePages:      8192 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">HugePages_Total:       0</span><br><span class="line">HugePages_Free:        0</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:               0 kB</span><br></pre></td></tr></table></figure>

<p>explained is <a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt">here</a>.</p>
<h2 id="设置页表大小"><a href="#设置页表大小" class="headerlink" title="设置页表大小"></a>设置页表大小</h2><h3 id="other-ways-change-source-code"><a href="#other-ways-change-source-code" class="headerlink" title="other ways: change source code"></a>other ways: change source code</h3><ol>
<li>way1: Linux transparent huge page (THP) support allows the kernel to automatically promote regular memory pages into huge pages, <code>cat /sys/kernel/mm/transparent_hugepage/enabled</code> but achieve this needs some <a target="_blank" rel="noopener" href="https://rigtorp.se/hugepages/">details</a>.</li>
<li>way2: Huge pages are allocated from a reserved pool which needs to change <a target="_blank" rel="noopener" href="https://www.kernel.org/doc/html/next/admin-guide/mm/hugetlbpage.html">sys-config</a>. for example <code>echo 20 &gt; /proc/sys/vm/nr_hugepages</code>. And you need to write <a target="_blank" rel="noopener" href="https://mazzo.li/posts/check-huge-page.html">speacial C++ code</a> to use the hugo page</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># using mmap system call to request huge page</span></span><br><span class="line">mount -t hugetlbfs \</span><br><span class="line">	-o uid=&lt;value&gt;,gid=&lt;value&gt;,mode=&lt;value&gt;,pagesize=&lt;value&gt;,size=&lt;value&gt;,\</span><br><span class="line">	min_size=&lt;value&gt;,nr_inodes=&lt;value&gt; none /mnt/huge</span><br></pre></td></tr></table></figure>

<h3 id="without-recompile"><a href="#without-recompile" class="headerlink" title="without recompile"></a>without recompile</h3><p>But there is a <a target="_blank" rel="noopener" href="https://easyperf.net/blog/2022/09/01/Utilizing-Huge-Pages-For-Code">blog</a> using unmaintained tool <code>hugeadm</code> and <code>iodlr</code> library to do this.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libhugetlbfs-bin</span><br><span class="line">sudo hugeadm --create-global-mounts</span><br><span class="line">sudo hugeadm --pool-pages-min 2M:64</span><br></pre></td></tr></table></figure>

<p>So <code>meminfo</code> is changed</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/meminfo | grep huge -i</span><br><span class="line">AnonHugePages:      8192 kB</span><br><span class="line">ShmemHugePages:        0 kB</span><br><span class="line">FileHugePages:         0 kB</span><br><span class="line">HugePages_Total:      64</span><br><span class="line">HugePages_Free:       64</span><br><span class="line">HugePages_Rsvd:        0</span><br><span class="line">HugePages_Surp:        0</span><br><span class="line">Hugepagesize:       2048 kB</span><br><span class="line">Hugetlb:          131072 kB</span><br></pre></td></tr></table></figure>

<p>using <code>iodlr</code> library</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> </span><br></pre></td></tr></table></figure>


<h2 id="应用测量"><a href="#应用测量" class="headerlink" title="应用测量"></a>应用测量</h2><p>Measurement tools from <a target="_blank" rel="noopener" href="https://github.com/Kirrito-k423/PIA-Zsim/blob/main/investigation/pagewalk/tlbstat">code</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shaojiemike @ snode6 in ~/github/PIA_huawei on git:main x [17:40:50]</span></span><br><span class="line">$ ./investigation/pagewalk/tlbstat -c <span class="string">&#x27;/staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1&#x27;</span></span><br><span class="line"><span class="built_in">command</span> is /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1</span><br><span class="line">K_CYCLES   K_INSTR      IPC DTLB_WALKS ITLB_WALKS K_DTLBCYC  K_ITLBCYC  DTLB% ITLB%</span><br><span class="line">324088     207256      0.64 733758     3276       18284      130         5.64  0.04</span><br><span class="line">21169730   11658340    0.55 11802978   757866     316625     24243       1.50  0.11</span><br></pre></td></tr></table></figure>

<p>平均单次开销(开始到稳定)：<br>dtlb miss read need 24<del>50 cycle ，itlb miss read need 40</del>27 cycle</p>
<p>案例的时间分布：</p>
<ul>
<li>读数据开销占比不大，2.5%左右</li>
<li>pagerank等图应用并行计算时，飙升至 22%<ul>
<li>bfs 最多就是 5%，没有那么随机的访问。</li>
</ul>
</li>
<li>但是gemv 在<code>65000 100000</code>超内存前，即使是全部在计算，都是0.24% <ul>
<li>原因：访存模式：图应用的访存模式通常是随机的、不规则的。它们不像矩阵向量乘法（gemv）等应用那样具有良好的访存模式，后者通常以连续的方式访问内存。连续的内存访问可以利用空间局部性，通过预取和缓存块的方式减少TLB缺失的次数。</li>
</ul>
</li>
<li>github - GUOPS can achive 90%</li>
<li>DAMOV - ligra - pagerank can achive 90% in 20M input case</li>
</ul>
<h3 id="gemm"><a href="#gemm" class="headerlink" title="gemm"></a>gemm</h3><ul>
<li>nomal gemm can achive 100% some situation<ul>
<li>matrix too big can not be filled in cache, matrix2 access jump lines so always cache miss</li>
<li>O3 flag seems no time reduce, beacause there is no SIMD assembly in code</li>
<li>memory access time &#x3D; pgw + tlb access time + load data 2 cache time</li>
</ul>
</li>
</ul>
<p><img src="https://pic.shaojiemike.top/img/20230815192118.png" alt="gemm"></p>
<p>the <code>gemm</code>‘s core line is</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;N; i++)&#123;</span><br><span class="line">   <span class="comment">// ignore the overflow, do not influence the running time.</span></span><br><span class="line">   <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;N; j++)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> l=<span class="number">0</span>; l&lt;N; l++)&#123;</span><br><span class="line">            <span class="comment">// gemm</span></span><br><span class="line">            <span class="comment">// ans[i * N + j] += matrix1[i * N + l] * matrix2[l * N + j];</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// for gemm sequantial</span></span><br><span class="line">            ans[i * N + j] += matrix1[i * N + l] * matrix2[j * N + l];</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and real time breakdown is as followed. to do</p>
<ol>
<li>first need to perf get the detail time</li>
</ol>
<h3 id="bigJump"><a href="#bigJump" class="headerlink" title="bigJump"></a>bigJump</h3><p><a target="_blank" rel="noopener" href="https://github.com/Kirrito-k423/PIA-Zsim/blob/main/test/manual/bigJump.cpp">manual code</a> to test if tlb entries is run out</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ ./tlbstat -c <span class="string">&#x27;../../test/manual/bigJump.exe 1 10 100&#x27;</span></span><br><span class="line"><span class="built_in">command</span> is ../../test/manual/bigJump.exe 1 10 100</span><br><span class="line">K_CYCLES   K_INSTR      IPC DTLB_WALKS ITLB_WALKS K_DTLBCYC  K_ITLBCYC  DTLB% ITLB%</span><br><span class="line">2002404    773981      0.39 104304528  29137      2608079    684        130.25  0.03</span><br><span class="line"></span><br><span class="line">$ perf <span class="built_in">stat</span> -e mem_uops_retired.all_loads -e mem_uops_retired.all_stores -e mem_uops_retired.stlb_miss_loads -e mem_uops_retired.stlb_miss_stores ./bigJump.exe 1 10 500</span><br><span class="line">Number <span class="built_in">read</span> from <span class="built_in">command</span> line: 1 10 (N,J should not big, [0,5] is best.)</span><br><span class="line">result 0</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;./bigJump.exe 1 10 500&#x27;</span>:</span><br><span class="line"></span><br><span class="line">          10736645      mem_uops_retired.all_loads</span><br><span class="line">         532100339      mem_uops_retired.all_stores</span><br><span class="line">             57715      mem_uops_retired.stlb_miss_loads</span><br><span class="line">         471629056      mem_uops_retired.stlb_miss_stores</span><br></pre></td></tr></table></figure>

<p>In this case, tlb miss rate up to <code>47/53 = 88.6%</code></p>
<h3 id="Big-bucket-hash-table"><a href="#Big-bucket-hash-table" class="headerlink" title="Big bucket hash table"></a>Big bucket hash table</h3><p>using <a target="_blank" rel="noopener" href="https://rigtorp.se/hugepages/">big hash table</a></p>
<h3 id="other-apps"><a href="#other-apps" class="headerlink" title="other apps"></a>other apps</h3><p>Any algorithm that does random accesses into a large memory region will likely suffer from TLB misses. Examples are plenty: binary search in a big array, large hash tables, histogram-like algorithms, etc.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-28T16:00:00.000Z" title="8/28/2023, 4:00:00 PM">2023-08-28</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.052Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Artificial-Intelligence/">Artificial Intelligence</a></span><span class="level-item">4 minutes read (About 578 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/28/Work/Artificial%20Intelligence/AICompiler/">AI Compiler</a></p><div class="content"><h2 id="百度"><a href="#百度" class="headerlink" title="百度"></a>百度</h2><p>秋招面试时遇到高铁柱前辈。问了相关的问题（对AI专业的人可能是基础知识）</p>
<ol>
<li>nvcc编译器不好用吗？为什么要开发tvm之类的编译器？<ol start="2">
<li>答：首先，nvcc是类似与gcc, msvc(Microsoft Visual C++) 之类的传统的编译器，支持的是CUDA C&#x2F;C++ 代码。</li>
<li>但是tvm编译器是张量编译器，支持的是python之类的代码，将其中的网络设计，编译拆解成各种算子，然后使用cudnn或者特定硬件的高效机器码来执行。</li>
</ol>
</li>
</ol>
<h2 id="蔚来"><a href="#蔚来" class="headerlink" title="蔚来"></a>蔚来</h2><p><img src="https://pic.shaojiemike.top/img/20220710194118.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220710195249.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220710195644.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220710195857.png"></p>
<p>数字信号处理器 (Digital signal processor)<br><img src="https://pic.shaojiemike.top/img/20220710200215.png"></p>
<p>HLO 简单理解为编译器 IR。</p>
<h3 id="TVM介绍"><a href="#TVM介绍" class="headerlink" title="TVM介绍"></a>TVM介绍</h3><p><a target="_blank" rel="noopener" href="https://tvm.apache.org/">https://tvm.apache.org</a></p>
<ol>
<li>TVM解决的问题：<ol>
<li>2017年，deploy Deep learning(TF,Pytorch) everywhere(hardware).</li>
<li>Before TVM,<ol>
<li>手动调优：loop tiling for locality.</li>
<li>operator fusion 算子融合。虽然性能高，但是部署不高效</li>
</ol>
</li>
</ol>
</li>
<li>编译优化思路引入深度学习<ol>
<li>定义了算子描述到部署空间的映射。核心是感知调度空间，并且实现compute&#x2F;schedule 分离</li>
</ol>
</li>
<li>TVM当前的发展<ol>
<li>上层计算图表示：NNVM Relay Relax</li>
<li>底层优化方式：manual -&gt; AutoTVM(schedule最优参数的搜索，基于AI的cost model) -&gt; Ansor(也不再需要手动写AutoTVM模版，使用模版规则生成代码)</li>
</ol>
</li>
<li>TVM的额外工作<ol>
<li>HeteroCL: TVM + FPGA</li>
</ol>
</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20220710201028.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220710201106.png"><br><img src="https://pic.shaojiemike.top/img/20220710201311.png"></p>
<ol>
<li>output Fusion<ol>
<li>减少Global Memory Copy</li>
</ol>
</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20220710202343.png"></p>
<p>把中间算子库替换成编译器？</p>
<p><img src="https://pic.shaojiemike.top/img/20220710202928.png"></p>
<p>暂时不好支持张量</p>
<p><img src="https://pic.shaojiemike.top/img/20220710203701.png"></p>
<p>AI自动调整变化来调优</p>
<p><img src="https://pic.shaojiemike.top/img/20220710203959.png"></p>
<p>自动调参。缺点：</p>
<ol>
<li>需要人工写模版</li>
<li>人工导致解空间变小</li>
<li><img src="https://pic.shaojiemike.top/img/20220710204141.png"></li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20220710204604.png"></p>
<p>随机各级循环应用优化策略（并行，循环展开，向量化</p>
<p><img src="https://pic.shaojiemike.top/img/20220710204756.png"></p>
<p>介绍了Ansor效果很好</p>
<p><img src="https://pic.shaojiemike.top/img/20220710205345.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-27T16:00:00.000Z" title="8/27/2023, 4:00:00 PM">2023-08-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.052Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Algorithms/">Algorithms</a></span><span class="level-item">a few seconds read (About 99 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/27/Work/Algorithms/pagerank/">Graph Algorithms: Pagerank</a></p><div class="content"><h2 id="Pagerank"><a href="#Pagerank" class="headerlink" title="Pagerank"></a>Pagerank</h2><ol>
<li>Network and social network can be identified as a weighted graph</li>
<li>How to do the important ranking is Pagerank</li>
</ol>
<p>how to design a graph when pr executing memory access jump data-array very random?</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/137561088">https://zhuanlan.zhihu.com/p/137561088</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-27T16:00:00.000Z" title="8/27/2023, 4:00:00 PM">2023-08-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.072Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">17 minutes read (About 2534 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/27/Work/software/benchmark/benchmark/">Benchmark</a></p><div class="content"><h2 id="Differentiated-Bounded-Applications"><a href="#Differentiated-Bounded-Applications" class="headerlink" title="Differentiated-Bounded Applications"></a>Differentiated-Bounded Applications</h2><p>According to the DAMOV, data movement have six different types.</p>
<p>Although the authors only use temporal Locality to classify the apps, the Figure 3: Locality-based clustering of 44 representative functions shows some cases deserved to test.</p>
<p>In the context of data movement, the DAMOV framework identifies <strong>six</strong> distinct types. While the authors primarily utilize <code>temporal locality</code> for app classification, Figure 3 offers a comprehensive view of the <code>locality-based</code> clustering of 44 representative functions, highlighting specific cases that warrant further examination.</p>
<p>Take, for instance, the four cases situated in the lower right corner:</p>
<table>
<thead>
<tr>
<th>function short name</th>
<th>benchmark</th>
<th>class</th>
</tr>
</thead>
<tbody><tr>
<td>CHAHsti</td>
<td>Chai-Hito</td>
<td>1b: DRAM Latency</td>
</tr>
<tr>
<td>CHAOpad</td>
<td>Chai-Padding</td>
<td>1c: L1&#x2F;L2 Cache Capacity</td>
</tr>
<tr>
<td>PHELinReg</td>
<td>Phoenix-Linear Regression</td>
<td>1b</td>
</tr>
<tr>
<td>PHEStrMat</td>
<td>Phoenix-String Matching</td>
<td>1b</td>
</tr>
</tbody></table>
<p>TLB percentage high -&gt; tlb miss rate high -&gt; memory access address in large span -&gt; spacial locality is low.</p>
<h2 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h2><h3 id="Chai-Benchmark"><a href="#Chai-Benchmark" class="headerlink" title="Chai Benchmark"></a>Chai Benchmark</h3><p>The Chai benchmark code can be sourced either from DAMOV or directly from its <a target="_blank" rel="noopener" href="https://github.com/chai-benchmarks/chai">GitHub repository</a>. Chai stands for “Collaborative Heterogeneous Applications for Integrated Architectures.”</p>
<p>Installing Chai is a straightforward process. You can achieve it by executing the command <code>python3 compile.py</code>.</p>
<p>One notable feature of the Chai benchmark is its adaptability in terms of input size. Modifying the input size of the following applications is a simple and flexible task: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd application directory</span></span><br><span class="line">./bfs_00 -t 4 -f input/xxx.input</span><br><span class="line">./hsti -n 1024000             <span class="comment"># Image Histogram - Input Partitioning (HSTI)</span></span><br><span class="line">./hsto -n 1024000             <span class="comment"># Image Histogram - Output Partitioning (HSTO)</span></span><br><span class="line">./ooppad -m 1000 -n 1000   <span class="comment"># Padding (PAD)</span></span><br><span class="line">./ooptrns -m 100 -n 10000  <span class="comment"># Transpose / In-place Transposition (TRNS)</span></span><br><span class="line">./sc -n 1024000            <span class="comment"># Stream Compaction (SC)</span></span><br><span class="line">./sri -n 1024000           <span class="comment"># select application</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vector pack , 2048 = 1024 * 2, 1024 = 2^n</span></span><br><span class="line">./vpack -m 2048 -n 1024 -i 2 </span><br><span class="line"><span class="comment"># vector unpack , 2048 = 1024 * 2, 1024 = 2^n</span></span><br><span class="line">./vupack -m 2048 -n 1024 -i 2 </span><br></pre></td></tr></table></figure>

<h3 id="Parboil-how-to-run"><a href="#Parboil-how-to-run" class="headerlink" title="Parboil (how to run)"></a>Parboil (how to run)</h3><p>The Parboil suite was developed from a collection of benchmarks used at the<br>University of Illinois to measure and compare the <strong>performance of computation-intensive algorithms</strong> executing on either a CPU or a GPU.  Each<br>implementation of a GPU algorithm is either in CUDA or OpenCL, and requires<br>a system capable of executing applications using those APIs.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile , vim compile.py </span></span><br><span class="line"><span class="comment"># python2.7 ./parboil compile bfs omp_base </span></span><br><span class="line">python3 compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># no idea how to run, failed command: (skip)</span></span><br><span class="line">python2.7 ./parboil run bfs cuda default </span><br><span class="line"><span class="comment"># exe in benchmarks/*, but need some nowhere input.</span></span><br></pre></td></tr></table></figure>

<h3 id="Phoenix"><a href="#Phoenix" class="headerlink" title="Phoenix"></a>Phoenix</h3><p>Phoenix is a shared-memory implementation of Google’s MapReduce model for data-intensive processing tasks.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># with code from DAMOV</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">os.chdir(<span class="string">&quot;phoenix-2.0/tests&quot;</span>) <span class="comment"># app is changed from sample_apps/*</span></span><br><span class="line">os.system(<span class="string">&quot;make&quot;</span>)</span><br><span class="line">os.chdir(<span class="string">&quot;../../&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate excution in phoenix-2.0/tests/&#123;app&#125;/&#123;app&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># running for example</span></span><br><span class="line">./phoenix-<span class="number">2.0</span>/tests/linear_regression/linear_regression ./phoenix-<span class="number">2.0</span>/datasets/linear_regression_datafiles/key_file_500MB.txt </span><br></pre></td></tr></table></figure>

<h3 id="PolyBench"><a href="#PolyBench" class="headerlink" title="PolyBench"></a>PolyBench</h3><p>PolyBench is a benchmark suite of 30 numerical computations with <strong>static control flow</strong>, extracted from operations in various application domains (linear algebra computations, image processing, physics<br>simulation, dynamic programming, statistics, etc.). </p>
<p>PolyBench features include:</p>
<ul>
<li>A single file, tunable at compile-time, used for the kernel<br>instrumentation. It performs extra operations such as cache flushing<br>before the kernel execution, and can set real-time scheduling to<br>prevent OS interference.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile using DAMOV code</span></span><br><span class="line">python compile.py</span><br><span class="line"><span class="comment"># exe in OpenMP/compiled, and all running in no parameter</span></span><br></pre></td></tr></table></figure>


<h3 id="PriM"><a href="#PriM" class="headerlink" title="PriM"></a>PriM</h3><p>real apps for the first real PIM platform</p>
<h3 id="Rodinia-developed"><a href="#Rodinia-developed" class="headerlink" title="Rodinia (developed)"></a>Rodinia (developed)</h3><p>Rodinia, a benchmark suite for heterogeneous parallel computing which target multi-core CPU and GPU platforms, which first introduced in <a target="_blank" rel="noopener" href="https://ieeexplore.ieee.org/document/5306797">2009 IISWC</a>.</p>
<p>zsim hooked code from <a target="_blank" rel="noopener" href="https://github.com/Kirrito-k423/rodinia-zsimhooks">github</a></p>
<ol>
<li>Install the CUDA&#x2F;OCL drivers, SDK and toolkit on your machine. </li>
<li>Modify the <code>common/make.config</code> file to change the settings of <ol>
<li>rodinia home directory and CUDA&#x2F;OCL library paths.</li>
<li>It seems need intel opencl, but intel do everything to <a target="_blank" rel="noopener" href="https://community.intel.com/t5/OpenCL-for-CPU/OpenCL-Runtime-for-Ubuntu-20-04/m-p/1366728">oneapi</a></li>
</ol>
</li>
<li>To compile all the programs of the Rodinia benchmark suite, simply use the universal <code>makefile</code> to compile all the programs, or go to each benchmark directory and make individual programs. </li>
<li>full code with related data can be downloaded from <a target="_blank" rel="noopener" href="http://www.cs.virginia.edu/~skadron/lava/Rodinia/Packages/rodinia_3.1.tar.bz2">website</a></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ./bin/linux/omp</span><br><span class="line">make OMP</span><br></pre></td></tr></table></figure>

<p>Running the zsim hooked apps</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> bin/linux/omp</span><br><span class="line">./pathfinder 100000 100 7</span><br><span class="line">./myocyte.out 100 1 0 4</span><br><span class="line">./lavaMD -cores 4 -boxes1d 10 <span class="comment"># -boxes1d  (number of boxes in one dimension, the total number of boxes will be that^3)</span></span><br><span class="line">./omp/lud_omp -s 8000</span><br><span class="line">./srad 2048 2048 0 127 0 127 2 0.5 2</span><br><span class="line">./backprop 4 65536 <span class="comment"># OMP_NUM_THREADS=4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># need to download data or file</span></span><br><span class="line">./hotspot 1024 1024 2 4 ../../data/hotspot/temp_1024 ../../data/hotspot/power_1024 output.out</span><br><span class="line">./OpenMP/leukocyte 5 4 ../../data/leukocyte/testfile.avi</span><br><span class="line"><span class="comment"># streamcluster</span></span><br><span class="line">./sc_omp k1 k2 d n chunksize clustersize infile outfile <span class="built_in">nproc</span></span><br><span class="line">./sc_omp 10 20 256 65536 65536 1000 none output.txt 4</span><br><span class="line">./bfs 4 ../../data/bfs/graph1MW_6.txt </span><br><span class="line">./kmeans_serial/kmeans -i ../../data/kmeans/kdd_cup</span><br><span class="line">./kmeans_openmp/kmeans -n 4 -i ../../data/kmeans/kdd_cup</span><br></pre></td></tr></table></figure>

<h2 id="dynamic-data-structures"><a href="#dynamic-data-structures" class="headerlink" title="dynamic data structures"></a>dynamic data structures</h2><p>We choose this specific suite because dynamic data structures are the core of many server workloads (e.g., Memcached’s hash table, RocksDB’s skip list), and are a great match for nearmemory processing</p>
<p>ASCYLIB + OPTIK[^1]</p>
<h2 id="Graph-Apps"><a href="#Graph-Apps" class="headerlink" title="Graph Apps"></a>Graph Apps</h2><h3 id="Graph500-Benchmark-Exploration"><a href="#Graph500-Benchmark-Exploration" class="headerlink" title="Graph500 Benchmark Exploration"></a>Graph500 Benchmark Exploration</h3><h4 id="Official-Version"><a href="#Official-Version" class="headerlink" title="Official Version"></a>Official Version</h4><p>The official version of the Graph500 benchmark can be downloaded from its <a target="_blank" rel="noopener" href="https://github.com/graph500/graph500">GitHub repository</a>. Notable features of this version include:</p>
<ul>
<li>Primarily MPI Implementation: The benchmark is built as an MPI (Message Passing Interface) version, without an accompanying OpenMP version. This can be disappointing for those utilizing tools like zsim.</li>
<li>Flexible <code>n</code> Value: By default, the value <code>n</code> is set to powers of 2, but it’s possible to change this behavior through configuration adjustments.</li>
<li>Customization Options: Environment variables can be altered to modify the execution process. For instance, the BFS (Breadth-First Search) portion can be skipped or the destination path for saved results can be changed.</li>
</ul>
<h4 id="Unofficial-Repository"><a href="#Unofficial-Repository" class="headerlink" title="Unofficial Repository"></a>Unofficial Repository</h4><p>An alternative <a target="_blank" rel="noopener" href="https://github.com/PamplemousseMR/Benchmark">unofficial repository</a> also exists. However, it requires OpenCL for compilation. The process can be broken down as follows:</p>
<ul>
<li>OpenCL Dependency: The unofficial repository mandates the presence of OpenCL. To set up OpenCL, you can refer to this <a target="_blank" rel="noopener" href="https://support.zivid.com/en/latest/getting-started/software-installation/gpu/install-opencl-drivers-ubuntu.html">tutorial</a>.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install clinfo</span><br><span class="line">sudo apt-get install opencl-headers</span><br><span class="line">sudo apt install opencl-dev</span><br></pre></td></tr></table></figure>

<p>After completing the OpenCL setup and the compilation process using <code>cmake &amp; make</code>, we obtain the executable file named <code>benchmark</code>.<br>By default, running this executable without any arguments appears to utilize only a single core, despite attempts to set the environment variable with <code>export OMP_NUM_THREADS=32</code>.<br>This default behavior led to a runtime of approximately 5 minutes to generate a report related to edges-node-verify status (or similar). However, for someone without an in-depth technical background, this report can be confusing, especially when trying to locate the BFS (Breadth-First Search) and SSSP (Single-Source Shortest Path) components.</p>
<p>What is even more disheartening is that the TLB (Translation Lookaside Buffer) result is disappointingly low, similar to the performance of the GUPS (Giga Updates Per Second) OpenMP version.</p>
<p>In order to gain a clearer understanding and potentially address these issues, further investigation and potentially adjustments to the program configuration may be necessary.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ./tlbstat -c <span class="string">&#x27;/staff/shaojiemike/github/graph500_openmp/build/benchmark&#x27;</span> </span><br><span class="line"><span class="built_in">command</span> is /staff/shaojiemike/github/graph500_openmp/build/benchmark                       </span><br><span class="line">K_CYCLES   K_INSTR      IPC DTLB_WALKS ITLB_WALKS K_DTLBCYC  K_ITLBCYC  DTLB% ITLB%         </span><br><span class="line">20819312   10801013    0.52 7736938    1552557    369122     51902       1.77  0.25</span><br><span class="line">20336549   10689727    0.53 7916323    1544469    354426     48123       1.74  0.24</span><br></pre></td></tr></table></figure>

<h3 id="GAP"><a href="#GAP" class="headerlink" title="GAP"></a>GAP</h3><p>Zsim?&#x2F;LLVM Pass Instrumentation Code from PIMProf paper <a target="_blank" rel="noopener" href="https://github.com/Systems-ShiftLab/PIMProf">github</a></p>
<p>But the graph dataset should be generated by yourself following the <a target="_blank" rel="noopener" href="https://github.com/sbeamer/gapbs">github</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2^17 nodes </span></span><br><span class="line">./converter -g17 -k16 -b kron-17.sg</span><br><span class="line">./converter -g17 -k16 -wb kron-17.wsg</span><br></pre></td></tr></table></figure>

<p>Kernels Included</p>
<ul>
<li>Breadth-First Search (BFS) - direction optimizing</li>
<li>Single-Source Shortest Paths (SSSP) - delta stepping</li>
<li>PageRank (PR) - iterative method in pull direction</li>
<li>Connected Components (CC) - Afforest &amp; Shiloach-Vishkin</li>
<li>Betweenness Centrality (BC) - Brandes</li>
<li>Triangle Counting (TC) - Order invariant with possible relabelling</li>
</ul>
<h3 id="ligra"><a href="#ligra" class="headerlink" title="ligra"></a>ligra</h3><p>Code also from DAMOV</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile</span></span><br><span class="line">python3 compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 kind exe of each app, relative code can be found in /ligra directory</span></span><br><span class="line"><span class="comment"># emd: edgeMapDense() maybe processing related dense-data </span></span><br><span class="line"><span class="comment"># ems: edgeMapSparse() analyse edge-data</span></span><br><span class="line"><span class="comment"># compute: of course, the core compute part</span></span><br></pre></td></tr></table></figure>

<p>the source code is difficult to read, skip</p>
<p>the graph format : It seems <code>lines_num = offsets + edges + 3</code> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AdjacencyGraph</span><br><span class="line">16777216 <span class="comment"># offsets, and vertex from []</span></span><br><span class="line">100000000 <span class="comment">#   uintE* edges = newA(uintE,m);</span></span><br><span class="line">0</span><br><span class="line">470</span><br><span class="line">794 <span class="comment"># must monotonic increasing, and range [0,edges), represent the folloing edges are belong to corresponding vector</span></span><br><span class="line">……</span><br><span class="line">14680024 <span class="comment"># random but range [0,vector-1], represent each node&#x27;s conjoint others nodes(so there are pairs).</span></span><br><span class="line">16644052</span><br><span class="line">16284631</span><br><span class="line">15850460</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">wc</span> -l  /staff/qcjiang/codes/DAMOV/workloads/ligra/inputs/rMat_10M</span><br><span class="line">116777219 /staff/qcjiang/codes/DAMOV/workloads/ligra/inputs/rMat_10M</span><br></pre></td></tr></table></figure>

<p>Pagerank Algorithm should be referened from my another post.</p>
<h2 id="HPC"><a href="#HPC" class="headerlink" title="HPC"></a>HPC</h2><p>maybe more computation-intensive than graph applications</p>
<h3 id="parsec"><a href="#parsec" class="headerlink" title="parsec"></a>parsec</h3><p>From DAMOV</p>
<p>The Princeton Application Repository for Shared-Memory Computers (PARSEC) is a<br>collection of <strong>parallel programs</strong> which can be used for performance studies of<br>multiprocessor machines.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile</span></span><br><span class="line">python3 compile_parsec.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># exe in pkgs/binaries</span></span><br><span class="line">./pkgs/binaries/blackscholes 4 ./pkgs/inputs/blackscholes/in_64K.txt black.out</span><br><span class="line">./pkgs/binaries/fluidanimate 4 10 ./pkgs/inputs/fluidanimate/in_300K.fluid</span><br></pre></td></tr></table></figure>

<h3 id="STREAM-apps"><a href="#STREAM-apps" class="headerlink" title="STREAM apps"></a>STREAM apps</h3><p>DAMOV code for memory bandwidth testing which reference J. D. McCalpin et al., “Memory Bandwidth and Machine Balance in Current High Performance Computers,” IEEE TCCA Newsletter, 1995</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile</span></span><br><span class="line">python3 compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># default run with Failed Validation error(whatever)</span></span><br><span class="line">-------------------------------------------------------------</span><br><span class="line">Function    Best Rate MB/s  Avg time     Min time     Max time</span><br><span class="line">Copy:            5072.0     0.205180     0.157728     0.472323</span><br><span class="line">Add:             6946.6     0.276261     0.172746     0.490767</span><br></pre></td></tr></table></figure>

<h3 id="Hardware-Effects"><a href="#Hardware-Effects" class="headerlink" title="Hardware Effects"></a>Hardware Effects</h3><p>Two very Interesting repositys of <a target="_blank" rel="noopener" href="https://github.com/kobzol/hardware-effects">cpu</a> and <a target="_blank" rel="noopener" href="https://github.com/kobzol/hardware-effects-gpu">gpu</a> hardware effects that can degrade application performance<br>in surprising ways and that may be very hard to explain without knowledge of the low-level CPU&#x2F;GPU and OS architecture.</p>
<p>Test also using DAMOV code</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># compile</span></span><br><span class="line">python3 compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Every example directory has a README that explains the individual effects.</span></span><br><span class="line">./build/bandwidth-saturation/bandwidth-saturation 0 1</span><br><span class="line">./build/false-sharing/false-sharing 3 8</span><br></pre></td></tr></table></figure>

<p>Most cases using the help of <code>perf</code> to know more about your system ability.</p>
<h3 id="HPCC"><a href="#HPCC" class="headerlink" title="HPCC"></a>HPCC</h3><p>From DAMOV and The HPC Challenge (HPCC) Benchmark Suite,” in SC, 2006</p>
<ul>
<li>RandomAccess OpenMP version (it is also the <a target="_blank" rel="noopener" href="https://github.com/alexandermerritt/gups">GUPS</a>)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">python compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># must export</span></span><br><span class="line"><span class="built_in">export</span> OMP_NUM_THREADS=32</span><br><span class="line">./OPENMP/ra_omp 26 <span class="comment"># 26 need almost 20GB mem, 27 need 30GB mem, and so on.</span></span><br></pre></td></tr></table></figure>

<p>but the openmp version shows no big pgw overhead</p>
<h3 id="GUPS"><a href="#GUPS" class="headerlink" title="GUPS"></a>GUPS</h3><p>描述系统的随机访问能力</p>
<p>From <a target="_blank" rel="noopener" href="https://github.com/alexandermerritt/gups">github</a> or <a target="_blank" rel="noopener" href="https://hpcchallenge.org/hpcc/index.html">hpcc official-web</a> and RandomAccess MPI version</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download using github</span></span><br><span class="line">make -f Makefile.linux gups_vanilla</span><br><span class="line"><span class="comment"># running</span></span><br><span class="line">gups_vanilla N M chunk</span><br></pre></td></tr></table></figure>

<ul>
<li><code>N = length of global table is 2^N</code><ul>
<li><code>Thus N = 30 would run with a billion-element table.</code></li>
</ul>
</li>
<li><code>M = # of update sets per proc</code> 越大代表算得越久（随机访问越久），</li>
<li><code>chunk = # of updates in one set on each proc</code><ul>
<li>In the official HPCC benchmark this is specified to be no larger than 1024, but you can run the code with any value you like.  Your GUPS performance will typically decrease for smaller chunk size.</li>
</ul>
</li>
</ul>
<p>测试之后，最佳搭配如下 <code>mpirun -n 32 ./gups_vanilla 32 100000 2048</code> 其中n最多32，不然会爆内存。</p>
<table>
<thead>
<tr>
<th>n</th>
<th>32</th>
<th>31</th>
<th>30</th>
<th>29</th>
</tr>
</thead>
<tbody><tr>
<td>DTLB%</td>
<td>66.81</td>
<td>45.22</td>
<td>19.50</td>
<td>13.20</td>
</tr>
<tr>
<td>ITLB%</td>
<td>0.06</td>
<td>0.07</td>
<td>0.06</td>
<td>0.09</td>
</tr>
</tbody></table>
<p>或者单独运行<code>./gups_vanilla 30 100000 k</code> n最多30, <code>./tlbstat -c &#39;/usr/bin/mpirun -np 1 /staff/shaojiemike/github/gups/gups_vanilla  30 100000 8192</code></p>
<table>
<thead>
<tr>
<th>n\k</th>
<th>1024</th>
<th>2048</th>
<th>4096</th>
<th>8192</th>
</tr>
</thead>
<tbody><tr>
<td>30</td>
<td></td>
<td>44%</td>
<td>90%</td>
<td>80%</td>
</tr>
<tr>
<td>27</td>
<td></td>
<td></td>
<td></td>
<td>88%</td>
</tr>
<tr>
<td>24</td>
<td></td>
<td></td>
<td>83%</td>
<td>83%</td>
</tr>
<tr>
<td>20</td>
<td></td>
<td></td>
<td>58%</td>
<td>62%</td>
</tr>
<tr>
<td>15</td>
<td></td>
<td></td>
<td>0.27%</td>
<td>0.3%</td>
</tr>
</tbody></table>
<h3 id="HPCG"><a href="#HPCG" class="headerlink" title="HPCG"></a>HPCG</h3><p>From DAMOV and High Performance Conjugate Gradient Benchmark (HPCG)</p>
<p>HPCG is a software package that performs a fixed number of multigrid preconditioned<br>(using a symmetric Gauss-Seidel smoother) conjugate gradient (PCG) iterations using double<br>precision (64 bit) floating point values. 浮点数的共轭梯度求解</p>
<p>follow the instructions in <code>INSTALL</code> and analyze the <code>compile.py</code></p>
<ol>
<li>choose makefile like <code>setup/Make.GCC_OMP</code><ol>
<li>config values like <code>MPdir</code>, but we can leave them beacuse we use <code>GCC_OMP</code> which set <code>-DHPCG_NO_MPI</code> in it</li>
<li>add <code>-DHPGSym</code> to <code>CXXFLAGS</code> or <code>HPCG_OPTS</code></li>
</ol>
</li>
<li><code>cd build</code> and <code>../configure GCC_OMP</code></li>
<li>run <code>compile.py</code> to compile the executable files<ol>
<li>get 4 <code>ComputePrologation</code> in <code>build/bin</code></li>
</ol>
</li>
<li>test the exe using <code>xhpcg 32 24 16</code> for three  dimension<ol>
<li>or <code>xhpcg --nx=16 --rt=120</code> for <code>NX=NY=NZ=16</code> and time is 120 seconds</li>
<li>change <code>int refMaxIters = 50;</code> to <code>int refMaxIters = 1;</code> to limit <code>CG</code> iteration number</li>
<li>to be attention: <code>--nx=16</code> must be a multiple of 8</li>
</ol>
</li>
<li>if there is no geometry arguments on the command line, hpcg will <code>ReadHpcgDat</code> and get the default <code>--nx=104 --rt=60</code></li>
</ol>
<table>
<thead>
<tr>
<th>value\nx</th>
<th>96</th>
<th>240</th>
<th>360</th>
<th>480</th>
</tr>
</thead>
<tbody><tr>
<td>mem</td>
<td></td>
<td>17GB</td>
<td>40GB</td>
<td>72.8GB</td>
</tr>
<tr>
<td>time(icarus0)</td>
<td>8s</td>
<td>84S</td>
<td>4min40s</td>
<td>core dumped(7mins)</td>
</tr>
</tbody></table>
<p>core dumped for <code>xhpcg_HPGPro: ../src/GenerateProblem_ref.cpp:204: void GenerateProblem_ref(SparseMatrix&amp;, Vector*, Vector*, Vector*): Assertion &#39;totalNumberOfNonzeros&gt;0&#39; failed.</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MPdir        = </span><br><span class="line">MPinc        = </span><br><span class="line">MPlib        = </span><br><span class="line"></span><br><span class="line">HPCG_OPTS     = -DHPCG_NO_MPI -DHPGSym</span><br></pre></td></tr></table></figure>

<h4 id="compile-error"><a href="#compile-error" class="headerlink" title="compile error"></a>compile error</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../src/ComputeResidual.cpp:59:13: error: <span class="string">&#x27;n&#x27;</span> not specified <span class="keyword">in</span> enclosing <span class="string">&#x27;parallel&#x27;</span></span><br></pre></td></tr></table></figure>

<p>just add <code>n</code> to shared values</p>
<h2 id="Database"><a href="#Database" class="headerlink" title="Database"></a>Database</h2><h2 id="Hash-Joins"><a href="#Hash-Joins" class="headerlink" title="Hash Joins"></a>Hash Joins</h2><p>This package provides implementations of the main-memory hash join algorithms<br>described and studied in C. Balkesen, J. Teubner, G. Alonso, and M. T. Ozsu, “Main-Memory Hash Joins on Modern Processor Architectures,” TKDE, 2015.</p>
<p>Test also in DAMOV</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line">python compile.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># runing</span></span><br><span class="line">./src/mchashjoins_* -r 12800000 -s 12000000 -x 12345 -y 54321</span><br></pre></td></tr></table></figure>

<p>these case shows tlb resource strains</p>
<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><h3 id="Darknet-for-CV-using-multi-cores"><a href="#Darknet-for-CV-using-multi-cores" class="headerlink" title="Darknet for CV using multi-cores"></a>Darknet for CV using multi-cores</h3><p>From DAMOV and <a target="_blank" rel="noopener" href="https://pjreddie.com/darknet/install/">official documentation</a> is  detailed</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shaojiemike @ snode6 <span class="keyword">in</span> ~/github/DAMOV/workloads/Darknet on git:main x [14:13:02]                   │drwxr-xr-x  3 shaojiemike staff   21 Mar 14  2022 .</span><br><span class="line">$ ./darknet detect cfg/yolo.cfg ./weights/yolo.weights data/dog.jpg</span><br></pre></td></tr></table></figure>

<ul>
<li>model in <code>weight</code> files, different size model (28MB -528MB)can be downloaded from <a target="_blank" rel="noopener" href="https://pjreddie.com/darknet/imagenet/">website</a></li>
<li>picture data in <code>data</code> files. (70KB - 100MB)</li>
<li>must run the exe in the file directory. SHIT.</li>
</ul>
<h2 id="genomics-DNA"><a href="#genomics-DNA" class="headerlink" title="genomics &#x2F; DNA"></a>genomics &#x2F; DNA</h2><h3 id="BWA"><a href="#BWA" class="headerlink" title="BWA"></a>BWA</h3><p>From DAMOV and for mapping DNA sequences against a large reference genome, such as the human genome</p>
<ul>
<li>Download DNA data like <code>ref.fa</code> following <a target="_blank" rel="noopener" href="https://github.com/bwa-mem2/bwa-mem2">Data download steps</a><ul>
<li>stucked when running <code>sratoolkit.3.0.6-ubuntu64/bin/fastq-dump --split-files SRR7733443</code> due to generate several 96GB <code>SRR7733443_X.fastq</code> files which <code>X</code> from 1 to n.</li>
<li>sratool can not limit the file size, but we can use <code>head -c 100MB SRR7733443_1.fastq &gt; ref_100MB.fastq</code> to get wanted<br>file size.</li>
</ul>
</li>
<li>Further running commands you can read the <a target="_blank" rel="noopener" href="https://github.com/bwa-mem2/bwa-mem2#usage">github</a><ul>
<li><code>./bwa index -p abc ref_100MB.fastq</code> will generate sevaral <code>abc.suffix</code> files using 50 seconds.</li>
<li>and now you can run <code>./bwa mem -t 4 abc ref_100MB.fastq</code> or <code>./bwa aln -t 4 abc ref_100MB.fastq</code></li>
</ul>
</li>
</ul>
<h3 id="GASE"><a href="#GASE" class="headerlink" title="GASE"></a>GASE</h3><p>GASE - Generic Aligner for *Seed-and-Extend</p>
<hr>
<p>GASE is a DNA read aligner, developed for measuring the mapping accuracy and execution time of different combinations of seeding and extension techniques. GASE is implemented by extending BWA (version 0.7.13) developed by Heng Li.</p>
<p>Code also from DAMOV. But seems there are some program syntax errors, skip this app.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>DAMOV: A New Methodology and Benchmark Suite for Evaluating Data Movement Bottlenecks</p>
<p>[^1]: <a target="_blank" rel="noopener" href="https://github.com/LPD-EPFL/ASCYLIB">ASCYLIB + OPTIK</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-27T16:00:00.000Z" title="8/27/2023, 4:00:00 PM">2023-08-27</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.064Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">20 minutes read (About 2993 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/27/Work/Programming/2-languageGrammar/python/pythonDataStructure/">Python: DataStructure</a></p><div class="content"><h2 id="check-if-it-is-empty"><a href="#check-if-it-is-empty" class="headerlink" title="check if it is empty?"></a>check if it is empty?</h2><p>strings, lists, tuples</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Correct:</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> seq:</span><br><span class="line"><span class="keyword">if</span> seq:</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wrong:</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(seq):</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(seq):</span><br></pre></td></tr></table></figure>

<h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># sth</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    pprint.pprint(<span class="built_in">list</span>)</span><br><span class="line">    <span class="keyword">raise</span> e</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    un_set()</span><br></pre></td></tr></table></figure>

<h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><h3 id="step"><a href="#step" class="headerlink" title="step"></a>step</h3><p>调参需要测试间隔值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>, <span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<h3 id="遍历修改值"><a href="#遍历修改值" class="headerlink" title="遍历修改值"></a>遍历修改值</h3><ul>
<li>使用 <code>enumerate</code> 函数结合 <code>for</code> 循环遍历 list，以修改 list 中的元素。</li>
<li><code>enumerate</code> 函数返回一个包含元组的迭代器，其中每个元组包含当前遍历元素的索引和值。在 for 循环中，我们通过索引 <code>i</code> 修改了列表中的元素。</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于 二维list appDataDict</span></span><br><span class="line">baseline = appDataDict[<span class="number">0</span>][<span class="number">0</span>] <span class="comment"># CPU Total</span></span><br><span class="line"><span class="keyword">for</span> i, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(appDataDict):</span><br><span class="line">    <span class="keyword">for</span> j, entry <span class="keyword">in</span> <span class="built_in">enumerate</span>(line):</span><br><span class="line">        appDataDict[i][j] = <span class="built_in">round</span>(entry/baseline, <span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<h2 id="itertools"><a href="#itertools" class="headerlink" title="itertools"></a>itertools</h2><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/itertools.html">itertools</a> — 为高效循环而创建迭代器的函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> a,b,c <span class="keyword">in</span> permutations((a,b,c)):</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="String-字符串"><a href="#String-字符串" class="headerlink" title="String 字符串"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-strings.html">String 字符串</a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">%c  格式化字符及其ASCII码</span><br><span class="line">%s  格式化字符串</span><br><span class="line">%d  格式化整数</span><br><span class="line">%u  格式化无符号整型</span><br><span class="line">%o  格式化无符号八进制数</span><br><span class="line">%x  格式化无符号十六进制数</span><br><span class="line">%X  格式化无符号十六进制数（大写）</span><br><span class="line">%f  格式化浮点数字，可指定小数点后的精度</span><br><span class="line">%e  用科学计数法格式化浮点数</span><br><span class="line">%E  作用同%e，用科学计数法格式化浮点数</span><br><span class="line">%g  %f和%e的简写</span><br><span class="line">%G  %F 和 %E 的简写</span><br><span class="line">%p  用十六进制数格式化变量的地址</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;My name is %s and weight is %d kg!&quot;</span> % (<span class="string">&#x27;Zara&#x27;</span>, <span class="number">21</span>))</span><br></pre></td></tr></table></figure>

<h3 id="string-list"><a href="#string-list" class="headerlink" title="string &lt;-&gt; list"></a>string &lt;-&gt; list</h3><p><code>&#39; &#39;.join(pass_list)</code> and <code>pass_list.split(&quot; &quot;)</code></p>
<p>对齐<code>&quot;\n&quot;.join([&quot;%-10s&quot; % item for item in List_A])</code></p>
<h3 id="字符串开头判断"><a href="#字符串开头判断" class="headerlink" title="字符串开头判断"></a>字符串开头判断</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;Hello, world!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> text.startswith(<span class="string">&quot;Hello&quot;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The string starts with &#x27;Hello&#x27;&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The string does not start with &#x27;Hello&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="format-格式化函数"><a href="#format-格式化函数" class="headerlink" title="format 格式化函数"></a>format 格式化函数</h3><p>Python2.6 开始，<a target="_blank" rel="noopener" href="https://www.runoob.com/python/att-string-format.html">通过 <code>&#123;&#125;</code> 和 <code>:</code> 来代替以前的 <code>%</code></a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;<span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)    <span class="comment"># 不设置指定位置，按默认顺序</span></span><br><span class="line"><span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&quot;&#123;1&#125; &#123;0&#125; &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)  <span class="comment"># 设置指定位置</span></span><br><span class="line"><span class="string">&#x27;world hello world&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串补齐100位，&lt;表示左对齐</span></span><br><span class="line">variable = <span class="string">&quot;Hello&quot;</span></span><br><span class="line">padded_variable = <span class="string">&quot;&#123;:&lt;100&#125;&quot;</span>.<span class="built_in">format</span>(variable)</span><br></pre></td></tr></table></figure>

<p>数字处理</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#123;:.2f&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">3.1415926</span>)) <span class="comment"># 保留小数点后两位</span></span><br><span class="line"></span><br><span class="line">&#123;:&gt;10d&#125; 右对齐 (默认, 宽度为<span class="number">10</span>)</span><br><span class="line">&#123;:^10d&#125; 中间对齐 (宽度为<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<h2 id="小数位"><a href="#小数位" class="headerlink" title="小数位"></a>小数位</h2><p><code>x = round(x,3)</code># 保留小数点后三位</p>
<h2 id="容器：List"><a href="#容器：List" class="headerlink" title="容器：List"></a>容器：List</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-lists.html">https://www.runoob.com/python/python-lists.html</a></p>
<h3 id="初始化以及访问"><a href="#初始化以及访问" class="headerlink" title="初始化以及访问"></a>初始化以及访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span> = [<span class="string">&#x27;physics&#x27;</span>, <span class="string">&#x27;chemistry&#x27;</span>, <span class="number">1997</span>, <span class="number">2000</span>]</span><br><span class="line"><span class="built_in">list</span> = []          <span class="comment">## 空列表</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<h3 id="切片"><a href="#切片" class="headerlink" title="切片"></a>切片</h3><p>格式：<code>[start_index:end_index:step]</code></p>
<p>不包括<code>end_index</code>的元素</p>
<h3 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">list_three = [[<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line">//numpy 创建连续的，可自动向量化，线程并行</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 创建一个 3x4 的数组且所有值全为 0</span></span><br><span class="line">x3 = np.zeros((<span class="number">3</span>, <span class="number">4</span>), dtype=<span class="built_in">int</span>)</span><br><span class="line"><span class="comment"># 创建一个 3x4 的数组，然后将所有元素的值填充为 2</span></span><br><span class="line">x5 = np.full((<span class="number">3</span>, <span class="number">4</span>), <span class="number">2</span>, dtype=<span class="built_in">int</span>)</span><br></pre></td></tr></table></figure>

<h3 id="size-大小"><a href="#size-大小" class="headerlink" title="size 大小"></a>size 大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(day)</span><br></pre></td></tr></table></figure>

<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># take second element for sort</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">takeSecond</span>(<span class="params">elem</span>):</span><br><span class="line">    <span class="keyword">return</span> elem[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">LCData.sort(key=takeSecond)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [1740, &#x27;黄业琦&#x27;, 392, &#x27;第 196 场周赛&#x27;],</span></span><br><span class="line"><span class="comment"># [1565, &#x27;林坤贤&#x27;, 458, &#x27;第 229 场周赛&#x27;],</span></span><br><span class="line"><span class="comment"># [1740, &#x27;黄业琦&#x27;, 458, &#x27;第 229 场周赛&#x27;],</span></span><br><span class="line"><span class="comment"># [1509, &#x27;林坤贤&#x27;, 460, &#x27;第 230 场周赛&#x27;],</span></span><br><span class="line"><span class="comment"># [1740, &#x27;黄业琦&#x27;, 460, &#x27;第 230 场周赛&#x27;],</span></span><br><span class="line"><span class="comment"># [1779, &#x27;黄业琦&#x27;, 558, &#x27;第 279 场周赛&#x27;],</span></span><br></pre></td></tr></table></figure>

<h3 id="对应元素相加到一个变量"><a href="#对应元素相加到一个变量" class="headerlink" title="对应元素相加到一个变量"></a>对应元素相加到一个变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tmp_list = [[],[],[],[]]</span><br><span class="line"><span class="comment"># 注意不需要右值赋值</span></span><br><span class="line">[x.append(copy.deepcopy(entry)) <span class="keyword">for</span> x,entry <span class="keyword">in</span> <span class="built_in">zip</span>(tmp_list, to_add)]</span><br></pre></td></tr></table></figure>

<h3 id="两个list对应元素相加"><a href="#两个list对应元素相加" class="headerlink" title="两个list对应元素相加"></a>两个list对应元素相加</h3><p>对于等长的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">list1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">list2 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">result = [x + y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(list1, list2)]</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>如果两个列表的长度不同，你可以使用zip_longest()函数来处理它们。zip_longest()函数可以处理不等长的列表，并使用指定的填充值填充缺失的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> zip_longest</span><br><span class="line"></span><br><span class="line">list1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">list2 = [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">result = [x + y <span class="keyword">for</span> x, y <span class="keyword">in</span> zip_longest(list1, list2, fillvalue=<span class="number">0</span>)]</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>如果是二维list</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">list1 = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">         [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]]</span><br><span class="line"></span><br><span class="line">list2 = [[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>],</span><br><span class="line">         [<span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>]]</span><br><span class="line"></span><br><span class="line">rows = <span class="built_in">max</span>(<span class="built_in">len</span>(list1), <span class="built_in">len</span>(list2))</span><br><span class="line">cols = <span class="built_in">max</span>(<span class="built_in">len</span>(row) <span class="keyword">for</span> row <span class="keyword">in</span> list1 + list2)</span><br><span class="line"></span><br><span class="line">result = [[<span class="number">0</span>] * cols <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rows)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(rows):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(cols):</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(list1) <span class="keyword">and</span> j &lt; <span class="built_in">len</span>(list1[i]):</span><br><span class="line">            result[i][j] += list1[i][j]</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(list2) <span class="keyword">and</span> j &lt; <span class="built_in">len</span>(list2[i]):</span><br><span class="line">            result[i][j] += list2[i][j]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将一个二维列表的所有元素除以一个数A</span></span><br><span class="line">result = [[element / A <span class="keyword">for</span> element <span class="keyword">in</span> row] <span class="keyword">for</span> row <span class="keyword">in</span> list1]</span><br></pre></td></tr></table></figure>

<h2 id="直接赋值、浅拷贝和深度拷贝"><a href="#直接赋值、浅拷贝和深度拷贝" class="headerlink" title="直接赋值、浅拷贝和深度拷贝"></a>直接赋值、浅拷贝和深度拷贝</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/python-append-deepcopy.html">Python append() 与深拷贝、浅拷贝</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/python-understanding-dict-copy-shallow-or-deep.html">python赋值只是引用，别名</a></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>.append(<span class="string">&#x27;Google&#x27;</span>)   <span class="comment">## 使用 append() 添加元素</span></span><br><span class="line">alist.append( num ) <span class="comment"># 浅拷贝 ，之后修改num 会影响alist内的值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line">alist.append( copy.deepcopy( num ) ) <span class="comment"># 深拷贝</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># delete</span></span><br><span class="line"><span class="keyword">del</span> <span class="built_in">list</span>[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<h3 id="for循环迭代的元素-也是-引用"><a href="#for循环迭代的元素-也是-引用" class="headerlink" title="for循环迭代的元素 也是 引用"></a>for循环迭代的元素 也是 引用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">original_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> original_list:</span><br><span class="line">    item *= <span class="number">2</span> <span class="comment"># 每个元素是不可变的</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(original_list) </span><br><span class="line"></span><br><span class="line">original_list = [[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], [<span class="number">2</span>], [<span class="number">3</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> original_list:</span><br><span class="line">    item.append(<span class="string">&quot;xxx&quot;</span>) <span class="comment"># 每个元素是可变的</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(original_list) </span><br><span class="line"></span><br><span class="line"><span class="comment"># [1, 2, 3]</span></span><br><span class="line"><span class="comment"># [[1, 2, 3, &#x27;xxx&#x27;], [2, &#x27;xxx&#x27;], [3, &#x27;xxx&#x27;]]</span></span><br></pre></td></tr></table></figure>

<h3 id="函数传参是引用，但是能通过切片来得到类似指针"><a href="#函数传参是引用，但是能通过切片来得到类似指针" class="headerlink" title="函数传参是引用，但是能通过切片来得到类似指针"></a><a target="_blank" rel="noopener" href="https://blog.csdn.net/skying_li/article/details/52398114">函数传参是引用，但是能通过切片来得到类似指针</a></h3><p>参数的传递<br>函数声明时的形参，使用时，等同于函数体内的局部变量。由于Python中一切皆为对象。因此，参数传递时直接传递对象的地址，但具体使用分两种类型：<br>1.传递不可变对象的引用（起到其他语言值传递的效果） 数字，字符串，元组，function等<br>2.传递可变对象的引用（起到其他语言引用传递的效果） 字典，列表，集合，自定义的对象等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fun0</span>(<span class="params">a</span>):</span><br><span class="line">    a = [<span class="number">0</span>,<span class="number">0</span>] <span class="comment"># a在修改后，指向的地址发生改变，相当于新建了一个值为[0,0]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>(<span class="params">a</span>):</span><br><span class="line">    a[<span class="number">0</span>] = [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun2</span>(<span class="params">a</span>):</span><br><span class="line">    a[:] = [<span class="number">10</span>,<span class="number">20</span>]</span><br><span class="line">    </span><br><span class="line">b = [<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">fun0(b)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">fun(b)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line">fun2(b)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># [3, 4]</span></span><br><span class="line"><span class="comment"># [[1, 2], 4]</span></span><br><span class="line"><span class="comment"># [10, 20]</span></span><br></pre></td></tr></table></figure>

<h3 id="return-返回值"><a href="#return-返回值" class="headerlink" title="return 返回值"></a>return 返回值</h3><p>可变的也是引用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fun1</span>(<span class="params">l</span>):</span><br><span class="line">    l.append(<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> l </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun2</span>(<span class="params">l</span>):</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">    rel2 = fun2(l)</span><br><span class="line">    <span class="built_in">print</span>(rel2)   </span><br><span class="line">    rel1 = fun1(l)</span><br><span class="line">    <span class="built_in">print</span>(rel1)   </span><br><span class="line">    <span class="built_in">print</span>(rel2)   </span><br><span class="line">    l.append(<span class="string">&quot;xxx&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(rel1)   </span><br><span class="line">    <span class="built_in">print</span>(rel2)   </span><br><span class="line">    <span class="keyword">del</span> rel1[<span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span>(rel1)   </span><br><span class="line">    <span class="built_in">print</span>(rel2)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, &#x27;0&#x27;]</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, &#x27;0&#x27;]</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, &#x27;0&#x27;, &#x27;xxx&#x27;]</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, &#x27;0&#x27;, &#x27;xxx&#x27;]</span></span><br><span class="line"><span class="comment"># [1, 2, 4, 5, &#x27;0&#x27;, &#x27;xxx&#x27;]</span></span><br><span class="line"><span class="comment"># [1, 2, 4, 5, &#x27;0&#x27;, &#x27;xxx&#x27;]</span></span><br></pre></td></tr></table></figure>

<h2 id="容器：元组Tuple"><a href="#容器：元组Tuple" class="headerlink" title="容器：元组Tuple"></a>容器：元组Tuple</h2><ul>
<li>元组和列表类似，但是不同的是元组<strong>不能修改</strong>，但可以对元组进行连接组合，元组使用小括号。</li>
<li>元组中只包含一个元素时，需要在元素后面<strong>添加逗号</strong>，否则括号会被当作运算符使用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建元组</span></span><br><span class="line">tup = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">tup1 = (<span class="number">23</span>, <span class="number">78</span>);</span><br><span class="line">tup2 = (<span class="string">&#x27;ab&#x27;</span>, <span class="string">&#x27;cd&#x27;</span>)</span><br><span class="line">tup3 = tup1 + tup2</span><br></pre></td></tr></table></figure>

<h2 id="容器：Dict"><a href="#容器：Dict" class="headerlink" title="容器：Dict"></a>容器：Dict</h2><h3 id="empty-dict"><a href="#empty-dict" class="headerlink" title="empty dict"></a>empty dict</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a= &#123;&#125;</span><br><span class="line">a=<span class="built_in">dict</span>()</span><br></pre></td></tr></table></figure>

<h3 id="key-支持tuple元组"><a href="#key-支持tuple元组" class="headerlink" title="key 支持tuple元组"></a>key 支持tuple元组</h3><p>类似c++ 的 <code>pair&lt;int,int&gt;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bblHashDict[(tmpHigherHash,tmpLowerHash)]=tmpBBL</span><br></pre></td></tr></table></figure>

<p>但是这样就不支持json.dump， <code>json.dump()</code> 无法序列化 Python 中元组(tuple)作为字典的 key，这会导致 <code>json.dump()</code> 函数在写入此类字典数据时会进入死循环或陷入卡住状态</p>
<h3 id="初始化以及访问-1"><a href="#初始化以及访问-1" class="headerlink" title="初始化以及访问"></a>初始化以及访问</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>tinydict = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;3&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tinydict[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;3&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a_dict = &#123;<span class="string">&#x27;color&#x27;</span>: <span class="string">&#x27;blue&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> a_dict:</span><br><span class="line"> <span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment"># color</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> a_dict:</span><br><span class="line">    <span class="built_in">print</span>(key, <span class="string">&#x27;-&gt;&#x27;</span>, a_dict[key])</span><br><span class="line"><span class="comment"># color -&gt; blue</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> a_dict.items():</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br><span class="line"><span class="comment"># (&#x27;color&#x27;, &#x27;blue&#x27;)</span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> a_dict.items():</span><br><span class="line"> <span class="built_in">print</span>(key, <span class="string">&#x27;-&gt;&#x27;</span>, value)</span><br><span class="line"><span class="comment"># color -&gt; blue</span></span><br></pre></td></tr></table></figure>

<h3 id="判断key-是否存在"><a href="#判断key-是否存在" class="headerlink" title="判断key 是否存在"></a>判断key 是否存在</h3><p>以下是两种常用的方法：</p>
<p>方法一：使用in操作符: in操作符返回一个布尔值，True表示存在，False表示不存在。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Copy code</span><br><span class="line">my_dict = &#123;<span class="string">&quot;key1&quot;</span>: <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;key2&quot;</span>: <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;key3&quot;</span>: <span class="string">&quot;value3&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否存在指定的键</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;key2&quot;</span> <span class="keyword">in</span> my_dict:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Key &#x27;key2&#x27; exists in the dictionary.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Key &#x27;key2&#x27; does not exist in the dictionary.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>方法二：使用dict.get()方法: dict.get()方法在键存在时返回对应的值，不存在时返回None。根据需要选择适合的方法进行判断。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Copy code</span><br><span class="line">my_dict = &#123;<span class="string">&quot;key1&quot;</span>: <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;key2&quot;</span>: <span class="string">&quot;value2&quot;</span>, <span class="string">&quot;key3&quot;</span>: <span class="string">&quot;value3&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断是否存在指定的键</span></span><br><span class="line"><span class="keyword">if</span> my_dict.get(<span class="string">&quot;key2&quot;</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Key &#x27;key2&#x27; exists in the dictionary.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Key &#x27;key2&#x27; does not exist in the dictionary.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>这两种方法都可以用来判断字典中是否存在指定的键。</p>
<h3 id="size-大小-1"><a href="#size-大小-1" class="headerlink" title="size 大小"></a>size 大小</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(day)</span><br></pre></td></tr></table></figure>

<h3 id="修改以及添加"><a href="#修改以及添加" class="headerlink" title="修改以及添加"></a>修改以及添加</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tinydict = &#123;<span class="string">&#x27;Name&#x27;</span>: <span class="string">&#x27;Zara&#x27;</span>, <span class="string">&#x27;Age&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;Class&#x27;</span>: <span class="string">&#x27;First&#x27;</span>&#125;</span><br><span class="line"> </span><br><span class="line">tinydict[<span class="string">&#x27;Age&#x27;</span>] = <span class="number">8</span> <span class="comment"># 更新</span></span><br><span class="line">tinydict[<span class="string">&#x27;School&#x27;</span>] = <span class="string">&quot;RUNOOB&quot;</span> <span class="comment"># 添加</span></span><br></pre></td></tr></table></figure>

<h3 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dict1 = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">8</span>&#125; </span><br><span class="line">dict2 = &#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">4</span>&#125; </span><br><span class="line">  </span><br><span class="line"><span class="comment"># dict2保留了合并的结果</span></span><br><span class="line">dict2.update(dict1)</span><br><span class="line"><span class="built_in">print</span>(dict2)</span><br><span class="line">&#123;<span class="string">&#x27;d&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;a&#x27;</span>: <span class="number">10</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">8</span>&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> tinydict[<span class="string">&#x27;Name&#x27;</span>]  <span class="comment"># 删除键是&#x27;Name&#x27;的条目</span></span><br><span class="line">tinydict.clear()      <span class="comment"># 清空字典所有条目</span></span><br><span class="line"><span class="keyword">del</span> tinydict          <span class="comment"># 删除字典</span></span><br></pre></td></tr></table></figure>

<h3 id="print-by-key"><a href="#print-by-key" class="headerlink" title="print by key"></a>print by key</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line">pprint</span><br></pre></td></tr></table></figure>

<h2 id="容器：set"><a href="#容器：set" class="headerlink" title="容器：set"></a>容器：set</h2><p>无序不重复序列</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a=  <span class="built_in">set</span>() <span class="comment"># 空set</span></span><br><span class="line"></span><br><span class="line">thisset = <span class="built_in">set</span>((<span class="string">&quot;Google&quot;</span>, <span class="string">&quot;Runoob&quot;</span>, <span class="string">&quot;Taobao&quot;</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>basket = &#123;<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;orange&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(basket)                      <span class="comment"># 这里演示的是去重功能</span></span><br></pre></td></tr></table></figure>

<h3 id="list2set"><a href="#list2set" class="headerlink" title="list2set"></a>list2set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setL=<span class="built_in">set</span>(listV)</span><br></pre></td></tr></table></figure>

<h3 id="set2list"><a href="#set2list" class="headerlink" title="set2list"></a>set2list</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my_set = &#123;<span class="string">&#x27;Geeks&#x27;</span>, <span class="string">&#x27;for&#x27;</span>, <span class="string">&#x27;geeks&#x27;</span>&#125;</span><br><span class="line">  </span><br><span class="line">s = <span class="built_in">list</span>(my_set)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment"># [&#x27;Geeks&#x27;, &#x27;for&#x27;, &#x27;geeks&#x27;]</span></span><br></pre></td></tr></table></figure>

<h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thisset.add(<span class="string">&quot;Facebook&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="合并-1"><a href="#合并-1" class="headerlink" title="合并"></a>合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = &#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;cherry&quot;</span>&#125;</span><br><span class="line">y = &#123;<span class="string">&quot;google&quot;</span>, <span class="string">&quot;runoob&quot;</span>, <span class="string">&quot;apple&quot;</span>&#125;</span><br><span class="line"> </span><br><span class="line">z = x.union(y) </span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(z)</span><br><span class="line"><span class="comment"># &#123;&#x27;cherry&#x27;, &#x27;runoob&#x27;, &#x27;google&#x27;, &#x27;banana&#x27;, &#x27;apple&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="删除与清空"><a href="#删除与清空" class="headerlink" title="删除与清空"></a>删除与清空</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.remove( x )</span><br><span class="line">a.clear()</span><br></pre></td></tr></table></figure>

<h2 id="修改原本的值"><a href="#修改原本的值" class="headerlink" title="修改原本的值"></a>修改原本的值</h2><h3 id="修改传入参数"><a href="#修改传入参数" class="headerlink" title="修改传入参数"></a>修改传入参数</h3><p>在Python中,函数的参数是按值传递的,也就是说在函数内部修改参数不会影响到函数外部的变量。</p>
<p>但是有几种方法可以实现类似修改参数的效果:</p>
<ol>
<li>返回修改后的值,在函数外部重新赋值</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">x</span>):</span><br><span class="line">    x = x + <span class="number">1</span> </span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">a = <span class="number">10</span></span><br><span class="line">a = func(a) </span><br><span class="line"><span class="built_in">print</span>(a) <span class="comment"># 11</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>使用可变对象作为参数,修改可变对象的内部值</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">lst</span>):</span><br><span class="line">    lst.append(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">lst = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">func(lst)</span><br><span class="line"><span class="built_in">print</span>(lst) <span class="comment"># [1,2,3,1]</span></span><br></pre></td></tr></table></figure>

<p>这里lst是列表,在func内部修改了lst,由于lst是可变的,所以函数外部的lst也被修改了。</p>
<ol start="3">
<li>使用全局变量</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">global</span> count</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">func()</span><br><span class="line"><span class="built_in">print</span>(count) <span class="comment"># 1</span></span><br></pre></td></tr></table></figure>

<p>通过global关键字声明count为全局变量,这样就可以在函数内部修改全局变量count了。</p>
<p>所以要修改传入参数的值,主要的方法是:</p>
<ol>
<li>返回修改后的值并重新赋值</li>
<li>传入一个可变对象并修改可变对象内部的值</li>
<li>使用全局变量</li>
</ol>
<p>这些技巧可以实现模拟修改参数的效果。</p>
<h3 id="修改for循环对象"><a href="#修改for循环对象" class="headerlink" title="修改for循环对象"></a>修改for循环对象</h3><p>在Python中,for循环遍历的是一个迭代器,每次循环会将迭代器的下一个元素赋值给循环变量。</p>
<p>如果想在for循环内部修改迭代器中的元素,可以使用以下方法:</p>
<ol>
<li>将迭代器转换成列表,然后修改列表中的元素:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">all_for_one = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> app_info <span class="keyword">in</span> <span class="built_in">list</span>(all_for_one):</span><br><span class="line">    <span class="keyword">if</span> app_info == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        all_for_one[<span class="number">1</span>] = <span class="string">&#x27;x&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(all_for_one) <span class="comment"># [&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>这里通过list()将迭代器转成列表,然后修改列表的元素。</p>
<ol start="2">
<li>使用循环的索引而不是直接使用元素:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">all_for_one = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(all_for_one)):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">        all_for_one[i] = <span class="string">&#x27;x&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(all_for_one) <span class="comment"># [&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>通过索引 i 来访问并修改元素。</p>
<ol start="3">
<li>使用enumerate()在循环中获取索引:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">all_for_one = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, app_info <span class="keyword">in</span> <span class="built_in">enumerate</span>(all_for_one):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">        all_for_one[i] = <span class="string">&#x27;x&#x27;</span></span><br><span class="line">        </span><br><span class="line"><span class="built_in">print</span>(all_for_one) <span class="comment"># [&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>enumerate()可以同时迭代索引和元素。</p>
<p>所以主要思路就是不直接修改循环变量,而是通过索引或临时列表来修改迭代器中的原始元素。</p>
<h3 id="修改for循环的对象-set"><a href="#修改for循环的对象-set" class="headerlink" title="修改for循环的对象 set"></a>修改for循环的对象 set</h3><p>对于 set 这样的不可变对象,不能直接通过索引或者 enumerate 来修改,因为 set 对象不支持索引和切片操作。</p>
<p>对于 set,可以使用以下方法在循环内部进行修改:</p>
<ol>
<li>将 set 转换成 list,修改后再转换回 set</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">list</span>(s):</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        s = <span class="built_in">list</span>(s)</span><br><span class="line">        s[<span class="number">1</span>] = <span class="string">&#x27;x&#x27;</span></span><br><span class="line">        s = <span class="built_in">set</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment"># &#123;&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建一个新的 set,在循环中添加修改后的元素</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line">new_s = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        new_s.add(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        new_s.add(item)</span><br><span class="line">        </span><br><span class="line">s = new_s</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment"># &#123;&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用 set 的discard()和add()方法在循环中修改</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> s:</span><br><span class="line">    <span class="keyword">if</span> item == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        s.discard(item)</span><br><span class="line">        s.add(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s) <span class="comment"># &#123;&#x27;a&#x27;, &#x27;x&#x27;, &#x27;c&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面这些方法的关键思路都是:</p>
<ol>
<li>将不可变对象设置转换成可变类型</li>
<li>在循环中针对可变类型进行修改</li>
<li>再转换回不可变 Set 对象</li>
</ol>
<p>这样就可以实现循环中修改 Set 的效果。</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_63719049/article/details/125680242">https://blog.csdn.net/weixin_63719049/article/details/125680242</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-24T16:00:00.000Z" title="8/24/2023, 4:00:00 PM">2023-08-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.076Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">28 minutes read (About 4183 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/24/Work/software/perf/perf/">Perf</a></p><div class="content"><h2 id="perf-介绍"><a href="#perf-介绍" class="headerlink" title="perf 介绍"></a>perf 介绍</h2><p>Perf是Linux下的一个性能分析工具(profiler)。基于Linux 内核perf_event子系统实现。</p>
<p>Perf不仅能够分析 PMU 事件(硬件事件)，也能分析各种软件事件，如进程切换、pagefault、网络、文件IO等。</p>
<p><img src="https://pic.shaojiemike.top/img/20220801152818.png"></p>
<h2 id="常用perf命令"><a href="#常用perf命令" class="headerlink" title="常用perf命令"></a>常用perf命令</h2><h3 id="间隔选项"><a href="#间隔选项" class="headerlink" title="间隔选项"></a>间隔选项</h3><p><code>-I 100</code> 以100ms为间隔打印数据</p>
<h3 id="性能事件的属性"><a href="#性能事件的属性" class="headerlink" title="性能事件的属性"></a>性能事件的属性</h3><p>硬件性能事件由处理器中的PMU提供支持。由于现代处理器的主频非常高，再加上深度流水线机制，从性能事件被触发，到处理器响应 PMI中断，流水线上可能已处理过数百条指令。</p>
<p>那么PMI中断采到的指令地址就不再是<strong>触发性能事件的那条指令的地址了</strong>，而且可能具有非常严重的偏差。</p>
<p>为了解决这个问题，Intel处理器通过<strong>PEBS机制</strong>实现了高精度事件采样。PEBS通过硬件在计数器溢出时将处理器现场直接保存到内存（而不是在响应中断时才保存寄存器现场），从而使得 perf能够采到真正触发性能事件的那条指令的地址，提高了采样精度。</p>
<p>在默认条件下，perf不使用PEBS机制。用户如果想要使用高精度采样，需要在指定性能事件时，在事件名后添加后缀”:p”或”:pp”。Perf在采样精度上定义了4个级别，如下表所示。</p>
<p>级别描述</p>
<pre><code>  0 无精度保证
  1 采样指令与触发性能事件的指令之间的偏差为常数（:p）
  2 需要尽量保证采样指令与触发性能事件的指令之间的偏差为0（:pp）
  3 保证采样指令与触发性能事件的指令之间的偏差必须为0（:ppp）
  性能事件的精度级别目前的X86处理器，包括Intel处理器与AMD处理器均仅能实现前 3 个精度级别。
</code></pre>
<p>除了精度级别以外，性能事件还具有其它几个属性，均可以通过”event: X”的方式予以指定。</p>
<p>标志属性</p>
<pre><code>  u 仅统计用户空间程序触发的性能事件
  k 仅统计内核触发的性能事件，有些根据寄存器计数器获得的数值，无法区分内核态还是用户态产生。
  uk 测量两者的合
  h 仅统计Hypervisor触发的性能事件
  G 在KVM虚拟机中，仅统计Guest系统触发的性能事件
  H 仅统计 Host 系统触发的性能事件
  p 精度级别
</code></pre>
<h3 id="perf-list"><a href="#perf-list" class="headerlink" title="perf list"></a>perf list</h3><p>列出可采集事件(to be used in -e).</p>
<p>常用的集合事件 Metric Groups: <code>perf list metricgroup</code></p>
<h3 id="perf-stat"><a href="#perf-stat" class="headerlink" title="perf stat"></a>perf stat</h3><p>可以列出程序运行的基本分析数据，或者特殊指明事件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> ./bin/pivot <span class="string">&quot;../run/uniformvector-2dim-5h.txt&quot;</span></span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 236.736000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;./bin/pivot ../run/uniformvector-2dim-5h.txt&#x27;</span>:</span><br><span class="line"></span><br><span class="line">          7,445.60 msec task-clock                <span class="comment">#   30.814 CPUs utilized</span></span><br><span class="line">               188      context-switches          <span class="comment">#    0.025 K/sec</span></span><br><span class="line">                33      cpu-migrations            <span class="comment">#    0.004 K/sec</span></span><br><span class="line">               678      page-faults               <span class="comment">#    0.091 K/sec</span></span><br><span class="line">    14,181,698,360      cycles                    <span class="comment">#    1.905 GHz                      (75.63%)</span></span><br><span class="line">    46,455,227,542      instructions              <span class="comment">#    3.28  insn per cycle           (74.37%)</span></span><br><span class="line">     2,008,507,493      branches                  <span class="comment">#  269.758 M/sec                    (74.18%)</span></span><br><span class="line">        13,872,537      branch-misses             <span class="comment">#    0.69% of all branches          (75.82%)</span></span><br><span class="line"></span><br><span class="line">       0.241629599 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       7.448593000 seconds user</span><br><span class="line">       0.000000000 seconds sys</span><br></pre></td></tr></table></figure>

<p>Using Metric Groups: <code>perf stat -M Summary,TLB  --metric-only ./exe</code></p>
<p><code>--metric-only</code> will just print calculated metric without raw data.</p>
<h3 id="perf-record"><a href="#perf-record" class="headerlink" title="perf record"></a>perf record</h3><p>Run a command and record its profile into <code>perf.data</code></p>
<p><img src="https://pic.shaojiemike.top/img/20220801160433.png"></p>
<p>must add <code>perf record -g xxx</code> to generate perf report topdown graph</p>
<p>不指定 <code>-e</code> 默认 <code>-e cycles:u</code> 。要统计全部的周期使用 <code>-e cycles:uk</code></p>
<p>注意周期和指令统计的是多核的。选项<code>-a</code>可以指定所有核。</p>
<p>cycles和task-clock基本差不多<br><img src="https://pic.shaojiemike.top/img/20220814160342.png"></p>
<p>在测试时加上 <code>uppp</code> 的p提高精度，防止采样偏移到其他指令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perf record -g -e branch-misses:uppp ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br><span class="line">perf record -g -e task-clock:uppp ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br></pre></td></tr></table></figure>

<p>可以看出分支失败在for循环这里<br><img src="https://pic.shaojiemike.top/img/20220801221232.png"></p>
<p><code>echo 0 &gt; /proc/sys/kernel/kptr_restrict</code> is needed.</p>
<h3 id="perf-report"><a href="#perf-report" class="headerlink" title="perf report"></a>perf report</h3><p>Read <code>perf.data</code> (created by perf record) and display the profile</p>
<p>可交互的命令行。不仅可以显示出汇编和原代码的对应关系，还可以jump自动跳转</p>
<!-- ![](https://pic.shaojiemike.top/img/20220801161146.png) -->

<p><img src="https://pic.shaojiemike.top/img/20230823173138.png"></p>
<h3 id="perf-annotate"><a href="#perf-annotate" class="headerlink" title="perf annotate"></a>perf annotate</h3><ol>
<li>program compiled in <code>-g</code> flag</li>
<li><code>perf annotate</code> can show each line execution cycles percentage</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20230823172840.png"></p>
<h3 id="percentage-at-the-end-of-each-line"><a href="#percentage-at-the-end-of-each-line" class="headerlink" title="percentage at the end of each line"></a>percentage at the end of each line</h3><p>When you select many metric using <code>-e</code> option, but there is limited PMU hardware to use. So perf using <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/33679408/perf-what-do-n-percent-records-mean-in-perf-stat-output">Event multiplexing</a><br>to measure parttime data to estimate the full data. the <code>%</code> is the <code>parttime / fulltime</code></p>
<h3 id="pmc-tools"><a href="#pmc-tools" class="headerlink" title="pmc-tools"></a>pmc-tools</h3><p><a target="_blank" rel="noopener" href="https://github.com/brendangregg/pmc-cloud-tools">pmc-tools</a></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>Because of perf estimation, when numbers bigger than <code>10^9</code>, the math relationship is more convincible.</p>
<h3 id="Integer-Operations-per-seconds-IntOps"><a href="#Integer-Operations-per-seconds-IntOps" class="headerlink" title="Integer Operations per seconds (IntOps)"></a>Integer Operations per seconds (IntOps)</h3><p>??? failure “No integer-ralated state But float in perf list”</p>
<pre><code>  1. [perf is hard to measure int](https://stackoverflow.com/questions/48811754/are-there-integer-performance-counters-on-current-intel-cpus)
  2. [Check raw hardware event codes (to be used with -rNNN) also difficult choice](https://stackoverflow.com/questions/4335011/measuring-flops-of-an-application-with-the-linux-perf-tool)

  ![](https://pic.shaojiemike.top/shaojiemike/2023/11/9b8be6dd1ae6e1b4a11ba7754a357cc7.png)
</code></pre>
<p>??? warning “Roofline: PMU &amp; Perf”</p>
<pre><code>maybe we should further research Integer PMU events. Or just use VTune

![](https://pic.shaojiemike.top/shaojiemike/2023/11/8fb6589960bc5234207d26bf1a60c263.png)[^1]
</code></pre>
<h3 id="TLB-miss-rate"><a href="#TLB-miss-rate" class="headerlink" title="TLB miss rate"></a>TLB miss rate</h3><p><a target="_blank" rel="noopener" href="https://community.intel.com/t5/Software-Tuning-Performance/Perf-counters-for-measuring-TLB-miss-rate/m-p/1256403">reference</a> inspire me in snode6</p>
<ul>
<li>Total number of memory references ( X ) &#x3D; <code>mem_uops_retired.all_loads</code> + <code>mem_uops_retired.all_stores</code></li>
<li>Total number of memory references that missed in TLB ( Y ) &#x3D; <code>mem_uops_retired.stlb_miss_loads</code> + <code>mem_uops_retired.stlb_miss_stores</code></li>
<li>TLB miss rate &#x3D; Y&#x2F;X</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">perf <span class="built_in">stat</span> \</span><br><span class="line">    -e mem_uops_retired.all_loads \</span><br><span class="line">    -e mem_uops_retired.all_stores \</span><br><span class="line">    -e mem_uops_retired.stlb_miss_loads \</span><br><span class="line">    -e mem_uops_retired.stlb_miss_stores xxx</span><br></pre></td></tr></table></figure>

<p>according to the following experience, <code>mem_uops_retired.stlb_miss_stores</code> is equal to <code>dtlb_store_misses.miss_causes_a_walk</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> -e mem_uops_retired.all_loads -e mem_uops_retired.all_stores -e mem_uops_retired.stlb_miss_loads -e mem_uops_retired.stlb_miss_stores -e dtlb_load_misses.miss_causes_a_walk\</span><br><span class="line">    -e dtlb_store_misses.miss_causes_a_walk \</span><br><span class="line">    -e itlb_misses.miss_causes_a_walk  \</span><br><span class="line">    -e dtlb_load_misses.walk_duration \</span><br><span class="line">    -e dtlb_store_misses.walk_duration \</span><br><span class="line">    -e itlb_misses.walk_duration \</span><br><span class="line">    -e instructions:uk \</span><br><span class="line">    -e cycles:uk ./bigJump.exe 1 10 500</span><br><span class="line">Number <span class="built_in">read</span> from <span class="built_in">command</span> line: 1 10 (N,J should not big, [0,5] is best.)</span><br><span class="line">result 0</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;./bigJump.exe 1 10 500&#x27;</span>:</span><br><span class="line"></span><br><span class="line">           3253636      mem_uops_retired.all_loads                                     (41.53%)</span><br><span class="line">         529570049      mem_uops_retired.all_stores                                     (41.62%)</span><br><span class="line">             59111      mem_uops_retired.stlb_miss_loads                                     (41.71%)</span><br><span class="line">         471688964      mem_uops_retired.stlb_miss_stores                                     (33.50%)</span><br><span class="line">            101474      dtlb_load_misses.miss_causes_a_walk                                     (33.56%)</span><br><span class="line">         477591045      dtlb_store_misses.miss_causes_a_walk                                     (33.47%)</span><br><span class="line">             61667      itlb_misses.miss_causes_a_walk                                     (33.37%)</span><br><span class="line">           5591102      dtlb_load_misses.walk_duration                                     (33.28%)</span><br><span class="line">       16489869334      dtlb_store_misses.walk_duration                                     (33.22%)</span><br><span class="line">           2202174      itlb_misses.walk_duration                                     (33.22%)</span><br><span class="line">        3712587926      instructions:uk           <span class="comment">#    0.34  insn per cycle           (41.52%)</span></span><br><span class="line">       10791067051      cycles:uk                                                     (41.52%)</span><br></pre></td></tr></table></figure>

<h3 id="perf测量-page-walk-时间占比"><a href="#perf测量-page-walk-时间占比" class="headerlink" title="perf测量 page walk 时间占比"></a>perf测量 page walk 时间占比</h3><p>脚本如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Intel(R) Xeon(R) CPU E5-2695 v4 @ 2.10GHz</span></span><br><span class="line">USER=<span class="string">&quot;/staff/qcjiang/codes/PIA_workspace&quot;</span></span><br><span class="line">APP=<span class="string">&quot;<span class="variable">$USER</span>/workloads/pagerank/cpp/pagerank <span class="variable">$USER</span>/workloads/pagerank/test/barabasi-100000-pr-p.txt&quot;</span></span><br><span class="line">perf <span class="built_in">stat</span> \</span><br><span class="line">    -e dtlb_load_misses.miss_causes_a_walk\</span><br><span class="line">    -e dtlb_store_misses.miss_causes_a_walk \</span><br><span class="line">    -e itlb_misses.miss_causes_a_walk  \</span><br><span class="line">    -e dtlb_load_misses.walk_duration \</span><br><span class="line">    -e dtlb_store_misses.walk_duration \</span><br><span class="line">    -e itlb_misses.walk_duration \</span><br><span class="line">    -e instructions:uk \</span><br><span class="line">    -e cycles:uk \</span><br><span class="line">    <span class="variable">$APP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dtlb_load_misses.walk_duration</span></span><br><span class="line"><span class="comment"># [Cycles when PMH(Page Miss Handling) is busy with page walks Spec update: BDM69]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GH</span></span><br><span class="line">perf <span class="built_in">stat</span>\</span><br><span class="line">    -e dtlb_load_misses.walk_completed\</span><br><span class="line">    -e dtlb_load_misses.walk_active\</span><br><span class="line">    -e dtlb_store_misses.walk_completed\</span><br><span class="line">    -e dtlb_store_misses.walk_active\</span><br><span class="line">    -e itlb_misses.walk_completed\</span><br><span class="line">    -e itlb_misses.walk_active\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># different perf on hades0 AMD cpu</span></span><br><span class="line"><span class="comment"># AMD do not have the page walk time record</span></span><br><span class="line">perf <span class="built_in">stat</span>\</span><br><span class="line"> -e ls_l1_d_tlb_miss.all\</span><br><span class="line"> -e l1_dtlb_misses\</span><br><span class="line"> -e l2_dtlb_misses\</span><br><span class="line"> -e l2_itlb_misses\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if2m\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if4k\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if1g\</span><br><span class="line"> -e ls_tablewalker.dc_type0\</span><br><span class="line"> -e ls_tablewalker.dc_type1\</span><br><span class="line"> -e ls_tablewalker.dside\</span><br><span class="line"> -e ls_tablewalker.ic_type0\</span><br><span class="line"> -e ls_tablewalker.ic_type1\</span><br><span class="line"> -e ls_tablewalker.iside -e instructions:uk -e cycles:uk /staff/shaojiemike/github/DAMOV/workloads/gemm/gemm 2000</span><br></pre></td></tr></table></figure>

<p>统计TLB miss的性能事件可以帮助分析程序是否存在地址翻译方面的性能瓶颈。STLB miss通常表示存储指令无法利用局部性,访问了过多随机地址。优化程序的数据访问模式可以减少TLB miss。</p>
<p><code>-I 100</code> 以100ms为间隔打印数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./investigation/pagewalk/tlbstat -c <span class="string">&#x27;/staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1&#x27;</span></span><br><span class="line"><span class="built_in">command</span> is /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1</span><br><span class="line">K_CYCLES   K_INSTR      IPC DTLB_WALKS ITLB_WALKS K_DTLBCYC  K_ITLBCYC  DTLB% ITLB%</span><br><span class="line">186001     83244       0.45 753584     63         27841      1          14.97  0.00</span><br><span class="line">229121     89734       0.39 1009100    213        31103      10         13.58  0.00</span><br><span class="line">6233833    3629907     0.58 1227653    316159     45877      8347        0.74  0.13</span><br><span class="line">16579329   8756681     0.53 10860225   524414     264655     15348       1.60  0.09</span><br></pre></td></tr></table></figure>

<ul>
<li>obs1: 前期读取数据部分DTLB大</li>
<li>obs2: cycle数前面是单核，后面是32核。而且读取时与计算时的core动态频率也不同。<ul>
<li>根据<code>lscpu</code>的结果。最高3.3GHz, min 1.2GHz. <code>2*32*33/12 = 176 ~ 165</code>。符合预期。</li>
</ul>
</li>
<li>obs3: 可以不考虑kernel。内核操作（malloc空间）的浮动很大。</li>
</ul>
<h3 id="为什么强调是Retired"><a href="#为什么强调是Retired" class="headerlink" title="为什么强调是Retired"></a>为什么强调是Retired</h3><p>在Intel处理器中,不是所有的存储指令(store uops)都会退休(retire)执行。具体来说,有以下几种情况:</p>
<ol>
<li>存储指令被重排序或规避了,没有真正执行,所以不会退休。</li>
<li>存储指令执行期间遇到异常,被取消了,同样不会退休。</li>
<li>优化后的微操作 fusion 可能会 cancel 掉冗余的存储指令,这些指令也不会退休。</li>
<li>硬件优化会将多个存储指令合并(coalescing)为一个存储指令执行,其它冗余指令不会退休。</li>
</ol>
<p>综上所述,不是所有的存储指令都会 retirement,其中有一部分指令因为各种原因被取消或合并了。</p>
<p>所以这个事件“Retired store uops” 特别强调统计的是执行完整并退休的存储指令。只统计退休的存储指令,可以更准确地反映程序实际进行了存储操作的次数。如果包含被取消的指令,会引入噪声,影响分析结果。</p>
<p>此外,TLB miss只发生在指令真正要执行时,那时已经可以确定指令确实会退休,不会被取消。</p>
<h2 id="进阶应用："><a href="#进阶应用：" class="headerlink" title="进阶应用："></a>进阶应用：</h2><p>改变数据规模好方式，统计该函数花费的cycle，斜率即CPE(cycles per element)</p>
<h3 id="Perf-stat例子-通过CPE估计L1-Cache-latency"><a href="#Perf-stat例子-通过CPE估计L1-Cache-latency" class="headerlink" title="Perf stat例子: 通过CPE估计L1 Cache latency"></a>Perf stat例子: 通过CPE估计L1 Cache latency</h3><p>改变链表的长度n，统计该函数花费的cycle，斜率即CPE(cycles per element)</p>
<p><img src="https://pic.shaojiemike.top/img/20220801155626.png"><br><img src="https://pic.shaojiemike.top/img/20220801155729.png"></p>
<h3 id="Perf-stat例子-通过CPE估计分支预测失败惩罚"><a href="#Perf-stat例子-通过CPE估计分支预测失败惩罚" class="headerlink" title="Perf stat例子: 通过CPE估计分支预测失败惩罚"></a>Perf stat例子: 通过CPE估计分支预测失败惩罚</h3><p><img src="https://pic.shaojiemike.top/img/20220801155711.png"><br><img src="https://pic.shaojiemike.top/img/20220801155913.png"></p>
<h2 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ perf record -g ./bin/pivot <span class="string">&quot;../run/uniformvector-2dim-5h.txt&quot;</span></span><br><span class="line">WARNING: Kernel address maps (/proc/&#123;kallsyms,modules&#125;) are restricted,</span><br><span class="line">check /proc/sys/kernel/kptr_restrict and /proc/sys/kernel/perf_event_paranoid.</span><br><span class="line"></span><br><span class="line">Samples <span class="keyword">in</span> kernel <span class="built_in">functions</span> may not be resolved <span class="keyword">if</span> a suitable vmlinux</span><br><span class="line">file is not found <span class="keyword">in</span> the buildid cache or <span class="keyword">in</span> the vmlinux path.</span><br><span class="line"></span><br><span class="line">Samples <span class="keyword">in</span> kernel modules won<span class="string">&#x27;t be resolved at all.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If some relocation was applied (e.g. kexec) symbols may be misresolved</span></span><br><span class="line"><span class="string">even with a suitable vmlinux or kallsyms file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Couldn&#x27;</span>t record kernel reference relocation symbol</span><br><span class="line">Symbol resolution may be skewed <span class="keyword">if</span> relocation was used (e.g. kexec).</span><br><span class="line">Check /proc/kallsyms permission or run as root.</span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 240.525000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line">[ perf record: Woken up 1 <span class="built_in">times</span> to write data ]</span><br><span class="line">[ perf record: Captured and wrote 2.794 MB perf.data (30470 samples) ]</span><br></pre></td></tr></table></figure>

<p>在不改变 <code>/proc/sys/kernel</code> 的时候</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf record ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 389.349000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line">[ perf record: Woken up 1 times to write data ]</span><br><span class="line">[ perf record: Captured and wrote 1.909 MB perf.data (49424 samples) ]</span><br></pre></td></tr></table></figure>

<h2 id="超算使用perf分析"><a href="#超算使用perf分析" class="headerlink" title="超算使用perf分析"></a>超算使用perf分析</h2><p>有时候由于架构不同超算不能使用vtune，</p>
<h3 id="srun"><a href="#srun" class="headerlink" title="srun"></a>srun</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -p IPCC -N 1 -n 1 -c 64 -t 1  perf record -g ../build/bin/pivot uniformvector-4dim-1h.txt</span><br></pre></td></tr></table></figure>

<p>没有生成perf.data文件。终端末尾输出一堆乱码，不懂（后面知道了乱码是因为没有指定 <code>-o</code> 输出，默认竟然输出到命令行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -p IPCC -N 1 -n 1 -c 64 -t 1  /usr/bin/bash</span><br></pre></td></tr></table></figure>

<p>申请bash然后运行一样结果</p>
<h3 id="salloc"><a href="#salloc" class="headerlink" title="salloc"></a>salloc</h3><p>这样可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/github/MarchZnver1/IPCC2022-preliminary/run (main*) [07:38:46]           </span><br><span class="line">&gt; salloc -p IPCC -N 1 -t 10:00                                            </span><br><span class="line">salloc: Granted job allocation 2175282                                       </span><br><span class="line">salloc: Waiting for resource configuration                                         </span><br><span class="line">salloc: Nodes fb0101 are ready for job                                     </span><br><span class="line">bash-4.2$ ls                                                             </span><br><span class="line">check.py  manual.log  refer-2dim-5h.txt  refer-4dim-1h.txt  result.txt  run.2022-08-10.log  run_case1.sh  run-ipcc-mpi.sh  run-ipcc.sh  run-mpi.sh  run.sh  uniformvector-2dim-5h.txt  uniformvector-4dim-1h.txt   </span><br><span class="line">bash-4.2$ perf record -g ../build/bin/pivot uniformvector-4dim-1h.txt</span><br></pre></td></tr></table></figure>

<p>但实际在登录节点跑的，有ssh不上去</p>
<h3 id="sbatch"><a href="#sbatch" class="headerlink" title="sbatch"></a>sbatch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#SBATCH -p IPCC</span><br><span class="line">#SBATCH -t 3:00</span><br><span class="line">#SBATCH --nodes=1</span><br><span class="line">#SBATCH --exclude=</span><br><span class="line">#SBATCH --cpus-per-task=64</span><br><span class="line">#SBATCH --mail-type=FAIL</span><br><span class="line">#SBATCH --mail-user=ta1ly@mail.ustc.edu.cn</span><br><span class="line"></span><br><span class="line">source /public1/soft/modules/module.sh</span><br><span class="line">module purge</span><br><span class="line"></span><br><span class="line">module load gcc/8.1.0</span><br><span class="line">module load mpich/3.1.4-gcc8.1.0</span><br><span class="line"></span><br><span class="line">logname=vtune</span><br><span class="line">export OMP_PROC_BIND=close; export OMP_PLACES=cores</span><br><span class="line">perf record -g -e task-clock:uppp /public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/uniformvector-4dim-1h.txt |tee ./$logname</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/slurm  [11:18:06]</span><br><span class="line">&gt; cat slurm-2180072.out </span><br><span class="line">Error:</span><br><span class="line">task-clock:uppp: PMU Hardware doesn&#x27;t support sampling/overflow-interrupts. Try &#x27;perf stat&#x27;</span><br></pre></td></tr></table></figure>

<p>修改指令为 <code>perf record -g -o perfData -e task-clock:upp</code> 支持 <code>pp</code></p>
<h3 id="分析CVT"><a href="#分析CVT" class="headerlink" title="分析CVT"></a>分析CVT</h3><p><img src="https://pic.shaojiemike.top/img/20220814155514.png"></p>
<p>感觉寄存器才用到10，还可以展开一次。</p>
<h3 id="分析CVT变sub"><a href="#分析CVT变sub" class="headerlink" title="分析CVT变sub"></a>分析CVT变sub</h3><p><img src="https://pic.shaojiemike.top/img/20220814164135.png"></p>
<p>为了形成add流水，编译器把sub都改成add了。</p>
<p><code>vmovaps      0xf98(%rip),%ymm9        # 81a0 &lt;blockSize+0x20&gt; </code> 应该是从静态变量里读的。</p>
<h3 id="分析再展开一次float"><a href="#分析再展开一次float" class="headerlink" title="分析再展开一次float"></a>分析再展开一次float</h3><p><img src="https://pic.shaojiemike.top/img/20220814171830.png"></p>
<p><img src="https://pic.shaojiemike.top/img/5abb94364cd2a094b030879b154a880.jpg"><br>结果已经不对了，而且也没快(还是和资源流水有关吧，寄存器也吃紧了，sub都没在一起)</p>
<p>但是说明 <code>unroll_SumDistance(j)</code> 这种写法是能在汇编层面实现展开的</p>
<h3 id="对比分析再展开一次double"><a href="#对比分析再展开一次double" class="headerlink" title="对比分析再展开一次double"></a>对比分析再展开一次double</h3><p>由于寄存器更加紧张，load都不能再一起， <code>ymm9</code> 寄存器不够。<br><img src="https://pic.shaojiemike.top/img/20220817193944.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220817194451.png"><br>第一条红色的vadd感觉可以放下来。可能add和sub是公用同一个流水？</p>
<h3 id="perf-stat-1"><a href="#perf-stat-1" class="headerlink" title="perf stat"></a>perf stat</h3><p>单节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#x27;/public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/case2/uniformvector-4dim-1h.txt&#x27;:</span><br><span class="line"></span><br><span class="line">        73,637.63 msec task-clock:u              #   54.327 CPUs utilized          </span><br><span class="line">                0      context-switches:u        #    0.000 K/sec                  </span><br><span class="line">                0      cpu-migrations:u          #    0.000 K/sec                  </span><br><span class="line">            9,433      page-faults:u             #    0.128 K/sec                  </span><br><span class="line">  192,614,020,152      cycles:u                  #    2.616 GHz                      (83.34%)</span><br><span class="line">    4,530,181,367      stalled-cycles-frontend:u #    2.35% frontend cycles idle     (83.32%)</span><br><span class="line">   25,154,915,770      stalled-cycles-backend:u  #   13.06% backend cycles idle      (83.33%)</span><br><span class="line">  698,720,546,628      instructions:u            #    3.63  insn per cycle         </span><br><span class="line">                                                 #    0.04  stalled cycles per insn  (83.34%)</span><br><span class="line">   27,780,261,977      branches:u                #  377.256 M/sec                    (83.33%)</span><br><span class="line">       11,900,773      branch-misses:u           #    0.04% of all branches          (83.33%)</span><br><span class="line"></span><br><span class="line">      1.355446229 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     73.465281000 seconds user</span><br><span class="line">      0.181156000 seconds sys</span><br></pre></td></tr></table></figure>

<p>两个节点的perf数据感觉有问题， <code>perf record</code> 结果也很奇怪<br><img src="https://pic.shaojiemike.top/img/20220814160918.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#x27;mpirun -n 2 /public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/case2/uniformvector-4dim-1h.txt&#x27;:</span><br><span class="line"></span><br><span class="line">             51.37 msec task-clock:u              #    0.060 CPUs utilized          </span><br><span class="line">                 0      context-switches:u        #    0.000 K/sec                  </span><br><span class="line">                 0      cpu-migrations:u          #    0.000 K/sec                  </span><br><span class="line">             2,278      page-faults:u             #    0.044 M/sec                  </span><br><span class="line">        39,972,793      cycles:u                  #    0.778 GHz                      (84.56%)</span><br><span class="line">         2,747,434      stalled-cycles-frontend:u #    6.87% frontend cycles idle     (85.16%)</span><br><span class="line">        10,620,259      stalled-cycles-backend:u  #   26.57% backend cycles idle      (88.39%)</span><br><span class="line">        58,479,982      instructions:u            #    1.46  insn per cycle         </span><br><span class="line">                                                  #    0.18  stalled cycles per insn  (89.18%)</span><br><span class="line">        14,068,620      branches:u                #  273.884 M/sec                    (77.31%)</span><br><span class="line">           365,530      branch-misses:u           #    2.60% of all branches          (75.40%)</span><br><span class="line"></span><br><span class="line">       0.850258803 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.015115000 seconds user</span><br><span class="line">       0.038139000 seconds sys</span><br></pre></td></tr></table></figure>

<h3 id="具体分析例子"><a href="#具体分析例子" class="headerlink" title="具体分析例子"></a>具体分析例子</h3><p>对于精心展开的手动向量化代码(理应用满了avx2的16个YMM*寄存器)</p>
<p>但是 <code>-march=znver1</code> 还是有1&#x2F;3的加速。</p>
<p><img src="https://pic.shaojiemike.top/img/20220810205433.png"></p>
<p>可以发现变快的代码几点区别（可能和相同类型指令在一起执行，没什么关系）</p>
<ol>
<li>load的形式变了，没有采用了<code>insertf128</code>。(0.71 下降到 0.06)</li>
<li>load的次数变少了(vmaxpd 地址元素实现，减少指令数)</li>
<li>指令没有被拆分的那么散，更紧凑了。</li>
</ol>
<p>下面是核心展开两次的代码：<br><img src="https://pic.shaojiemike.top/img/20220810211341.png"><br>快速的代码</p>
<ol>
<li>load统一load快？而且在循环外围load，，无需load(vmax地址元素实现)</li>
<li>从sub指令可以看出，是编译器是很想一起load，但是只有16个.（ymm0是总和，ymm9是掩码</li>
</ol>
<p>综合来看<strong>指令数减少</strong>了许多(看截图，快的36条指令， 慢的54条指令)。性能瓶颈在<strong>指令退休</strong>？？<br><img src="https://pic.shaojiemike.top/img/20220810212911.png"><br>可以perf stat来验证<br><img src="https://pic.shaojiemike.top/img/20220811110002.png"><br>可以看出IPC基本没变。<br><img src="https://pic.shaojiemike.top/img/20220811110153.png"></p>
<p>这样就可以解释为什么数据重用加上 <code>-march=znver1</code> 变快了，但是原本的没变快。因为数据重用多了n*n的许多的数据读取，然后该选项合并消减了许多指令(直接隐含到vmaxpd里了)，所以有加速。但是原本的实现基本没有数据读取，自然没得优化，所以基本没加速。</p>
<h2 id="机器的IPC影响因素"><a href="#机器的IPC影响因素" class="headerlink" title="机器的IPC影响因素"></a>机器的IPC影响因素</h2><p>可以看出优化了有些许变化，主要原因是不同指令的Throughput不同(每个周期能执行的指令数)。</p>
<p><img src="https://pic.shaojiemike.top/img/20220812074940.png"><br>核数竟然就是 <code>userTime/elapsedTime</code> 这也太粗暴了吧。</p>
<p>运行不同的例子，执行的程序内代码的权重和类型不同，IPC有所不同。(小例子有400&#x2F;600的时间都在MPI_Init, 自然IPC会低一些)</p>
<p><img src="https://pic.shaojiemike.top/img/20220812080417.png"></p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="限制选项"><a href="#限制选项" class="headerlink" title="限制选项"></a>限制选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">perf_event_paranoid setting is 4:</span><br><span class="line">  -1: Allow use of (almost) all events by all <span class="built_in">users</span></span><br><span class="line">      Ignore mlock <span class="built_in">limit</span> after perf_event_mlock_kb without CAP_IPC_LOCK</span><br><span class="line">&gt;= 0: Disallow raw and ftrace <span class="keyword">function</span> tracepoint access</span><br><span class="line">&gt;= 1: Disallow CPU event access</span><br><span class="line">&gt;= 2: Disallow kernel profiling</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/sysctl.conf</code> 文件，加入<br><code>kernel.perf_event_paranoid = -1</code><br>保存文件并退出。然后，你可以通过重新加载 sysctl 配置来使设置生效：<br><code>sudo sysctl -p</code></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>实验室同学袁福焱组会汇报</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141694060">https://zhuanlan.zhihu.com/p/141694060</a></p>
<p>[^1]: <a target="_blank" rel="noopener" href="https://people.inf.ethz.ch/markusp/teaching/263-2300-ETH-spring14/slides/08-perfcounters.pdf">Performance Counters and applying the Roofline Model</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-23T16:00:00.000Z" title="8/23/2023, 4:00:00 PM">2023-08-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.068Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Operating-system/">Operating system</a></span><span class="level-item">a minute read (About 172 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/23/Work/info/IntelSDM/">Intel SDM(Software Developer&#039;s Manual)</a></p><div class="content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This set consists of </p>
<table>
<thead>
<tr>
<th>volume</th>
<th>Descriptions</th>
<th>pages(size)</th>
</tr>
</thead>
<tbody><tr>
<td>volume 1</td>
<td>Basic Architecture</td>
<td>500 pages(3MB)</td>
</tr>
<tr>
<td>volume 2 (combined 2A, 2B, 2C, and 2D)</td>
<td>full instruction set reference</td>
<td>2522 pages(10.8MB)</td>
</tr>
<tr>
<td>volume 3 (combined 3A, 3B, 3C, and 3D)</td>
<td>system programming guide</td>
<td>1534 pages(8.5MB)</td>
</tr>
<tr>
<td>volume 4</td>
<td>MODEL-SPECIFIC REGISTERS (MSRS)</td>
<td>520 pages</td>
</tr>
</tbody></table>
<p>volume3:  Memory management(paging), protection, task management, interrupt and exception handling, multi-processor support, thermal and power management features, debugging, performance monitoring, system management mode, virtual machine extensions (VMX) instructions, Intel® Virtualization Technology (Intel® VT), and Intel® Software Guard Extensions (Intel® SGX).</p>
<h2 id="AMD64-Architecture-Programmer’s-Manual-3336-pages"><a href="#AMD64-Architecture-Programmer’s-Manual-3336-pages" class="headerlink" title="AMD64 Architecture Programmer’s Manual (3336 pages)"></a>AMD64 Architecture Programmer’s Manual (3336 pages)</h2><p>more graph and easier to read.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-21T16:00:00.000Z" title="8/21/2023, 4:00:00 PM">2023-08-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.072Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 488 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/21/Work/software/manager/git/git-data-code-separate/">Git Submodule: Data &amp; Code Repository Separate</a></p><div class="content"><h2 id="Just-follow-my-mind"><a href="#Just-follow-my-mind" class="headerlink" title="Just follow my mind"></a>Just follow my mind</h2><ol>
<li>parent repository ignore the sub directory in <code>.gitignore</code></li>
<li>Normal git usage in child repository, eg. <code>init commit push</code></li>
<li>submodule for what?<ol>
<li>for auto upload and init multi-subgit to target git commit</li>
</ol>
</li>
</ol>
<h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><p>submodule is <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87053283">hard to use</a> when it will be blocked under big sub-srepository.</p>
<p>I recommend to use <code>.gitignore</code> or just use <code>ln -s xxx yyy</code></p>
<h2 id="chatgpt-balabala"><a href="#chatgpt-balabala" class="headerlink" title="chatgpt balabala"></a>chatgpt balabala</h2><p>Adding a Git repository inside another Git repository, often referred to as a “submodule,” is a way to manage a separate repository as a part of your main project. This is particularly useful when you want to include another project within your project and keep them separate.</p>
<p>Here’s how you can add a submodule and set up <code>.gitignore</code> for the outer repository:</p>
<ol>
<li><p><strong>Add a Submodule</strong>:</p>
<p> Navigate to the root of your outer Git repository and run the following command:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add &lt;repository_url&gt; &lt;submodule_path&gt;</span><br></pre></td></tr></table></figure>

<p> Replace <code>&lt;repository_url&gt;</code> with the URL of the repository you want to add as a submodule, and <code>&lt;submodule_path&gt;</code> with the relative path within your outer repository where you want to place the submodule.</p>
</li>
<li><p><strong>Update and Initialize Submodule</strong>:</p>
<p> After adding the submodule, you need to update and initialize it:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> This command fetches the submodule’s content and initializes it.</p>
</li>
<li><p><strong>Set Up <code>.gitignore</code></strong>:</p>
<p> To ignore the submodule’s content and avoid committing it to the outer repository, you need to add the submodule path to the <code>.gitignore</code> file of the outer repository. For example, if your submodule is located in a directory called “submodule_folder,” add the following line to the <code>.gitignore</code> file:</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">submodule_folder/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Working with Submodules</strong>:</p>
<p> When you clone the outer repository on another system or share it with others, they will need to run <code>git submodule update --init --recursive</code> to fetch and initialize the submodule’s content.</p>
<p> To make changes to the submodule, navigate into the submodule directory and work as you would in a regular Git repository. When you commit changes in the submodule, you will need to push them to its remote repository. After that, commit the updated submodule reference in the outer repository.</p>
<p> To update the submodule to the latest version available, you can navigate into the submodule directory and run <code>git pull origin master</code> (or the appropriate branch) to update its content. Then, commit the updated reference in the outer repository.</p>
</li>
</ol>
<p>Remember that submodules have their own independent version control, so you need to manage them separately. Submodules provide a way to incorporate external projects into your main project while keeping their development and versioning separate.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-20T16:00:00.000Z" title="8/20/2023, 4:00:00 PM">2023-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.072Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 387 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/20/Work/software/linux/LinuxCommand/">LinuxCommand: system info</a></p><div class="content"><h2 id="硬盘-挂载空间"><a href="#硬盘-挂载空间" class="headerlink" title="硬盘&#x2F;挂载空间"></a>硬盘&#x2F;挂载空间</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h .</span><br></pre></td></tr></table></figure>

<h2 id="各个文件夹空间"><a href="#各个文件夹空间" class="headerlink" title="各个文件夹空间"></a>各个文件夹空间</h2><p>deep为1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -h -d .</span><br></pre></td></tr></table></figure>

<h2 id="进程查看与kill"><a href="#进程查看与kill" class="headerlink" title="进程查看与kill"></a>进程查看与kill</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># thi</span></span><br><span class="line">ps aux | grep 1499321</span><br><span class="line">ps -auxf | grep -nB 10 -E <span class="string">&#x27;python[3]?|PID&#x27;</span></span><br><span class="line"><span class="built_in">kill</span> -9 </span><br></pre></td></tr></table></figure>

<p>ps aux linux command whill show no zero cpu usage when the process is sleeping beacuse of its <a target="_blank" rel="noopener" href="https://superuser.com/questions/117913/ps-aux-output-meaning">snapshots mechanism</a></p>
<h2 id="apt-get-problems"><a href="#apt-get-problems" class="headerlink" title="apt-get problems"></a>apt-get problems</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dpkg: 处理归档 /var/cache/apt/archives/bat_0.12.1-1build1_arm64.deb (--unpack)时出错：</span><br><span class="line"> 正试图覆盖 /usr/.crates2.json，它同时被包含于软件包 ripgrep 11.0.2-1build1</span><br><span class="line">dpkg-deb: 错误: 粘贴 子进程被信号(断开的管道) 终止了</span><br><span class="line">在处理时有错误发生：</span><br><span class="line"> /var/cache/apt/archives/bat_0.12.1-1build1_arm64.deb</span><br><span class="line">E: Sub-process /usr/bin/dpkg returned an error code (1)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge -h</span><br><span class="line"><span class="comment"># jsonfile conflict purge - Remove packages and config files</span></span><br></pre></td></tr></table></figure>

<h2 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h2><h3 id="deep-size"><a href="#deep-size" class="headerlink" title="deep size"></a>deep size</h3><p>tree -L DepthSIze Folder_Path</p>
<h2 id="so文件分析"><a href="#so文件分析" class="headerlink" title="so文件分析"></a>so文件分析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分析symbols </span></span><br><span class="line">nm -gDC intel64/gcc4.8/*</span><br></pre></td></tr></table></figure>

<ul>
<li>-g：显示全局符号表。</li>
<li>-D：显示动态符号表。</li>
<li>-C：将 C++ 符号名还原成源代码中的名称。</li>
</ul>
<p>综合来看，使用 <code>nm -gDC &lt;filename&gt;</code> 命令可以查看一个二进制可执行文件或者共享库中的全局符号表和动态符号表，并将包含其中的 C++ 符号名还原成源代码中的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shaojiemike@snode6 ~/github/gem5  [10:49:56]</span><br><span class="line">&gt; nm /usr/local/lib/libprotobuf.a |c++filt|grep google::protobuf::MessageFactory::InternalRegisterGeneratedFile</span><br><span class="line">                 U google::protobuf::MessageFactory::InternalRegisterGeneratedFile(char const*, void (*)(std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;))</span><br><span class="line">0000000000000e00 T google::protobuf::MessageFactory::InternalRegisterGeneratedFile(char const*, void (*)(std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;))</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析子so</span></span><br><span class="line">ldd .so</span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-20T16:00:00.000Z" title="8/20/2023, 4:00:00 PM">2023-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:34:42.072Z" title="1/12/2024, 8:34:42 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a few seconds read (About 105 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/20/Work/software/linux/linuxCMDquickActions/">Linux CMD:quick actions</a></p><div class="content"><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>more in <a target="_blank" rel="noopener" href="https://linuxhandbook.com/find-exec-command/">blog</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -size +10M -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>&#123;&#125;</code> is a placeholder that is used to hold results given by the find command. </li>
<li><code>\;</code> says that for each found result, the [command] is executed</li>
</ol>
<h2 id="sed-awk"><a href="#sed-awk" class="headerlink" title="sed , awk"></a>sed , awk</h2><h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/15/">Previous</a></div><div class="pagination-next"><a href="/page/17/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/15/">15</a></li><li><a class="pagination-link is-current" href="/page/16/">16</a></li><li><a class="pagination-link" href="/page/17/">17</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/39/">39</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">382</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-10T12:00:31.000Z">2024-01-10</time></p><p class="title"><a href="/2024/01/10/Work/Programming/2-languageGrammar/OpenCLBasic/">OpenCL Basic</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-10T08:18:51.000Z">2024-01-10</time></p><p class="title"><a href="/2024/01/10/Work/Architecture/GPU/huaweiDaVinci/">Huawei GPU : DaVinci</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-09T15:38:04.000Z">2024-01-09</time></p><p class="title"><a href="/2024/01/09/Work/Programming/6-deploy/pipPackage/">Build and release your Pip Package</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-05T07:17:06.000Z">2024-01-05</time></p><p class="title"><a href="/2024/01/05/Work/Programming/2-languageGrammar/cudaExeModel/">The CUDA Execution Model</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-04T02:55:54.000Z">2024-01-04</time></p><p class="title"><a href="/2024/01/04/Work/Architecture/performanceModel/GPUPerformanceModel/">CPU / GPU Performance Model based on Interval Analysis</a></p><p class="categories"><a href="/categories/Architecture/">Architecture</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>