<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-30T16:00:00.000Z" title="5/30/2023, 4:00:00 PM">2023-05-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.054Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">24 minutes read (About 3665 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/30/Work/HPC/llvm-mca/LLVM-mca/">LLVM-MCA: docs</a></p><div class="content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>LLVM Machine Code Analyzer æ˜¯ä¸€ç§æ€§èƒ½åˆ†æå·¥å…·ï¼Œå®ƒä½¿ç”¨llvmä¸­å¯ç”¨çš„ä¿¡æ¯ï¼ˆå¦‚è°ƒåº¦æ¨¡å‹ï¼‰é™æ€æµ‹é‡ç‰¹å®šCPUä¸­æœºå™¨ä»£ç çš„æ€§èƒ½ã€‚</p>
<p>æ€§èƒ½æ˜¯æ ¹æ®<strong>ååé‡</strong>å’Œ<strong>å¤„ç†å™¨èµ„æºæ¶ˆè€—</strong>æ¥è¡¡é‡çš„ã€‚è¯¥å·¥å…·ç›®å‰é€‚ç”¨äºåœ¨åç«¯ä¸­ä½¿ç”¨LLVMè°ƒåº¦æ¨¡å‹çš„å¤„ç†å™¨ã€‚</p>
<p>è¯¥å·¥å…·çš„ä¸»è¦ç›®æ ‡ä¸ä»…æ˜¯é¢„æµ‹ä»£ç åœ¨ç›®æ ‡ä¸Šè¿è¡Œæ—¶çš„æ€§èƒ½ï¼Œè¿˜å¸®åŠ©è¯Šæ–­æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ç»™å®šæ±‡ç¼–ä»£ç ï¼Œllvm-mcaå¯ä»¥ä¼°è®¡æ¯ä¸ªå‘¨æœŸçš„æŒ‡ä»¤æ•°ï¼ˆIPCï¼‰ä»¥åŠç¡¬ä»¶èµ„æºå‹åŠ›ã€‚åˆ†æå’ŒæŠ¥å‘Šé£æ ¼çš„çµæ„Ÿæ¥è‡ªè‹±ç‰¹å°”çš„IACAå·¥å…·ã€‚</p>
<h3 id="github"><a href="#github" class="headerlink" title="github"></a>github</h3><p><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca">https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca</a></p>
<h3 id="docs"><a href="#docs" class="headerlink" title="docs"></a>docs</h3><p><a target="_blank" rel="noopener" href="https://llvm.org/docs/CommandGuide/llvm-mca.html">https://llvm.org/docs/CommandGuide/llvm-mca.html</a></p>
<h2 id="options"><a href="#options" class="headerlink" title="options"></a>options</h2><h3 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-mtriple=&lt;target triple&gt;</span><br><span class="line">    eg. -mtriple=x86_64-unknown-unknown</span><br><span class="line">-march=&lt;arch&gt;</span><br><span class="line">    Specify the architecture for which to analyze the code. It defaults to the host default target.</span><br><span class="line">-march=&lt;arch&gt;</span><br><span class="line">    Specify the architecture for which to analyze the code. It defaults to the host default target.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ”¯æŒçš„arch</span></span><br><span class="line">llc --version</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…·ä½“æ”¯æŒçš„CPU Architecture</span></span><br><span class="line">llc -march=x86 -mattr=<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="output-report"><a href="#output-report" class="headerlink" title="output-report"></a>output-report</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-output-asm-variant=&lt;variant id&gt;</span><br><span class="line">    ä¸ºå·¥å…·ç”Ÿæˆçš„æŠ¥å‘ŠæŒ‡å®šè¾“å‡ºç¨‹åºé›†å˜é‡ã€‚???</span><br><span class="line">-print-imm-hex</span><br><span class="line">    ä¼˜å…ˆ16è¿›åˆ¶è¾“å‡ºã€‚</span><br><span class="line">-json</span><br><span class="line">    é™¤äº†ç“¶é¢ˆåˆ†æï¼ŒåŸºæœ¬éƒ½æ”¯æŒjsonæ ¼å¼è¾“å‡ºè§†å›¾</span><br><span class="line">-timeline</span><br><span class="line">    æ‰“å°æŒ‡ä»¤æµæ°´çº¿æƒ…å†µ</span><br></pre></td></tr></table></figure>

<h3 id="runtime-options"><a href="#runtime-options" class="headerlink" title="runtime options"></a>runtime options</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-dispatch=&lt;width&gt;</span><br><span class="line">    ä¸ºå¤„ç†å™¨æŒ‡å®šä¸åŒçš„è°ƒåº¦å®½åº¦ã€‚è°ƒåº¦å®½åº¦é»˜è®¤ä¸ºå¤„ç†å™¨è°ƒåº¦æ¨¡å‹ä¸­çš„â€œIssueWidthâ€å­—æ®µã€‚</span><br><span class="line">-register-file-size=&lt;size&gt;</span><br><span class="line">    æŒ‡å®šå¯„å­˜å™¨æ–‡ä»¶çš„å¤§å°ã€‚æŒ‡å®šæ—¶ï¼Œè¯¥é¡¹ä¼šé™åˆ¶å¯ç”¨äºå¯„å­˜å™¨é‡å‘½åçš„ç‰©ç†å¯„å­˜å™¨çš„æ•°é‡ã€‚æ­¤æ ‡å¿—çš„å€¼ä¸ºé›¶æ„å‘³ç€â€œæ— é™æ•°é‡çš„ç‰©ç†å¯„å­˜å™¨â€ã€‚</span><br><span class="line">-iterations=&lt;number of iterations&gt;</span><br><span class="line">    æŒ‡å®šè¦è¿è¡Œçš„è¿­ä»£æ¬¡æ•°ã€‚å¦‚æœæ­¤æ ‡å¿—è®¾ç½®ä¸º 0ï¼Œåˆ™è¯¥å·¥å…·ä¼šå°†è¿­ä»£æ¬¡æ•°è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ˆå³ 100ï¼‰ã€‚</span><br><span class="line">-noalias=&lt;bool&gt;</span><br><span class="line">    loads and stores donâ€™t alias</span><br><span class="line">-lqueue=&lt;load queue size&gt;</span><br><span class="line">-squeue=&lt;store queue size&gt;</span><br><span class="line">    åœ¨å·¥å…·æ¨¡æ‹Ÿçš„åŠ è½½/å­˜å‚¨å•å…ƒä¸­æŒ‡å®šåŠ è½½é˜Ÿåˆ—çš„å¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å·¥å…·å‡å®šåŠ è½½é˜Ÿåˆ—ä¸­çš„æ¡ç›®æ•°é‡ä¸å—é™åˆ¶ã€‚æ­¤æ ‡å¿—çš„é›¶å€¼å°†è¢«å¿½ç•¥ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤åŠ è½½é˜Ÿåˆ—å¤§å°ã€‚</span><br><span class="line">-disable-cb</span><br><span class="line">    å¼ºåˆ¶ä½¿ç”¨é€šç”¨çš„ CustomBehaviour å’Œ InstrPostProcess ç±»ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›®æ ‡ç‰¹å®šçš„å®ç°ã€‚é€šç”¨ç±»ä»ä¸æ£€æµ‹ä»»ä½•è‡ªå®šä¹‰å±é™©æˆ–å¯¹æŒ‡ä»¤è¿›è¡Œä»»ä½•åå¤„ç†ä¿®æ”¹ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="more-values-Info"><a href="#more-values-Info" class="headerlink" title="more values&#x2F;Info"></a>more values&#x2F;Info</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-resource-pressure</span><br><span class="line">    Enable the resource pressure view. This is enabled by default.</span><br><span class="line">-register-file-stats</span><br><span class="line">    å¯ç”¨æ³¨å†Œæ–‡ä»¶ä½¿ç”¨ç»Ÿè®¡ã€‚</span><br><span class="line">-dispatch-stats</span><br><span class="line">-scheduler-stats</span><br><span class="line">-retire-stats</span><br><span class="line">-instruction-info</span><br><span class="line">    å¯ç”¨é¢å¤–çš„è°ƒåº¦/å‘å‡º/retire control unitç»Ÿè®¡ã€‚è¯¥è§†å›¾æ”¶é›†å’Œåˆ†ææŒ‡ä»¤åˆ†æ´¾äº‹ä»¶ï¼Œä»¥åŠé™æ€/åŠ¨æ€åˆ†æ´¾åœé¡¿äº‹ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤è§†å›¾ã€‚</span><br><span class="line">-show-encoding</span><br><span class="line">    æ‰“å°æŒ‡ä»¤16è¿›åˆ¶</span><br><span class="line">-all-stats</span><br><span class="line">-all-views</span><br><span class="line">-instruction-tables</span><br><span class="line">    è¿™ä¸èµ„æºå‹åŠ›è§†å›¾ä¸åŒï¼Œå› ä¸ºå®ƒä¸éœ€è¦æ¨¡æ‹Ÿä»£ç ã€‚ç›¸åï¼Œå®ƒæŒ‰é¡ºåºæ‰“å°æ¯ä¸ªæŒ‡ä»¤çš„èµ„æºå‹åŠ›çš„ç†è®ºå‡åŒ€åˆ†å¸ƒã€‚</span><br><span class="line">-bottleneck-analysis</span><br><span class="line">    æ‰“å°æœ‰å…³å½±å“ååé‡çš„ç“¶é¢ˆçš„ä¿¡æ¯ã€‚è¿™ç§åˆ†æå¯èƒ½å¾ˆæ˜‚è´µï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ã€‚ç“¶é¢ˆåœ¨æ‘˜è¦è§†å›¾ä¸­çªå‡ºæ˜¾ç¤ºã€‚å…·æœ‰æœ‰åºåç«¯çš„å¤„ç†å™¨ç›®å‰ä¸æ”¯æŒç“¶é¢ˆåˆ†æã€‚???</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h2><p><img src="https://pic.shaojiemike.top/img/38FD1039D93F746E0A45477E84CF74A0.png"></p>
<h2 id="æ ·ä¾‹åˆ†æ"><a href="#æ ·ä¾‹åˆ†æ" class="headerlink" title="æ ·ä¾‹åˆ†æ"></a>æ ·ä¾‹åˆ†æ</h2><h3 id="quick-overview-of-the-performance-throughput"><a href="#quick-overview-of-the-performance-throughput" class="headerlink" title="quick overview of the performance throughput"></a>quick overview of the performance throughput</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Iterations:        300</span><br><span class="line">Instructions:      900</span><br><span class="line">Total Cycles:      610</span><br><span class="line">Total uOps:        900</span><br><span class="line"></span><br><span class="line">Dispatch Width:    2</span><br><span class="line">uOps Per Cycle:    1.48</span><br><span class="line">IPC:               1.48</span><br><span class="line">Block RThroughput: 2.0</span><br></pre></td></tr></table></figure>

<ol>
<li>IPC<ol>
<li>ç†è®ºæœ€å¤§å€¼æ˜¯$$\frac{OneLoopInstructions}{Block_RThroughput}&#x3D;(OneLoopInstructions)*(Block_Throughput)$$</li>
</ol>
</li>
<li>uOps Per Cycle<ol>
<li>simulated micro opcodes (uOps)</li>
<li><strong>æ¯ä¸ªå‘¨æœŸçš„simulated micro opcodesæ•°</strong></li>
<li>åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šæœ€å¤§å€¼æ˜¯$$\frac{OneLoopUOps}{Block_RThroughput}&#x3D;(OneLoopUOps)*(Block_Throughput)$$</li>
<li>A delta between Dispatch Width and this field is an indicator of a performance issue.</li>
<li>The delta between the Dispatch Width (2.00), and the theoretical maximum uOp throughput (1.50) is an indicator of a performance bottleneck caused by the lack of hardware resources, and the Resource pressure view can help to identify the problematic resource usage.</li>
</ol>
</li>
<li>Dispatch Width<ol>
<li>å‘å°„åˆ°ä¹±åºåç«¯çš„æœ€å¤§å¾®æŒ‡ä»¤æ“ä½œæ•°(the maximum number of micro opcodes&#x2F;uOps)ï¼Ÿ</li>
</ol>
</li>
<li>Block RThroughput (Block Reciprocal Throughput)<ol>
<li>åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šçš„<strong>æ¯æ¬¡å¾ªç¯çš„æœ€å¤§blockæˆ–è€…iterationsæ•°</strong></li>
<li>å—é™äºdispatch rateå’Œthe availability of hardware resources.</li>
</ol>
</li>
</ol>
<h3 id="Instruction-info-view"><a href="#Instruction-info-view" class="headerlink" title="Instruction info view"></a>Instruction info view</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Instruction Info:</span><br><span class="line">[1]: #uOps</span><br><span class="line">[2]: Latency</span><br><span class="line">[3]: RThroughput</span><br><span class="line">[4]: MayLoad</span><br><span class="line">[5]: MayStore</span><br><span class="line">[6]: HasSideEffects (U)</span><br><span class="line"></span><br><span class="line">[1]    [2]    [3]    [4]    [5]    [6]    Instructions:</span><br><span class="line"> 1      2     1.00                        vmulps      %xmm0, %xmm1, %xmm2</span><br><span class="line"> 1      3     1.00                        vhaddps     %xmm2, %xmm2, %xmm3</span><br><span class="line"> 1      3     1.00                        vhaddps     %xmm3, %xmm3, %xmm4</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºäº†æŒ‡ä»¤é‡Œé˜Ÿåˆ—æ¯æ¡æŒ‡ä»¤çš„<strong>å»¶è¿Ÿ</strong>å’Œ<strong>ååé‡çš„å€’æ•°</strong>ã€‚</p>
<p>RThroughputæ˜¯æŒ‡ä»¤ååé‡çš„å€’æ•°ã€‚åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œååé‡æ˜¯<strong>å•å‘¨æœŸèƒ½æ‰§è¡Œçš„åŒç±»å‹æŒ‡ä»¤çš„æœ€å¤§æ•°é‡</strong>ã€‚</p>
<h3 id="Resource-pressure-view"><a href="#Resource-pressure-view" class="headerlink" title="Resource pressure view"></a>Resource pressure view</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Resources:</span><br><span class="line">[0]   - JALU0</span><br><span class="line">[1]   - JALU1</span><br><span class="line">[2]   - JDiv</span><br><span class="line">[3]   - JFPA</span><br><span class="line">[4]   - JFPM</span><br><span class="line">[5]   - JFPU0</span><br><span class="line">[6]   - JFPU1</span><br><span class="line">[7]   - JLAGU</span><br><span class="line">[8]   - JMul</span><br><span class="line">[9]   - JSAGU</span><br><span class="line">[10]  - JSTC</span><br><span class="line">[11]  - JVALU0</span><br><span class="line">[12]  - JVALU1</span><br><span class="line">[13]  - JVIMUL</span><br><span class="line"></span><br><span class="line">Resource pressure per iteration:</span><br><span class="line">[0]    [1]    [2]    [3]    [4]    [5]    [6]    [7]    [8]    [9]    [10]   [11]   [12]   [13]</span><br><span class="line"> -      -      -     2.00   1.00   2.00   1.00    -      -      -      -      -      -      -</span><br><span class="line"></span><br><span class="line">Resource pressure by instruction:</span><br><span class="line">[0]    [1]    [2]    [3]    [4]    [5]    [6]    [7]    [8]    [9]    [10]   [11]   [12]   [13]   Instructions:</span><br><span class="line"> -      -      -      -     1.00    -     1.00    -      -      -      -      -      -      -     vmulps      %xmm0, %xmm1, %xmm2</span><br><span class="line"> -      -      -     1.00    -     1.00    -      -      -      -      -      -      -      -     vhaddps     %xmm2, %xmm2, %xmm3</span><br><span class="line"> -      -      -     1.00    -     1.00    -      -      -      -      -      -      -      -     vhaddps     %xmm3, %xmm3, %xmm4</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡å¾ªç¯æˆ–è€…æ¯æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œæ¶ˆè€—çš„èµ„æºå‘¨æœŸæ•°ã€‚ä»è€Œæ‰¾åˆ°é«˜èµ„æºå ç”¨çš„éƒ¨åˆ†ã€‚</p>
<h3 id="Timeline-View"><a href="#Timeline-View" class="headerlink" title="Timeline View"></a>Timeline View</h3><p>å¯æ‰“å°æµæ°´çº¿æƒ…å†µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Timeline view:</span><br><span class="line">                    012345</span><br><span class="line">Index     0123456789</span><br><span class="line"></span><br><span class="line">[0,0]     DeeER.    .    .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[0,1]     D==eeeER  .    .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[0,2]     .D====eeeER    .   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">[1,0]     .DeeE-----R    .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[1,1]     . D=eeeE---R   .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[1,2]     . D====eeeER   .   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">[2,0]     .  DeeE-----R  .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[2,1]     .  D====eeeER  .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[2,2]     .   D======eeeER   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Average Wait times (based on the timeline view):</span><br><span class="line">[0]: Executions</span><br><span class="line">[1]: Average time spent waiting in a scheduler&#x27;s queue</span><br><span class="line">[2]: Average time spent waiting in a scheduler&#x27;s queue while ready</span><br><span class="line">[3]: Average time elapsed from WB until retire stage</span><br><span class="line"></span><br><span class="line">      [0]    [1]    [2]    [3]</span><br><span class="line">0.     3     1.0    1.0    3.3       vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">1.     3     3.3    0.7    1.0       vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">2.     3     5.7    0.0    0.0       vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">       3     3.3    0.5    1.4       &lt;total&gt;</span><br></pre></td></tr></table></figure>

<p>å½±å“å› ç´ åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ•°æ®å†²çª&#x2F;ä¾èµ–ï¼šè¯»åå†™ï¼Œå†™åè¯»ä¾èµ– ã€‚æ— æ³•æŒ‡ä»¤çº§å¹¶è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯„å­˜å™¨é‡å‘½åè§£å†³</li>
<li>ç»“æ„å†²çªï¼šå ç”¨å‘å°„ä½ æˆ–è€… åŒä¸€ç¡¬ä»¶</li>
<li>æ§åˆ¶å†²çªï¼šåˆ†æ”¯ï¼Ÿ</li>
<li>instructions must retire in program order, so [1,0] has to wait for [0,2] to be retired first</li>
</ol>
<h3 id="Bottleneck-Analysis"><a href="#Bottleneck-Analysis" class="headerlink" title="Bottleneck Analysis"></a>Bottleneck Analysis</h3><ul>
<li>å¯ä»¥åˆ†æå‡ºæ•°æ®å†²çª&#x2F;ä¾èµ–å’Œç»“æ„å†²çªçš„å½±å“å¤§å°</li>
<li>å‡†ç¡®æ€§å–å†³äºæ¨¡æ‹Ÿå’Œæ˜¯å¦æœ‰å¯¹åº”CPUæ¨¡å‹ã€‚</li>
<li>æš‚æ—¶ä¸æ”¯æŒæœ‰åºåç«¯ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Cycles with backend pressure increase [ 91.52% ]</span><br><span class="line">Throughput Bottlenecks:</span><br><span class="line">  Resource Pressure       [ 0.01% ]</span><br><span class="line">  - SBPort0  [ 0.01% ]</span><br><span class="line">  - SBPort1  [ 0.01% ]</span><br><span class="line">  - SBPort5  [ 0.01% ]</span><br><span class="line">  Data Dependencies:      [ 91.51% ]</span><br><span class="line">  - Register Dependencies [ 91.51% ]</span><br><span class="line">  - Memory Dependencies   [ 10.76% ]</span><br></pre></td></tr></table></figure>

<ul>
<li>ç«¯å£ä¿¡æ¯æ¥è‡ªTableGen <code>llvm/lib/Target/X86/X86SchedSandyBridge.td</code></li>
<li>é²²é¹920çš„æ¥è‡ª <code>llvm/lib/Target/AArch64/AArch64SchedTSV110.td</code></li>
</ul>
<h3 id="é¢å¤–ä¿¡æ¯"><a href="#é¢å¤–ä¿¡æ¯" class="headerlink" title="é¢å¤–ä¿¡æ¯"></a>é¢å¤–ä¿¡æ¯</h3><ol>
<li>Dynamic Dispatch Stall Cycles</li>
<li>Dispatch Logic<ol>
<li>å¯ä»¥çœ‹å‡ºæµæ°´çº¿å‘å°„æ»¡å¸¦å®½æˆ–å‡ æ¡æŒ‡ä»¤çš„æ—¶é—´å æ¯”</li>
</ol>
</li>
<li>Schedulers<ol>
<li>æ¯ä¸ªå‘¨æœŸå¾®æŒ‡ä»¤å‘å°„æ•°å æ¯”</li>
</ol>
</li>
<li>Schedulerâ€™s queue usage<ol>
<li><p>æ‰§è¡Œæ—¶ä½¿ç”¨çš„å¹³å‡æˆ–æœ€å¤§buffer entries (i.e., scheduler queue entries)</p>
</li>
<li><p>AMD Jaguar</p>
</li>
<li><pre><code>  JALU01 - A scheduler for ALU instructions.
  JFPU01 - A scheduler floating point operations.
  JLSAGU - A scheduler for address generation.
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. Retire Control Unit</span><br><span class="line">   1. åœ¨ä¸€ä¸ªå‘¨æœŸé‡Œæœ‰å¤šå°‘æŒ‡ä»¤retiredçš„å æ¯”(å¥½å§ï¼Œæ„Ÿè§‰æœ‰è¯­ç—…)</span><br><span class="line">6. A re-order buffer (ROB) çš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line">7. Register File statistics</span><br><span class="line">   1. physical register file (PRF)</span><br><span class="line">   2. floating-point registers (JFpuPRF)</span><br><span class="line">   3. integer registers (JIntegerPRF)</span><br><span class="line"></span><br><span class="line">## Instruction Flow</span><br><span class="line"></span><br><span class="line">llvm-mca å‡è®¾æŒ‡ä»¤åœ¨æ¨¡æ‹Ÿå¼€å§‹ä¹‹å‰å·²ç»å…¨éƒ¨è§£ç å¹¶æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚å› æ­¤ï¼ŒæŒ‡ä»¤æå–å’Œè§£ç é˜¶æ®µæ²¡æœ‰è¢«è®¡ç®—ã€‚æœªè€ƒè™‘å‰ç«¯çš„æ€§èƒ½ç“¶é¢ˆã€‚æ­¤å¤–ï¼Œllvm-mca ä¸æ¨¡æ‹Ÿåˆ†æ”¯é¢„æµ‹ã€‚</span><br><span class="line"></span><br><span class="line">### Instruction Dispatch</span><br><span class="line"></span><br><span class="line">å¤„ç†å™¨çš„é»˜è®¤ dispatch widthå€¼ç­‰äºLLVMâ€™s scheduling modelé‡Œçš„IssueWidthå€¼ã€‚</span><br><span class="line"></span><br><span class="line">An instruction can be dispatched if:</span><br><span class="line"></span><br><span class="line">* The size of the **dispatch group** is smaller than processorâ€™s dispatch width.</span><br><span class="line">* There are enough entries in the **reorder buffer**.</span><br><span class="line">* There are enough **physical registers** to do register renaming.</span><br><span class="line">* The schedulers are **not full**.</span><br><span class="line"></span><br><span class="line">reorder bufferè´Ÿè´£è·Ÿè¸ªå‘½ä»¤ï¼Œä½¿ä¹‹æŒ‰ç…§ç¨‹åºé¡ºåºretiredç»“æŸã€‚å…¶é»˜è®¤å€¼ä¸º MicroOpBufferSize ã€‚</span><br><span class="line"></span><br><span class="line">å„ç§Buffered resources è¢«è§†ä½œscheduler resources.</span><br><span class="line"></span><br><span class="line">### Instruction Issue</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªå¤„ç†å™¨è°ƒåº¦å™¨å®ç°ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºã€‚æŒ‡ä»¤å¿…é¡»åœ¨è°ƒåº¦ç¨‹åºçš„ç¼“å†²åŒºä¸­ç­‰å¾…ï¼Œç›´åˆ°è¾“å…¥å¯„å­˜å™¨æ“ä½œæ•°å¯ç”¨ã€‚åªæœ‰åœ¨é‚£ä¸ªæ—¶å€™ï¼ŒæŒ‡ä»¤æ‰ç¬¦åˆæ‰§è¡Œçš„æ¡ä»¶ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¢«å‘å‡ºï¼ˆå¯èƒ½æ˜¯ä¹±åºçš„ï¼‰ä»¥ä¾›æ‰§è¡Œã€‚ llvm-mca åœ¨è°ƒåº¦æ¨¡å‹çš„å¸®åŠ©ä¸‹è®¡ç®—æŒ‡ä»¤å»¶è¿Ÿã€‚</span><br><span class="line"></span><br><span class="line">llvm-mca çš„è°ƒåº¦å™¨æ—¨åœ¨æ¨¡æ‹Ÿå¤šå¤„ç†å™¨è°ƒåº¦å™¨ã€‚è°ƒåº¦å™¨è´Ÿè´£è·Ÿè¸ªæ•°æ®ä¾èµ–å…³ç³»ï¼Œå¹¶åŠ¨æ€é€‰æ‹©æŒ‡ä»¤æ¶ˆè€—å“ªäº›å¤„ç†å™¨èµ„æºã€‚å®ƒå°†å¤„ç†å™¨èµ„æºå•å…ƒå’Œèµ„æºç»„çš„ç®¡ç†å§”æ‰˜ç»™èµ„æºç®¡â€‹â€‹ç†å™¨ã€‚èµ„æºç®¡ç†å™¨è´Ÿè´£é€‰æ‹©æŒ‡ä»¤æ¶ˆè€—çš„èµ„æºå•å…ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€æ¡æŒ‡ä»¤æ¶ˆè€—äº†ä¸€ä¸ªèµ„æºç»„çš„1cyï¼Œåˆ™èµ„æºç®¡ç†å™¨ä»è¯¥ç»„ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨å•å…ƒï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºç®¡ç†å™¨ä½¿ç”¨å¾ªç¯é€‰æ‹©å™¨æ¥ä¿è¯èµ„æºä½¿ç”¨åœ¨ç»„çš„æ‰€æœ‰å•å…ƒä¹‹é—´å‡åŒ€åˆ†é…ã€‚</span><br><span class="line"></span><br><span class="line">llvm-mcaâ€™s scheduler internally groups instructions into three sets:</span><br><span class="line"></span><br><span class="line">* WaitSet: a set of instructions whose operands are not ready.</span><br><span class="line">* ReadySet: a set of instructions ready to execute.</span><br><span class="line">* IssuedSet: a set of instructions executing.</span><br><span class="line"></span><br><span class="line">### Write-Back and Retire Stage</span><br><span class="line"></span><br><span class="line"> retire control unit</span><br><span class="line"></span><br><span class="line">1. When instructions are executed,the flags the instruction as â€œready to retire.â€</span><br><span class="line">2. Instructions are retired in program order</span><br><span class="line">3. free the physical registers</span><br><span class="line"></span><br><span class="line">### Load/Store Unit and Memory Consistency Model</span><br><span class="line"></span><br><span class="line">load/store unit (LSUnit)ç”¨æ¥æ¨¡æ‹Ÿä¹±åºmemoryæ“ä½œ</span><br><span class="line"></span><br><span class="line">The rules are:</span><br><span class="line"></span><br><span class="line">1. A younger load is allowed to pass an older load only if there are no intervening stores or barriers between the two loads.</span><br><span class="line">2. A younger load is allowed to pass an older store provided that the load does not alias with the store.</span><br><span class="line">3. A younger store is not allowed to pass an older store.ä¸èƒ½äº¤æ¢é¡ºåºçš„æ„æ€</span><br><span class="line">4. A younger store is not allowed to pass an older load.</span><br><span class="line"></span><br><span class="line">å‡è®¾ loads do not alias (-noalias=true) store operations.Under this assumption, younger loads are always allowed to pass older stores. ???</span><br><span class="line"></span><br><span class="line">LSUnitä¸æ‰“ç®—è·‘alias analysisæ¥é¢„æµ‹ä½•æ—¶loadä¸storeä¸ç›¸äº’alias???</span><br><span class="line"></span><br><span class="line">in the case of write-combining memory, rule 3 could be relaxed to allow reordering of non-aliasing store operations.???</span><br><span class="line"></span><br><span class="line">LSUnitä¸ç®¡çš„å…¶ä½™ä¸‰ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">1. The LSUnit does not know when store-to-load forwarding may occur.</span><br><span class="line">2. The LSUnit does not know anything about cache hierarchy and memory types.</span><br><span class="line">3. The LSUnit does not know how to identify serializing operations and memory fences.</span><br><span class="line">4. The LSUnit does not attempt to predict if a load or store hits or misses the L1 cache(ä¸è€ƒè™‘cacheå‘½ä¸­ï¼Œé»˜è®¤æ˜¯å‘½ä¸­L1,äº§ç”Ÿthe load-to-use latencyçš„æœ€ä¹è§‚å¼€é”€)</span><br><span class="line"></span><br><span class="line">llvm-mca ä¸çŸ¥é“åºåˆ—åŒ–æ“ä½œæˆ–å†…å­˜å±éšœä¹‹ç±»çš„æŒ‡ä»¤ã€‚ LSUnit ä¿å®ˆåœ°å‡è®¾åŒæ—¶å…·æœ‰â€œMayLoadâ€å’Œæœªå»ºæ¨¡å‰¯ä½œç”¨çš„æŒ‡ä»¤çš„è¡Œä¸ºç±»ä¼¼äºâ€œè½¯â€load-barrierã€‚è¿™æ„å‘³ç€ï¼Œå®ƒåœ¨ä¸å¼ºåˆ¶åˆ·æ–°loadé˜Ÿåˆ—çš„æƒ…å†µä¸‹åºåˆ—åŒ–åŠ è½½ã€‚ç±»ä¼¼åœ°ï¼Œâ€œMayStoreâ€å’Œå…·æœ‰æœªå»ºæ¨¡å‰¯ä½œç”¨çš„æŒ‡ä»¤è¢«è§†ä¸ºstoreéšœç¢ã€‚å®Œæ•´çš„memory-barrieræ˜¯å…·æœ‰æœªå»ºæ¨¡å‰¯ä½œç”¨çš„â€œMayLoadâ€å’Œâ€œMayStoreâ€æŒ‡ä»¤ã€‚LLVMçš„å®ç°æ˜¯ä¸å‡†ç¡®çš„ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬ç›®å‰ä½¿ç”¨ LLVM ä¸­å¯ç”¨çš„å½“å‰ä¿¡æ¯æ‰€èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…ã€‚</span><br><span class="line"></span><br><span class="line">load/store barrierä¼šå ç”¨åœ¨load/store é˜Ÿåˆ—é‡Œå ç”¨ä¸€é¡¹ã€‚</span><br><span class="line">å½“load/store barrieræ˜¯å…¶é˜Ÿåˆ—é‡Œoldesté¡¹æ—¶ï¼Œå…¶ä¼šè¢«æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">![](https://pic.shaojiemike.top/img/440472FD7AB14BC3C1F29BD2D565ACDF.png)</span><br><span class="line"></span><br><span class="line">### In-order Issue and Execute</span><br><span class="line"></span><br><span class="line">æœ‰åºå¤„ç†å™¨è¢«å»ºæ¨¡ä¸ºå•ä¸ª InOrderIssueStage é˜¶æ®µã€‚å®ƒç»•è¿‡ Dispatchã€Scheduler å’Œ Load/Store å•å…ƒã€‚ä¸€æ—¦å®ƒä»¬çš„æ“ä½œæ•°å¯„å­˜å™¨å¯ç”¨å¹¶ä¸”æ»¡è¶³èµ„æºè¦æ±‚ï¼Œå°±ä¼šå‘å‡ºæŒ‡ä»¤ã€‚æ ¹æ®LLVMçš„è°ƒåº¦æ¨¡å‹ä¸­IssueWidthå‚æ•°çš„å€¼ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå‘¨æœŸå†…å‘å‡ºå¤šæ¡æŒ‡ä»¤ã€‚ä¸€æ—¦å‘å‡ºï¼ŒæŒ‡ä»¤å°±ä¼šè¢«ç§»åˆ° IssuedInst é›†ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½retireã€‚ llvm-mca ç¡®ä¿æŒ‰é¡ºåºæäº¤å†™å…¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœ RetireOOO å±æ€§for at least one of its writesä¸ºçœŸï¼Œåˆ™å…è®¸æŒ‡ä»¤æäº¤å†™å…¥å¹¶æ— åºretire???</span><br><span class="line"></span><br><span class="line">## Custom Behaviour è‡ªå®šä¹‰è¡Œä¸º</span><br><span class="line"></span><br><span class="line">æŸäº›æŒ‡ä»¤åœ¨è¯¥æ¨¡å‹ä¸­å¹¶ä¸èƒ½è¢«å‡†ç¡®çš„æ¨¡æ‹Ÿã€‚ä¸ºäº†å‡ æ¡æŒ‡ä»¤è€Œä¿®æ”¹æ¨¡å‹ä¸æ˜¯ä¸ªå¥½çš„é€‰æ‹©ï¼Œä¸€èˆ¬é€šè¿‡**CustomBehaviour**ç±»å¯¹æŸäº›æŒ‡ä»¤è¿›è¡Œç‰¹æ®Šå»ºæ¨¡ï¼šè‡ªå®šä¹‰æ•°æ®ä¾èµ–ï¼Œä»¥åŠè§„é¿ã€å•ç‹¬å¤„ç†ç‰¹æ®Šæƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">ä¸ºæ­¤ï¼Œllvm-mcaè®¾ç½®äº†ä¸€ä¸ªé€šç”¨çš„ä»¥åŠå¤šä¸ªç‰¹æ®Šçš„**CustomBehaviour**ç±»ã€‚ä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨é€šç”¨ç±»ï¼š</span><br><span class="line"></span><br><span class="line">1. å¼€å¯äº†`-disable-cb`é€‰é¡¹</span><br><span class="line">2. ä¸å­˜åœ¨é’ˆå¯¹æŸç›®æ ‡çš„ç‰¹æ®Šç±»(é€šç”¨ç±»ä¹Ÿåšä¸äº†ä»€ä¹ˆï¼Œæˆ‘ä»€ä¹ˆä¹Ÿåšä¸åˆ°ğŸ˜¥)</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯æ³¨æ„ç›®å‰åªæœ‰in-orderæµæ°´çº¿å®ç°äº†**CustomBehaviour**ç±»ï¼Œout-orderæµæ°´çº¿å°†æ¥ä¹Ÿä¼šæ”¯æŒã€‚</span><br><span class="line"></span><br><span class="line">è¯¥ç±»ä¸»è¦é€šè¿‡`checkCustomHazard()`å‡½æ•°æ¥å®ç°ï¼Œé€šè¿‡å½“å‰æŒ‡ä»¤å’ŒçœŸæ­£æµæ°´çº¿ä¸­æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¥åˆ¤æ–­å½“å‰æŒ‡ä»¤éœ€è¦ç­‰å¾…å‡ ä¸ªå‘¨æœŸæ‰èƒ½å‘å°„ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæƒ³å¯¹æ²¡æœ‰å®ç°çš„ç›®æ ‡æ·»åŠ **CustomBehaviour**ç±»ï¼Œå¯ä»¥å‚è€ƒå·²æœ‰çš„å®ç°ï¼Œæ¯”å¦‚åœ¨`/llvm/lib/Target/AMDGPU/MCA/`ç›®å½•ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">## Custom Views è‡ªå®šä¹‰è§†å›¾</span><br><span class="line"></span><br><span class="line">å…³äºè‡ªå®šä¹‰çš„è§†å›¾çš„æ·»åŠ è·¯å¾„ï¼Œå¦‚æœ**æ²¡æœ‰è¾“å‡º**ä»æœªåœ¨MC layer classes (MCSubtargetInfo, MCInstrInfo, etc.)é‡Œå‡ºç°è¿‡çš„**æ–°åç«¯å€¼**ï¼Œè¯·æŠŠå®ç°åŠ å…¥`/tools/llvm-mca/View/`ã€‚ç›¸åï¼Œè¯·åŠ å…¥`/lib/Target/&lt;TargetName&gt;/MCA/`ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">å…³äºCustom Viewsæ‰€éœ€å†…å®¹ï¼Œéœ€è¦å†™ç‰¹æ®Šçš„**CustomBehaviour**ç±»æ¥è¦†å†™`CustomBehaviour::getViews()`å‡½æ•°ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒè¿˜æœ‰ä¸‰ç§å®ç°`getStartViews(), getPostInstrInfoViews(),getEndViews()`ã€‚</span><br><span class="line"></span><br><span class="line">## å½±å“å‡†ç¡®æ€§çš„å› ç´ </span><br><span class="line"></span><br><span class="line">è°ƒåº¦æ¨¡å‹ä¸ä»…ç”¨äºè®¡ç®—æŒ‡ä»¤å»¶è¿Ÿå’Œååé‡ï¼Œè¿˜ç”¨äºäº†è§£å¯ç”¨çš„å¤„ç†å™¨èµ„æºä»¥åŠå¦‚ä½•æ¨¡æ‹Ÿå®ƒä»¬ã€‚</span><br><span class="line"></span><br><span class="line">llvm mcaè¿›è¡Œåˆ†æçš„è´¨é‡ä¸å¯é¿å…åœ°å—åˆ°**llvmä¸­è°ƒåº¦æ¨¡å‹è´¨é‡**çš„å½±å“ã€‚</span><br><span class="line"></span><br><span class="line">## åŠŸèƒ½ï¼ˆèƒ½ä¼°è®¡çš„å€¼</span><br><span class="line"></span><br><span class="line">1. IPC</span><br><span class="line">2. ç¡¬ä»¶èµ„æºå‹åŠ›resource-pressure</span><br><span class="line">3. ä¸€äº›é¢å¤–Infoï¼Ÿ</span><br><span class="line">   1.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 register-file-stats
 -dispatch-stats
 -scheduler-stats
 -retire-stats
 -instruction-info
 instruction-tables
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ååé‡ç“¶é¢ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">### æ”¯æŒå¯¹ç‰¹å®šä»£ç å—çš„åˆ†æ</span><br><span class="line"></span><br><span class="line">1. æ±‡ç¼–ä»£ç ï¼Œæ”¯æŒå‘½åå’ŒåµŒå¥—</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
<h1 id="LLVM-MCA-BEGIN-block-name"><a href="#LLVM-MCA-BEGIN-block-name" class="headerlink" title="LLVM-MCA-BEGIN block-name"></a>LLVM-MCA-BEGIN block-name</h1><p> add %eax, %eax</p>
<h1 id="LLVM-MCA-END"><a href="#LLVM-MCA-END" class="headerlink" title="LLVM-MCA-END"></a>LLVM-MCA-END</h1> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. é«˜çº§è¯­è¨€ï¼Œé€šè¿‡å†…è”æ±‡ç¼–å®ç°</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> int foo(int a, int b) {<br>     __asm volatile(â€œ# LLVM-MCA-BEGIN fooâ€);<br>     a +&#x3D; 42;<br>     __asm volatile(â€œ# LLVM-MCA-ENDâ€);<br>     a *&#x3D; b;<br>     return a;<br> }</p>
<pre><code>
ä½†æ˜¯ï¼Œè¿™ä¼šå¹²æ‰°å¾ªç¯çŸ¢é‡åŒ–ç­‰ä¼˜åŒ–ï¼Œå¹¶å¯èƒ½å¯¹ç”Ÿæˆçš„ä»£ç äº§ç”Ÿå½±å“ã€‚å…·ä½“å½±å“è¯·å¯¹æ¯”æ±‡ç¼–ä»£ç ã€‚
</code></pre>
</li>
</ol>
<h2 id="ç›¸å…³è®ºæ–‡"><a href="#ç›¸å…³è®ºæ–‡" class="headerlink" title="ç›¸å…³è®ºæ–‡"></a>ç›¸å…³è®ºæ–‡</h2><p>Googleå­¦æœ¯æœllvm-mcaï¼Œä¸€å †è®ºæ–‡ã€‚ä½†æ˜¯ä¸æ€¥ç€çœ‹ï¼Œå› ä¸ºæ²¡æœ‰é¢„å¤‡çŸ¥è¯†ï¼Œæ²¡æœ‰é—®é¢˜çš„å»çœ‹è®ºæ–‡ã€‚æ•ˆç‡å’Œæ”¶è·å¾ˆä½çš„ï¼Œè€Œä¸”ä¼šçœ‹ä¸æ‡‚ã€‚</p>
<h2 id="ç›¸å…³é¡¹ç›®"><a href="#ç›¸å…³é¡¹ç›®" class="headerlink" title="ç›¸å…³é¡¹ç›®"></a>ç›¸å…³é¡¹ç›®</h2><h3 id="mc-ruler"><a href="#mc-ruler" class="headerlink" title="mc-ruler"></a>mc-ruler</h3><p><a target="_blank" rel="noopener" href="https://github.com/jeremyong/mc_ruler#">mc-ruler</a>æ˜¯æ•´åˆäº†llvm-mcaçš„cmake,å¯ä»¥æ‰“å°æŒ‡å®šéƒ¨åˆ†çš„ä»£ç åˆ†æä¿¡æ¯ã€‚å¦‚æœä¹‹åè¦æµ‹è¯•å¯èƒ½ç”¨å¾—ä¸Šã€‚</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><ol>
<li>å…·ä½“åŠŸèƒ½</li>
<li>llvmå¦‚ä½•å®ç°çš„ï¼Œè¦çœ‹ä»£ç ã€‚</li>
</ol>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol>
<li>(llvm-mca detects Intel syntax by the presence of an <strong>.intel_syntax</strong> directive at the beginning of the input. By default its output syntax matches that of its input.)</li>
<li>ï¼Ÿï¼Ÿï¼Ÿçš„åœ°æ–¹</li>
<li>å¤§æ¦‚çœ‹äº†ä¸€ä¸‹åŠŸèƒ½ï¼Œä½†æ˜¯æ€§èƒ½æ€ä¹ˆå¯¹æ¯”å‘¢ã€‚å‡†ç¡®å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿ<ol>
<li>arm kunpeng pmu-tools å®ç°</li>
</ol>
</li>
<li>æ¯æ¬¡çš„ä¼°è®¡å€¼ä¼šæ³¢åŠ¨å—ï¼Ÿ</li>
</ol>
<p>å¦‚ä½•å’Œå¤§ç¥äº¤æµå‘¢+æé—®çš„è‰ºæœ¯</p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-30T16:00:00.000Z" title="5/30/2023, 4:00:00 PM">2023-05-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.062Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">11 minutes read (About 1699 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/30/Work/Programming/4-compile/llvmBackend/">llvm Backend</a></p><div class="content"><h2 id="llvm-åç«¯-æ¦‚è¿°"><a href="#llvm-åç«¯-æ¦‚è¿°" class="headerlink" title="llvm åç«¯ æ¦‚è¿°"></a>llvm åç«¯ æ¦‚è¿°</h2><ul>
<li>åç«¯ï¼ˆbackendï¼‰ç”±ä¸€å¥—<strong>åˆ†æ</strong>å’Œ<strong>è½¬æ¢</strong>Passç»„æˆï¼Œå®ƒä»¬çš„ä»»åŠ¡æ˜¯ä»£ç ç”Ÿæˆï¼Œå³å°†LLVMä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰å˜æ¢ä¸ºç›®æ ‡ä»£ç ï¼ˆæˆ–è€…æ±‡ç¼–ï¼‰ã€‚</li>
<li>LLVMæ”¯æŒå¹¿æ³›çš„ç›®æ ‡ï¼šARMï¼ŒAArch64ï¼ŒHexagonï¼ŒMSP430ï¼ŒMIPSï¼ŒNvidia PTXï¼ŒPowerPCï¼ŒR600ï¼ŒSPARCï¼ŒSystemZï¼ŒX86ï¼Œå’ŒXCoreã€‚</li>
<li>æ‰€æœ‰è¿™äº›åç«¯å…±äº«ä¸€å¥—å…±ç”¨çš„æ¥å£ï¼Œå®ƒæ˜¯ç›®æ ‡æ— å…³ä»£ç ç”Ÿæˆå™¨çš„ä¸€éƒ¨åˆ†ï¼Œä»¥é€šç”¨APIçš„æ–¹æ³•æŠ½è±¡åŒ–åç«¯ä»»åŠ¡ã€‚æ¯ä¸ªç›®æ ‡å¿…é¡»ç‰¹æ®ŠåŒ–ä»£ç ç”Ÿæˆé€šç”¨ç±»ï¼Œä»¥å®ç°ç›®æ ‡ç‰¹å®šçš„è¡Œä¸ºã€‚</li>
</ul>
<h3 id="åç«¯çš„åŸºæœ¬æµç¨‹"><a href="#åç«¯çš„åŸºæœ¬æµç¨‹" class="headerlink" title="åç«¯çš„åŸºæœ¬æµç¨‹"></a>åç«¯çš„åŸºæœ¬æµç¨‹</h3><ul>
<li>ä¸‹å›¾ç»™å‡ºäº†å°†LLVM IRè½¬æ¢ä¸ºç›®æ ‡æ±‡ç¼–ä»£ç å¿…éœ€çš„æ­¥éª¤</li>
</ul>
<p><img src="https://pic.shaojiemike.top/img/20230523160158.png" alt="Backend"></p>
<ul>
<li>æµ…ç°è‰²çš„ä¸­é—´æ¡†ï¼Œä¹Ÿå«super passï¼Œæ˜¯å¿…éœ€çš„ï¼Œå®ƒä»¬æ˜¯åç«¯çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</li>
<li>ç™½è‰²æ¡†æ‰€æŒ‡ç¤ºçš„ï¼Œå¯ä»¥æ‰§è¡Œéå¿…éœ€çš„ä¼˜åŒ–Passä»¥è¿›ä¸€æ­¥æ”¹è¿›ç¿»è¯‘çš„è´¨é‡ã€‚å¯¹äºæé«˜æ‰€ç”Ÿæˆçš„ä»£ç çš„æ•ˆç‡æ›´é‡è¦ã€‚<ul>
<li>æ¯”å¦‚<code>-O3</code>çš„ä¼˜åŒ–ï¼Œè€Œä¸”å…¶é¡ºåºå¯¹ç»“æœä¹Ÿæœ‰å½±å“ã€‚</li>
</ul>
</li>
</ul>
<p>è¯¦ç»†è§£é‡Šå„é˜¶æ®µï¼š</p>
<ol>
<li>æŒ‡ä»¤é€‰æ‹©ï¼ˆInstruction Selectionï¼‰ï¼šå°†ä¸‰åœ°å€ç»“æ„çš„LLVM IRå˜æ¢ä¸ºDAGï¼ˆDirected Acyclic Graphï¼‰<ul>
<li>æ¯ä¸ªDAGèƒ½å¤Ÿè¡¨ç¤ºå•ä¸€åŸºæœ¬å—çš„è®¡ç®—ã€‚DAGå†…èŠ‚ç‚¹è¡¨ç¤ºæœºå™¨æŒ‡ä»¤ï¼Œè¾¹è¡¨ç¤ºæ•°æ®ä¾èµ–å…³ç³»ã€‚</li>
</ul>
</li>
<li>ç¬¬1æ¬¡æŒ‡ä»¤è°ƒåº¦ï¼ˆInstruction Schedulingï¼‰ï¼Œä¹Ÿç§°ä¸ºå‰å¯„å­˜å™¨åˆ†é…ï¼ˆRAï¼‰è°ƒåº¦ï¼Œå¯¹æŒ‡ä»¤æ’åºï¼ŒåŒæ—¶å°è¯•å‘ç°å°½å¯èƒ½å¤šçš„æŒ‡ä»¤å±‚æ¬¡çš„å¹¶è¡Œã€‚ç„¶åè¿™äº›æŒ‡ä»¤è¢«å˜æ¢ä¸ºMachineInsträ¸‰åœ°å€è¡¨ç¤ºã€‚</li>
<li>å¯„å­˜å™¨åˆ†é…ï¼ˆRegister Allocationï¼‰ï¼Œå®ƒå°†æ— é™çš„è™šæ‹Ÿå¯„å­˜å™¨çš„å¼•ç”¨è½¬æ¢ä¸ºæœ‰é™çš„ç›®æ ‡ç‰¹å®šçš„å¯„å­˜å™¨é›†ï¼Œå¯„å­˜å™¨ä¸å¤Ÿæ—¶æŒ¤å‡ºï¼ˆspillï¼‰åˆ°å†…å­˜ã€‚</li>
<li>ç¬¬2æ¬¡æŒ‡ä»¤è°ƒåº¦ï¼Œä¹Ÿç§°ä¸ºåå¯„å­˜å™¨åˆ†é…ï¼ˆRAï¼‰è°ƒåº¦ã€‚å› ä¸ºæ­¤æ—¶åœ¨è¿™ä¸ªç‚¹å¯è·å¾—çœŸå®çš„å¯„å­˜å™¨ä¿¡æ¯ï¼ŒæŸäº›ç±»å‹å¯„å­˜å™¨å­˜åœ¨é¢å¤–çš„é£é™©å’Œå»¶è¿Ÿï¼Œå®ƒä»¬å¯è¢«ç”¨ä»¥æ”¹è¿›æŒ‡ä»¤é¡ºåºã€‚</li>
<li>ä»£ç è¾“å‡ºï¼ˆCode Emissionï¼‰é˜¶æ®µå°†æŒ‡ä»¤ä»MachineInstrè¡¨ç¤ºå˜æ¢ä¸ºMCInstå®ä¾‹ã€‚è¿™ç§æ–°çš„è¡¨ç¤ºæ›´é€‚åˆæ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼Œå®ƒæœ‰ä¸¤ç§é€‰æ‹©ï¼šè¾“å‡ºæ±‡ç¼–ä»£ç æˆ–è€…è¾“å‡ºäºŒè¿›åˆ¶å—ï¼ˆblobï¼‰åˆ°ä¸€ç§ç‰¹å®šçš„ç›®æ ‡ä»£ç æ ¼å¼ã€‚</li>
</ol>
<h3 id="åç«¯ä»£ç ç»“æ„"><a href="#åç«¯ä»£ç ç»“æ„" class="headerlink" title="åç«¯ä»£ç ç»“æ„"></a>åç«¯ä»£ç ç»“æ„</h3><p>åç«¯çš„å®ç°åˆ†æ•£åœ¨LLVMæºä»£ç æ ‘çš„ä¸åŒç›®å½•ä¸­ã€‚ä»£ç ç”ŸæˆèƒŒåçš„ä¸»è¦ç¨‹åºåº“ä½äºlibç›®å½•å’Œå®ƒçš„å­æ–‡ä»¶å¤¹CodeGenã€MCã€TableGenã€å’ŒTargetä¸­ï¼Œ å…·ä½“å‚è€ƒ<a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id4">æ–‡æ¡£</a></p>
<p>Tablegenä½ç½®åœ¨ç±»ä¼¼ <code>llvm/lib/Target/X86/X86.td</code>çš„åœ°æ–¹</p>
<h2 id="llvm-ç¼–è¯‘ä¼˜åŒ–"><a href="#llvm-ç¼–è¯‘ä¼˜åŒ–" class="headerlink" title="llvm ç¼–è¯‘ä¼˜åŒ–"></a>llvm ç¼–è¯‘ä¼˜åŒ–</h2><ul>
<li>é€šè¿‡llvmçš„åˆ†æå’Œè½¬æ¢Passç›¸ç»“åˆå®ç°çš„ã€‚</li>
<li>é¦–å…ˆï¼Œé€šè¿‡åˆ†æPassè·å–ç¨‹åºçš„ä¸€äº›ç‰¹æ€§å’Œæ•°æ®æµç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ§åˆ¶æµåˆ†æã€æ•°æ®æµåˆ†æã€ä¾èµ–åˆ†æç­‰ã€‚</li>
<li>ç„¶åï¼Œæ ¹æ®æ‰€å¾—åˆ°çš„åˆ†æä¿¡æ¯ï¼Œllvmä¼šæ‰§è¡Œè½¬æ¢Passï¼Œå¯¹ç¨‹åºè¿›è¡Œä¸€ç³»åˆ—çš„é‡æ„ã€ä¼˜åŒ–å’Œå˜æ¢ï¼Œä¾‹å¦‚å¸¸é‡ä¼ æ’­ã€æ­»ä»£ç æ¶ˆé™¤ã€å†…è”å‡½æ•°ã€å¾ªç¯å±•å¼€ç­‰ã€‚</li>
</ul>
<h3 id="ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°"><a href="#ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°" class="headerlink" title="ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°"></a>ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°</h3><p>ç¨‹åºä¼˜åŒ–é€‰é¡¹ -O3 æ˜¯é€šè¿‡å¯ç”¨ LLVM Pass Manager å¹¶æŒ‰ç…§é¡ºåºæ‰§è¡ŒåŒ…å«å¤šä¸ªå…·ä½“ä¼˜åŒ– Pass çš„è¿‡ç¨‹å®ç°çš„ã€‚åŒ…æ‹¬ï¼š</p>
<ol>
<li>å‡½æ•°å†…éƒ¨ä¼˜åŒ– Passï¼Œå¦‚å†…è”ã€å‡½æ•°å†…è”ã€æ— ç”¨å‡½æ•°æ¸…ç†ã€æ§åˆ¶æµæ‰å¹³åŒ–ï¼›</li>
<li>å‡½æ•°é—´ä¼˜åŒ– Passï¼Œå¦‚åŸºäºé™æ€å•èµ°è¾¹åˆ†æçš„é—´æ¥è°ƒç”¨ç›®æ ‡æ¨å¯¼ã€å‡½æ•°æ¯æ¬¡è°ƒç”¨çš„å‚æ•°çš„é‡å¤è®¡ç®—æ¶ˆé™¤ã€é€šè¿‡ç¬¦å·è§£ææ‰§è¡Œçš„å‡½æ•°ç®€ä»‹åŒ–ç­‰ã€‚</li>
<li>æ¨¡å—ä¼˜åŒ– Passï¼Œå¦‚æ­»ä»£ç æ¶ˆé™¤ã€å…¨å±€ä¼˜åŒ–ã€å¸¸é‡ä¼ æ’­ã€æ•°å€¼å®½åŒ–å’Œçª„åŒ–ã€æ•´é™¤ä¼˜åŒ–ç­‰ï¼›</li>
<li>ç‰¹å®šäºæ¶æ„çš„ä¼˜åŒ– Passï¼ŒåŒ…æ‹¬æŒ‡ä»¤è°ƒåº¦å’Œå¯„å­˜å™¨åˆ†é…ç­‰ã€‚</li>
</ol>
<p>è¿™äº› Pass çš„æ‰§è¡ŒèŒƒå›´æ¶µç›– LLVM IR ä¸ LLVM åç«¯ã€‚</p>
<h2 id="TableGen"><a href="#TableGen" class="headerlink" title="TableGen"></a>TableGen</h2><ul>
<li>LLVMçš„TableGenæ˜¯ä¸€ç§è¡¨æ ¼é©±åŠ¨ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸»è¦ç”¨äºç”Ÿæˆæ±‡ç¼–å™¨ã€åæ±‡ç¼–å™¨ã€æŒ‡ä»¤é€‰æ‹©å™¨ã€è°ƒåº¦å™¨ç­‰ä»£ç ã€‚</li>
<li>å®ƒä½¿ç”¨åŸºäºLLVM IRçš„DSL(Domain-Specific Language)æ¥æè¿°ç›®æ ‡æŒ‡ä»¤é›†çš„ç‰¹æ€§å’Œè§„åˆ™ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯è½¬æ¢ä¸ºC++ä»£ç ã€‚</li>
<li>ä½¿ç”¨TableGenå¯ä»¥å°†ç›®æ ‡æŒ‡ä»¤é›†çš„å®ç°ä¸æºä»£ç åˆ†ç¦»ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<p>TableGençš„è¾“å…¥æ–‡ä»¶ä½¿ç”¨æ‰©å±•åâ€œ<code>.td</code>â€ï¼ˆTableGençš„ç¼©å†™ï¼‰ï¼Œå®ƒä»¬å¯ä»¥æè¿°å¦‚ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>Instruction Set Architecture (ISA) - æè¿°ç›®æ ‡æœºçš„æŒ‡ä»¤é›†ç‰¹æ€§ï¼Œä¾‹å¦‚æŒ‡ä»¤é›†æ¶æ„ã€å¯„å­˜å™¨ã€å¯„å­˜å™¨ç±»ã€æ“ä½œæ•°ç±»å‹ã€åœ°å€æ¨¡å‹ã€ç«¯å¯¹é½æ€§ç­‰ã€‚</li>
<li>Selection DAG - æè¿°äº†å¦‚ä½•å°†LLVM IRèŠ‚ç‚¹æ˜ å°„åˆ°ç›®æ ‡æœºæŒ‡ä»¤é›†çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚æŒ‡ä»¤çš„æ“ä½œç ã€æ“ä½œæ•°ã€è°ƒç”¨çº¦å®šã€æŒ‡ä»¤å»¶è¿Ÿç­‰ã€‚</li>
<li>Pattern Matching - å¯¹åŒ¹é…åˆ°çš„æŒ‡ä»¤æ¨¡æ¿åšå‡ºç”Ÿæˆæƒ³è¦çš„IRèŠ‚ç‚¹çš„é€‰æ‹©ã€‚</li>
<li>Instruction Scheduling - æè¿°è°ƒåº¦å™¨è¡Œä¸ºã€æŒ‡ä»¤ä¹‹é—´çš„æ—¶é—´å…³ç³»ï¼Œä»¥åŠå¦‚ä½•å°†æŒ‡ä»¤æ’å…¥åˆ°è°ƒåº¦å›¾ä¸­çš„è§„åˆ™ç­‰ã€‚</li>
</ol>
<ul>
<li>TableGenè‡ªåŠ¨åŒ–äº†ç›®æ ‡æœºæŒ‡ä»¤é›†çš„å¤§éƒ¨åˆ†å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—è‡ªå®šä¹‰ç›®æ ‡æœºå˜å¾—ç›¸å¯¹å®¹æ˜“ã€‚</li>
<li>è¯¥å·¥å…·æ”¯æŒé’ˆå¯¹å¤šç§å¹³å°å’Œç¼–è¯‘å™¨çš„åç«¯ä»£ç ç”Ÿæˆã€‚</li>
<li>å¯¹äºåµŒå…¥å¼ç³»ç»Ÿå’Œéæ ‡å‡†æŒ‡ä»¤é›†æ¶æ„ç­‰é¢†åŸŸï¼ŒTableGenæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚</li>
</ul>
<h3 id="ç›¸å…³çš„æ¦‚å¿µ"><a href="#ç›¸å…³çš„æ¦‚å¿µ" class="headerlink" title="ç›¸å…³çš„æ¦‚å¿µ"></a>ç›¸å…³çš„æ¦‚å¿µ</h3><ul>
<li>ç›®æ ‡æè¿°è¯­è¨€ï¼ˆTarget Description Languageï¼ŒTDLï¼‰æ¥å®šä¹‰ç›®æ ‡æ¶æ„ç‰¹å®šçš„æŒ‡ä»¤å’Œå¯„å­˜å™¨ã€‚å…¶ä¸­ï¼ŒTDLå¯ç”¨äºç›®æ ‡æ¶æ„ä¸­æŒ‡ä»¤å®šä¹‰å’Œå¯„å­˜å™¨å®šä¹‰çš„æ˜ å°„å…³ç³»å’ŒåŠ¨æ€ç”Ÿæˆæœºå™¨æŒ‡ä»¤çš„è§„åˆ™ã€‚</li>
</ul>
<h2 id="å®è·µï¼šllvm-IR-åç«¯"><a href="#å®è·µï¼šllvm-IR-åç«¯" class="headerlink" title="å®è·µï¼šllvm IR åç«¯"></a>å®è·µï¼šllvm IR åç«¯</h2><p>å®ç°ä¸€ä¸ªç®€å•çš„LLVM IRåç«¯ï¼Œå°†LLVM IRè½¬æ¢ä¸ºx86æ±‡ç¼–ä»£ç ï¼Œèƒ½line by lineçš„è¾“å‡ºã€‚</p>
<p>å‚è€ƒLLVMå®˜æ–¹æ–‡æ¡£ä¸­çš„â€œWriting an LLVM Backendâ€ä»¥åŠâ€œTableGen Backendsâ€</p>
<!-- ä¸‹é¢å›ç­”éƒ¨åˆ†**æ¥è‡ªChatGPT-3.5**ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚ -->

<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id2">https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id2</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-22T16:00:00.000Z" title="5/22/2023, 4:00:00 PM">2023-05-22</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.062Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">11 minutes read (About 1584 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/22/Work/Programming/4-compile/llvmPass/">llvm Pass</a></p><div class="content"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul>
<li>Passå°±æ˜¯â€œéå†ä¸€éIRï¼Œå¯ä»¥åŒæ—¶å¯¹å®ƒåšä¸€äº›æ“ä½œâ€çš„æ„æ€ã€‚ç¿»è¯‘æˆä¸­æ–‡åº”è¯¥å«â€œä¼ é€’â€ã€‚</li>
<li>åœ¨å®ç°ä¸Šï¼ŒLLVMçš„æ ¸å¿ƒåº“ä¸­ä¼šç»™ä½ ä¸€äº› Passç±» å»ç»§æ‰¿ã€‚ä½ éœ€è¦å®ç°å®ƒçš„ä¸€äº›æ–¹æ³•ã€‚<ul>
<li>ModulePass , CallGraphSCCPass, FunctionPass , or LoopPass, or RegionPass</li>
</ul>
</li>
<li>æœ€åä½¿ç”¨LLVMçš„ç¼–è¯‘å™¨ä¼šæŠŠå®ƒç¿»è¯‘å¾—åˆ°çš„IRä¼ å…¥Passé‡Œï¼Œç»™ä½ éå†å’Œä¿®æ”¹ã€‚</li>
</ul>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><ol>
<li>æ’æ¡©ï¼š åœ¨Passéå†LLVM IRçš„åŒæ—¶ï¼Œè‡ªç„¶å°±å¯ä»¥å¾€é‡Œé¢æ’å…¥æ–°çš„ä»£ç ã€‚</li>
<li>æœºå™¨æ— å…³çš„ä»£ç ä¼˜åŒ–ï¼šç¼–è¯‘åŸç†ä¸€è¯¾è¯´ï¼šIRåœ¨è¢«ç¿»è¯‘æˆæœºå™¨ç å‰ä¼šåšä¸€äº›æœºå™¨æ— å…³çš„ä¼˜åŒ–ã€‚ ä½†æ˜¯ä¸åŒçš„ä¼˜åŒ–æ–¹æ³•ä¹‹é—´éœ€è¦è§£è€¦ï¼Œæ‰€ä»¥è‡ªç„¶è¦å„è‡ªéå†ä¸€éIRï¼Œå®ç°æˆäº†ä¸€ä¸ªä¸ªLLVM Passã€‚ æœ€ç»ˆï¼ŒåŸºäºLLVMçš„ç¼–è¯‘å™¨ä¼šåœ¨å‰ç«¯ç”ŸæˆLLVM IRåè°ƒç”¨ä¸€äº›LLVM Passåšæœºå™¨æ— å…³ä¼˜åŒ–ï¼Œ ç„¶åå†è°ƒç”¨LLVMåç«¯ç”Ÿæˆç›®æ ‡å¹³å°ä»£ç ã€‚</li>
<li>é™æ€åˆ†æï¼š åƒVSCodeçš„C&#x2F;C++æ’ä»¶å°±ä¼šç”¨LLVM Passæ¥åˆ†æä»£ç ï¼Œæç¤ºå¯èƒ½çš„é”™è¯¯ (æ— ç”¨çš„å˜é‡ã€æ— æ³•åˆ°è¾¾çš„ä»£ç ç­‰ç­‰)ã€‚</li>
</ol>
<h2 id="ç†è§£-llvm-Pass"><a href="#ç†è§£-llvm-Pass" class="headerlink" title="ç†è§£ llvm Pass"></a>ç†è§£ llvm Pass</h2><h3 id="ç†è§£Pass-API"><a href="#ç†è§£Pass-API" class="headerlink" title="ç†è§£Pass API"></a>ç†è§£Pass API</h3><p>ã€€ã€€Passç±»æ˜¯å®ç°ä¼˜åŒ–çš„ä¸»è¦èµ„æºã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ä¸ç›´æ¥ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯é€šè¿‡æ¸…æ¥šçš„å­ç±»ä½¿ç”¨å®ƒã€‚å½“å®ç°ä¸€ä¸ªPassæ—¶ï¼Œä½ åº”è¯¥é€‰æ‹©é€‚åˆä½ çš„Passçš„æœ€ä½³ç²’åº¦ï¼Œé€‚åˆæ­¤ç²’åº¦çš„æœ€ä½³å­ç±»ï¼Œä¾‹å¦‚åŸºäºå‡½æ•°ã€æ¨¡å—ã€å¾ªç¯ã€å¼ºè”é€šåŒºåŸŸï¼Œç­‰ç­‰ã€‚å¸¸è§çš„è¿™äº›å­ç±»å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>ModulePass</code>ï¼šè¿™æ˜¯æœ€é€šç”¨çš„Passï¼›å®ƒä¸€æ¬¡åˆ†ææ•´ä¸ªæ¨¡å—ï¼Œå‡½æ•°çš„æ¬¡åºä¸ç¡®å®šã€‚å®ƒä¸é™å®šä½¿ç”¨è€…çš„è¡Œä¸ºï¼Œå…è®¸åˆ é™¤å‡½æ•°å’Œå…¶å®ƒä¿®æ”¹ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œä½ éœ€è¦å†™ä¸€ä¸ªç±»ç»§æ‰¿ModulePassï¼Œå¹¶é‡è½½runOnModule()æ–¹æ³•ã€‚</li>
<li><code>FunctionPass</code>ï¼šè¿™ä¸ªå­ç±»å…è®¸ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå‡½æ•°ï¼Œå¤„ç†å‡½æ•°çš„æ¬¡åºä¸ç¡®å®šã€‚è¿™æ˜¯åº”ç”¨æœ€å¤šçš„Passç±»å‹ã€‚å®ƒç¦æ­¢ä¿®æ”¹å¤–éƒ¨å‡½æ•°ã€åˆ é™¤å‡½æ•°ã€åˆ é™¤å…¨å±€å˜é‡ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œéœ€è¦å†™ä¸€ä¸ªå®ƒçš„å­ç±»ï¼Œé‡è½½runOnFunction()æ–¹æ³•ã€‚</li>
<li><code>BasicBlockPass</code>ï¼šè¿™ä¸ªç±»çš„ç²’åº¦æ˜¯åŸºæœ¬å—ã€‚FunctionPassç±»ç¦æ­¢çš„ä¿®æ”¹åœ¨è¿™é‡Œä¹Ÿæ˜¯ç¦æ­¢çš„ã€‚å®ƒè¿˜ç¦æ­¢ä¿®æ”¹æˆ–è€…åˆ é™¤å¤–éƒ¨åŸºæœ¬å—ã€‚ä½¿ç”¨è€…éœ€è¦å†™ä¸€ä¸ªç±»ç»§æ‰¿BasicBlockPassï¼Œå¹¶é‡è½½å®ƒçš„runOnBasicBlock()æ–¹æ³•ã€‚</li>
</ul>
<p>ã€€ã€€è¢«é‡è½½çš„å…¥å£å‡½æ•°runOnModule()ã€runOnFunction()ã€runOnBasicBlock()è¿”å›å¸ƒå°”å€¼falseï¼Œå¦‚æœè¢«åˆ†æçš„å•å…ƒï¼ˆæ¨¡å—ã€å‡½æ•°å’ŒåŸºæœ¬å—ï¼‰ä¿æŒä¸å˜ï¼Œå¦åˆ™è¿”å›å¸ƒå°”å€¼trueã€‚</p>
<h3 id="Passçš„æ‰§è¡Œé¡ºåº-ä¾èµ–"><a href="#Passçš„æ‰§è¡Œé¡ºåº-ä¾èµ–" class="headerlink" title="Passçš„æ‰§è¡Œé¡ºåº&#x2F;ä¾èµ–"></a>Passçš„æ‰§è¡Œé¡ºåº&#x2F;ä¾èµ–</h3><ul>
<li>ChatGPTè¯´é»˜è®¤é¡ºåºæ˜¯ï¼šFunctionPass -&gt; Module Pass -&gt; LoopPass ?</li>
<li>å½“ç„¶æˆ‘ä»¬æ˜¯å¯ä»¥ä¿®æ”¹æ’å…¥Passçš„æ‰§è¡Œé¡ºåºçš„ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> PIMProf::AnnotationInjection::ID = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ³¨å†Œ llvm pass</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterPass&lt;PIMProf::AnnotationInjection&gt; <span class="title">RegisterMyPass</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="string">&quot;AnnotationInjection&quot;</span>, <span class="string">&quot;Inject annotators to uniquely identify each basic block.&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">loadPass</span><span class="params">(<span class="type">const</span> PassManagerBuilder &amp;,</span></span></span><br><span class="line"><span class="params"><span class="function">                           legacy::PassManagerBase &amp;PM)</span> </span>&#123;</span><br><span class="line">    PM.<span class="built_in">add</span>(<span class="keyword">new</span> PIMProf::<span class="built_in">AnnotationInjection</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ox çš„ä»£ç  llvm pass åœ¨EP_OptimizerLast ä½ç½®load</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">clangtoolLoader_Ox</span><span class="params">(PassManagerBuilder::EP_OptimizerLast, loadPass)</span></span>;</span><br><span class="line"><span class="comment">// O0 çš„ä»£ç  llvm pass EP_EnabledOnOptLevel0 ä½ç½®load</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">clangtoolLoader_O0</span><span class="params">(PassManagerBuilder::EP_EnabledOnOptLevel0, loadPass)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol>
<li>ç¼–å†™LLVM passä»£ç </li>
<li>é…ç½®ç¼–è¯‘ç¯å¢ƒ(cmake or make)</li>
<li>è¿è¡Œ(opt or clang)</li>
</ol>
<h2 id="1-ä»£ç æ¡†æ¶"><a href="#1-ä»£ç æ¡†æ¶" class="headerlink" title="1 ä»£ç æ¡†æ¶"></a>1 ä»£ç æ¡†æ¶</h2><p>æœ€ç®€å•æ¡†æ¶hello.cppå¦‚ä¸‹ï¼Œæ³¨æ„<code>Important</code>ä¸€å®šéœ€è¦ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Pass.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/IR/Function.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Support/raw_ostream.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/IR/LegacyPassManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Transforms/IPO/PassManagerBuilder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"> <span class="comment">// Important</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Hello</span> : <span class="keyword">public</span> FunctionPass &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ID;</span><br><span class="line">    <span class="built_in">Hello</span>() : <span class="built_in">FunctionPass</span>(ID) &#123;&#125;</span><br><span class="line"> <span class="comment">// Important</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">      <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Hello: &quot;</span>;</span><br><span class="line">      <span class="built_in">errs</span>().<span class="built_in">write_escaped</span>(F.<span class="built_in">getName</span>()) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> Hello::ID = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Important:Register for opt</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterPass&lt;Hello&gt; <span class="title">X</span><span class="params">(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;Hello World Pass&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Important:Register for clang</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">Y</span><span class="params">(PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="params"><span class="function">  [](<span class="type">const</span> PassManagerBuilder &amp;Builder, legacy::PassManagerBase &amp;PM) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    PM.add(<span class="keyword">new</span> Hello());</span></span></span><br><span class="line"><span class="params"><span class="function">  &#125;)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-ç¼–è¯‘åŠ¨æ€åº“"><a href="#2-ç¼–è¯‘åŠ¨æ€åº“" class="headerlink" title="2 ç¼–è¯‘åŠ¨æ€åº“"></a>2 ç¼–è¯‘åŠ¨æ€åº“</h2><h3 id="ä½¿ç”¨cmake"><a href="#ä½¿ç”¨cmake" class="headerlink" title="ä½¿ç”¨cmake"></a>ä½¿ç”¨cmake</h3><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://llvm.org/docs/CMake.html#cmake-out-of-source-pass">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>An example of a project layout is provided below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;project <span class="built_in">dir</span>&gt;/</span><br><span class="line">    |</span><br><span class="line">    CMakeLists.txt</span><br><span class="line">    &lt;pass name&gt;/</span><br><span class="line">        |</span><br><span class="line">        CMakeLists.txt</span><br><span class="line">        Pass.cpp</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>Contents of <code>&lt;project dir&gt;/CMakeLists.txt</code>:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(LLVM REQUIRED CONFIG)</span><br><span class="line"></span><br><span class="line"><span class="keyword">separate_arguments</span>(LLVM_DEFINITIONS_LIST NATIVE_COMMAND <span class="variable">$&#123;LLVM_DEFINITIONS&#125;</span>)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="variable">$&#123;LLVM_DEFINITIONS_LIST&#125;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;LLVM_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(&lt;pass name&gt;)</span><br></pre></td></tr></table></figure>

<p>Contents of <code>&lt;project dir&gt;/&lt;pass name&gt;/CMakeLists.txt</code>:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(LLVMPassname MODULE Pass.cpp)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œcmakeç¼–è¯‘ã€‚äº§ç”Ÿ<code>LLVMPassname.so</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. &amp;&amp; make</span><br></pre></td></tr></table></figure>

<!-- ä¸‹é¢å›ç­”éƒ¨åˆ†**æ¥è‡ªChatGPT-3.5**ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚ -->

<h3 id="ä½¿ç”¨å‘½ä»¤è¡Œ"><a href="#ä½¿ç”¨å‘½ä»¤è¡Œ" class="headerlink" title="ä½¿ç”¨å‘½ä»¤è¡Œ"></a>ä½¿ç”¨å‘½ä»¤è¡Œ</h3><p>è¯·é˜…è¯»<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122522485">çŸ¥ä¹çš„æ–‡ç« </a></p>
<h2 id="3-ä½¿ç”¨"><a href="#3-ä½¿ç”¨" class="headerlink" title="3 ä½¿ç”¨"></a>3 ä½¿ç”¨</h2><h3 id="optåŠ è½½Pass"><a href="#optåŠ è½½Pass" class="headerlink" title="optåŠ è½½Pass"></a>optåŠ è½½Pass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang -c -emit-llvm main.c -o main.bc <span class="comment"># éšæ„å†™ä¸€ä¸ªCä»£ç å¹¶ç¼–è¯‘åˆ°bcæ ¼å¼</span></span><br><span class="line">opt -load path/to/LLVMHello.so -hello main.bc -o /dev/null</span><br></pre></td></tr></table></figure>

<p>æŠŠæºä»£ç ç¼–è¯‘æˆIRä»£ç ï¼Œç„¶åç”¨optè¿è¡ŒPasså®åœ¨éº»çƒ¦ä¸”æ— è¶£ã€‚</p>
<h3 id="clangåŠ è½½Pass"><a href="#clangåŠ è½½Pass" class="headerlink" title="clangåŠ è½½Pass"></a>clangåŠ è½½Pass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">clang -Xclang -load -Xclang path/to/LLVMHello.so main.c -o main</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">clang++ -Xclang -load -Xclang ./build/hello/libLLVMPassname.so test.cpp -o main</span><br></pre></td></tr></table></figure>

<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h3 id="æ’å…¥ä»£ç "><a href="#æ’å…¥ä»£ç " class="headerlink" title="æ’å…¥ä»£ç "></a>æ’å…¥ä»£ç </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">InjectSimMagic2</span><span class="params">(Module &amp;M, Instruction *insertPt, <span class="type">uint64_t</span> arg0, <span class="type">uint64_t</span> arg1, <span class="type">uint64_t</span> arg2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LLVMContext &amp;ctx = M.<span class="built_in">getContext</span>();</span><br><span class="line">    std::vector&lt;Type *&gt; argtype &#123;</span><br><span class="line">        Type::<span class="built_in">getInt64Ty</span>(ctx), Type::<span class="built_in">getInt64Ty</span>(ctx), Type::<span class="built_in">getInt64Ty</span>(ctx)</span><br><span class="line">    &#125;;</span><br><span class="line">    FunctionType *ty = FunctionType::<span class="built_in">get</span>(</span><br><span class="line">        Type::<span class="built_in">getVoidTy</span>(ctx), argtype, <span class="literal">false</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// template of Sniper&#x27;s SimMagic0</span></span><br><span class="line">    InlineAsm *ia = InlineAsm::<span class="built_in">get</span>(</span><br><span class="line">        ty,</span><br><span class="line">        <span class="string">&quot;\tmov $0, %rax \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\tmov $1, %rbx \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\tmov $2, %rcx \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\txchg %bx, %bx\n&quot;</span>,</span><br><span class="line">        <span class="string">&quot;imr,imr,imr,~&#123;rax&#125;,~&#123;rbx&#125;,~&#123;rcx&#125;,~&#123;dirflag&#125;,~&#123;fpsr&#125;,~&#123;flags&#125;&quot;</span>,</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    );</span><br><span class="line">    Value *val0 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg0);</span><br><span class="line">    Value *val1 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg1);</span><br><span class="line">    Value *val2 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg2);</span><br><span class="line">    std::vector&lt;Value *&gt; arglist &#123;val0, val1, val2&#125;;</span><br><span class="line">    CallInst::<span class="built_in">Create</span>(</span><br><span class="line">            ia, arglist, <span class="string">&quot;&quot;</span>, insertPt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä½¿ç”¨å†…è”æ±‡ç¼–åµŒå…¥åˆ° LLVM IR ä¸­ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov $0, %rax</span><br><span class="line">mov $1, %rbx</span><br><span class="line">mov $2, %rcx</span><br><span class="line">xchg %bx, %bx</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼š</p>
<ul>
<li>mov $0, %rax å°†ç«‹å³æ•° arg0 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rax ä¸­ã€‚</li>
<li>mov $1, %rbx å°†ç«‹å³æ•° arg1 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rbx ä¸­ã€‚</li>
<li>mov $2, %rcx å°†ç«‹å³æ•° arg2 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rcx ä¸­ã€‚</li>
<li>xchg %bx, %bx æ˜¯ä¸€æ¡æ— æ“ä½œæŒ‡ä»¤ï¼Œç”¨äºä¿è¯è¯¥æ±‡ç¼–ä»£ç çš„åŸå­æ€§ã€‚</li>
</ul>
<h3 id="æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤"><a href="#æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤"></a>æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤</h3><p>ç”±äºç›´æ¥æ‰“å°çš„æ˜¯llvm IRçš„è¡¨ç¤ºï¼Œæƒ³è¦æ‰“å°ç‰¹å®šæ¶æ„æ¯”å¦‚x86çš„æ±‡ç¼–ä»£ç ï¼Œå…¶å®éœ€è¦è¿›è¡Œllvmåç«¯çš„è½¬æ¢ã€‚ï¼ˆå–å·§ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åæ±‡ç¼–ï¼Œç„¶åæ ¹æ®æ’å…¥çš„æ±‡ç¼–æ¡©åˆ’åˆ†ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><p>å¤ç°PIMProfè®ºæ–‡æ—¶ï¼Œç”¨åˆ°äº†ä½¿ç”¨ llvm passæ¥æ’å…¥ç‰¹æ®Šæ±‡ç¼–</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://www.llvm.org/docs/WritingAnLLVMPass.html">https://www.llvm.org/docs/WritingAnLLVMPass.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122522485">https://zhuanlan.zhihu.com/p/122522485</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-20T16:00:00.000Z" title="5/20/2023, 4:00:00 PM">2023-05-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.062Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">18 minutes read (About 2675 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/20/Work/Programming/2.1-Assembly/assemblyGNUFile/">GNU Assembly File</a></p><div class="content"><h2 id="GNUæ±‡ç¼–è¯­æ³•"><a href="#GNUæ±‡ç¼–è¯­æ³•" class="headerlink" title="GNUæ±‡ç¼–è¯­æ³•"></a>GNUæ±‡ç¼–è¯­æ³•</h2><h3 id="ä¼ªæŒ‡ä»¤"><a href="#ä¼ªæŒ‡ä»¤" class="headerlink" title="ä¼ªæŒ‡ä»¤"></a>ä¼ªæŒ‡ä»¤</h3><ul>
<li><strong>æŒ‡ç¤ºï¼ˆDirectivesï¼‰</strong>: ä»¥ç‚¹å·å¼€å§‹ï¼Œç”¨æ¥æŒ‡ç¤ºå¯¹ç¼–è¯‘å™¨ï¼Œè¿æ¥å™¨ï¼Œè°ƒè¯•å™¨æœ‰ç”¨çš„ç»“æ„ä¿¡æ¯ã€‚æŒ‡ç¤ºæœ¬èº«ä¸æ˜¯æ±‡ç¼–æŒ‡ä»¤ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th align="center">ä¼ªæŒ‡ä»¤</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">.file</td>
<td align="center">æŒ‡å®šç”±å“ªä¸ªæºæ–‡ä»¶ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ã€‚</td>
</tr>
<tr>
<td align="center">.data</td>
<td align="center">è¡¨ç¤ºæ•°æ®æ®µ(section)çš„å¼€å§‹åœ°å€</td>
</tr>
<tr>
<td align="center">.text</td>
<td align="center">æŒ‡å®šä¸‹é¢çš„æŒ‡ä»¤å±äºä»£ç æ®µã€‚</td>
</tr>
<tr>
<td align="center">.string</td>
<td align="center">è¡¨ç¤ºæ•°æ®æ®µä¸­çš„å­—ç¬¦ä¸²å¸¸é‡ã€‚</td>
</tr>
<tr>
<td align="center">.globl main</td>
<td align="center">æŒ‡æ˜æ ‡ç­¾mainæ˜¯ä¸€ä¸ªå¯ä»¥åœ¨å…¶å®ƒæ¨¡å—çš„ä»£ç ä¸­è¢«è®¿é—®çš„å…¨å±€ç¬¦å· ã€‚</td>
</tr>
<tr>
<td align="center">.align</td>
<td align="center">æ•°æ®å¯¹é½æŒ‡ä»¤</td>
</tr>
<tr>
<td align="center">.section</td>
<td align="center">æ®µæ ‡è®°</td>
</tr>
<tr>
<td align="center">.type</td>
<td align="center">è®¾ç½®ä¸€ä¸ªç¬¦å·çš„å±æ€§å€¼</td>
</tr>
</tbody></table>
<ul>
<li>è¯­æ³•ï¼š<code>.type name , description</code><ul>
<li>descriptionå–å€¼å¦‚ä¸‹ï¼š<ul>
<li><code>%function</code> è¡¨ç¤ºè¯¥ç¬¦å·ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°å</li>
<li><code>%object</code> è¡¨ç¤ºè¯¥ç¬¦å·ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ•°æ®å¯¹è±¡</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è‡³äºå…¶å®ƒçš„æŒ‡ç¤ºä½ å¯ä»¥å¿½ç•¥ã€‚</p>
<h2 id="å®è·µï¼šé˜…è¯»æ±‡ç¼–æ–‡ä»¶"><a href="#å®è·µï¼šé˜…è¯»æ±‡ç¼–æ–‡ä»¶" class="headerlink" title="å®è·µï¼šé˜…è¯»æ±‡ç¼–æ–‡ä»¶"></a>å®è·µï¼šé˜…è¯»æ±‡ç¼–æ–‡ä»¶</h2><p>ä»æœ€ç®€å•çš„Cæ–‡ä»¶å…¥æ‰‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>gcc -S -O3 main.c -o main.s</code>ï¼Œå¾—åˆ°<code>main.s</code>æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> .file &quot;simple.cpp&quot;</span><br><span class="line"> .text</span><br><span class="line"> .section .text.startup,&quot;ax&quot;,@progbits</span><br><span class="line"> .p2align 4</span><br><span class="line"> .globl main</span><br><span class="line"> .type main, @function</span><br><span class="line">main:</span><br><span class="line">.LFB0:</span><br><span class="line"> .cfi_startproc</span><br><span class="line"> endbr64</span><br><span class="line"> xorl %eax, %eax</span><br><span class="line"> ret</span><br><span class="line"> .cfi_endproc</span><br><span class="line">.LFE0:</span><br><span class="line"> .size main, .-main</span><br><span class="line"> .ident &quot;GCC: (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0&quot;</span><br><span class="line"> .section .note.GNU-stack,&quot;&quot;,@progbits</span><br><span class="line"> .section .note.gnu.property,&quot;a&quot;</span><br><span class="line"> .align 8</span><br><span class="line"> .long  1f - 0f</span><br><span class="line"> .long  4f - 1f</span><br><span class="line"> .long  5</span><br><span class="line">0:</span><br><span class="line"> .string  &quot;GNU&quot;</span><br><span class="line">1:</span><br><span class="line"> .align 8</span><br><span class="line"> .long  0xc0000002</span><br><span class="line"> .long  3f - 2f</span><br><span class="line">2:</span><br><span class="line"> .long  0x3</span><br><span class="line">3:</span><br><span class="line"> .align 8</span><br><span class="line">4:</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸‹é¢å›ç­”<strong>æ¥è‡ªChatGPT-3.5</strong>ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚</li>
</ul>
<h3 id="section"><a href="#section" class="headerlink" title="section"></a>section</h3><ul>
<li><code>.section .rodata.str1.1,&quot;aMS&quot;,@progbits,1</code><ul>
<li><code>rodata.str1.1</code>æ˜¯ä¸€ä¸ªæ ‡å·ï¼ˆlabelï¼‰, æ„æ€æ˜¯åªè¯»æ•°æ®æ®µçš„å­—ç¬¦ä¸²å¸¸é‡</li>
<li><code>aMS</code>æ˜¯ä¸€ä¸ªå±æ€§å€¼ï¼š<ul>
<li>å¯åˆ†é…çš„ï¼ˆallocatableï¼‰ï¼Œå³ç¨‹åºè¿è¡Œæ—¶éœ€è¦åŠ¨æ€åˆ†é…ç©ºé—´æ‰èƒ½åˆ†é…è¯¥ä»£ç æ®µï¼Œ</li>
<li>ä¸å¯æ‰§è¡Œ ï¼ˆMï¼‰ï¼Œ</li>
<li>æ•°æ®çš„ç±»å‹ä¸ºä¸²ï¼ˆSï¼‰</li>
<li>å…¶ä½™å±æ€§å€¼ï¼šå¯¹é½æ–¹å¼çš„é€šå¸¸ä¸º bï¼ˆbyteå¯¹é½ï¼‰ï¼Œwï¼ˆwordå¯¹é½ï¼‰ï¼Œæˆ–è€…å…¶ä»–æ›´å¤§çš„å¯¹é½å•ä½ï¼Œä¾‹å¦‚ dï¼ˆdouble wordå¯¹é½ï¼‰ã€‚</li>
</ul>
</li>
<li><code>@progbits</code>: è¡¨ç¤ºè¯¥æ®µçš„ç±»å‹æ˜¯ç¨‹åºæ•°æ®æ®µï¼ˆPROGBITSï¼‰ï¼Œè¿™ç§ç±»å‹çš„æ®µåŒ…å«ç¨‹åºçš„ä»£ç å’Œæ•°æ®ã€‚</li>
<li><code>1</code>: è¡¨ç¤ºè¯¥æ®µçš„å¯¹é½æ–¹å¼æ˜¯2^1 &#x3D; 2ä¸ªå­—èŠ‚ï¼ˆæŒ‰å­—èŠ‚å¯¹é½ï¼‰ã€‚å¦‚æœä¸å†™è¿™ä¸ªæ•°å­—ï¼Œé»˜è®¤å¯¹é½åˆ°å½“å‰æœºå™¨çš„å­—é•¿ã€‚</li>
</ul>
</li>
<li><code>.section .text.startup,&quot;ax&quot;,@progbits</code> å…¶ä¸­<code>ax</code>è¡¨ç¤ºè¯¥æ®µæ˜¯å¯åˆ†é…çš„ï¼ˆallocatableï¼‰å’Œå¯æ‰§è¡Œçš„ï¼ˆexecutableï¼‰ã€‚</li>
<li>â€œ<code>.section .note.GNU-stack</code>â€œæŒ‡ä»¤ç”¨äºå‘Šè¯‰é“¾æ¥å™¨æ˜¯å¦å…è®¸åœ¨å †æ ˆä¸Šæ‰§è¡Œä»£ç ã€‚</li>
<li>â€œ<code>.section .note.gnu.property</code>â€œæŒ‡ä»¤ç”¨äºæŒ‡å®šä¸€äº›å±æ€§ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªGNUç‰¹æ€§æ ‡è®°ã€‚</li>
</ul>
<h3 id="æ±‡ç¼–çš„å…¥å£"><a href="#æ±‡ç¼–çš„å…¥å£" class="headerlink" title="æ±‡ç¼–çš„å…¥å£"></a>æ±‡ç¼–çš„å…¥å£</h3><ul>
<li>æ±‡ç¼–çš„æ‰§è¡Œæµç¨‹ï¼šå…¥å£å‡½æ•°åœ¨å“ªé‡Œ</li>
<li>å…¥å£å‡½æ•°åœ¨è¯¥æ–‡ä»¶ä¸­çš„åç§°ä¸ºâ€œmainâ€ï¼Œå®šä¹‰äºâ€œ<code>.text.startupâ€ section</code>ï¼Œå…¶é¦–åœ°å€ä¸ºâ€œ<code>.globl main</code>â€ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.section .text.startup,&quot;ax&quot;,@progbits</span><br><span class="line">.p2align 4</span><br><span class="line">.globl main</span><br><span class="line">.type main, @function</span><br></pre></td></tr></table></figure>

<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p><img src="https://pic.shaojiemike.top/img/20230521194515.png"></p>
<ul>
<li>ä¸ºäº†ç¡®ä¿è¿™äº›åˆå§‹åŒ–æ“ä½œå¯ä»¥åœ¨ç¨‹åºå¯åŠ¨æ—¶æ­£ç¡®æ‰§è¡Œï¼Œç¼–è¯‘å™¨å°†æŠŠè¿™äº›æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„è°ƒç”¨ä»£ç æ‰“åŒ…æˆè‹¥å¹²ä¸ªå‡½æ•°ï¼Œç»Ÿä¸€æ”¾åœ¨åå­—ä¸ºâ€œ<code>_GLOBAL__sub_I_xxx</code>â€çš„sectionä¸­ã€‚<ul>
<li>å› ä¸ºåœ¨C++ç¨‹åºç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå…¨å±€å˜é‡ã€é™æ€å˜é‡å’Œå…¨å±€å¯¹è±¡ç­‰ä¿¡æ¯éƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–å¯¹è±¡ï¼‰å’Œææ„å‡½æ•°ï¼ˆæ¸…ç†å¯¹è±¡ï¼‰ã€‚</li>
<li>åœ¨è¿™æ®µæ±‡ç¼–ä»£ç ä¸­ï¼Œä¹Ÿå°±æ˜¯é‚£ä¸ªâ€_GLOBAL__sub_I_mainâ€å‡½æ•°ï¼Œå®ƒæ˜¯C++å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„æ„é€ å‡½æ•°ï¼Œå®ƒè°ƒç”¨äº†é¢„åˆå§‹åŒ–å‡½æ•° â€œ<code>ios_base::Init()</code>â€œï¼Œå¹¶æ³¨å†Œäº†ä¸€ä¸ªåœ¨ç¨‹åºé€€å‡ºæ—¶è°ƒç”¨çš„ææ„å‡½æ•° â€œ<code>__cxa_atexit</code>â€œã€‚</li>
</ul>
</li>
<li>åœ¨â€<code>.init_array</code>â€œ sectionä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªâ€_GLOBAL__sub_I_mainâ€çš„åœ°å€ï¼Œè¿™æ˜¯åœ¨ç¨‹åºå¯åŠ¨æ—¶éœ€è¦è°ƒç”¨çš„æ‰€æœ‰C++å…¨å±€å’Œé™æ€å¯¹è±¡çš„åˆå§‹åŒ–å‡½æ•°åˆ—è¡¨ï¼Œç¼–è¯‘å™¨é“¾æ¥è¿™ä¸ªåˆ—è¡¨å¹¶åœ¨ç¨‹åºå¯åŠ¨æ—¶ä¾æ¬¡è°ƒç”¨è¿™äº›åˆå§‹åŒ–å‡½æ•°ã€‚</li>
<li>æ€»ä¹‹ï¼Œè¿™ä¸¤ä¸ªsectionçš„å­˜åœ¨æ˜¯ä¸ºäº†ä¿è¯C++å…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„æ­£ç¡®åˆå§‹åŒ–ã€‚</li>
</ul>
<p>å…¶ä¸­å››æ¡æŒ‡ä»¤éƒ½å®šä¹‰äº†ä¸€äº›ç¬¦å·æˆ–å˜é‡ï¼Œå¹¶åˆ†é…äº†ä¸€äº›å†…å­˜ç©ºé—´ï¼Œè¿™äº›åœ¨ç¨‹åºé‡Œçš„æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<ol>
<li>â€œ<code>.quad _GLOBAL__sub_I_main</code>â€œ:</li>
</ol>
<p>åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°†è°ƒç”¨æ‰€æœ‰å…¨å±€é™æ€å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚è¿™äº›æ„é€ å‡½æ•°è¢«æ”¾åœ¨ä¸€ä¸ªåä¸ºâ€_GLOBAL__sub_I_xxxâ€çš„sectionä¸­ï¼Œè€Œæ¯ä¸ªsectionéƒ½æ˜¯ç”±ä¸€ä¸ªæŒ‡å‘è¯¥sectionæ‰€æœ‰å¯¹è±¡çš„åœ°å€åˆ—è¡¨æ‰€å¼•ç”¨ã€‚è¿™é‡Œçš„â€.quad _GLOBAL__sub_I_mainâ€æ˜¯ä¸ºäº†å°†â€_GLOBAL__sub_I_mainâ€å‡½æ•°çš„åœ°å€æ·»åŠ åˆ°è¯¥åˆ—è¡¨ä¸­ã€‚</p>
<ol start="2">
<li>â€œ<code>.local _ZStL8__ioinit</code>â€œ:</li>
</ol>
<p>è¿™æ¡æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªæœ¬åœ°ç¬¦å·â€_ZStL8__ioinitâ€ï¼Œå®ƒè¡¨ç¤ºC++æ ‡å‡†è¾“å…¥è¾“å‡ºçš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ç”±äºè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªæœ¬åœ°ç¬¦å·ï¼Œæ‰€ä»¥åªèƒ½åœ¨ç¼–è¾‘è¯¥æ–‡ä»¶çš„å½“å‰å•å…ƒä¸­ä½¿ç”¨è¯¥ç¬¦å·ã€‚</p>
<ol start="3">
<li>â€œ<code>.comm _ZStL8__ioinit,1,1</code>â€œ:</li>
</ol>
<p>è¿™æ¡æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªåä¸ºâ€_ZStL8__ioinitâ€çš„æœªåˆå§‹åŒ–çš„å¼±ç¬¦å·ï¼Œå¹¶ä¸ºè¯¥ç¬¦å·åˆ†é…äº†1ä¸ªå¤§å°çš„å­—èŠ‚ç©ºé—´ã€‚è¿™ä¸ªå¼±ç¬¦å·å®šä¹‰äº†ä¸€ä¸ªC++æ ‡å‡†è¾“å…¥è¾“å‡ºéƒ¨åˆ†çš„å…¨å±€çŠ¶æ€å¯¹è±¡ã€‚åœ¨å…¨ç”¨åŠ¨æ€åº“æ—¶ï¼Œä¸åŒçš„åŠ¨æ€åº“å¯èƒ½æœ‰è‡ªå·±çš„IOçŠ¶æ€ï¼Œæ‰€ä»¥ä¸ºäº†ç¡®ä¿C++è¾“å…¥è¾“å‡ºçš„çŠ¶æ€æ­£ç¡®ï¼Œéœ€è¦ä¸ºå…¶æŒ‡å®šä¸€ä¸ªå•ç‹¬çš„æ®µæ¥å­˜å‚¨è¿™äº›çŠ¶æ€æ•°æ®ã€‚åœ¨è¿™é‡Œï¼Œâ€.comm _ZStL8__ioinit,1,1â€å°†ä¼šä¸ºâ€_ZStL8__ioinitâ€ç¬¦å·åˆ†é…ä¸€ä¸ªå­—èŠ‚å¤§å°çš„ç©ºé—´ã€‚</p>
<ol start="4">
<li>â€œ<code>.hidden __dso_handle</code>â€œ:</li>
</ol>
<p>è¿™æ¡æŒ‡ä»¤å®šä¹‰äº†ä¸€ä¸ªéšè—çš„ç¬¦å· â€œ__dso_handleâ€ã€‚è¿™ä¸ªç¬¦å·æ˜¯ä¸€ä¸ªé“¾æ¥å™¨ç”Ÿæˆçš„éšå¼å˜é‡ï¼Œå…¶å®šä¹‰äº†ä¸€ä¸ªæŒ‡å‘è¢«å½“å‰åŠ¨æ€åº“ä½¿ç”¨çš„å…¨å±€æ•°æ®å¯¹è±¡çš„ä¸€ä¸ªæŒ‡é’ˆã€‚è¯¥ç¬¦å·åœ¨è¢«é“¾æ¥è¿›æ¥çš„åº“ä¸­æ˜¯éšè—çš„ï¼Œä¸ä¼šè¢«å…¶ä»–åº“æˆ–è€…mainå‡½æ•°æœ¬èº«è°ƒç”¨ï¼Œä½†æ˜¯åœ¨mainè¿”å›åï¼Œå¯ä»¥ç”¨æ¥æ£€æŸ¥åº“æ˜¯å¦å·²ç»è¢«å¸è½½ã€‚</p>
<h3 id="æœ«å°¾çš„å…ƒæ•°æ®"><a href="#æœ«å°¾çš„å…ƒæ•°æ®" class="headerlink" title="æœ«å°¾çš„å…ƒæ•°æ®"></a>æœ«å°¾çš„å…ƒæ•°æ®</h3><p><img src="https://pic.shaojiemike.top/img/20230521191453.png"></p>
<p>è¿™æ®µä»£ç æ˜¯ä¸€äº›ç‰¹æ®Šçš„æŒ‡ä»¤å’Œæ•°æ®ï¼Œä¸»è¦æ˜¯ç”¨äºå‘å¯æ‰§è¡Œæ–‡ä»¶æ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€‚è¿™äº›å…ƒæ•°æ®å¯èƒ½åŒ…å«å„ç§ä¿¡æ¯ï¼Œå¦‚è°ƒè¯•ä¿¡æ¯ã€ç‰¹å®šå¹³å°çš„æŒ‡ä»¤é›†æ”¯æŒç­‰ç­‰ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li>â€œ.longâ€æŒ‡ä»¤ç”¨äºå®šä¹‰ä¸€ä¸ªé•¿æ•´å‹æ•°å€¼ï¼Œè¿™é‡Œç”¨æ¥è®¡ç®—åœ°å€ä¹‹é—´çš„å·®å€¼ã€‚<ul>
<li>ä¾‹å¦‚ï¼Œç¬¬ä¸€è¡Œâ€<code>.long 1f - 0f</code>â€œå»ºç«‹äº†ä¸€ä¸ªé•¿æ•´å‹æ•°å€¼ï¼Œè¡¨ç¤ºâ€1:â€æ ‡ç­¾ç›¸å¯¹äºå½“å‰æŒ‡ä»¤åœ°å€ï¼ˆå³0fï¼‰çš„åç§»é‡ã€‚åç§»é‡å¯ä»¥ç”¨æ¥è®¡ç®—æ ‡ç­¾å¯¹åº”çš„æŒ‡ä»¤åœ°å€ï¼Œä»è€Œå¯ç”¨äºè·³è½¬æˆ–è®¡ç®—æŒ‡é’ˆåç§»é‡ã€‚</li>
<li>â€œ<code>4f - 1f</code>â€œï¼Œå³â€4:â€æ ‡ç­¾ç›¸å¯¹äºâ€1:â€æ ‡ç­¾çš„åç§»é‡ï¼›</li>
</ul>
</li>
<li>â€œ<code>.long 0xc0000002</code>â€œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§æ ‡è®°ï¼Œæ ‡è¯†è¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨Linuxå¹³å°ä¸Šæ‰§è¡Œã€‚å®ƒæ˜¯ç”¨æ¥å‘Šè¯‰æ“ä½œç³»ç»Ÿè¿™ä¸ªç¨‹åºæ˜¯ç”¨ç‰¹å®šæŒ‡ä»¤é›†ç¼–è¯‘çš„ã€‚</li>
<li>â€œ<code>.long 0x3</code>â€œè¡¨ç¤ºå¦ä¸€ä¸ªå±æ€§æ ‡è®°ï¼Œè¡¨ç¤ºè¿™ä¸ªæ–‡ä»¶å¯ä»¥åŠ è½½åˆ°ä»»æ„åœ°å€ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œè¿™äº›å…ƒæ•°æ®å¯èƒ½å¯¹ç¨‹åºè¿è¡Œèµ·åˆ°å…³é”®ä½œç”¨ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¯èƒ½éƒ½æ²¡æœ‰æ˜æ˜¾çš„ä½œç”¨ï¼Œå› æ­¤çœ‹èµ·æ¥æ²¡æœ‰ç”¨ã€‚</p>
<h2 id="æ¯”è¾ƒæ±‡ç¼–çš„debugging-symbols"><a href="#æ¯”è¾ƒæ±‡ç¼–çš„debugging-symbols" class="headerlink" title="æ¯”è¾ƒæ±‡ç¼–çš„debugging symbols"></a>æ¯”è¾ƒæ±‡ç¼–çš„debugging symbols</h2><p>æ‰§è¡Œ<code>gcc -S -g testBigExe.cpp -o testDebug.s</code>ï¼Œå¯¹æ¯”ä¹‹å‰çš„æ±‡ç¼–æ–‡ä»¶ï¼Œç”±72è¡Œå˜æˆ9760è¡Œã€‚</p>
<ul>
<li><img src="https://pic.shaojiemike.top/img/20230521195333.png" alt="-gå‰å"></li>
</ul>
<h3 id="loc"><a href="#loc" class="headerlink" title=".loc"></a>.loc</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.LBE32:</span><br><span class="line"> .file 3 &quot;/usr/include/c++/9/bits/char_traits.h&quot;</span><br><span class="line"> .loc 3 342 2 is_stmt 1 view .LVU4</span><br><span class="line"> .loc 1 5 11 is_stmt 0 view .LVU5</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬ä¸€è¡Œï¼š<code>.loc 3 342 2</code> è¡¨ç¤ºå½“å‰æŒ‡ä»¤å¯¹åº”çš„æºä»£ç æ–‡ä»¶IDä¸º3ï¼Œåœ¨ç¬¬342è¡Œï¼Œç¬¬2åˆ—ï¼ˆå…¶ä¸­ç¬¬1åˆ—æ˜¯è¡Œå·ï¼Œç¬¬2åˆ—æ˜¯ç¬¬å‡ ä¸ªå­—ç¬¦ï¼‰ï¼ŒåŒæ—¶<code>is_stmt</code>ä¸º1è¡¨ç¤ºè¿™æ¡æŒ‡ä»¤æ˜¯è¯­å¥çš„èµ·å§‹ä½ç½®ã€‚</li>
<li>ç¬¬äºŒè¡Œï¼š<code>.loc 1 5 11</code> è¡¨ç¤ºå½“å‰æŒ‡ä»¤å¯¹åº”çš„æºä»£ç æ–‡ä»¶IDä¸º1ï¼Œåœ¨ç¬¬5è¡Œï¼Œç¬¬11åˆ—ï¼ŒåŒæ—¶<code>is_stmt</code>ä¸º0è¡¨ç¤ºè¿™æ¡æŒ‡ä»¤ä¸æ˜¯è¯­å¥çš„èµ·å§‹ä½ç½®ã€‚</li>
<li><code>view .LVU4</code> è¡¨ç¤ºå½“å‰æŒ‡ä»¤æ‰€å¤„çš„ä½œç”¨åŸŸï¼ˆscopeï¼‰æ˜¯.LVU4ã€‚ä½œç”¨åŸŸæ˜¯æŒ‡è¯¥æŒ‡ä»¤æ‰€åœ¨çš„å‡½æ•°ã€ä»£ç å—ç­‰ä¸€æ®µèŒƒå›´å†…çš„æ‰€æœ‰å˜é‡å’Œå¯¹è±¡çš„å¯è§æ€§ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.LVU4 æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ä½œç”¨åŸŸï¼Œå› ä¸ºå®ƒæ˜¯ä½äºä¸€ä¸ªC++æ ‡å‡†åº“å¤´æ–‡ä»¶ä¸­çš„ä¸€ä¸ªå‡½æ•°çš„èµ·å§‹ä½ç½®ã€‚</li>
</ul>
<h3 id="debug-section"><a href="#debug-section" class="headerlink" title="debug section"></a>debug section</h3><p>æ–°å¢çš„è¿™äº› section å­˜å‚¨äº† DWARF è°ƒè¯•ä¿¡æ¯ã€‚DWARFï¼ˆDebugging With Attributed Record Formatsï¼‰æ˜¯ä¸€ç§è°ƒè¯•ä¿¡æ¯çš„æ ‡å‡†æ ¼å¼ï¼ŒåŒ…æ‹¬ä»£ç ä¸­çš„å˜é‡ã€ç±»å‹ã€å‡½æ•°ã€æºæ–‡ä»¶çš„æ˜ å°„å…³ç³»ï¼Œä»¥åŠä»£ç çš„ç¼–è¯‘ç›¸å…³ä¿¡æ¯ç­‰ç­‰ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¿™äº› section å­˜å‚¨çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>.debug_info</code>ï¼šåŒ…å«ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¼–è¯‘å•å…ƒã€ç±»å‹ä¿¡æ¯ã€å‡½æ•°å’Œå˜é‡ä¿¡æ¯ç­‰ã€‚</li>
<li><code>.debug_abbrev</code>ï¼šåŒ…å«äº† .debug_info ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰ç¼©å†™åç§°åŠå…¶å¯¹åº”çš„å«ä¹‰ï¼Œç”¨äºå‹ç¼©æ ¼å¼å’Œæé«˜æ•ˆç‡ã€‚</li>
<li><code>.debug_loc</code>ï¼šå­˜å‚¨æ¯ä¸ªç¨‹åºå˜é‡æˆ–è¡¨è¾¾å¼çš„åœ°å€èŒƒå›´åŠå…¶åœ°å€å¯„å­˜å™¨ã€è¡¨è¾¾å¼è§„åˆ™ç­‰ä¿¡æ¯ã€‚åœ¨è°ƒè¯•æ—¶ç”¨æ¥ç¡®å®šå˜é‡æˆ–è¡¨è¾¾å¼çš„å€¼å’ŒèŒƒå›´ã€‚</li>
<li><code>.debug_aranges</code>ï¼šå­˜å‚¨ç®€åŒ–ç‰ˆæœ¬çš„åœ°å€èŒƒå›´æè¿°ï¼Œå…è®¸è°ƒè¯•å™¨åŠ é€Ÿåœ°å®šä½ä»£ç å’Œæ•°æ®çš„ä½ç½®ã€‚</li>
<li><code>.debug_ranges</code>ï¼šå­˜å‚¨æ¯ä¸ªç¼–è¯‘å•å…ƒï¼ˆCUï¼‰çš„åœ°å€èŒƒå›´ï¼Œæ¯ä¸ªèŒƒå›´éƒ½æ˜¯ä¸€ä¸ªæœ‰é™å¼€åŒºé—´ã€‚</li>
<li><code>.debug_line</code>ï¼šå­˜å‚¨æºä»£ç è¡Œå·ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯è¡Œçš„æ–‡ä»¶ã€è¡Œå·ã€æ˜¯å¦ä¸ºè¯­å¥èµ·å§‹ä½ç½®ç­‰ä¿¡æ¯ã€‚</li>
<li><code>.debug_str</code>ï¼šåŒ…å«äº†æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¦‚æ–‡ä»¶åã€å‡½æ•°åç­‰ï¼Œç”±äºæ¯ä¸ªè°ƒè¯•ä¿¡æ¯çš„æ•°æ®éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤è¿™æ˜¯æ‰€æœ‰è°ƒè¯•ä¿¡æ¯çš„åŸºç¡€ã€‚</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº› section ä¸­çš„ä¿¡æ¯æ˜¯æ ¹æ®ç¼–è¯‘å™¨çš„é…ç½®å’Œé€‰é¡¹ç”Ÿæˆçš„ï¼Œå› æ­¤ä¸åŒç¼–è¯‘å™¨å¯èƒ½ä¼šç”Ÿæˆç•¥æœ‰ä¸åŒçš„è°ƒè¯•ä¿¡æ¯ã€‚</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><ul>
<li>åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œå“ªä¸ªé˜¶æ®µ labelä¼šå˜æˆçœŸå®æ‰§è¡Œåœ°å€</li>
</ul>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zuofaqi/articles/12853734.html">https://www.cnblogs.com/zuofaqi/articles/12853734.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zuofaqi/articles/12853734.html">https://www.cnblogs.com/zuofaqi/articles/12853734.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-14T16:00:00.000Z" title="5/14/2023, 4:00:00 PM">2023-05-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.046Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Network/">Network</a></span><span class="level-item">14 minutes read (About 2110 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/14/OutOfWork/3-homepage/background/PersonalWebsiteBeginners/">Web Server</a></p><div class="content"><h2 id="å¸¸è§çš„webæœåŠ¡å™¨"><a href="#å¸¸è§çš„webæœåŠ¡å™¨" class="headerlink" title="å¸¸è§çš„webæœåŠ¡å™¨"></a>å¸¸è§çš„webæœåŠ¡å™¨</h2><p>å¸¸è§çš„webæœåŠ¡å™¨æœ‰Apacheã€nginxã€IIS</p>
<ol>
<li>Apache<ol>
<li>ApacheéŸ³è¯‘ä¸ºé˜¿å¸•å¥‡, æ˜¯å…¨ä¸–ç•Œæœ€å—æ¬¢è¿çš„webæœåŠ¡å™¨ï¼Œå› å…¶å¿«é€Ÿã€å¯é å¹¶ä¸”å¯é€šè¿‡ç®€å•çš„APIæ‰©å……ï¼Œèƒ½å°†Python\Perlç­‰è§£é‡Šå™¨éƒ¨ç½²åœ¨å…¶ä¸Šé¢ç­‰ä¼˜åŠ¿ï¼Œå—åˆ°å¹¿æ³›çš„å…³æ³¨ä¸ä½¿ç”¨ã€‚</li>
<li>ä½†æ˜¯ç°åœ¨ç”¨çš„äººå°‘äº†ï¼Œè€Œä¸”æ€§èƒ½æ²¡nginxå¥½</li>
</ol>
</li>
<li>nginx<ol>
<li>Apacheçš„è‡´å‘½ç¼ºé™·å°±æ˜¯åœ¨åŒæ—¶å¤„ç†å¤§é‡çš„ï¼ˆä¸€ä¸‡ä¸ªä»¥ä¸Šï¼‰è¯·æ±‚æ—¶ï¼Œæ˜¾å¾—æœ‰äº›åƒåŠ›ï¼Œæ‰€ä»¥â€œæˆ˜æ–—æ°‘æ—â€çš„äººè®¾è®¡çš„ä¸€æ¬¾è½»é‡çº§çš„webæœåŠ¡å™¨â€”â€”nginx, åœ¨é«˜å¹¶å‘ä¸‹nginx èƒ½ä¿æŒæ¯”Apacheä½èµ„æºä½æ¶ˆè€—é«˜æ€§èƒ½ ï¼Œ</li>
</ol>
</li>
<li>IIS<ol>
<li>iisæ˜¯Internet Information Servicesçš„ç¼©å†™ï¼Œæ„ä¸ºäº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼Œæ˜¯ç”±å¾®è½¯å…¬å¸æä¾›çš„åŸºäºè¿è¡ŒMicrosoft Windowsçš„äº’è”ç½‘åŸºæœ¬æœåŠ¡,</li>
</ol>
</li>
</ol>
<h2 id="æŸ¥æ‰¾ç½‘ç«™æœåŠ¡"><a href="#æŸ¥æ‰¾ç½‘ç«™æœåŠ¡" class="headerlink" title="æŸ¥æ‰¾ç½‘ç«™æœåŠ¡"></a>æŸ¥æ‰¾ç½‘ç«™æœåŠ¡</h2><h3 id="åˆ¤æ–­æ˜¯nginxè¿˜æ˜¯apach2"><a href="#åˆ¤æ–­æ˜¯nginxè¿˜æ˜¯apach2" class="headerlink" title="åˆ¤æ–­æ˜¯nginxè¿˜æ˜¯apach2"></a>åˆ¤æ–­æ˜¯nginxè¿˜æ˜¯apach2</h3><p>éšä¾¿è¾“å‡ºè¿”å›404é¡µé¢æ˜¾ç¤º <code>nginx/1.14.0 (Ubuntu)</code></p>
<h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo service apache2 status</span><br><span class="line">sudo service nginx status</span><br><span class="line">sudo vim /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#PasswordAuthentication yes</span></span><br><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure>

<h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><ol>
<li>&#x2F;etc&#x2F;nginx&#x2F;nginx.conf<ol>
<li>å…¨å±€å—ã€</li>
<li>eventså—</li>
<li>httpå—<ol>
<li>httpå…¨å±€å—</li>
<li>å¤šä¸ªserverå—<ol>
<li>serverå…¨å±€å—</li>
<li>å¤šä¸ªlocationå—<ol>
<li>Nginxä¸­locationçš„ä½œç”¨æ˜¯æ ¹æ®Urlæ¥å†³å®šæ€ä¹ˆå¤„ç†ç”¨æˆ·è¯·æ±‚(è½¬å‘è¯·æ±‚ç»™å…¶ä»–æœåŠ¡å™¨å¤„ç†æˆ–è€…æŸ¥æ‰¾æœ¬åœ°æ–‡ä»¶è¿›è¡Œå¤„ç†)ã€‚locationæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œ<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wyy1234/p/10632108.html">é…ç½®ååˆ†çµæ´»</a>ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœº(nginxä¸­çš„ä¸€ä¸ªserverèŠ‚ç‚¹)ä¸‹é…ç½®å¤šä¸ªlocationä»¥æ»¡è¶³å¦‚åŠ¨é™åˆ†ç¦»ï¼Œé˜²ç›—é“¾ç­‰éœ€æ±‚ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="å…¨å±€å—"><a href="#å…¨å±€å—" class="headerlink" title="å…¨å±€å—"></a>å…¨å±€å—</h3><p>å…¨å±€å—æ˜¯é»˜è®¤é…ç½®æ–‡ä»¶ä»å¼€å§‹åˆ°eventså—ä¹‹é—´çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä¸»è¦è®¾ç½®ä¸€äº›å½±å“NginxæœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œå› æ­¤ï¼Œè¿™äº›æŒ‡ä»¤çš„ä½œç”¨åŸŸæ˜¯NginxæœåŠ¡å™¨å…¨å±€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‡å®šå¯ä»¥è¿è¡ŒnginxæœåŠ¡çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œåªèƒ½åœ¨å…¨å±€å—é…ç½®</span><br><span class="line">user www-data;</span><br><span class="line"># æŒ‡å®šå·¥ä½œçº¿ç¨‹æ•°</span><br><span class="line">worker_processes auto;</span><br><span class="line"># æŒ‡å®špidæ–‡ä»¶å­˜æ”¾çš„è·¯å¾„ï¼Œè¿™ä¸ªæŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—é…ç½®</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line"># includeæŒ‡ä»¤ï¼Œç”¨äºåŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶çš„ä»»ä½•åœ°æ–¹ï¼Œä½†æ˜¯è¦æ³¨æ„ä½ åŒ…å«è¿›æ¥çš„é…ç½®æ–‡ä»¶ä¸€å®šç¬¦åˆé…ç½®è§„èŒƒï¼Œæ¯”å¦‚è¯´ä½ includeè¿›æ¥çš„é…ç½®æ˜¯worker_processesæŒ‡ä»¤çš„é…ç½®ï¼Œè€Œä½ å°†è¿™ä¸ªæŒ‡ä»¤åŒ…å«åˆ°äº†httpå—ä¸­ï¼Œç€è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œä¸Šé¢å·²ç»ä»‹ç»è¿‡worker_processesæŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—ä¸­ã€‚</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br></pre></td></tr></table></figure>

<h3 id="åŠ¨æ€æ¨¡å—æ”¯æŒ"><a href="#åŠ¨æ€æ¨¡å—æ”¯æŒ" class="headerlink" title="åŠ¨æ€æ¨¡å—æ”¯æŒ"></a>åŠ¨æ€æ¨¡å—æ”¯æŒ</h3><p>æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="https://docshome.gitbook.io/nginx-docs/he-xin-gong-neng/http/ngx_http_geoip_module">https://docshome.gitbook.io/nginx-docs/he-xin-gong-neng/http/ngx_http_geoip_module</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@acsa:/etc/nginx/modules-enabled<span class="comment"># cat 50-mod-http-geoip.conf </span></span><br><span class="line">load_module modules/ngx_http_geoip_module.so;</span><br><span class="line">root@acsa:/etc/nginx/modules-enabled<span class="comment"># cat 50-mod-http-image-filter.conf </span></span><br><span class="line">load_module modules/ngx_http_image_filter_module.so;</span><br><span class="line">root@acsa:/etc/nginx/modules-enabled<span class="comment"># cat 50-mod-http-xslt-filter.conf </span></span><br><span class="line">load_module modules/ngx_http_xslt_filter_module.so;</span><br><span class="line">root@acsa:/etc/nginx/modules-enabled<span class="comment"># cat 50-mod-mail.conf </span></span><br><span class="line">load_module modules/ngx_mail_module.so;</span><br><span class="line">root@acsa:/etc/nginx/modules-enabled<span class="comment"># cat 50-mod-stream.conf </span></span><br><span class="line">load_module modules/ngx_stream_module.so;</span><br></pre></td></tr></table></figure>
<p><code>/usr/share/nginx/modules -&gt; ../../lib/nginx/modules</code></p>
<p>ä½ç½®<code>/usr/share/nginx</code>æˆ–è€…<code>/usr/local/nginx</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â”€ modules-enabled</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 50-mod-http-geoip.conf -&gt; /usr/share/nginx/modules-available/mod-http-geoip.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 50-mod-http-image-filter.conf -&gt; /usr/share/nginx/modules-available/mod-http-image-filter.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 50-mod-http-xslt-filter.conf -&gt; /usr/share/nginx/modules-available/mod-http-xslt-filter.conf</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 50-mod-mail.conf -&gt; /usr/share/nginx/modules-available/mod-mail.conf</span><br><span class="line">â”‚Â Â  â””â”€â”€ 50-mod-stream.conf -&gt; /usr/share/nginx/modules-available/mod-stream.conf</span><br></pre></td></tr></table></figure>

<h3 id="eventså—"><a href="#eventså—" class="headerlink" title="eventså—"></a>eventså—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è®¾ç½®å…è®¸æ¯ä¸€ä¸ªworker processåŒæ—¶å¼€å¯çš„æœ€å¤§è¿æ¥æ•°ï¼Œå½“æ¯ä¸ªå·¥ä½œè¿›ç¨‹æ¥å—çš„è¿æ¥æ•°è¶…è¿‡è¿™ä¸ªå€¼æ—¶å°†ä¸å†æ¥æ”¶è¿æ¥</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  768;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="htmlå—"><a href="#htmlå—" class="headerlink" title="htmlå—"></a>htmlå—</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Basic Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        sendfile on; # å¼€å¯å…³é—­sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ </span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        tcp_nodelay on;</span><br><span class="line">        keepalive_timeout 65;</span><br><span class="line">        types_hash_max_size 2048;</span><br><span class="line">        # server_tokens off;</span><br><span class="line"></span><br><span class="line">        # server_names_hash_bucket_size 64;</span><br><span class="line">        # server_name_in_redirect off;</span><br><span class="line"></span><br><span class="line">        include /etc/nginx/mime.types; # åŒºåˆ†å„ç§ç½‘ç»œèµ„æº</span><br><span class="line">        default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # SSL Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Dropping SSLv3, ref: POODLE</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        access_log /var/log/nginx/access.log;</span><br><span class="line">        error_log /var/log/nginx/error.log;</span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        # gzip_vary on;</span><br><span class="line">        # gzip_proxied any;</span><br><span class="line">        # gzip_comp_level 6;</span><br><span class="line">        # gzip_buffers 16 8k;</span><br><span class="line">        # gzip_http_version 1.1;</span><br><span class="line">        # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Virtual Host Configs</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        include /etc/nginx/conf.d/*.conf;</span><br><span class="line">        include /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="include-etc-nginx-sites-enabled"><a href="#include-etc-nginx-sites-enabled" class="headerlink" title="include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*"></a>include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*</h3><p>å¯¹åº”htmlåœ¨<code>root /var/www/html;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen 80 default_server;</span><br><span class="line">        listen [::]:80 default_server;</span><br><span class="line"></span><br><span class="line">        # SSL configuration</span><br><span class="line">        #</span><br><span class="line">        # listen 443 ssl default_server;</span><br><span class="line">        # listen [::]:443 ssl default_server;</span><br><span class="line">        #</span><br><span class="line">        # Note: You should disable gzip for SSL traffic.</span><br><span class="line">        # See: https://bugs.debian.org/773332</span><br><span class="line">        #</span><br><span class="line">        # Read up on ssl_ciphers to ensure a secure configuration.</span><br><span class="line">        # See: https://bugs.debian.org/765782</span><br><span class="line">        #</span><br><span class="line">        # Self signed certs generated by the ssl-cert package</span><br><span class="line">        # Don&#x27;t use them in a production server!</span><br><span class="line">        #</span><br><span class="line">        # include snippets/snakeoil.conf;</span><br><span class="line"></span><br><span class="line">        root /var/www/html;</span><br><span class="line"></span><br><span class="line">        # Add index.php to the list if you are using PHP</span><br><span class="line">        index index.php index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">        server_name _;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">                # First attempt to serve request as file, then</span><br><span class="line">                # as directory, then fall back to displaying a 404.</span><br><span class="line">                try_files $uri $uri/ =404;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # pass PHP scripts to FastCGI server</span><br><span class="line">        #</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">            include snippets/fastcgi-php.conf;</span><br><span class="line">            fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;</span><br><span class="line">        &#125;</span><br><span class="line">    location ~ \.csv$ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location ~ \.code$ &#123;</span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache&#x27;s document root</span><br><span class="line">        # concurs with nginx&#x27;s one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht &#123;</span><br><span class="line">        #       deny all;</span><br><span class="line">        #&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="mailå—ï¼ˆå¯é€‰ï¼‰"><a href="#mailå—ï¼ˆå¯é€‰ï¼‰" class="headerlink" title="mailå—ï¼ˆå¯é€‰ï¼‰"></a>mailå—ï¼ˆå¯é€‰ï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#mail &#123;</span><br><span class="line">#       # See sample authentication script at:</span><br><span class="line">#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span><br><span class="line"># </span><br><span class="line">#       # auth_http localhost/auth.php;</span><br><span class="line">#       # pop3_capabilities &quot;TOP&quot; &quot;USER&quot;;</span><br><span class="line">#       # imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;;</span><br><span class="line"># </span><br><span class="line">#       server &#123;</span><br><span class="line">#               listen     localhost:110;</span><br><span class="line">#               protocol   pop3;</span><br><span class="line">#               proxy      on;</span><br><span class="line">#       &#125;</span><br><span class="line"># </span><br><span class="line">#       server &#123;</span><br><span class="line">#               listen     localhost:143;</span><br><span class="line">#               protocol   imap;</span><br><span class="line">#               proxy      on;</span><br><span class="line">#       &#125;</span><br><span class="line">#&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ubuntu-18-04ä¸‹-Apache2-web-æœåŠ¡å™¨çš„å®‰è£…-åœ¨node5æµ‹è¯•"><a href="#Ubuntu-18-04ä¸‹-Apache2-web-æœåŠ¡å™¨çš„å®‰è£…-åœ¨node5æµ‹è¯•" class="headerlink" title="Ubuntu 18.04ä¸‹ Apache2 web æœåŠ¡å™¨çš„å®‰è£… (åœ¨node5æµ‹è¯•)"></a>Ubuntu 18.04ä¸‹ Apache2 web æœåŠ¡å™¨çš„å®‰è£… (åœ¨node5æµ‹è¯•)</h2><p>httpdæ˜¯Apacheè¶…æ–‡æœ¬ä¼ è¾“åè®®(HTTP)æœåŠ¡å™¨çš„ä¸»ç¨‹åºã€‚è¢«è®¾è®¡ä¸ºä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„åå°è¿›ç¨‹ï¼Œå®ƒä¼šå»ºç«‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å­è¿›ç¨‹æˆ–çº¿ç¨‹çš„æ± ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install apache2 -y</span><br></pre></td></tr></table></figure>
<p>åˆ¤æ–­æ˜¯å¦æ­£å¸¸è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl status apache2</span><br><span class="line">service apache2 status</span><br></pre></td></tr></table></figure>

<p>å¼€å¯ã€å…³é—­å’Œé‡å¯æœåŠ¡å™¨,éœ€è¦sudo</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/apache2 start    //å¯åŠ¨ApacheæœåŠ¡</span><br><span class="line">/etc/init.d/apache2 stop    //åœæ­¢ApacheæœåŠ¡ </span><br><span class="line">/etc/init.d/apache2 restart    //é‡å¯ApacheæœåŠ¡</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹æ ¹ç›®å½•&#x2F;æŠŠæ–‡ä»¶ä¼ åˆ°æ ¹ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apache2/sites-available/000-default.conf</span><br><span class="line">    DocumentRoot /var/www/html    // é»˜è®¤</span><br><span class="line">    DocumentRoot /home/shaojiemike/Network/HUGO/shaojiemike/public //ä½†æ˜¯æ²¡æœ‰è®¿é—®æ–‡ä»¶çš„æƒé™ï¼Œæœ€åæ˜¯æŠŠé™æ€ç½‘é¡µæ”¾åˆ°/var/www/htmlä¸‹</span><br><span class="line">sudo apache2ctl -k restart //é‡å¯</span><br></pre></td></tr></table></figure>

<h3 id="åŸºç¡€é…ç½®è§£é‡Š"><a href="#åŸºç¡€é…ç½®è§£é‡Š" class="headerlink" title="åŸºç¡€é…ç½®è§£é‡Š"></a>åŸºç¡€é…ç½®è§£é‡Š</h3><p><img src="https://pic.shaojiemike.top/img/20230510103819.png" alt="é»˜è®¤å†…ç½‘"></p>
<ul>
<li>You should replace this file (located at <code>/var/www/html/index.html</code>) before continuing to operate your HTTP server.</li>
<li>Configuration Overview<ul>
<li>Ubuntuâ€™s Apache2 default configuration is different from the upstream default configuration, and split into several files optimized for interaction with Ubuntu tools. </li>
<li>The configuration system is fully documented in <code>/usr/share/doc/apache2/README.Debian.gz</code>. Refer to this for the full documentation. Documentation for the web server itself can be found by accessing the manual if the <code>apache2-doc</code> package was installed on this server.</li>
</ul>
</li>
<li>The <strong>configuration layout</strong> for an Apache2 web server installation on Ubuntu systems is as follows:</li>
<li><pre><code>  /etc/apache2/
  |-- apache2.conf
  |       `--  ports.conf
  |-- mods-enabled
  |       |-- *.load
  |       `-- *.conf
  |-- conf-enabled
  |       `-- *.conf
  |-- sites-enabled
  |       `-- *.conf
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  * **apache2.conf** is the main configuration file. It puts the pieces together by including all remaining configuration files when starting up the web server.</span><br><span class="line">  * **ports.conf** is always included from the main configuration file. It is used to determine the listening ports for incoming connections, and this file can be customized anytime.</span><br><span class="line">* Configuration files in the `mods-enabled/`, `conf-enabled/` and `sites-enabled/` directories contain particular configuration snippets which manage modules, global configuration fragments, or virtual host configurations, respectively.</span><br><span class="line">* They are activated by symlinking available configuration files from their respective `*-available/` counterparts. These should be managed by using our helpers a2enmod, a2dismod, a2ensite, a2dissite, and a2enconf, a2disconf . See their respective man pages for detailed information.</span><br><span class="line">* The binary is called apache2. Due to the use of environment variables, in the default configuration, </span><br><span class="line">  * apache2 needs to be started/stopped with `/etc/init.d/apache2` or `apache2ctl`.</span><br><span class="line">  * Calling `/usr/bin/apache2` directly will not work with the default configuration.</span><br><span class="line">* Document Roots</span><br><span class="line">  * By default, Ubuntu does not allow access through the web browser to any file apart of those located in `/var/www`, `public_html` directories (when enabled) and `/usr/share` (for web applications). </span><br><span class="line">  * If your site is using a web document root located elsewhere (such as in /srv) you may need to whitelist your document root directory in `/etc/apache2/apache2.conf`.</span><br><span class="line">    * æœ€ç®€å•å®ç°`mount -t none -o bind,ro /targetPath /var/www/html`</span><br><span class="line">  * The default Ubuntu document root is `/var/www/html`. You can make your own virtual hosts under `/var/www`. This is different to previous releases which provides better security out of the box.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## é‡åˆ°çš„é—®é¢˜</span><br><span class="line"></span><br><span class="line">æŠŠé™æ€ç½‘é¡µä¼ ä¸Šå»</span><br></pre></td></tr></table></figure>
$ sudo apache2ctl -k restart
AH00558: apache2: Could not reliably determine the server&#39;s fully qualified domain name, using 127.0.1.1. Set the &#39;ServerName&#39; directive globally to suppress this message
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ²¡æœ‰è®¿é—®æƒé™</span><br></pre></td></tr></table></figure>
Forbidden
You don&#39;t have permission to access / on this server.
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯å› ä¸ºæ²¡æœ‰ä¿®æ”¹è¿è¡Œè®¿é—®çš„ç›®å½•,è€Œä¸”èƒ½é€šè¿‡åˆ«å</span><br></pre></td></tr></table></figure>
sudo vim apache2.conf
  alias /testtsj/ &quot;/home/shaojiemike/Network/&quot;
  &lt;Directory &quot;/home/shaojiemike/Network/&quot;&gt;
      Options Indexes FollowSymLinks #é¦–é¡µä¸å­˜åœ¨ï¼Œå…è®¸è®¿é—®å½“å‰ç›®å½•ä¸‹å…¶å®ƒå†…å®¹
      AllowOverride None
      Require all granted #å…è®¸è®¿é—®æ‰€æœ‰
  &lt;/Directory&gt;
</code></pre>
</li>
</ul>
<pre><code>![testtsj](https://link.jscdn.cn/sharepoint/aHR0cHM6Ly9tYWlsdXN0Y2VkdWNuLW15LnNoYXJlcG9pbnQuY29tLzppOi9nL3BlcnNvbmFsL3NoYW9qaWVtaWtlX21haWxfdXN0Y19lZHVfY24vRVZGMXhWcnUzUnBLb083VkFrdElodFlCdDRUTmVMYWp6NXkybE9WSTVnX25mUT9lPW5vUGx5Nw.png)

## å‚è€ƒæ–‡çŒ®

https://blog.csdn.net/weixin_39212776/article/details/81192847

https://blog.csdn.net/weixin_41843699/article/details/90390562
</code></pre>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-12T16:00:00.000Z" title="5/12/2023, 4:00:00 PM">2023-05-12</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.046Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">9 minutes read (About 1382 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/12/OutOfWork/6-games/6-SWITCH/">Switch emulator on PC</a></p><div class="content"><h2 id="åˆæ³•ä½¿ç”¨"><a href="#åˆæ³•ä½¿ç”¨" class="headerlink" title="åˆæ³•ä½¿ç”¨"></a>åˆæ³•ä½¿ç”¨</h2><p>è™½ç„¶ Ryujinx æ¨¡æ‹Ÿå™¨é¡¹ç›®æœ¬èº«æ˜¯å¼€æºå…è´¹ä¸”åˆæ³•çš„ï¼Œä½†å®ƒé»˜è®¤æƒ…å†µä¸‹å¹¶ä¸èƒ½ç›´æ¥è¿è¡Œå¸‚é¢ä¸Šå‘è¡Œçš„å„ç§å•†ä¸šæ¸¸æˆï¼Œå› ä¸ºå®ƒå¹¶<strong>ä¸åŒ…å« Switch ç³»ç»Ÿå›ºä»¶</strong>ï¼Œä¹Ÿ<strong>æ²¡æœ‰æ¸¸æˆ ROM</strong>ã€‚</p>
<p>è€ŒæŒ‰ç…§å›½å¤–çš„æ³•è§„ï¼Œå¦‚æœä½ ç”¨æˆ·è´­ä¹°äº†ä¸»æœºå’Œæ¸¸æˆï¼Œå°†å…¶å†…å®¹ DUMP (æå–) å‡ºæ¥è‡ªå·±ä½¿ç”¨æ˜¯åˆæ³•çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ— è®ºæ˜¯ Ryujinx è¿˜æ˜¯ Yuzu ç­‰æ¨¡æ‹Ÿå™¨ï¼Œæƒ³è¦å¼€ç©éƒ½éœ€è¦å…ˆå®Œæˆ</p>
<ul>
<li>å®‰è£…ç³»ç»Ÿå›ºä»¶å’Œ </li>
<li>prod.keys å¯†é’¥ç­‰æ­¥éª¤ã€‚<ul>
<li>å¦‚æœæ¸¸æˆè¦æ±‚æœ€æ–°çš„keyå’Œfirmwareä½ éœ€è¦å»æ›´æ–°</li>
</ul>
</li>
</ul>
<h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h3><ol>
<li>ä¸‹è½½ Ryujinx æ¨¡æ‹Ÿå™¨ä¸»ç¨‹åº</li>
<li>ä¸‹è½½ <code>prod.keys</code> å¯†é’¥æ–‡ä»¶ä»¥åŠ Switch çš„ç³»ç»Ÿå›ºä»¶ (Firmware)</li>
<li>è‡ªè¡Œç½‘ä¸Šæœç´¢ä¸‹è½½ä½ å–œæ¬¢çš„ä»»å¤©å ‚æ¸¸æˆæ–‡ä»¶ï¼Œæ”¯æŒ <code>.NSP</code> æˆ–è€… <code>.XCI</code> æ ¼å¼</li>
</ol>
<h2 id="å¯†é’¥æ–‡ä»¶ä»¥åŠ-Switch-çš„ç³»ç»Ÿå›ºä»¶"><a href="#å¯†é’¥æ–‡ä»¶ä»¥åŠ-Switch-çš„ç³»ç»Ÿå›ºä»¶" class="headerlink" title="å¯†é’¥æ–‡ä»¶ä»¥åŠ Switch çš„ç³»ç»Ÿå›ºä»¶"></a>å¯†é’¥æ–‡ä»¶ä»¥åŠ Switch çš„ç³»ç»Ÿå›ºä»¶</h2><ul>
<li>é€šè¿‡<a target="_blank" rel="noopener" href="https://www.base64decode.org/">decode</a> çŸ¥é“ <a target="_blank" rel="noopener" href="https://rentry.org/128bbkeys">ç½‘ç«™ä¸­ç¼–ç </a>çš„ä¸‹è½½åœ°å€<ul>
<li>ä¸º<a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/10c755wcDVn3sBb5LkxwWk-lIkZsnv40X">key</a></li>
</ul>
</li>
</ul>
<h2 id="Ryujinx-é¾™ç¥-æ¨¡æ‹Ÿå™¨"><a href="#Ryujinx-é¾™ç¥-æ¨¡æ‹Ÿå™¨" class="headerlink" title="Ryujinx (é¾™ç¥)æ¨¡æ‹Ÿå™¨"></a>Ryujinx (é¾™ç¥)æ¨¡æ‹Ÿå™¨</h2><p>ç‡å…ˆæ”¯æŒäº†ARMå’Œè‹¹æœ M ç³»åˆ—èŠ¯ç‰‡</p>
<h3 id="ç®€æ˜“æ­¥éª¤æ•™ç¨‹ï¼š"><a href="#ç®€æ˜“æ­¥éª¤æ•™ç¨‹ï¼š" class="headerlink" title="ç®€æ˜“æ­¥éª¤æ•™ç¨‹ï¼š"></a>ç®€æ˜“æ­¥éª¤æ•™ç¨‹ï¼š</h3><ol>
<li>ä¸‹è½½<a target="_blank" rel="noopener" href="https://ryujinx.org/download">æ¨¡æ‹Ÿå™¨</a>å¯¹åº”<a target="_blank" rel="noopener" href="https://github.com/Ryujinx/Ryujinx">github</a></li>
<li>å°† Ryujinx æ¨¡æ‹Ÿå™¨ä¸»ç¨‹åºè§£å‹åˆ°ã€Œä¸åŒ…å«ä¸­æ–‡çš„è·¯å¾„ã€ä¸‹ã€‚</li>
<li>é¦–æ¬¡å¯åŠ¨ Ryujinx æ¨¡æ‹Ÿå™¨åï¼Œä¼šæç¤ºæ‰¾ä¸åˆ° key æ–‡ä»¶çš„é”™è¯¯<ol>
<li>ç‚¹å‡»èœå• æ–‡ä»¶ (File) â†’ æ‰“å¼€ Ryujinx æ–‡ä»¶å¤¹ (Open Ryujinx Folder)ï¼Œä¼šå¼¹å‡ºæ¨¡æ‹Ÿå™¨æ•°æ®æ‰€åœ¨çš„ç›®å½•ã€‚</li>
<li>å°† <code>prod.keys</code> æ–‡ä»¶æ”¾è¿›åˆ° Ryujinx ç›®å½•ä¸­çš„ <code>system</code> æ–‡ä»¶å¤¹é‡Œï¼Œé‡å¯æ¨¡æ‹Ÿå™¨</li>
</ol>
</li>
<li>æ”¾ç½®å¥½ keys æ–‡ä»¶ä¹‹åå°±å¼€å§‹å®‰è£…å›ºä»¶ (Firmware) äº†ï¼Œ<ol>
<li>ç‚¹å‡»èœå• å·¥å…· (Tools)â†’å®‰è£…å›ºä»¶ (Install Firmware)â†’ä» XCI æˆ– ZIP å®‰è£…å›ºä»¶ (Install a firmware from XCI or ZIP)ï¼Œé€‰æ‹©ä½ ä¸‹è½½åˆ°çš„ Firmware å‹ç¼©åŒ…(ä¸éœ€è§£å‹)ï¼Œ</li>
<li>æ¨¡æ‹Ÿå™¨å°±ä¼šå¼€å§‹å®‰è£…ï¼Œç›´åˆ°æ˜¾ç¤ºå®‰è£…å®Œæˆå³å¯ã€‚</li>
</ol>
</li>
<li>æ­¤æ—¶å·²ç»å¯ä»¥è¿è¡Œ Switch æ¸¸æˆäº†ï¼Œ<ol>
<li>ç‚¹å‡»èœå• é€‰é¡¹ (Options) â†’ è®¾ç½® (Settings)ï¼Œåœ¨ ç”¨æˆ·ç•Œé¢ (General) â†’ æ¸¸æˆç›®å½• (Game Directories) ä¸‹ç‚¹å‡» æ·»åŠ  (Add) æ¥ã€Œæ·»åŠ ä¸€ä¸ªæ¸¸æˆ ROM æ–‡ä»¶å­˜æ”¾ç›®å½•ã€ã€‚</li>
<li>æ­¤åï¼Œæ¨¡æ‹Ÿå™¨ä¼šè‡ªåŠ¨åŠ è½½å‡ºå­˜æ”¾åœ¨è¿™äº›æ–‡ä»¶å¤¹é‡Œçš„æ¸¸æˆåˆ—è¡¨ã€‚</li>
</ol>
</li>
</ol>
<h3 id="å®‰è£…nsp-DLCæ–‡ä»¶"><a href="#å®‰è£…nsp-DLCæ–‡ä»¶" class="headerlink" title="å®‰è£…nsp DLCæ–‡ä»¶"></a>å®‰è£…nsp DLCæ–‡ä»¶</h3><p>ä¸æ˜¯<br><img src="https://pic.shaojiemike.top/img/20221209151137.png"></p>
<p>è€Œæ˜¯<br><img src="https://pic.shaojiemike.top/img/20221209151349.png"></p>
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h3><p><img src="https://pic.shaojiemike.top/img/20221209154239.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20221209154454.png"></p>
<h2 id="YUZU-æŸšå­-æ¨¡æ‹Ÿå™¨"><a href="#YUZU-æŸšå­-æ¨¡æ‹Ÿå™¨" class="headerlink" title="YUZU(æŸšå­)æ¨¡æ‹Ÿå™¨"></a>YUZU(æŸšå­)æ¨¡æ‹Ÿå™¨</h2><p><a target="_blank" rel="noopener" href="https://github.com/yuzu-emu/yuzu-mainline">yuzu</a>ï¼Œå¥¶åˆƒ2å¥½åƒéƒ½æ˜¯ç”¨è¿™ä¸ª</p>
<h3 id="å¯†é’¥ç¼ºå¤±"><a href="#å¯†é’¥ç¼ºå¤±" class="headerlink" title="å¯†é’¥ç¼ºå¤±"></a>å¯†é’¥ç¼ºå¤±</h3><p>å°†ä½ åŸæ¥çš„Useræ–‡ä»¶å¤¹å’ŒROMæ–‡ä»¶å¤¹æ‹–åˆ°æ–°ç‰ˆæ¨¡æ‹Ÿå™¨æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•å³å¯ã€‚</p>
<p>å°† <code>prod.keys</code> æ–‡ä»¶æ”¾åœ¨<code>Yuzu\user\keys</code></p>
<h3 id="æ›´æ–°å¯†é’¥å’Œå›ºä»¶"><a href="#æ›´æ–°å¯†é’¥å’Œå›ºä»¶" class="headerlink" title="æ›´æ–°å¯†é’¥å’Œå›ºä»¶"></a>æ›´æ–°å¯†é’¥å’Œå›ºä»¶</h3><ul>
<li>ä¸‹é¢ä¸¤ä¸ªç›®å½•çš„å†…å®¹éƒ½å¯ä»¥åˆ é™¤ï¼Œç„¶åè§£å‹</li>
<li>keysè§£å‹åˆ°<code>Yuzu\user\keys</code></li>
<li>å›ºä»¶è§£å‹åˆ°<code>Yuzu\user\nand\system\Contents\registered</code></li>
</ul>
<h3 id="YUZUæ¨¡æ‹Ÿå™¨ä½¿ç”¨æ•™ç¨‹"><a href="#YUZUæ¨¡æ‹Ÿå™¨ä½¿ç”¨æ•™ç¨‹" class="headerlink" title="YUZUæ¨¡æ‹Ÿå™¨ä½¿ç”¨æ•™ç¨‹"></a>YUZUæ¨¡æ‹Ÿå™¨ä½¿ç”¨æ•™ç¨‹</h3><p><a target="_blank" rel="noopener" href="https://www.playdanji.com/yuzu">https://www.playdanji.com/yuzu</a></p>
<h3 id="YUZUé‡‘æ‰‹æŒ‡"><a href="#YUZUé‡‘æ‰‹æŒ‡" class="headerlink" title="YUZUé‡‘æ‰‹æŒ‡"></a>YUZUé‡‘æ‰‹æŒ‡</h3><p><a target="_blank" rel="noopener" href="https://www.playdanji.com/yuzujinshouzhi">https://www.playdanji.com/yuzujinshouzhi</a></p>
<h3 id="YUZUè½¯ä»¶å‡çº§æ–¹æ³•"><a href="#YUZUè½¯ä»¶å‡çº§æ–¹æ³•" class="headerlink" title="YUZUè½¯ä»¶å‡çº§æ–¹æ³•"></a>YUZUè½¯ä»¶å‡çº§æ–¹æ³•</h3><p>Early Accessç‰ˆæœ¬æ˜¯éœ€è¦èŠ±é’±è®¢é˜…æ‰èƒ½ä¸‹è½½çš„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/yuzu-emu/yuzu-mainline">github</a>çš„releaseç›´æ¥ä¸‹è½½zipåè§£å‹æ›¿æ¢å³å¯ã€‚</p>
<h3 id="YUZUå­˜æ¡£ä½ç½®"><a href="#YUZUå­˜æ¡£ä½ç½®" class="headerlink" title="YUZUå­˜æ¡£ä½ç½®"></a>YUZUå­˜æ¡£ä½ç½®</h3><p>æ¸¸æˆå³é”®ï¼Œæ‰“å¼€å­˜æ¡£ä½ç½®ã€‚</p>
<h3 id="é€€å‡ºå…¨å±"><a href="#é€€å‡ºå…¨å±" class="headerlink" title="é€€å‡ºå…¨å±"></a>é€€å‡ºå…¨å±</h3><p>F11</p>
<h3 id="YUZU-å®‰è£…-nspå’Œxciæ–‡ä»¶"><a href="#YUZU-å®‰è£…-nspå’Œxciæ–‡ä»¶" class="headerlink" title="YUZU å®‰è£… nspå’Œxciæ–‡ä»¶"></a>YUZU å®‰è£… nspå’Œxciæ–‡ä»¶</h3><p>keyå’Œä¸­æ–‡çš„é—®é¢˜ï¼Œå»ºè®®ç”¨ä¹‹å‰å¥½çš„æ–‡ä»¶</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/406048136">https://zhuanlan.zhihu.com/p/406048136</a></p>
<h3 id="å®‰è£…å‡çº§è¡¥ä¸nspæ–‡ä»¶å’ŒDLC"><a href="#å®‰è£…å‡çº§è¡¥ä¸nspæ–‡ä»¶å’ŒDLC" class="headerlink" title="å®‰è£…å‡çº§è¡¥ä¸nspæ–‡ä»¶å’ŒDLC"></a>å®‰è£…å‡çº§è¡¥ä¸nspæ–‡ä»¶å’ŒDLC</h3><p><a target="_blank" rel="noopener" href="https://jingyan.baidu.com/article/39810a23e2ce82f737fda63d.html">å¯¼å…¥NANDæ–‡ä»¶å³å¯</a></p>
<h2 id="å¼‚åº¦ä¹‹åˆƒ2"><a href="#å¼‚åº¦ä¹‹åˆƒ2" class="headerlink" title="å¼‚åº¦ä¹‹åˆƒ2"></a>å¼‚åº¦ä¹‹åˆƒ2</h2><h3 id="æ‰“åŒ…æœ¬ä½“1"><a href="#æ‰“åŒ…æœ¬ä½“1" class="headerlink" title="æ‰“åŒ…æœ¬ä½“1"></a>æ‰“åŒ…æœ¬ä½“1</h3><p>30å¸§720P</p>
<p><a target="_blank" rel="noopener" href="https://switch520.com/23050.html">https://switch520.com/23050.html</a></p>
<h3 id="æ¨èOpenGLæ¨¡å¼"><a href="#æ¨èOpenGLæ¨¡å¼" class="headerlink" title="æ¨èOpenGLæ¨¡å¼"></a>æ¨èOpenGLæ¨¡å¼</h3><p>væ¨¡å¼ï¼Œæš—åœºæ™¯ä¼šè¿‡æ›ã€‚</p>
<h3 id="ç”»è´¨è¡¥ä¸"><a href="#ç”»è´¨è¡¥ä¸" class="headerlink" title="ç”»è´¨è¡¥ä¸"></a>ç”»è´¨è¡¥ä¸</h3><p><a target="_blank" rel="noopener" href="https://tieba.baidu.com/p/6733982266">è´´å§è€å“¥çš„</a>æ”¾å…¥ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\gamePojie\NaiRen2\A3285 v2.0.2_yuzuEA2077\user\sdmc\atmosphere\contents</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ²¡ä»€ä¹ˆç”¨ã€‚</p>
<p>inié…ç½®åŸç†æ˜¯ï¼Œå¦‚ä¸‹å›¾<strong>å¯¹åº”</strong>é…ç½®ç›®å½•<br><img src="https://pic.shaojiemike.top/img/20220620165029.png"></p>
<p>æ”¾å…¥å¦‚ä¸‹ä¿®æ”¹çš„iniæ–‡ä»¶æ¥ä¿®æ”¹ç”»è´¨</p>
<p><img src="https://pic.shaojiemike.top/img/20220620165155.png"></p>
<p>å¦‚ä¸‹å›¾æˆåŠŸ</p>
<p><img src="https://pic.shaojiemike.top/img/20220620165322.png"></p>
<p><a target="_blank" rel="noopener" href="https://tieba.baidu.com/p/7459891171">è´´å§10æ¥¼</a>ï¼šåˆšè¯•äº†ä¸‹ï¼Œæˆ‘æŠŠå±æ€§çš„modé€‰é¡¹å…³æ‰ï¼Œç„¶åæŠŠ0100F3400332C000çš„ç”»è´¨modåˆ æ‰ï¼Œæ•ˆæœä¸€æ ·æœ‰ï¼Œæ‰€ä»¥æ•ˆæœåº”è¯¥åªèƒ½åœ¨0100F3400332D001\ç”»è´¨mod\romfs\monolib\shaderä¸‹çš„lib_nx.inié‡Œæ”¹ï¼Œå…¶ä»–çš„éƒ½æ²¡ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">red_sclX=2.0</span><br><span class="line">red_sclY=2.0</span><br><span class="line">red_hdsclX=2.0</span><br><span class="line">red_hdsclY=2.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">red_Auto=on</span><br><span class="line">red_AtMaxX=2.0</span><br><span class="line">red_AtMaxY=2.0</span><br><span class="line">red_AtMinX=2.0</span><br><span class="line">red_AtMinY=2.0</span><br><span class="line">red_AtRate=100.0</span><br></pre></td></tr></table></figure>

<p>2.0å°±æ˜¯1440pï¼Œ1.0å°±æ˜¯åŸç‰ˆ720pã€‚ä½ ä»¬å¯ä»¥è¯•è¯•æ”¹å…¶ä»–çš„</p>
<h3 id="å¸§æ•°è¡¥ä¸"><a href="#å¸§æ•°è¡¥ä¸" class="headerlink" title="å¸§æ•°è¡¥ä¸"></a>å¸§æ•°è¡¥ä¸</h3><p>60å¸§è¡¥ä¸å®é™…æ•ˆæœè¿œæ²¡æœ‰60å¸§è€Œä¸”ä¸€å †å‰¯ä½œç”¨ï¼Œä¸ç”¨æµªè´¹æ—¶é—´äº†</p>
<h3 id="bugèŠ±å±"><a href="#bugèŠ±å±" class="headerlink" title="bugèŠ±å±"></a>bugèŠ±å±</h3><p>æŒ‰ç…§<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1h3411L7ay?spm_id_from=333.851.header_right.fav_list.click&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3">Bç«™è®¾ç½®</a>ï¼Œä¸»è¦æ”¹äº†GLSL</p>
<p><img src="https://pic.shaojiemike.top/img/20220622072520.png"></p>
<h2 id="å¡å°”è¾¾-æ—·é‡ä¹‹æ¯"><a href="#å¡å°”è¾¾-æ—·é‡ä¹‹æ¯" class="headerlink" title="å¡å°”è¾¾-æ—·é‡ä¹‹æ¯"></a>å¡å°”è¾¾-æ—·é‡ä¹‹æ¯</h2><p>æ¸¸ä¾ è®ºå›çš„cemuæ¨¡æ‹Ÿçš„æ•ˆæœå°±ä¸é”™</p>
<h2 id="å¡å°”è¾¾-ç‹å›½ä¹‹æ³ª"><a href="#å¡å°”è¾¾-ç‹å›½ä¹‹æ³ª" class="headerlink" title="å¡å°”è¾¾-ç‹å›½ä¹‹æ³ª"></a>å¡å°”è¾¾-ç‹å›½ä¹‹æ³ª</h2><ul>
<li>yuzu 1414ä»¥ä¸Š</li>
<li>keys firmware 16.0.2ä»¥ä¸Š</li>
</ul>
<p>é¾™ç¥æ¨¡æ‹Ÿå™¨ï¼Œä¼šç»å¸¸é—ªé€€ï¼Œæš‚æ—¶ä¸çŸ¥é“è§£å†³åŠæ³•(Cache PPTC rebuild?)ã€‚yuzuæ²¡æœ‰é—ªé€€çš„é—®é¢˜<br><img src="https://pic.shaojiemike.top/img/20230512210628.png"></p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><p>ä¹‹å‰ä¹°äº†æ­£ç‰ˆçš„switchï¼Œæ¸¸æˆä¹Ÿå…¥äº†ä¸¤ä¸‰åƒã€‚æ—·&#x2F;è’é‡ä¹‹æ¯ï¼Œå¥¥å¾·èµ›ï¼Œå¥¶åˆƒ2éƒ½é€šå…³äº†ã€‚å¯æƒœè¢«å¦ˆå¦ˆæ²¡æ”¶äº†~</p>
<p>æƒ³ç ”ç©¶ä¸€ä¸‹ï¼ŒPCæ¨¡æ‹Ÿï¼Œè®°å½•è¸©å‘è¿‡ç¨‹</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.066Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">23 minutes read (About 3401 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/network/Protocol/BT/">BitTorrent</a></p><div class="content"><h2 id="BTç®€è¿°"><a href="#BTç®€è¿°" class="headerlink" title="BTç®€è¿°"></a>BTç®€è¿°</h2><p>BitTorrent (ç®€ç§° BT) åè®®æ˜¯å’Œç‚¹å¯¹ç‚¹ï¼ˆpoint-to-pointï¼‰çš„åè®®ç¨‹åºä¸åŒï¼Œå®ƒæ˜¯ç”¨æˆ·ç¾¤å¯¹ç”¨æˆ·ç¾¤ï¼ˆpeer-to-peer, æˆ–ç®€å†™ä¸º P2P) ä¼ è¾“åè®®, å®ƒè¢«è®¾è®¡ç”¨æ¥é«˜æ•ˆåœ°åˆ†å‘æ–‡ä»¶ (å°¤å…¶æ˜¯å¯¹äºå¤§æ–‡ä»¶ã€å¤šäººåŒæ—¶ä¸‹è½½æ—¶æ•ˆç‡éå¸¸é«˜)ã€‚è¯¥åè®®åŸºäºHTTPåè®®ï¼Œå±äºTCP&#x2F;IPåº”ç”¨å±‚ã€‚</p>
<p>å°†æ–‡ä»¶åˆ’åˆ†æˆå¤šå—(é»˜è®¤256Kbä¸€å—)ï¼Œæ¯å—å¯ä»¥ä»ç½‘ç»œä¸­ä¸åŒçš„ç”¨æˆ·çš„BTå®¢æˆ·ç«¯å¤„å¹¶è¡Œä¸‹è½½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BT ä¸‹è½½çš„æ–‡ä»¶éƒ½æ˜¯åˆ«äººä¸Šä¼ ç»™ä½ çš„ã€‚</span><br><span class="line">BT ä¸‹è½½é€Ÿåº¦å‡æ¥è‡ªå…¶ä»–ä¸‹è½½åŒä¸€èµ„æºçš„ç”¨æˆ·ä¸Šä¼ é€Ÿåº¦ã€‚</span><br><span class="line">ä¸Šä¼ çš„ç”¨æˆ·è¶Šå¤šï¼Œä½ çš„ä¸‹è½½é€Ÿåº¦è¶Šå¿«ï¼Œç›¸åæ²¡ç”¨æˆ·ä¸Šä¼ ä½ å°±æ²¡æœ‰ä¸‹è½½é€Ÿåº¦ã€‚</span><br></pre></td></tr></table></figure>

<p>æ¯”ç‰¹å½—æ˜Ÿï¼ŒåŒ…æ‹¬å…¶ä»– BT è½¯ä»¶ï¼ˆè¿…é›·é™¤å¤–ï¼Œè¿…é›·ä¸æ˜¯ä¼šå‘˜ä¼šé™é€Ÿï¼Œé«˜é€Ÿé€šé“ä¸‹è½½æé«˜çš„é€Ÿåº¦ä¸€éƒ¨åˆ†å°±æ˜¯æ¥è§¦é™é€Ÿåè·å¾—çš„ï¼‰éƒ½ä¸ä¼šé™åˆ¶ä¸‹è½½é€Ÿåº¦ã€‚</p>
<h3 id="BTåˆ†äº«è§„åˆ™"><a href="#BTåˆ†äº«è§„åˆ™" class="headerlink" title="BTåˆ†äº«è§„åˆ™"></a>BTåˆ†äº«è§„åˆ™</h3><p>ä¸è¿…é›·ä¸åŒï¼ŒBTæ—¨åœ¨â€œäººäººä¸ºæˆ‘ï¼Œæˆ‘ä¸ºäººäººâ€ã€‚ç”¨æˆ·å’Œç”¨æˆ·ä¹‹é—´å¯¹ç­‰äº¤æ¢è‡ªå·±æ‰‹ä¸­å·²æœ‰çš„èµ„æºã€‚å¦‚æœä»»ä½•ä¸€æ–¹è¯•å›¾ç™½å«–å¦å¤–ä¸€æ–¹çš„èµ„æºï¼Œè€Œè‡ªå·±ä¸æ„¿æ„ä¸Šä¼ è‡ªå·±çš„èµ„æºï¼Œé‚£ä¹ˆé‚£æ–¹å°±ä¼šè¢«äººè§†ä½œå¸è¡€è€…è€Œè¢«è¸¢å‡ºè¿™ä¸ªäº¤æ¢ï¼Œä¸‹åœºæ˜¯æ²¡æœ‰äººä¼šæ„¿æ„å’Œä½ äº¤æ¢æ•°æ®ï¼Œä½ çš„ä¸‹è½½é€Ÿåº¦ä¹Ÿå°±å½’é›¶ã€‚</p>
<p>å¦‚æœæŠŠä¸Šä¼ é€Ÿåº¦é™åˆ¶ä¸ºäº†10KB&#x2F;sï¼Œ10KB&#x2F;sæ˜¯BitCometä¸Šä¼ æœ€ä½é™é€Ÿï¼Œå¾ˆå¤§æ—¶å€™å°±è¿™10KBä¼šè¢«åŒ…å«DHTæŸ¥è¯¢ã€å‘TrackeræœåŠ¡å™¨æ³¨å†Œï¼Œè¿æ¥ç”¨æˆ·æ‰€äº§ç”Ÿçš„ä¸Šä¼ å…¨éƒ¨å æ»¡ã€‚åœ¨ä¸‹è½½ç§å­çš„æ—¶å€™ï¼Œå…¶ä»–ç”¨æˆ·è¿ä¸Šä½ æ˜¯åªèƒ½æ‹¿åˆ°1ï½2KB&#x2F;sç”šè‡³ä¸€ç‚¹éƒ½æ²¡æœ‰çš„ã€‚</p>
<p>ç°åœ¨çš„BTä¸‹è½½å®¢æˆ·ç«¯éƒ½å¯ä»¥åšåˆ°æ™ºèƒ½åå¸è¡€ï¼Œæ‰€ä»¥åŸºæœ¬æƒ³å’Œäº¤æ¢æ•°æ®çš„ç”¨æˆ·éƒ½æŠŠä½ å½“ä½œLeecherï¼ˆå¸è¡€é¬¼ï¼‰Banï¼ˆå°ç¦ï¼‰å¤„ç†äº†ï¼Œæ•…æ²¡æœ‰ä¸‹è½½é€Ÿåº¦ä¸è¶³ä¸ºå¥‡ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåªè¦é¢„ç•™50KB&#x2F;sçš„ä¸Šä¼ ç»™å…¶ä»–ç½‘é¡µæµè§ˆã€èŠå¤©å°±å¯ä»¥äº†ï¼Œåœ¨ä¸‹è½½æ—¶åº”è¯¥å°½é‡æŠŠä¸Šä¼ ç•™ç»™é‚£äº›å’Œä½ äº¤æ¢èµ„æºçš„ç”¨æˆ·ï¼Œè¿™æ ·æ‰ä¸ä¼šè¢«ä»–ä»¬è§†ä½œä½ åœ¨å¸è¡€è¿›è€Œå±è”½ä½ ã€‚</p>
<p>å¦‚æœä¸Šä¼ ä¸è¶³ï¼Œå°±åº”è¯¥ä¸»åŠ¨é™åˆ¶è‡ªå·±çš„ä¸‹è½½é€Ÿåº¦ï¼Œå¦åˆ™å•ä½æ—¶é—´ä¸‹è½½é‡è¿œè¶…è¿‡ä¸Šä¼ é‡åè€Œä¼šé­æ¥æ›´å¤šçš„å±è”½ï¼Œå¯¹ä¸‹è½½é€Ÿåº¦æå‡æ›´åŠ ä¸åˆ©ã€‚</p>
<h3 id="BTåŸºæœ¬æµç¨‹"><a href="#BTåŸºæœ¬æµç¨‹" class="headerlink" title="BTåŸºæœ¬æµç¨‹"></a>BTåŸºæœ¬æµç¨‹</h3><p><code>.torrent</code> ç§å­æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯æ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«Trackerä¿¡æ¯å’Œæ–‡ä»¶ä¿¡æ¯ä¸¤éƒ¨åˆ†ã€‚Trackerä¿¡æ¯ä¸»è¦æ˜¯BTä¸‹è½½ä¸­éœ€è¦ç”¨åˆ°çš„TrackeræœåŠ¡å™¨çš„åœ°å€å’Œé’ˆå¯¹TrackeræœåŠ¡å™¨çš„è®¾ç½®ã€‚</p>
<ol>
<li>ä¸‹è½½æ—¶ï¼ŒBTå®¢æˆ·ç«¯é¦–å…ˆè§£æç§å­æ–‡ä»¶å¾—åˆ°Trackeråœ°å€ï¼Œç„¶åè¿æ¥TrackeræœåŠ¡å™¨ã€‚</li>
<li>TrackeræœåŠ¡å™¨å›åº”ä¸‹è½½è€…çš„è¯·æ±‚ï¼Œæä¾›ä¸‹è½½è€…å…¶ä»–ä¸‹è½½è€…ï¼ˆåŒ…æ‹¬å‘å¸ƒè€…ï¼‰çš„IPã€‚</li>
<li>ä¸‹è½½è€…å†è¿æ¥å…¶ä»–ä¸‹è½½è€…ï¼Œæ ¹æ®ç§å­æ–‡ä»¶ï¼Œä¸¤è€…åˆ†åˆ«å‘ŠçŸ¥å¯¹æ–¹è‡ªå·±å·²ç»æœ‰çš„å—ï¼Œç„¶åäº¤æ¢å¯¹æ–¹æ‰€æ²¡æœ‰çš„æ•°æ®ã€‚<ol>
<li>æ­¤æ—¶ä¸éœ€è¦å…¶ä»–æœåŠ¡å™¨å‚ä¸ï¼Œåˆ†æ•£äº†å•ä¸ªçº¿è·¯ä¸Šçš„æ•°æ®æµé‡ï¼Œå› æ­¤å‡è½»äº†æœåŠ¡å™¨è´Ÿæ‹…ã€‚</li>
</ol>
</li>
<li>ä¸‹è½½è€…æ¯å¾—åˆ°ä¸€ä¸ªå—ï¼Œéœ€è¦ç®—å‡ºä¸‹è½½å—çš„HashéªŒè¯ç ä¸ç§å­æ–‡ä»¶ä¸­çš„å¯¹æ¯”ï¼Œå¦‚æœä¸€æ ·åˆ™è¯´æ˜å—æ­£ç¡®ï¼Œä¸ä¸€æ ·åˆ™éœ€è¦é‡æ–°ä¸‹è½½è¿™ä¸ªå—ã€‚è¿™ç§è§„å®šæ˜¯ä¸ºäº†è§£å†³ä¸‹è½½å†…å®¹å‡†ç¡®æ€§çš„é—®é¢˜ã€‚</li>
</ol>
<h2 id="å¸¸è§„éƒ¨ç½²"><a href="#å¸¸è§„éƒ¨ç½²" class="headerlink" title="å¸¸è§„éƒ¨ç½²"></a>å¸¸è§„éƒ¨ç½²</h2><ul>
<li>å®‰è£…<a target="_blank" rel="noopener" href="https://manpages.ubuntu.com/manpages/jammy/man1/qbittorrent-nox.1.html">qBittorrent-nox</a>, tmuxä¸‹è¿è¡Œï¼Œåœ¨8080ç«¯å£æŒ‚è½½WebUI</li>
<li>å®‰è£…qbittorrent, ç”¨æˆ·è¿è¡Œqbittorrent, x11å¼¹å‡ºåº”ç”¨çª—å£<ul>
<li>é—®é¢˜ï¼š<ul>
<li>æ€ä¹ˆç»´æŒçª—å£ï¼Ÿ<code>sudo XAUTHORITY=/home/qcjiang/.Xauthority qbittorrent</code></li>
<li>å…³äºå†™æ–‡ä»¶æƒé™ï¼Œå¦‚ä½•å†™ç½‘ç»œç¡¬ç›˜</li>
<li>node5 ä¸Šä¼ å¾ˆå¿«, ç½‘ç»œåŸå› ï¼Ÿç§å­åŸå› ï¼Ÿ(ä¸æ˜¯ï¼Œæ˜¯å› ä¸ºç½‘ç»œç¡¬ç›˜ï¼Œæ‰€ä»¥ä¸‹è½½å¤šå°‘è¦å ç”¨å¤šå°‘ä¸Šä¼ )</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="dockeréƒ¨ç½²"><a href="#dockeréƒ¨ç½²" class="headerlink" title="dockeréƒ¨ç½²"></a>dockeréƒ¨ç½²</h2><p>ä»¥qBitçš„dockerä¸ºä¾‹ï¼Œå‚è€ƒ<a target="_blank" rel="noopener" href="https://hub.docker.com/r/linuxserver/qbittorrent/#!">linuxsever</a>çš„docker-composeå¦‚ä¸‹ï¼š(qBitç›¸å¯¹äºTransmissionæœ‰å¤šçº¿ç¨‹IOçš„ä¼˜åŠ¿) ä¹Ÿå¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/SuperNG6/Docker-qBittorrent">å…¶ä½™dockeré•œåƒ</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">version: &quot;2.1&quot;</span><br><span class="line">services:</span><br><span class="line">  qbittorrent:</span><br><span class="line">    image: lscr.io/linuxserver/qbittorrent:latest</span><br><span class="line">    container_name: qbittorrent</span><br><span class="line">    environment:</span><br><span class="line">      - PUID=0 # è¿™é‡Œæ˜¯root å¦‚æœæƒ³ä»¥å…¶ä»–ç”¨æˆ¶Aä¿®æ”¹æ–‡ä»¶ï¼Œå¯ä»¥æ”¹æˆå…¶ä»–ç”¨æˆ·çš„UIDã€‚é€šéid A æŸ¥çœ‹</span><br><span class="line">      - PGID=0</span><br><span class="line">      - TZ=Etc/UTC</span><br><span class="line">      - WEBUI_PORT=8080</span><br><span class="line">    volumes:</span><br><span class="line">      - /addDisk/DiskNo4/qBit:/config</span><br><span class="line">      - /addDisk/DiskNo4/bt:/downloads</span><br><span class="line"></span><br><span class="line">    network_mode: host</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤è´¦å· <code>admin</code> é»˜è®¤å¯†ç  <code>adminadmin</code><br>ç„¶åé€šè¿‡webUI <code>http://222.195.72.218:8080/</code>ç®¡ç†ã€‚</p>
<p>å¦‚æœä¸æƒ³ç½‘ç»œé€šè¿‡wireguardï¼Œè€Œæ˜¯æœ¬åœ°å¯ä»¥å¦‚ä¸‹è®¾ç½®<br><img src="https://pic.shaojiemike.top/img/20230314193709.png"></p>
<h3 id="åŒä¸€å°æœºå™¨å®ç°ä¸¤ä¸ªè´¦å·åšç§"><a href="#åŒä¸€å°æœºå™¨å®ç°ä¸¤ä¸ªè´¦å·åšç§" class="headerlink" title="åŒä¸€å°æœºå™¨å®ç°ä¸¤ä¸ªè´¦å·åšç§"></a>åŒä¸€å°æœºå™¨å®ç°ä¸¤ä¸ªè´¦å·åšç§</h3><ul>
<li>æ€è·¯ï¼šä¸¤ä¸ªdockerï¼ŒåŒä¸€ä¸ªç½‘ç»œå‡ºå£</li>
<li>å•é¡Œï¼š<ul>
<li>qBitè¦æœ‰æƒé™å†™æ–‡ä»¶</li>
<li>ä¸¤ä¸ªdockerå…¼å®¹æ€§ï¼š<ul>
<li>WebUIæœ‰bugï¼Œä¸ä¸€å®šä¼šæ˜¾ç¤ºã€‚é‡å¯åˆ·æ–°å³å¯</li>
<li>å…¶æ¬¡æœ‰ä¸€ä¸ªdockerä¼šæ²¡æœ‰ç½‘ç»œã€‚<ul>
<li>è¿™æ˜¯ç”±äºç«¯å£éšæœºé”™è¯¯å¯¼è‡´çš„ï¼Œä¼šå¯¼è‡´ä¸‹é¢è¿æ¥çŠ¶æ€æ˜¾ç¤ºç«ç„°ã€‚æ¢ç«¯å£åˆ·æ–°å³å¯è§£å†³ã€‚</li>
<li><img src="https://pic.shaojiemike.top/img/20230512090749.png"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å…³äºå°å·<ul>
<li>ç”±äºå›½å†…ç¯å¢ƒä¸‹è½½ä¸€èˆ¬éƒ½æ˜¯å¤§å†…ç½‘ã€‚åŒä¸€ä¸ªç½‘ç»œå‡ºå»åº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚</li>
<li>å¤§å¤šæ•°åšç§æ˜¯é€šè¿‡ipv6ï¼Œä¼šè¢«æ£€æµ‹å‡ºåŒä¸€ä¸ªæœºå™¨å¤šä¸ªè´¦æˆ·åšç§ï¼Œå¯¼è‡´å°å·</li>
<li>è¿˜æœ‰å…³äºç›’å­åˆ·ä¸Šä¼ ï¼Œä¸€æ–¹é¢é€šè¿‡é€Ÿåº¦ï¼Œå¦ä¸€æ–¹é¢ç”±äºç›’å­çš„ipæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ä¼šè¢«æ£€æµ‹å‡ºé‡å¤å¯¼è‡´å°å·ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æµ‹é€Ÿ"><a href="#æµ‹é€Ÿ" class="headerlink" title="æµ‹é€Ÿ"></a>æµ‹é€Ÿ</h2><ol>
<li>å…ˆç”¨ <a target="_blank" rel="noopener" href="https://www.speedtest.net/">https://www.speedtest.net</a> æµ‹é€Ÿ<ol>
<li><img src="https://pic.shaojiemike.top/img/20221117082208.png"></li>
</ol>
</li>
<li>è€ƒè™‘çƒ­é—¨ç§å­æµ‹è¯• <a target="_blank" rel="noopener" href="http://releases.ubuntu.com/19.10/ubuntu-19.10-desktop-amd64.iso.torrent">http://releases.ubuntu.com/19.10/ubuntu-19.10-desktop-amd64.iso.torrent</a><ol>
<li><img src="https://pic.shaojiemike.top/img/20221117084350.png"></li>
<li>æ²¡é€šè¿‡ä»£ç†èƒ½æ‰¾åˆ°çš„ç”¨æˆ·å˜å°‘ï¼Œé€Ÿåº¦ä¹Ÿå˜æ…¢äº†ã€‚</li>
</ol>
</li>
<li>å¦‚æœè·‘ä¸åˆ°ç½‘ç»œä¸Šé™ï¼Œå¯èƒ½å’Œ<a target="_blank" rel="noopener" href="https://www.cometbbs.com/t/%E8%A2%AB%E9%99%90%E9%80%9F%E5%9C%A8109mbs/34309/13">è½¯ä»¶è®¾ç½®æœ‰å…³</a></li>
</ol>
<h2 id="ä¸Šä¼ é€Ÿåº¦"><a href="#ä¸Šä¼ é€Ÿåº¦" class="headerlink" title="ä¸Šä¼ é€Ÿåº¦"></a>ä¸Šä¼ é€Ÿåº¦</h2><p>mç«™åˆ·ä¸Šä¼ çš„æ—¶å€™ï¼Œå‘ç°åŸºæœ¬éƒ½æ˜¯å¯¹æ–¹åŸºæœ¬éƒ½æ˜¯é€šè¿‡ipv6ä¸‹è½½<br><img src="https://pic.shaojiemike.top/img/Snipaste_2023-03-06_18-17-07.png"><br>uTPæ˜¯ä¸€ç§åŸºäºUDPçš„åè®®ï¼Œå®ƒå¯ä»¥æ ¹æ®ç½‘ç»œæ‹¥å¡æƒ…å†µè‡ªåŠ¨è°ƒèŠ‚ä¼ è¾“é€Ÿåº¦ï¼Œä»è€Œå‡å°‘å¯¹å…¶ä»–ç½‘ç»œåº”ç”¨çš„å½±å“ã€‚</p>
<p>BTè¿æ¥æ˜¯ä¸€ç§åŸºäºTCPçš„åè®®ï¼Œå®ƒå¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œå¯é æ€§ï¼Œä½†æ˜¯å¯èƒ½ä¼šå ç”¨è¾ƒå¤šçš„ç½‘ç»œå¸¦å®½å’Œèµ„æºã€‚</p>
<p>åœ¨qBittorrentä¸­ï¼Œæ ‡å¿—U K E Påˆ†åˆ«è¡¨ç¤ºä»¥ä¸‹å«ä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Uï¼šè¡¨ç¤ºä½ æ­£åœ¨ä¸Šä¼ æ•°æ®ç»™å¯¹æ–¹ï¼Œæˆ–è€…å¯¹æ–¹æ­£åœ¨ä»ä½ é‚£é‡Œä¸‹è½½æ•°æ®ã€‚</span><br><span class="line">Kï¼šè¡¨ç¤ºå¯¹æ–¹æ”¯æŒuTPåè®®ï¼Œå³åŸºäºUDPçš„ä¼ è¾“åè®®ã€‚</span><br><span class="line">Eï¼šè¡¨ç¤ºå¯¹æ–¹ä½¿ç”¨äº†åŠ å¯†è¿æ¥ï¼Œå³é€šè¿‡åŠ å¯†ç®—æ³•ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ã€‚</span><br><span class="line">Pï¼šè¡¨ç¤ºå¯¹æ–¹ä½¿ç”¨äº†ä»£ç†æœåŠ¡å™¨æˆ–VPNæœåŠ¡ï¼Œå³é€šè¿‡ç¬¬ä¸‰æ–¹ç½‘ç»œéšè—è‡ªå·±çš„çœŸå®IPåœ°å€ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="PTè®¾ç½®"><a href="#PTè®¾ç½®" class="headerlink" title="PTè®¾ç½®"></a>PTè®¾ç½®</h2><ul>
<li>è™½ç„¶è¯´PTä¸‹è½½ï¼Œå®¢æˆ·ç«¯è¦å…³é—­DHT,PeX, LSDã€‚</li>
<li>ä½†æ˜¯å…¶å®ç§å­æ˜¯é»˜è®¤å…³é—­çš„ï¼Œæ— åºé¢å¤–è®¾ç½®ï¼ŒåŒ—æ´‹å’ŒMç«™ä¸€æ ·ã€‚</li>
<li><img src="https://pic.shaojiemike.top/img/20230512091246.png"></li>
</ul>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="Tracker"><a href="#Tracker" class="headerlink" title="Tracker"></a>Tracker</h3><p>æ”¶é›†ä¸‹è½½è€…ä¿¡æ¯çš„æœåŠ¡å™¨ï¼Œå¹¶å°†æ­¤ä¿¡æ¯æä¾›ç»™å…¶ä»–ä¸‹è½½è€…ï¼Œä½¿ä¸‹è½½è€…ä»¬ç›¸äº’è¿æ¥èµ·æ¥ï¼Œä¼ è¾“æ•°æ®ã€‚</p>
<h3 id="ç§å­"><a href="#ç§å­" class="headerlink" title="ç§å­"></a>ç§å­</h3><p>æŒ‡ä¸€ä¸ªä¸‹è½½ä»»åŠ¡ä¸­æ‰€æœ‰æ–‡ä»¶éƒ½è¢«æŸä¸‹è½½è€…<strong>å®Œæ•´</strong>çš„ä¸‹è½½ï¼Œæ­¤æ—¶ä¸‹è½½è€…æˆä¸ºä¸€ä¸ªç§å­ã€‚å‘å¸ƒè€…æœ¬èº«å‘å¸ƒçš„æ–‡ä»¶å°±æ˜¯åŸå§‹ç§å­ã€‚</p>
<h3 id="åšç§"><a href="#åšç§" class="headerlink" title="åšç§"></a>åšç§</h3><p>å‘å¸ƒè€…æä¾›ä¸‹è½½ä»»åŠ¡çš„<strong>å…¨éƒ¨</strong>å†…å®¹çš„è¡Œä¸ºï¼›ä¸‹è½½è€…ä¸‹è½½å®Œæˆåç»§ç»­æä¾›ç»™ä»–äººä¸‹è½½çš„è¡Œä¸ºã€‚</p>
<h3 id="åˆ†äº«ç‡"><a href="#åˆ†äº«ç‡" class="headerlink" title="åˆ†äº«ç‡"></a>åˆ†äº«ç‡</h3><p>ä¸Šå‚³è³‡æ–™é‡ &#x2F; ä¸‹å‚³è³‡æ–™é‡çš„æ¯”ç‡,æ˜¯ä¸€ç¨®BTçš„è‰¯å¿ƒåº¦,æ²’å¯¦éš›ä½œç”¨.(ä¸€èˆ¬ä¸ºäº†è‰¯å¿ƒï¼Œè‡³å°‘å¤§äº1)</p>
<h3 id="é•¿æœŸç§å­"><a href="#é•¿æœŸç§å­" class="headerlink" title="é•¿æœŸç§å­"></a>é•¿æœŸç§å­</h3><p>BitCometçš„æ¦‚å¿µï¼Œç›¸å¯¹äºç§å­ä»»åŠ¡çš„ä¸Šä¼ èƒ½å¤Ÿæ§åˆ¶ã€‚</p>
<p>é•¿æ•ˆç§å­å°±æ˜¯ä½ <strong>ä¸å¼€å¯</strong>ä»»åŠ¡åšç§ï¼Œåªè¦ä½ å¯åŠ¨äº†æ¯”ç‰¹å½—æ˜Ÿï¼Œè½¯ä»¶æŒ‚åå°ï¼Œå½“æœ‰å…¶ä»–ç”¨æˆ·ä¹Ÿæ˜¯ç”¨æ¯”ç‰¹å½—æ˜Ÿä¸‹è½½ä½ åˆ—è¡¨é‡Œçš„å­˜åœ¨çš„æ–‡ä»¶æ—¶å€™å°±ä¼šè¢«è®¤ä¸ºæ˜¯é•¿æ•ˆç§å­ ã€‚</p>
<h3 id="DHT"><a href="#DHT" class="headerlink" title="DHT"></a>DHT</h3><p>.DHTå…¨ç§°å«åˆ†å¸ƒå¼å“ˆå¸Œè¡¨(Distributed Hash Table)ï¼Œæ˜¯ä¸€ç§åˆ†å¸ƒå¼å­˜å‚¨æ–¹æ³•ã€‚åœ¨ä¸éœ€è¦æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è´Ÿè´£ä¸€ä¸ªå°èŒƒå›´çš„è·¯ç”±ï¼Œå¹¶è´Ÿè´£å­˜å‚¨ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œä»è€Œå®ç°æ•´ä¸ªDHTç½‘ç»œçš„å¯»å€å’Œå­˜å‚¨ã€‚æ–°ç‰ˆBitCometå…è®¸åŒè¡Œè¿æ¥DHTç½‘ç»œå’ŒTrackerï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®Œå…¨ä¸è¿ä¸ŠTrackeræœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„ä¸‹è½½ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨DHTç½‘ç»œä¸­å¯»æ‰¾ä¸‹è½½åŒä¸€æ–‡ä»¶çš„å…¶ä»–ç”¨æˆ·ã€‚</p>
<p>ç±»ä¼¼Trackerçš„æ ¹æ®ç§å­ç‰¹å¾ç è¿”å›ç§å­ä¿¡æ¯çš„ç½‘ç»œã€‚</p>
<p>åœ¨BitCometä¸­ï¼Œæ— é¡»ä½œä»»ä½•è®¾ç½®å³å¯è‡ªåŠ¨è¿æ¥å¹¶ä½¿ç”¨DHTç½‘ç»œï¼Œå®Œå…¨ä¸éœ€è¦ç”¨æˆ·å¹²é¢„ã€‚</p>
<h3 id="ç”¨æˆ·äº¤æ¢Pex"><a href="#ç”¨æˆ·äº¤æ¢Pex" class="headerlink" title="ç”¨æˆ·äº¤æ¢Pex"></a>ç”¨æˆ·äº¤æ¢Pex</h3><p>Peer Exchange (PEX)ï¼Œ æ¯ä¸ªpeerå®¢æˆ·ç«¯çš„ç”¨æˆ·åˆ—è¡¨ï¼Œå¯ä»¥äº’ç›¸äº¤æ¢é€šç”¨ã€‚å¯ä»¥å°†å…¶ç†è§£ä¸ºâ€œèŠ‚ç‚¹ä¿¡æ¯äº¤æ¢â€ã€‚å‰é¢è¯´åˆ°äº† DHT ç½‘ç»œæ˜¯æ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å®¢æˆ·ç«¯æ€»ä¸èƒ½æ»¡ä¸–ç•Œå»å–Šï¼šâ€œæˆ‘åœ¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ï¼Œå¿«æ¥è¿æˆ‘å§.â€ï¼ˆå¾ˆå¤§å£°ï¼‰ã€‚æ‰€ä»¥å°±é€šè¿‡å„ä¸ª BT å®¢æˆ·ç«¯è‡ªå¸¦çš„èŠ‚ç‚¹å»åŒæ­¥è·¯ç”±è¡¨å®ç° DHT ç½‘ç»œè¿æ¥ã€‚</p>
<h3 id="æœ¬åœ°ç”¨æˆ·å‘ç°"><a href="#æœ¬åœ°ç”¨æˆ·å‘ç°" class="headerlink" title="æœ¬åœ°ç”¨æˆ·å‘ç°"></a>æœ¬åœ°ç”¨æˆ·å‘ç°</h3><p>LSDï¼ˆLPDï¼‰å°±æ˜¯æœ¬åœ°ç½‘ç»œèµ„æºï¼Œå†…ç½‘ä¸‹è½½ï¼Œæ²¡ä»€ä¹ˆå‡ æŠŠç”¨çš„ä¸œè¥¿ï¼Œå¯èƒ½å­¦æ ¡ç­‰ç§æœ‰ç½‘ç»œå¥½ä½¿</p>
<h3 id="ISP"><a href="#ISP" class="headerlink" title="ISP"></a>ISP</h3><p>ç¶²çµ¡æ¥­å‹™æä¾›å•†(Internet Service Providerï¼Œç°¡ç¨±ISP)ï¼Œäº’è¯ç¶²æœå‹™æä¾›å•†ï¼Œå³å‘å»£å¤§ç”¨æˆ·ç¶œåˆæä¾›äº’è¯ç¶²æ¥å…¥æ¥­å‹™ã€ä¿¡æ¯æ¥­å‹™ã€å’Œå¢å€¼æ¥­å‹™çš„é›»ä¿¡é‹ç‡Ÿå•†ã€‚</p>
<h2 id="åå¸è¡€æœºåˆ¶"><a href="#åå¸è¡€æœºåˆ¶" class="headerlink" title="åå¸è¡€æœºåˆ¶"></a>åå¸è¡€æœºåˆ¶</h2><h3 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h3><ol>
<li>æ ¹æ®<strong>æµé‡</strong>ï¼š é»˜è®¤è®¾ç½®ä¸º120ç§’ï¼ŒæŒç»­å¯¹æŸä¸ªpeeräº§ç”Ÿä¸Šä¼ ï¼Œå¹¶ä¸”ä»è¯¥peerç”¨æˆ·è·å–çš„ä¸‹è½½æµé‡æ²¡æœ‰è¶…è¿‡1KBæ–‡ä»¶ï¼ˆ1024å­—èŠ‚ï¼‰å¤§å°ï¼Œå³æ‹‰é»‘è¯¥peerï¼Œé¢„è­¦é¢œè‰²ä¸ºé»„è‰²ï¼Œåˆæ³•ä¸ºç»¿è‰²ï¼Œçº¢è‰²ä¸ºå°ç¦ã€‚</li>
<li>å¯ç»„åˆæ£€æµ‹<strong>æŒ‡å®šå®¢æˆ·ç«¯</strong>è¿›è¡Œåå¸è¡€ï¼Œæ¯”å¦‚è¯´æŒ‡å®šå±è”½qbittorrentã€utorrentç­‰å¸è¡€å®¢æˆ·ç«¯é€‰æ‹©ï¼ˆå¯å¤šé€‰å®¢æˆ·ç«¯ï¼Œå¯å¯¹ä¸‹è½½ä»»åŠ¡å’Œåšç§ä»»åŠ¡ç”Ÿæ•ˆï¼‰</li>
<li>å¯ç»„åˆæ£€æµ‹å®¢æˆ·ç«¯<strong>è¿æ¥ç«¯å£å·</strong>è¿›è¡Œåå¸è¡€ï¼Œæ¯”å¦‚è¯´æŒ‡å®šå±è”½15000è¿…é›·Xç‰ˆæœ¬å®¢æˆ·ç«¯ç­‰å¸è¡€ç«¯å£ï¼ˆå¯å¤šé€‰ç«¯å£å·ï¼Œå¯å¯¹ä¸‹è½½ä»»åŠ¡å’Œåšç§ä»»åŠ¡ç”Ÿæ•ˆï¼‰</li>
<li>å¯ç»„åˆæ£€æµ‹å®¢æˆ·ç«¯<strong>è¿æ¥peer_idæ ‡å¿—ç¬¦</strong>è¿›è¡Œåå¸è¡€å±è”½ï¼Œä¾‹å¦‚å±è”½XL0018å®¢æˆ·ç«¯ç­‰å¸è¡€æ ‡å¿—ç¬¦ï¼ˆå¯å¤šé€‰æ ‡å¿—ç¬¦ï¼Œå¯å¯¹ä¸‹è½½ä»»åŠ¡å’Œåšç§ä»»åŠ¡ç”Ÿæ•ˆï¼‰</li>
</ol>
<h3 id="é«˜çº§è®¾ç½®"><a href="#é«˜çº§è®¾ç½®" class="headerlink" title="é«˜çº§è®¾ç½®"></a>é«˜çº§è®¾ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bittorrent.anti_leech_min_byte</span><br><span class="line">è®¾å®šåå¸è¡€ä¿æŠ¤æµé‡ï¼šè¦æ±‚å¯¹æ–¹åœ¨æŒ‡å®šæ—¶é—´ï¼ˆç§’ï¼‰å†…éœ€è¦ä¸Šä¼ çš„æœ€å°‘æµé‡ï¼ˆbyteï¼‰ï¼Œ å–å€¼èŒƒå›´ï¼š1-10000ã€‚</span><br><span class="line"></span><br><span class="line">bittorrent.anti_leech_min_stable_sec</span><br><span class="line">è®¾å®šåå¸è¡€ä¿æŠ¤æ—¶é—´ï¼šæŒ‡å®šä¸å¯¹æ–¹è¿æ¥å¤šé•¿æ—¶é—´ï¼ˆç§’ï¼‰åå¼€å§‹æ£€æŸ¥æµé‡ï¼ˆbyteï¼‰ï¼Œå–å€¼èŒƒå›´ï¼š1-10000ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="éœ€è¦è½¯ä»¶å¼€ç€å—ï¼Ÿ"><a href="#éœ€è¦è½¯ä»¶å¼€ç€å—ï¼Ÿ" class="headerlink" title="éœ€è¦è½¯ä»¶å¼€ç€å—ï¼Ÿ"></a>éœ€è¦è½¯ä»¶å¼€ç€å—ï¼Ÿ</h3><p>éœ€è¦</p>
<h3 id="åŸæ–‡ä»¶æ”¹åæˆ–è€…ç§»åŠ¨ï¼Œè¿˜ä¼šä¸Šä¼ å—ï¼Ÿ"><a href="#åŸæ–‡ä»¶æ”¹åæˆ–è€…ç§»åŠ¨ï¼Œè¿˜ä¼šä¸Šä¼ å—ï¼Ÿ" class="headerlink" title="åŸæ–‡ä»¶æ”¹åæˆ–è€…ç§»åŠ¨ï¼Œè¿˜ä¼šä¸Šä¼ å—ï¼Ÿ"></a>åŸæ–‡ä»¶æ”¹åæˆ–è€…ç§»åŠ¨ï¼Œè¿˜ä¼šä¸Šä¼ å—ï¼Ÿ</h3><p>æ–‡ä»¶ä¸‹è½½åä¸èƒ½ç§»åŠ¨ï¼Œä¸èƒ½åˆ é™¤ï¼Œä¸èƒ½é‡å‘½åï¼ˆä½†å¯ä»¥åœ¨è½¯ä»¶å†…æ”¹ï¼‰ã€‚ ä¸€ä½†BT è½¯ä»¶æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œæˆ–åˆ é™¤äº†ä»»åŠ¡ï¼Œå°±æ— æ³•åšç§ä¸Šä¼ äº†ã€‚</p>
<h3 id="æ™šä¸Šé¿å…ä¸Šä¼ "><a href="#æ™šä¸Šé¿å…ä¸Šä¼ " class="headerlink" title="æ™šä¸Šé¿å…ä¸Šä¼ "></a>æ™šä¸Šé¿å…ä¸Šä¼ </h3><p>å¯ä»¥åœ¨Bitcomet<strong>é«˜çº§è®¾ç½®</strong>é‡Œè®¾ç½®<strong>æ—¶æ®µé™é€Ÿ</strong></p>
<h3 id="å¯¹ç¡¬ç›˜æŸå®³å¤§å—ï¼Ÿ"><a href="#å¯¹ç¡¬ç›˜æŸå®³å¤§å—ï¼Ÿ" class="headerlink" title="å¯¹ç¡¬ç›˜æŸå®³å¤§å—ï¼Ÿ"></a>å¯¹ç¡¬ç›˜æŸå®³å¤§å—ï¼Ÿ</h3><p>åˆ†äº«ä¸Šä¼ ä¹Ÿéœ€è¦é¢‘ç¹è¯»å–ç¡¬ç›˜ã€‚</p>
<p>ä»¥Bitcometä¸ºä¾‹ï¼Œè¯¥è½¯ä»¶å°±æ˜¯é€šè¿‡ç£ç›˜ç¼“å­˜æŠ€æœ¯å‡å°é¢‘ç¹éšæœºè¯»å†™å¯¹ç¡¬ç›˜çš„æŸä¼¤ã€‚</p>
<p>ç£ç›˜ç¼“å­˜å°±æ˜¯åˆ©ç”¨ç‰©ç†å†…å­˜ä½œä¸ºç¼“å†²ï¼Œå°†ä¸‹è½½ä¸‹çš„æ•°æ®å…ˆå­˜æ”¾äºå†…å­˜ä¸­ï¼Œç„¶åå®šæœŸçš„ä¸€æ¬¡æ€§å†™å…¥ç¡¬ç›˜ï¼Œä»¥å‡å°‘å¯¹ç¡¬ç›˜çš„å†™å…¥æ“ä½œï¼Œå¾ˆå¤§çš„ç¨‹åº¦ä¸Šé™ä½äº†ç£ç›˜ç¢ç‰‡ã€‚</p>
<p>å› ä¸ºé€šå¸¸æˆ‘ä»¬è®¾ç½®å†…å­˜ï¼ˆç£ç›˜ç¼“å­˜ï¼‰ä¸ºæ¯ä»»åŠ¡XXå…†ï¼Œæ„å‘³ç€ï¼Œè¿™ä¸ªç¼“å†²åŒºå¯ä»¥å­˜æ”¾æ•°å…†ç”šè‡³å‡ åå…†çš„â€œå—â€ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥æœç»ç¢ç‰‡äº†ã€‚</p>
<p>ç°åœ¨BTè½¯ä»¶éƒ½æ˜¯è‡ªåŠ¨è®¾ç½®ç¼“å­˜çš„ï¼Œå®ƒæ˜¯æ ¹æ®ä½ ç‰©ç†å†…å­˜çš„å¤§å°åˆ†é…çš„ã€‚</p>
<h2 id="æ³¨æ„è®¾ç½®"><a href="#æ³¨æ„è®¾ç½®" class="headerlink" title="æ³¨æ„è®¾ç½®"></a>æ³¨æ„è®¾ç½®</h2><ol>
<li>è®¾ç½®äº†â€œåå¸è¡€â€ï¼Œåº”å¯¹è¿…é›·</li>
<li>æ ¡å›­ç½‘è®¾ç½®9ï¼Œä¸é™åˆ¶P2P<ol>
<li>å›½å†…å„çœä»½ä¸åŒè¿è¥å•†é™é€Ÿç­–ç•¥ï¼ˆQOSï¼‰</li>
</ol>
</li>
</ol>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>è·¯ç”±å™¨ä¸‹è½½ï¼Ÿ</p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.066Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">4 minutes read (About 637 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/network/example/mountNetworkDisk/">Mount Network Disk</a></p><div class="content"><h2 id="æ–‡ä»¶ç±»å‹"><a href="#æ–‡ä»¶ç±»å‹" class="headerlink" title="æ–‡ä»¶ç±»å‹"></a>æ–‡ä»¶ç±»å‹</h2><ul>
<li>The <strong>Server Message Block (SMB)</strong> Protocol is the network file sharing protocol of Microsoft Windows. The set of message packets defining a particular version of the protocol is called a dialect(æ–¹è¨€ï¼Ÿ). </li>
<li>The <strong>Common Internet File System (CIFS)</strong> is a dialect of SMB. <ul>
<li>Both SMB and CIFS are also available on VMS. Both SMB and CIFS are also available on other operating systems like Linux and Android via alternate implementations which are not officially supported by Microsoft.</li>
</ul>
</li>
<li>mount é€šè¿‡ä¿®æ”¹ <code>/etc/fstab</code> æ–‡ä»¶å®ç°</li>
</ul>
<h2 id="lazy-umount"><a href="#lazy-umount" class="headerlink" title="lazy umount"></a>lazy umount</h2><ul>
<li>åˆ†åŒºå ç”¨ä¼šæŠ¥é”™<code>device is busy</code><ul>
<li>å…ˆå°è¯•killç›¸å…³å ç”¨è¿›ç¨‹ <code>lsof /mountPath | sed -n &#39;2,$p&#39; | awk &#39;&#123;print $2&#125;&#39; | sudo xargs -r kill -9</code></li>
</ul>
</li>
<li><code>umount -l /media/disk</code><ul>
<li>ç«‹å³ä»ç›®å½•ç»“æ„ä¸­å®ç°å¸è½½ï¼Œå³æ–°è¿›ç¨‹å°†æ— æ³•é€šè¿‡&#x2F;media&#x2F;diskè®¿é—®&#x2F;dev&#x2F;sdb1ã€‚</li>
<li>æ­£åœ¨è®¿é—®è¯¥æ–‡ä»¶ç³»ç»Ÿçš„ç¨‹åºä¸å—å½±å“ã€‚å³æ­£åœ¨æ“ä½œ&#x2F;media&#x2F;diskçš„è¿›ç¨‹ä¸ä¼šè¢«æ‰“æ–­ï¼Œä¸”ä»å¯ä»¥è¯»å†™&#x2F;dev&#x2F;sdb1ä¸­çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li>
<li>å¦‚æœæ‰€æœ‰è¿›ç¨‹å¯¹&#x2F;media&#x2F;diskçš„æ“ä½œéƒ½æ‰§è¡Œå®Œï¼Œé‚£ä¹ˆæ‰çœŸæ­£åœ°umountã€‚</li>
<li>ç”±æ­¤å¯çŸ¥ï¼Œlazy umountå¹¶æ²¡æœ‰çœŸæ­£å®ç°umountï¼Œä»…ç”¨äºç‰¹æ®Šéœ€è¦çš„æƒ…å†µï¼Œè€Œç”¨è¿™ç§æ–¹æ³•æ¥å¸è½½Uç›˜æ˜¯ä¸å®‰å…¨çš„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="Ubuntu-æŒ‚è½½ç½‘ç»œç¡¬ç›˜"><a href="#Ubuntu-æŒ‚è½½ç½‘ç»œç¡¬ç›˜" class="headerlink" title="Ubuntu æŒ‚è½½ç½‘ç»œç¡¬ç›˜"></a>Ubuntu æŒ‚è½½ç½‘ç»œç¡¬ç›˜</h2><p>åœ¨snode5æµ‹è¯•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip acsa-med.acsalab.com</span></span><br><span class="line">mount 114.214.236.245:/volume1/acsa-med /acsa-med</span><br><span class="line">  114.214.236.245:/volume1/acsa-med      66T   40T   27T  61% /acsa-med</span><br><span class="line">mount -o soft,proto=rdma,port=2050 10.1.13.1:/home /staff</span><br><span class="line">  10.1.13.1:/home                        35T  8.1G   35T   1% /staff</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½ç½‘ç»œå…±äº«æ–‡ä»¶å¤¹Entertainment åˆ°ubuntuç©ºç›®å½•/synologyï¼Œé™¤å¼€rootï¼Œæœ¬åœ°ç”¨æˆ·yyyä¹Ÿèƒ½è®¿é—®ï¼š</span></span><br><span class="line">sudo apt-get install cifs-utils</span><br><span class="line"><span class="comment"># å¯ä»¥çœç•¥ passã€‚ </span></span><br><span class="line">sudo mount.cifs //synology.acsalab.com/Entertainment /synology -o user=xxx vers=3.0</span><br></pre></td></tr></table></figure>

<ul>
<li>æ³¨æ„: æŒ‚è½½çš„æ—¶å€™é€‰æ‹©ipv6åŸŸå<code>synology.acsalab.com</code>æ›´å¥½, ä¹‹å‰ipv4åè€Œèµ°äº†WARPçš„wiregaurdä»£ç†å¯¼è‡´é“¾æ¥ä¸ä¸Š</li>
<li>å…¶ä¸­<code>uid</code>å’Œ<code>domain</code>å¯ä»¥ç”¨<code>id</code>å‘½ä»¤å¯çŸ¥</li>
</ul>
<h3 id="å¼ºåˆ¶å–æ¶ˆ-CIFS-Share-æŒ‚è½½"><a href="#å¼ºåˆ¶å–æ¶ˆ-CIFS-Share-æŒ‚è½½" class="headerlink" title="å¼ºåˆ¶å–æ¶ˆ CIFS Share æŒ‚è½½"></a>å¼ºåˆ¶å–æ¶ˆ CIFS Share æŒ‚è½½</h3><p>lazy<code>-l</code>æ–¹å¼unmountæ‰€æœ‰<code>-a</code> æ–‡ä»¶ç³»ç»Ÿä¸º<code>-t cifs</code>çš„æŒ‚è½½</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -a -t cifs -l /path/to/share</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>å§œå¸ˆå…„ä¸çŸ¥é“æ€ä¹ˆå–æ¶ˆæŒ‚è½½åå‡ºç°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@brainiac1:/home/qcjiang/mnt<span class="comment"># ls -al</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;nas&#x27;</span>: No such device</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 root    root    4096 May 11 15:52 .</span><br><span class="line">drwxr-xr-x 23 qcjiang qcjiang 4096 May 11 15:52 ..</span><br><span class="line">d?????????  ? ?       ?          ?            ? nas</span><br><span class="line"></span><br><span class="line">root@brainiac1:/home/qcjiang/mnt/nas<span class="comment"># ls -al</span></span><br><span class="line"><span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;.&#x27;</span>: No such device</span><br><span class="line"></span><br><span class="line">root@brainiac1:/home/qcjiang/mnt<span class="comment"># lsof /mntSyno</span></span><br><span class="line">lsof: WARNING: can<span class="string">&#x27;t stat() cifs file system /home/qcjiang/mnt/nas</span></span><br><span class="line"><span class="string">      Output information may be incomplete.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>d?????????</code>ç»å¸¸å‡ºç°åœ¨æ— æƒé™è®¿é—®æ—¶ï¼Œéœ€è¦<code>chmod +x /path</code>è§£å†³</li>
<li>ä½†æ˜¯è¿™é‡Œæ˜¯æ²¡æœ‰å¤„ç†ç©ºcifsæŒ‚è½½ï¼Œè¿è¡Œ<code>umount /home/qcjiang/mnt/nas</code> å³å¯è§£å†³ã€‚</li>
</ul>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><p>æƒ³å°†Nasä¸Šçš„ç›˜æŒ‚è½½åˆ°</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.070Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/network/">network</a></span><span class="level-item">8 minutes read (About 1233 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/network/vpn/3-cloudflare/">Cloudflare warp proxy</a></p><div class="content"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul>
<li>Cloudflare ä½œä¸ºå…¨çƒæœ€å¤§çš„ç½‘ç»œæœåŠ¡æä¾›å•†ï¼Œå…¨çƒå¤§çº¦æœ‰30%çš„ç½‘ç»œæœåŠ¡ç”±å®ƒæä¾›ã€‚</li>
<li>WARPæ˜¯Cloudflareæä¾›çš„å…è´¹çš„ï¼Œæ²¡æœ‰å¸¦å®½ä¸Šé™æˆ–é™åˆ¶çš„VPNæœåŠ¡ï¼Œå¯ä»¥è®©ä½ åœ¨ä»»ä½•åœ°æ–¹è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ä¼šå—åˆ°åœ°åŸŸé™åˆ¶ã€‚<ul>
<li>WARPè½¯ä»¶æ˜¯åŸºäºwireguardé­”æ”¹çš„ã€‚</li>
<li>WARPæœ‰å®‰å“å’ŒWindowsçš„å®¢æˆ·ç«¯ï¼Œä½†æ˜¯ä½¿ç”¨äººæ•°è¿‡å¤šï¼Œä½“éªŒå¹¶ä¸å¥½</li>
<li>Linuxä¸‹é€šè¿‡WARPä»£ç†èƒ½å®ç°20MB&#x2F;sçš„ä¸‹è½½é€Ÿåº¦ã€‚</li>
</ul>
</li>
</ul>
<h2 id="WARP-on-Linux"><a href="#WARP-on-Linux" class="headerlink" title="WARP on Linux"></a>WARP on Linux</h2><h3 id="å®‰è£…é…ç½®"><a href="#å®‰è£…é…ç½®" class="headerlink" title="å®‰è£…é…ç½®"></a>å®‰è£…é…ç½®</h3><ul>
<li>ç¼˜ç”±ï¼šWARPä¸‹çš„PTåšç§å¿«å¾—å¤šã€‚(ä¸æ˜¯ï¼Œæ˜¯å› ä¸ºç½‘ç»œç¡¬ç›˜ï¼Œæ‰€ä»¥ä¸‹è½½å¤šå°‘è¦å ç”¨å¤šå°‘ä¸Šä¼ )</li>
<li><a target="_blank" rel="noopener" href="https://github.com/P3TERX/warp.sh">å‚è€ƒæ•™ç¨‹</a>ã€‚</li>
<li>è„šæœ¬å’Œæ‰€éœ€æ–‡ä»¶åœ¨<code>Z:\shaojiemike\Documents\æ–‡çŒ®\è®¡ç®—æœºç½‘ç»œ</code>ç›®å½•ä¸‹ã€‚è¿™é‡Œå…ˆä½¿ç”¨fjwçš„è„šæœ¬ã€‚</li>
</ul>
<ol>
<li>é€šè¿‡æ³¨å†Œè„šæœ¬<code>register.py</code>ï¼Œè·å¾—ç§é’¥å’Œåˆ†é…çš„ip</li>
<li>é…ç½®wgã€‚å…¶ä¸­Endpointç«¯å£å¯ä»å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼Œé»˜è®¤çš„2408å¾ˆå¯èƒ½è¢«å°ã€‚<a target="_blank" rel="noopener" href="https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall/">WARP with firewall Â· Cloudflare Zero Trust docs</a> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">PrivateKey = xxxx         #register.pyçš„ç§é’¥</span><br><span class="line">Address = xxx/32,xxx/128  #register.pyçš„ipv4å’Œipv6</span><br><span class="line">Table = off              # offç¦æ­¢wgä¿®æ”¹è·¯ç”±è¡¨</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=</span><br><span class="line">AllowedIPs = 0.0.0.0/0,::/0</span><br><span class="line">Endpoint = [2606:4700:d0::a29f:c001]:500    #2408, 1701, 500, 4500</span><br><span class="line">PersistentKeepalive = 25</span><br></pre></td></tr></table></figure></li>
<li>warpä½¿ç”¨çš„ä¸æ˜¯æ ‡å‡†çš„wgåè®®ï¼Œrootä¸‹è¿è¡Œï¼Œéœ€è¦é€šè¿‡ä¸€ä¸ªnftè„šæœ¬<code>main.sh</code>ä¿®æ”¹åŒ…çš„3ä¸ªå­—èŠ‚ã€‚<ol>
<li>å®‰è£…nft <code>apt-get install nftables</code></li>
<li>éœ€è¦<code>/etc/default/warp-helper</code>æ–‡ä»¶å¡«å†™å¯¹åº”çš„</li>
<li>ROUTING_IDå¯¹åº”register.pyçš„ROUTING_IDã€‚æ³¨æ„ä¸‰ä¸ªæ•°ä¹‹é—´æ²¡ç©ºæ ¼</li>
<li>UPSTREAMå¯¹åº”<code>wg-conf</code>é‡ŒEndpointã€‚æ¯”å¦‚ï¼š</li>
<li><pre><code>  ROUTING_ID=11,45,14
  UPSTREAM=[2606:4700:d0::a29f:c001]:500
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2. æœ€åå¼€å¯è·¯ç”±è¡¨,Rootæƒé™è¿è¡Œ` ip route add default dev warp proto static scope link table default`</span><br><span class="line"></span><br><span class="line">## WARP on OpenWRT </span><br><span class="line"></span><br><span class="line">* ç›®çš„ï¼šä¸ºäº†é˜²æ­¢å¤§é‡æµé‡é€šè¿‡WARPï¼Œå¯¼è‡´è¢«å®˜æ–¹å°ç¦ï¼Œæ‰€ä»¥åªåœ¨OpenWRTä¸Šé…ç½®WARPåˆ†æµgithubçš„æµé‡ã€‚</span><br><span class="line">* å®ç°æ€è·¯ï¼š</span><br><span class="line">  * è¿è¡Œpythonè„šæœ¬ï¼Œé€šè¿‡githubçš„APIè·å¾—æ‰€æœ‰çš„githubåŸŸåipï¼Œ</span><br><span class="line">  * ä½¿ç”¨iptablesçš„warp_outè¡¨ï¼Œå°†ç›®çš„åœ°å€ä¸ºgithubåŸŸåipè·¯ç”±åˆ°WARPçš„è™šæ‹Ÿç½‘å¡ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">### WARP Wireguard Establishment</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">python register.py #è‡ªåŠ¨ç”Ÿæˆwarp-op.conf,warp.confå’Œwarp-helper</span><br><span class="line">mv warp-helper /etc/default</span><br><span class="line"># cat main.sh</span><br><span class="line"># cat warp-op.conf</span><br><span class="line">vim /etc/config/network #å¡«å†™warp-op.confå†…å®¹ï¼Œé»˜è®¤åªè½¬å‘172.16.0.0/24æ¥æµ‹è¯•è¿æ¥</span><br><span class="line">ifup warp #å¯åŠ¨warp, ä»£æ›¿wg-quick up warp.conf</span><br><span class="line">bash main.sh #å¯åŠ¨é˜²ç«å¢™å®ç°æŠ¥æ–‡å¤´å…³é”®ä¸‰å­—èŠ‚ä¿®æ”¹</span><br><span class="line">nft list ruleset #æŸ¥çœ‹é˜²ç«å¢™ï¼Œæ˜¯å¦é…ç½®æˆåŠŸ</span><br><span class="line">wg #æŸ¥çœ‹warpçŠ¶æ€ï¼Œæµ‹è¯•æ˜¯å¦è¿æ¥æˆæœ</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<p>è¿™æ—¶è¿˜æ²¡åˆ›å»ºwarp_outè·¯ç”±è¡¨ï¼Œæ‰€ä»¥è¿˜ä¸èƒ½é€šè¿‡WARPå‡ºæ•°æ®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/config/network</span></span><br><span class="line">config interface <span class="string">&#x27;warp&#x27;</span></span><br><span class="line">        option proto <span class="string">&#x27;wireguard&#x27;</span></span><br><span class="line">        option private_key <span class="string">&#x27;wKpvFCOk4sf8d/RD001TF7sNQ39bWnllpqaFf8QnHG4=&#x27;</span></span><br><span class="line">        option listen_port <span class="string">&#x27;51825&#x27;</span></span><br><span class="line">        list addresses <span class="string">&#x27;172.16.0.2/32&#x27;</span></span><br><span class="line">        list addresses <span class="string">&#x27;2606:4700:110:8466:d4ea:ffb8:10da:470f/128&#x27;</span></span><br><span class="line">        <span class="comment">#option disabled &#x27;1&#x27; </span></span><br></pre></td></tr></table></figure>
<p>ç„¶åWebUIç‚¹å‡»apply æˆ–è€…å‘½ä»¤è¡Œè¿è¡Œ<code>ifconfig warp down &amp;&amp; ifup</code></p>
<h3 id="Network-planning-and-design"><a href="#Network-planning-and-design" class="headerlink" title="Network planning and design"></a>Network planning and design</h3><p>æ·»åŠ äº†WARPçš„ç½‘ç»œå‡ºå£åï¼Œè·¯ç”±å™¨ä¸åœ¨åªæ˜¯é€šè¿‡WANå‡ºæ•°æ®ã€‚é˜²ç«å¢™éœ€è¦æ›´æ–°ï¼š<img src="https://pic.shaojiemike.top/img/20230330200503.png"></p>
<ul>
<li>åŸè·¯è¿”å›è§„åˆ™ã€‚<ul>
<li>é’ˆå¯¹æœ‰å…¬ç½‘ipçš„æ¥å£ï¼Œéœ€è¦åŸè·¯è¿”å›ã€‚<ul>
<li>é…ç½®æ¥è‡ªwanå’ŒWARPçš„ä¿¡æŠ¥ï¼Œä½¿ç”¨wanå’ŒWARPçš„è·¯ç”±è¡¨ï¼Œä¼˜å…ˆçº§3</li>
<li>æ¥è‡ªwançš„æ¯”å¦‚æ¥è‡ªå¤–éƒ¨çš„sshï¼Œä¸ºäº†é˜²æ­¢å¤±è”ã€‚</li>
<li>æ¥è‡ªWARPçš„æ¯”å¦‚<code>wget --bind-address=WARP_ip</code>æ¥æ¨¡æ‹Ÿ</li>
</ul>
</li>
<li>å†…ç½‘åœ°å€æ²¡æœ‰å¿…è¦é…ç½®ï¼Œå› ä¸ºé€šè¿‡å†…ç½‘åœ°å€è®¿é—®hostï¼Œåˆ™dstå¿…ç„¶ä¹Ÿæ˜¯å†…ç½‘åœ°å€ã€‚å› æ­¤ä¼šåŒ¹é…mainä¸­çš„å†…ç½‘åœ°å€è§„åˆ™ã€‚</li>
</ul>
</li>
<li>wanå’ŒWARPçš„è·¯ç”±è¡¨å†…å„è‡ªèµ°wanå’ŒWARPçš„ç½‘å¡</li>
<li>ä¸ºäº†ä½¿å¾—åŸæœ¬wgæ­£å¸¸è¿è¡Œï¼Œ<code>10:     from all lookup main suppress_prefixlength 1</code><ul>
<li>å‡å¦‚warp_outæ˜¯defualtè§„åˆ™ï¼Œè¯¥é¡¹ä¹Ÿæ˜¯ä¸ºäº†é˜²æ­¢å¤±è”ã€‚</li>
</ul>
</li>
<li>åˆ›å»ºwarp_outçš„ç©ºè·¯ç”±è¡¨<code>1000:   from all lookup warp_out</code>,ä¼˜å…ˆçº§1000</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@tsjOp:~/warp# ip rule</span><br><span class="line">0:      from all lookup local</span><br><span class="line">3:      from 114.214.233.141/22 iif eth1 lookup wan</span><br><span class="line">3:      from 172.16.0.2 iif warp lookup warp</span><br><span class="line">10:     from all lookup main suppress_prefixlength 1</span><br><span class="line">1000:   from all lookup warp_out</span><br><span class="line">32766:  from all lookup main</span><br><span class="line">32767:  from all lookup default</span><br></pre></td></tr></table></figure>

<h3 id="å¡«å……warp-outè·¯ç”±è¡¨"><a href="#å¡«å……warp-outè·¯ç”±è¡¨" class="headerlink" title="å¡«å……warp_outè·¯ç”±è¡¨"></a>å¡«å……warp_outè·¯ç”±è¡¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ip_route</span><br><span class="line"><span class="built_in">mv</span> ../github_ipv4.txt .</span><br><span class="line">python fill_ip_table.py --table warp_out --iface warp --p2p -f github_ipv4.txt</span><br></pre></td></tr></table></figure>

<p>å¯¹æ‰€æœ‰githubåŸŸåçš„ipæ‰§è¡Œç±»ä¼¼<code>ip ro add 192.30.252.0/22 dev warp proto static table warp_out</code>æ“ä½œã€‚</p>
<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mtr www.github.com</span><br><span class="line">ssh -vT git@github.com</span><br><span class="line">git clone https://github.com/llvm/llvm-project</span><br></pre></td></tr></table></figure>

<h3 id="æ·»åŠ åˆ°å¯åŠ¨é¡¹"><a href="#æ·»åŠ åˆ°å¯åŠ¨é¡¹" class="headerlink" title="æ·»åŠ åˆ°å¯åŠ¨é¡¹"></a>æ·»åŠ åˆ°å¯åŠ¨é¡¹</h3><p>ä¿®æ”¹<code>/etc/rc.local</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Put your custom commands here that should be executed once</span></span><br><span class="line"><span class="comment"># the system init finished. By default this file does nothing.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 30 &amp;&amp; <span class="built_in">cd</span> /root/warp/ip_route &amp;&amp; python fill_ip_table.py --table warp_out --iface warp --p2p -f github_ipv4.txt</span><br><span class="line"></span><br><span class="line">/root/warp/main.sh <span class="comment">#é‡æ–°æ·»åŠ é˜²ç«å¢™</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h2 id="WARP-on-Windows"><a href="#WARP-on-Windows" class="headerlink" title="WARP on Windows"></a>WARP on Windows</h2><p>åŸºäº1.1.1.1 çš„å®‰è£…windowsç‰ˆæœ¬ç›´æ¥ç™½å«–</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://gist.github.com/iBug/3107fd4d5af6a4ea7bcea4a8090dcc7e">https://gist.github.com/iBug/3107fd4d5af6a4ea7bcea4a8090dcc7e</a></p>
<p>glados</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-11-23T09:32:11.070Z" title="11/23/2023, 9:32:11 AM">2023-11-23</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">7 minutes read (About 1110 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/software/linux/services/">Services Systemd Systemclt</a></p><div class="content"><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>å†å²ä¸Šï¼ŒLinux çš„å¯åŠ¨ä¸€ç›´é‡‡ç”¨initè¿›ç¨‹ã€‚<br>ä¸‹é¢çš„å‘½ä»¤ç”¨æ¥å¯åŠ¨æœåŠ¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/apache2 start</span><br><span class="line"># æˆ–è€…</span><br><span class="line">$ service apache2 start</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ã€‚</p>
<p>ä¸€æ˜¯å¯åŠ¨æ—¶é—´é•¿ã€‚initè¿›ç¨‹æ˜¯ä¸²è¡Œå¯åŠ¨ï¼Œåªæœ‰å‰ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨å®Œï¼Œæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>äºŒæ˜¯å¯åŠ¨è„šæœ¬å¤æ‚ã€‚initè¿›ç¨‹åªæ˜¯æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¸ç®¡å…¶ä»–äº‹æƒ…ã€‚è„šæœ¬éœ€è¦è‡ªå·±å¤„ç†å„ç§æƒ…å†µï¼Œè¿™å¾€å¾€ä½¿å¾—è„šæœ¬å˜å¾—å¾ˆé•¿ã€‚</p>
<h3 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h3><p>Systemd å°±æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜è€Œè¯ç”Ÿçš„ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯ï¼Œä¸ºç³»ç»Ÿçš„å¯åŠ¨å’Œç®¡ç†æä¾›ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æ ¹æ® Linux æƒ¯ä¾‹ï¼Œå­—æ¯dæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰çš„ç¼©å†™ã€‚ Systemd è¿™ä¸ªåå­—çš„å«ä¹‰ï¼Œå°±æ˜¯å®ƒè¦å®ˆæŠ¤æ•´ä¸ªç³»ç»Ÿã€‚</p>
<p>ä½¿ç”¨äº† Systemdï¼Œå°±ä¸éœ€è¦å†ç”¨initäº†ã€‚Systemd å–ä»£äº†initdï¼Œæˆä¸ºç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆPID ç­‰äº 1ï¼‰ï¼Œå…¶ä»–è¿›ç¨‹éƒ½æ˜¯å®ƒçš„å­è¿›ç¨‹ã€‚</p>
<p>Systemd çš„ä¼˜ç‚¹æ˜¯åŠŸèƒ½å¼ºå¤§ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œç¼ºç‚¹æ˜¯ä½“ç³»åºå¤§ï¼Œéå¸¸å¤æ‚ã€‚äº‹å®ä¸Šï¼Œç°åœ¨è¿˜æœ‰å¾ˆå¤šäººåå¯¹ä½¿ç”¨ Systemdï¼Œç†ç”±å°±æ˜¯å®ƒè¿‡äºå¤æ‚ï¼Œä¸æ“ä½œç³»ç»Ÿçš„å…¶ä»–éƒ¨åˆ†å¼ºè€¦åˆï¼Œè¿åâ€keep simple, keep stupidâ€çš„Unix å“²å­¦ã€‚<br><img src="https://pic.shaojiemike.top/img/20220628174222.png"></p>
<h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>systemctlæ˜¯ Systemd çš„ä¸»å‘½ä»¤ï¼Œç”¨äºç®¡ç†ç³»ç»Ÿã€‚</p>
<p> systemctl - Control the systemd system and service manager</p>
<h3 id="systemctlå¸¸è§å‘½ä»¤"><a href="#systemctlå¸¸è§å‘½ä»¤" class="headerlink" title="systemctlå¸¸è§å‘½ä»¤"></a>systemctlå¸¸è§å‘½ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl is-enabled servicename.service #æŸ¥è¯¢æœåŠ¡æ˜¯å¦å¼€æœºå¯åŠ¨</span><br><span class="line">systemctl enable *.service #å¼€æœºè¿è¡ŒæœåŠ¡</span><br><span class="line">systemctl disable *.service #å–æ¶ˆå¼€æœºè¿è¡Œ</span><br><span class="line">systemctl start *.service #å¯åŠ¨æœåŠ¡</span><br><span class="line">systemctl stop *.service #åœæ­¢æœåŠ¡</span><br><span class="line">systemctl restart *.service #é‡å¯æœåŠ¡</span><br><span class="line">systemctl reload *.service #é‡æ–°åŠ è½½æœåŠ¡é…ç½®æ–‡ä»¶</span><br><span class="line">systemctl status *.service #æŸ¥è¯¢æœåŠ¡è¿è¡ŒçŠ¶æ€</span><br><span class="line">systemctl --failed #æ˜¾ç¤ºå¯åŠ¨å¤±è´¥çš„æœåŠ¡</span><br></pre></td></tr></table></figure>
<h3 id="systemctlå‘½ä»¤å®æ“"><a href="#systemctlå‘½ä»¤å®æ“" class="headerlink" title="systemctlå‘½ä»¤å®æ“"></a>systemctlå‘½ä»¤å®æ“</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥çœ‹ç›¸å…³unit</span><br><span class="line">shaojiemike@tsjNas:~$ systemctl|grep wg</span><br><span class="line">  pkg-wg-quick@wg0.service</span><br><span class="line">       loaded active exited  WireGuard via wg-quick(8) for wg0</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹å·²ç»å¯åŠ¨çš„æœåŠ¡</span><br><span class="line">systemctl list-unit-files --state=enabled|grep wg</span><br><span class="line">pkg-wg-quick@.service                     enabled //ç”±äºæˆ‘åˆ é™¤äº†wg0ï¼Œæ‰€ä»¥.serviceå‰æ²¡wg0</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æœåŠ¡</span><br><span class="line">sh-4.4#  systemctl disable pkg-wg-quick@.service</span><br><span class="line">Removed symlink /etc/systemd/system/syno-low-priority-packages.target.wants/pkg-wg-quick@wg0.service.</span><br></pre></td></tr></table></figure>

<h3 id="å¼€æœºå¯åŠ¨åŸç†"><a href="#å¼€æœºå¯åŠ¨åŸç†" class="headerlink" title="å¼€æœºå¯åŠ¨åŸç†"></a>å¼€æœºå¯åŠ¨åŸç†</h3><p>Systemd é»˜è®¤ä»ç›®å½•<code>/etc/systemd/system/</code>è¯»å–é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œé‡Œé¢å­˜æ”¾çš„å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½æ˜¯ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘ç›®å½•<code>/usr/lib/systemd/system/</code>ï¼ŒçœŸæ­£çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨é‚£ä¸ªç›®å½•ã€‚</p>
<p><code>systemctl enable</code>å‘½ä»¤ç”¨äºåœ¨ä¸Šé¢ä¸¤ä¸ªç›®å½•ä¹‹é—´ï¼Œå»ºç«‹ç¬¦å·é“¾æ¥å…³ç³»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl enable clamd@scan.service</span><br><span class="line"># ç­‰åŒäº</span><br><span class="line">$ sudo ln -s &#x27;/usr/lib/systemd/system/clamd@scan.service&#x27; &#x27;/etc/systemd/system/multi-user.target.wants/clamd@scan.service&#x27;</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<p>å¦‚æœé…ç½®æ–‡ä»¶é‡Œé¢è®¾ç½®äº†å¼€æœºå¯åŠ¨ï¼Œ<code>systemctl enable</code>å‘½ä»¤ç›¸å½“äºæ¿€æ´»å¼€æœºå¯åŠ¨ã€‚</p>
<p>ä¸ä¹‹å¯¹åº”çš„ï¼Œ<code>systemctl disable</code>å‘½ä»¤ç”¨äºåœ¨ä¸¤ä¸ªç›®å½•ä¹‹é—´ï¼Œæ’¤é”€ç¬¦å·é“¾æ¥å…³ç³»ï¼Œç›¸å½“äºæ’¤é”€å¼€æœºå¯åŠ¨ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl disable clamd@scan.service</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<p>é…ç½®æ–‡ä»¶çš„åç¼€åï¼Œå°±æ˜¯è¯¥ Unit çš„ç§ç±»ï¼Œæ¯”å¦‚<code>sshd.socket</code>ã€‚å¦‚æœçœç•¥ï¼ŒSystemd é»˜è®¤åç¼€åä¸º<code>.service</code>ï¼Œæ‰€ä»¥<code>sshd</code>ä¼šè¢«ç†è§£æˆ<code>sshd.service</code>ã€‚</p>
<h2 id="æŠŠç¨‹åºè®¾ç½®systemctlæœåŠ¡-å¹¶å¼€æœºå¯åŠ¨"><a href="#æŠŠç¨‹åºè®¾ç½®systemctlæœåŠ¡-å¹¶å¼€æœºå¯åŠ¨" class="headerlink" title="æŠŠç¨‹åºè®¾ç½®systemctlæœåŠ¡,å¹¶å¼€æœºå¯åŠ¨"></a>æŠŠç¨‹åºè®¾ç½®systemctlæœåŠ¡,å¹¶å¼€æœºå¯åŠ¨</h2><ol>
<li>Systemd é»˜è®¤ä»ç›®å½•<code>/etc/systemd/system/</code>è¯»å–é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œé‡Œé¢å­˜æ”¾çš„å¤§éƒ¨åˆ†æ–‡ä»¶éƒ½æ˜¯ç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘ç›®å½•<code>/usr/lib/systemd/system/</code>ï¼ŒçœŸæ­£çš„é…ç½®æ–‡ä»¶å­˜æ”¾åœ¨é‚£ä¸ªç›®å½•ã€‚</li>
<li>è¿›å…¥ç›®å½•<code>/usr/lib/systemd/system</code>,ä¿®æ”¹<code>webhook.service</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Webhook receiver for GitHub</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/webhook</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nexus.service  #å¯åŠ¨æœåŠ¡</span><br><span class="line">systemctl enable nexus.service #è®¾ç½®å¼€æœºå¯åŠ¨</span><br></pre></td></tr></table></figure>
<code>Loaded: loaded (/etc/systemd/system/webhook.service; enabled;</code>è¿™ä¸ª<code>enabled</code>å°±æ˜¯å¼€æœºå¯åŠ¨çš„æ„æ€</li>
</ol>
<h2 id="æŸ¥çœ‹æœåŠ¡çš„log"><a href="#æŸ¥çœ‹æœåŠ¡çš„log" class="headerlink" title="æŸ¥çœ‹æœåŠ¡çš„log"></a>æŸ¥çœ‹æœåŠ¡çš„log</h2><p>journalctl - Query the systemd journal</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># root @ snode0 in /etc/systemd/system [17:57:48]</span><br><span class="line">$ journalctl -u webhook.service</span><br><span class="line">-- Logs begin at Mon 2022-06-06 15:54:50 CST, end at Tue 2022-06-28 17:57:50 CST. --</span><br><span class="line">Jun 28 17:30:53 snode0 systemd[1]: Started Webhook receiver for GitHub.</span><br></pre></td></tr></table></figure>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl reload webhook.service</span><br><span class="line">==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===</span><br><span class="line">Authentication is required to reload &#x27;webhook.service&#x27;.</span><br><span class="line">Multiple identities can be used for authentication:</span><br><span class="line"> 1.  Jun Shi (shijun)</span><br><span class="line"> 2.  Shaojie Tan (shaojiemike)</span><br><span class="line">Choose identity to authenticate as (1-2): 2</span><br><span class="line">Password:</span><br><span class="line">==== AUTHENTICATION COMPLETE ===</span><br><span class="line">Failed to reload webhook.service: Job type reload is not applicable for unit webhook.service.</span><br></pre></td></tr></table></figure>
<p>Simple ç±»å‹ä¸èƒ½reload</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40741855/article/details/104984071">https://blog.csdn.net/qq_40741855/article/details/104984071</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/17/">Previous</a></div><div class="pagination-next"><a href="/page/19/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/17/">17</a></li><li><a class="pagination-link is-current" href="/page/18/">18</a></li><li><a class="pagination-link" href="/page/19/">19</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/35/">35</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">ğ˜Šğ˜°ğ˜®ğ˜±ğ˜¶ğ˜µğ˜¦ğ˜³ ğ˜ˆğ˜³ğ˜¤ğ˜©ğ˜ªğ˜µğ˜¦ğ˜¤ğ˜µğ˜¶ğ˜³ğ˜¦ &amp; ğ˜ğ˜—ğ˜Š</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">348</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">28</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">473</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">49</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-23T09:32:11.046Z">2023-11-23</time></p><p class="title"><a href="/2023/11/23/OutOfWork/3-homepage/labTemplate/"> </a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-22T08:12:35.000Z">2023-11-22</time></p><p class="title"><a href="/2023/11/22/Work/hardware/dataLink/">Data Link</a></p><p class="categories"><a href="/categories/hardware/">hardware</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-19T10:15:31.000Z">2023-11-19</time></p><p class="title"><a href="/2023/11/19/Work/network/example/wireguardServer2Server/">Wireguard Server 2 Server in OpenWRT</a></p><p class="categories"><a href="/categories/network/">network</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-18T02:42:03.000Z">2023-11-18</time></p><p class="title"><a href="/2023/11/18/OutOfWork/4-devices/nas/DockerOnNas/">Docker On Nas</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-18T02:05:50.000Z">2023-11-18</time></p><p class="title"><a href="/2023/11/18/OutOfWork/4-devices/nas/migrateFromSynology2UgreenDX4600/">Migrate From Synology DS220J to UGREEN DX4600</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">209</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shaojie Tan</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>