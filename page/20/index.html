<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-19T16:00:00.000Z" title="7/19/2023, 4:00:00 PM">2023-07-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.556Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Math/">Math</a></span><span class="level-item">11 minutes read (About 1663 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/19/Work/math/MathematicalLogic/">Mathematical Logic &amp; Algebraic structure</a></p><div class="content"><h2 id="数学的黑洞"><a href="#数学的黑洞" class="headerlink" title="数学的黑洞"></a>数学的黑洞</h2><p>启发来源<a href="%5B%E3%80%90%E6%AF%95%E5%AF%BC%E3%80%91%E8%BF%99%E4%B8%AA%E8%A7%86%E9%A2%91%E9%87%8C%E8%AF%B4%E7%9A%84%E9%83%BD%E6%98%AF%E7%9C%9F%E7%9A%84%EF%BC%8C%E4%BD%86%E4%BD%A0%E5%8D%B4%E6%B0%B8%E8%BF%9C%E6%97%A0%E6%B3%95%E8%AF%81%E6%98%8E%5D(https://www.bilibili.com/video/BV19u4y1D7GT/?spm_id_from=333.999.0.0&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3)">^1</a></p>
<h3 id="理发师悖论，与罗素悖论"><a href="#理发师悖论，与罗素悖论" class="headerlink" title="理发师悖论，与罗素悖论"></a>理发师悖论，与罗素悖论</h3><p>与排除自指的数学体系<code>类型论</code></p>
<h3 id="希尔伯特纲领"><a href="#希尔伯特纲领" class="headerlink" title="希尔伯特纲领"></a>希尔伯特纲领</h3><ul>
<li><strong>形式语言</strong> 公理，来建立数学。<ul>
<li>公理：约定俗成的命题，两点成一线 。算术的皮亚诺公理。</li>
<li>形式语言：所有的句子变成符号: 存在任意量词 + 与或非 + 命题</li>
</ul>
</li>
<li>完备性Completeness ，一致性Consistency ，可判断性 Decidability</li>
</ul>
<p>??? exmaple “形式语言: f(x)在p处的极限为L”</p>
<pre><code>$$(\forall \varepsilon \gt 0)(\exist \delta \gt 0)(\forall x \in \R)(0 \gt |x-p|\gt\delta\Longrightarrow|f(x)-L|\lt\varepsilon)$$
</code></pre>
<h3 id="哥德尔不完备定理"><a href="#哥德尔不完备定理" class="headerlink" title="哥德尔不完备定理"></a>哥德尔不完备定理</h3><p>(即使排除了自指，还是不完备的)</p>
<h2 id="数理逻辑-Mathematical-logic"><a href="#数理逻辑-Mathematical-logic" class="headerlink" title="数理逻辑 Mathematical logic"></a>数理逻辑 Mathematical logic</h2><p>数理逻辑的奥秘在于，它试图将人类主观的推理思维过程客观化，并建立起主观推理与客观证明之间的联系。通过对形式语言的公理化来达到自然语言的公理化目标。</p>
<h3 id="形式逻辑系统-与-一阶逻辑"><a href="#形式逻辑系统-与-一阶逻辑" class="headerlink" title="形式逻辑系统 与 一阶逻辑"></a>形式逻辑系统 与 一阶逻辑</h3><ul>
<li>形式逻辑系统 （Formal logical systems）是数理逻辑表示的方法。</li>
<li>一阶逻辑（英语：First-order logic），又称谓词逻辑（predicate logic）、量化逻辑（quantificational logic）、一阶谓词演算（first-order predicate calculus）[^2]</li>
<li>一阶逻辑在<strong>非逻辑对象</strong>上使用量化的变量，并且允许使用<strong>包含变量</strong>的句子，这样就可以有“存在x，使得x是苏格拉底并且x是人”形式的表达式，而不是像“苏格拉底是人”这样的命题，其中“存在”是一个量词，而x是一个变量。</li>
<li>意义：这将它与<strong>命题逻辑</strong>区分开来，命题逻辑不使用量词或关系; 在这个意义上，命题逻辑是一阶逻辑的基础。</li>
</ul>
<h3 id="逻辑推理"><a href="#逻辑推理" class="headerlink" title="逻辑推理"></a>逻辑推理</h3><ul>
<li><code>存在一个数</code> &#x3D; <code>存在最小的</code></li>
</ul>
<p>??? example “逻辑悖论导致的”</p>
<pre><code>- 毕导爱拖更”和“毕导不爱拖更”同时成立[^1]
- 因为“毕导爱拖更”为真 “毕导爱拖更”或“黎曼猜想成立”必为真
- “毕导爱拖更”、“黎曼猜想成立”至少有一个为真
- 又因为“毕导不爱拖更”为真 所以前半句不成立，故“黎曼猜想成立”为真，证毕。
</code></pre>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><ol>
<li>逆否命题：命题 “如果 P，则 Q”，其逆否命题是 “如果 非Q，则 非P”。逆否命题等价于原命题，当且仅当原命题的结构为蕴含式（implication）形式，即 “如果 P，则 Q”的If-Then 结构</li>
<li>存在量词与任意量词之间的转化：<br>$$(\exist x \sim Hx) \iff (\sim \forall x Hx)$$<br>$$(\sim \exist x  Hx) \iff ( \forall x \sim Hx)$$</li>
</ol>
<h2 id="代数结构"><a href="#代数结构" class="headerlink" title="代数结构"></a>代数结构</h2><p>在抽象代数里，代数结构（algebraic structure）是指装备了一个及以上的运算（最一般地，可以允许有无穷多个运算）的非空集合。一般研究的代数结构有群、环、域、格、模、域代数和向量空间等等。在数学中，更具体地说，在抽象代数中，代数结构是一个集合(称为载体集或底层集合)，它在它上定义了一个或多个满足公理的有限运算。</p>
<p>??? example “GPT: 群，环，域区别”</p>
<pre><code>1. **群：**
- **定义：** 群是一个集合，其中有一个二元运算（通常是加法或乘法），满足封闭性（运算的结果仍在集合内）、结合律、存在单位元素（对于加法是0，对于乘法是1）和每个元素都有逆元素。
- **例子：** 整数集合与加法形成一个群，因为整数的加法满足上述条件。

2. **环：**
- **定义：** 环是一个集合，其中有两个二元运算（通常是加法和乘法），满足封闭性、结合律、存在加法单位元素、存在加法逆元素、乘法分配律。
- 在环中，乘法逆元素对于0是未定义的。也就是说，在环中，存在一个乘法逆元素的元素不能为0。环的乘法可以有逆元素，但不要求对所有非零元素都有。
- **例子：** 整数集合与加法和乘法形成一个环，因为整数的加法和乘法满足上述条件。

3. **域：**
- **定义：** 域也是一个集合，其中有两个二元运算（通常是加法和乘法），满足封闭性、结合律、存在加法和乘法单位元素、存在加法逆元素、存在乘法逆元素、乘法分配律。额外的，域要求乘法逆元素对于0是未定义的。
- 在域中，每个非零元素都必须有乘法逆元素。换句话说，对于域中的任何非零元素，都存在一个元素与之相乘得到域中的乘法单位元素（通常是1）。
- 域是环的一种特殊情况，区别在于域要求乘法逆元素对于所有非零元素都是定义的。
- **例子：** 实数或复数集合与加法和乘法形成一个域，因为它们的加法和乘法满足上述条件。

简而言之，这些结构是数学中用来研究运算规则和性质的工具。在计算机学习中，这些抽象概念可以用来建模和解决各种问题，例如在优化算法、密码学、图形学等领域。如果有具体的问题或关注的方面，请告诉我，我将尽力提供更详细的解释。
</code></pre>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><p>秋招，百度的高铁柱面试官说，定义问题是很关键的一件事。能不能形式化的定义。（我已经很久没有注意这件事了，确实很重要。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[^2]: <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/First-order_logic">wiki First-order logic</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-18T16:00:00.000Z" title="7/18/2023, 4:00:00 PM">2023-07-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.544Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Operating-system/">Operating system</a></span><span class="level-item">a few seconds read (About 98 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/18/Work/Operating%20system/thread/">linux Thread and Process</a></p><div class="content"><h2 id="Linux-thread-evaluation"><a href="#Linux-thread-evaluation" class="headerlink" title="Linux thread evaluation"></a>Linux thread evaluation</h2><p>Java uses lots of threads but threads have become significantly faster and cheaper with the <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Native_POSIX_Thread_Library">NPTL</a> in Linux 2.6. </p>
<h3 id="pthread"><a href="#pthread" class="headerlink" title="pthread"></a>pthread</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Pthreads">to learn</a> </p>
<h2 id="父子线程进程的退出影响"><a href="#父子线程进程的退出影响" class="headerlink" title="父子线程进程的退出影响"></a>父子线程进程的退出影响</h2><p><a target="_blank" rel="noopener" href="http://originlee.com/2015/04/08/influence-of-main-threads-exiting-to-child-thread/">http://originlee.com/2015/04/08/influence-of-main-threads-exiting-to-child-thread/</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-18T16:00:00.000Z" title="7/18/2023, 4:00:00 PM">2023-07-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.560Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">8 minutes read (About 1166 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/18/Work/software/linux-apps/ssh/">ssh config &amp; X11 &amp; jump-machine</a></p><div class="content"><h2 id="ssh-config常见设置"><a href="#ssh-config常见设置" class="headerlink" title="ssh config常见设置"></a>ssh config常见设置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Host node5</span><br><span class="line">  HostName node5.xydustc.me   <span class="comment">#或者ip</span></span><br><span class="line">  IdentityFile ~/.ssh/id_rsa  <span class="comment">#windows： &quot;C:\Users\Administrator\.ssh\id_rsa&quot;</span></span><br><span class="line">  IdentitiesOnly yes          <span class="comment">#IdentitiesOnly指定ssh只能使用配置文件指定的identity和certificate文件或通过ssh命令行通过身份验证，即使ssh-agent或PKCS11Provider提供了多个identities。</span></span><br><span class="line">  User shaojiemike</span><br><span class="line">  Port <span class="number">22</span></span><br><span class="line">  ProxyCommand E:\\commonSoftware\\Git\\mingw64\\<span class="built_in">bin</span>\\connect.exe -S <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">7890</span> -a none %h %p</span><br><span class="line">  <span class="comment"># 注意ProxyCommand不能写全局，会代理其他ssh。出现ctrl-c会中断ssh连接之类的错误</span></span><br><span class="line"></span><br><span class="line">Host *</span><br><span class="line">   ForwardAgent yes     <span class="comment">#是否将本地SSH代理转发到远程主机。如果设置为“yes”，则可以在远程主机上使用本地SSH代理，而无需在远程主机上设置新的SSH连接。</span></span><br><span class="line">   AddKeysToAgent yes   <span class="comment">#是否将私钥添加到ssh-agent中。如果设置为“yes”，则在使用ssh连接时，ssh客户端会自动将私钥添加到ssh-agent中。</span></span><br><span class="line">   ForwardX11 yes</span><br><span class="line">   ForwardX11Trusted yes</span><br><span class="line">   Compression yes</span><br><span class="line">   TCPKeepAlive=yes</span><br><span class="line">   ServerAliveInterval <span class="number">60</span> <span class="comment"># Client每隔 60 秒发送一次请求给 Server，然后 Server响应，从而保持连接</span></span><br><span class="line">   ServerAliveCountMax <span class="number">3</span> <span class="comment"># Client发出请求后，服务器端没有响应得次数达到3，就自动断开连接，正常情况下，Server 不会不响应 </span></span><br></pre></td></tr></table></figure>

<h2 id="更安全但是更简单的加密-ed25519"><a href="#更安全但是更简单的加密-ed25519" class="headerlink" title="更安全但是更简单的加密 ed25519"></a>更安全但是更简单的加密 ed25519</h2><p>??? example “Use new way”</p>
<pre><code>  The error message &quot;userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms [preauth]&quot; indicates that the SSH server is configured to accept specific public key algorithms, and the client attempted to use the &quot;ssh-rsa&quot; algorithm, which is not included in the accepted algorithms list.

  To resolve this issue, you have a few options:

  1. **Update SSH Key Algorithm:**
     If you are generating a new key pair, consider using a more secure algorithm such as Ed25519 instead of the older RSA algorithm.

     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -f /path/to/output/keyfile -C <span class="string">&quot;Your Comment Here&quot;</span></span><br></pre></td></tr></table></figure>

  2. **Update Server Configuration:**
     If you don&#39;t have control over the client&#39;s key type, you may need to update the server&#39;s SSH configuration to include support for the &quot;ssh-rsa&quot; algorithm. Open the SSH server configuration file (usually located at `/etc/ssh/sshd_config`), and add or modify the following line:

     <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PubkeyAcceptedAlgorithms +ssh-rsa</span><br></pre></td></tr></table></figure>

     After making the change, restart the SSH server.

     <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure>

     Note: Adding &quot;ssh-rsa&quot; might reduce the security of your SSH server, as RSA is considered less secure than some newer algorithms.

  3. **Check Key Types:**
     Ensure that you are using the correct key type when attempting to authenticate. If you are using an existing key, make sure it&#39;s the right type (e.g., Ed25519) and not RSA.

  Choose the option that best fits your security requirements and constraints. If possible, it&#39;s generally recommended to use more modern and secure key algorithms like Ed25519 over older ones like RSA.
</code></pre>
<h3 id="查看-ssh-日志"><a href="#查看-ssh-日志" class="headerlink" title="查看 ssh 日志"></a>查看 ssh 日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl -u ssh --since <span class="string">&quot;yesterday&quot;</span> |less</span><br></pre></td></tr></table></figure>

<h2 id="X11-forward-GUI"><a href="#X11-forward-GUI" class="headerlink" title="X11 forward GUI"></a>X11 forward GUI</h2><p>windows use mobaxterm, mac use <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/21878489/error-unable-to-initialize-gtk-is-display-set-properly">xquartz + iterms</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -Y ak324@bert.eecs.qmul.ac.uk</span><br></pre></td></tr></table></figure>

<h2 id="跳板机"><a href="#跳板机" class="headerlink" title="跳板机"></a>跳板机</h2><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>在管理外网服务器时，出于安全等因素的考虑，我们一般不会把所有服务器都设置成可ssh直连，而是会从中挑选出一台机器作为跳板机，当我们想要连接外网服务器时，我们要先通过ssh登录到跳板机，再从跳板机登录到目标服务器。</p>
<h3 id="密钥认证"><a href="#密钥认证" class="headerlink" title="密钥认证"></a>密钥认证</h3><ol>
<li>开启ssh-agent，然后将我们的private key添加到ssh-agent中。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">eval</span> $(ssh-agent)</span><br><span class="line">Agent pid 8350</span><br><span class="line">$ ssh-add</span><br><span class="line">Identity added: /home/yt/.ssh/id_rsa (yt@<span class="built_in">arch</span>)</span><br><span class="line">Identity added: /home/yt/.ssh/id_ed25519 (yt@<span class="built_in">arch</span>)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ssh登录到跳板机（不过此次加上了-A参数，表示开启agent forwarding）。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -A u3@192.168.56.5</span><br></pre></td></tr></table></figure>

<p>或者直接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -J u3@192.168.56.5 u2@192.168.57.3</span><br></pre></td></tr></table></figure>

<p>这条命令将会首先连接到 <code>u3@192.168.56.5</code> 的跳板机，然后再通过跳板机连接到 <code>u2@192.168.57.3</code> 的目标服务器。</p>
<h3 id="scp传递数据"><a href="#scp传递数据" class="headerlink" title="scp传递数据"></a>scp传递数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -J u3@192.168.56.5 u2@192.168.57.3:/path/to/source/file /path/to/destination/file</span><br></pre></td></tr></table></figure>

<p>这个命令将会通过 <code>u3@192.168.56.5</code> 的跳板机从源文件 <code>/path/to/source/file</code> 复制数据到 <code>u2@192.168.57.3</code> 的目标文件 <code>/path/to/destination/file</code>。</p>
<h3 id="config配置"><a href="#config配置" class="headerlink" title="config配置"></a>config配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Host &lt;name&gt;</span><br><span class="line">    HostName 127.0.0.1 <span class="comment">#是不是写错了??不是目标ip吗？</span></span><br><span class="line">    User &lt;user&gt;</span><br><span class="line">    Port &lt;port&gt;</span><br><span class="line">    ProxyCommand ssh &lt;cloud-user&gt;@&lt;cloud-host&gt; -W %h:%p</span><br><span class="line"></span><br><span class="line">//example</span><br><span class="line">Host xunfei-V100</span><br><span class="line">   HostName 172.31.97.164</span><br><span class="line">   User root</span><br><span class="line">   ProxyCommand C:\Windows\System32\OpenSSH\ssh.exe node1 netcat -w 120 %h %p</span><br></pre></td></tr></table></figure>

<h3 id="如何判断当前ssh没用跳板机"><a href="#如何判断当前ssh没用跳板机" class="headerlink" title="如何判断当前ssh没用跳板机"></a>如何判断当前ssh没用跳板机</h3><p>check is ssh use direct connect not use jump host</p>
<h3 id="基于跳板机的x11转发"><a href="#基于跳板机的x11转发" class="headerlink" title="基于跳板机的x11转发"></a>基于跳板机的x11转发</h3><p>google check ssh gui x11 use jump host</p>
<p><a target="_blank" rel="noopener" href="https://www.ibm.com/support/pages/how-forward-x11-client-through-jump-host-back-pc-x-emulator">https://www.ibm.com/support/pages/how-forward-x11-client-through-jump-host-back-pc-x-emulator</a></p>
<ol>
<li>server side<ol>
<li><code>/etc/ssh/sshd_config</code><ol>
<li>X11Forwarding yes</li>
<li>X11UseForwarding yes</li>
</ol>
</li>
<li>install <code>xauth</code><ol>
<li>environment variables on the server. <code>DISPLAY</code> and <code>XAUTHORITY</code> will automatically be set to their proper values.</li>
<li>if <code>DISPLAY</code> is not set, it means ssh is <strong>not</strong> forwarding the X11 connection.</li>
</ol>
</li>
</ol>
</li>
<li>client side<ol>
<li><code>ForwardX11 yes</code> in <code>~/.ssh/config</code><ol>
<li><code>X11UseLocalhost yes</code></li>
</ol>
</li>
<li>ssh -v -X name@ip # -v for debug</li>
</ol>
</li>
</ol>
<h2 id="使用跳板机转发-vscode"><a href="#使用跳板机转发-vscode" class="headerlink" title="使用跳板机转发 vscode"></a>使用跳板机转发 vscode</h2><p>vlab 能正常登录的情况下<code>ssh -i D:\\PowerShell\\vlab-vm7096.pem ubuntu@vlab.ustc.edu.cn</code></p>
<p>有两种设置ssh config设置方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Host</span> jumpSnode6Ipv4W</span><br><span class="line">  <span class="title class_">Hostname</span> <span class="number">202.38</span><span class="number">.72</span><span class="number">.23</span></span><br><span class="line">  <span class="title class_">User</span> shaojiemike</span><br><span class="line">  <span class="title class_">Port</span> <span class="number">22</span></span><br><span class="line">  <span class="title class_">ProxyCommand</span> <span class="attr">C</span>:\\<span class="title class_">Windows</span>\\<span class="title class_">System32</span>\\<span class="title class_">OpenSSH</span>\\ssh.<span class="property">exe</span> -W %<span class="attr">h</span>:%p -i <span class="attr">D</span>:\\<span class="title class_">PowerShell</span>\\vlab-vm7096.<span class="property">pem</span> ubuntu@vlab.<span class="property">ustc</span>.<span class="property">edu</span>.<span class="property">cn</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Host</span> jumpSnode6Ipv4</span><br><span class="line">  <span class="title class_">Hostname</span> <span class="number">202.38</span><span class="number">.72</span><span class="number">.23</span></span><br><span class="line">  <span class="title class_">User</span> shaojiemike</span><br><span class="line">  <span class="title class_">Port</span> <span class="number">22</span></span><br><span class="line">  <span class="title class_">ProxyCommand</span> <span class="attr">C</span>:\\<span class="title class_">Windows</span>\\<span class="title class_">System32</span>\\<span class="title class_">OpenSSH</span>\\ssh.<span class="property">exe</span> -i <span class="attr">D</span>:\\<span class="title class_">PowerShell</span>\\vlab-vm7096.<span class="property">pem</span> ubuntu@vlab.<span class="property">ustc</span>.<span class="property">edu</span>.<span class="property">cn</span> netcat -w <span class="number">120</span> %h %p</span><br></pre></td></tr></table></figure>


<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1501977">https://cloud.tencent.com/developer/article/1501977</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-17T16:00:00.000Z" title="7/17/2023, 4:00:00 PM">2023-07-17</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.560Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">8 minutes read (About 1262 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/17/Work/software/linux/apt/">package manager: Apt</a></p><div class="content"><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="Ubuntu-版本代号"><a href="#Ubuntu-版本代号" class="headerlink" title="Ubuntu 版本代号"></a>Ubuntu 版本代号</h3><p>都是动物, 都是两个词，并且两个词的首字母相同,从6.06开始，首字母从D开始递增。</p>
<p>中间版本也有代号 Ubuntu 14.10 (Utopic Unicorn) Ubuntu 14.04.5 LTS (Trusty Tahr) <a target="_blank" rel="noopener" href="https://old-releases.ubuntu.com/releases/">https://old-releases.ubuntu.com/releases/</a> 官网可以查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 20.04.5 LTS</span><br><span class="line">Release:        20.04</span><br><span class="line">Codename:       focal</span><br></pre></td></tr></table></figure>

<p><img src="https://pic.shaojiemike.top/img/20221018171103.png"></p>
<h3 id="PPA（Personal-Package-Archive）"><a href="#PPA（Personal-Package-Archive）" class="headerlink" title="PPA（Personal Package Archive）"></a>PPA（Personal Package Archive）</h3><p>PPA 代表 个人包存档。PPA 允许应用程序开发人员和 Linux 用户创建自己的存储库来分发软件。使用 PPA，您可以轻松获得更新的软件版本或无法通过官方 Ubuntu 存储库获得的软件。除了PPA之外，其他操作系统也有类似的概念，例如Debian的APT存储库、Fedora的DNF存储库等。</p>
<p>常见三板斧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:dr-akulavich/lighttable</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install lighttable-installer</span><br></pre></td></tr></table></figure>

<h3 id="DEB-packages"><a href="#DEB-packages" class="headerlink" title="DEB packages"></a>DEB packages</h3><p>DEB packages（Debian Binary Package）是Debian及其基于Debian的操作系统（如Ubuntu）中使用的软件包格式。它们是一种存档格式，包含软件的二进制文件、配置文件、依赖关系和其他必要的文件。DEB packages是一种用于软件分发和安装的标准格式。</p>
<ul>
<li>相比于PPA，大部分DEB的包没有<code>source.list</code>.不能自动更新。</li>
</ul>
<h3 id="repository"><a href="#repository" class="headerlink" title="repository"></a>repository</h3><p>存储库是文件的集合，其中包含有关各种软件、其版本和其他一些详细信息（如校验和）的信息。每个 Ubuntu 版本都有自己的一套官方的四个存储库：</p>
<ul>
<li>Main – Canonical-supported free and open-source software. 规范支持的免费和开源软件。</li>
<li>Universe – Community-maintained free and open-source software. 社区维护的自由和开源软件。</li>
<li>Restricted – Proprietary drivers for devices. 设备的专有驱动程序。</li>
<li>Multiverse – Software restricted by copyright or legal issues. 受版权或法律问题限制的软件。</li>
</ul>
<h2 id="Ubuntu-添加软件源"><a href="#Ubuntu-添加软件源" class="headerlink" title="Ubuntu 添加软件源"></a>Ubuntu 添加软件源</h2><p>换源操作<a target="_blank" rel="noopener" href="https://help.ubuntu.com/stable/ubuntu-help/addremove-sources.html">官方教程</a>和<a target="_blank" rel="noopener" href="http://archive.ubuntu.com/ubuntu/dists/?ref=itsfoss.com">官方软件源</a></p>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/">清华教程</a>或者<a target="_blank" rel="noopener" href="https://mirrors.ustc.edu.cn/help/ubuntu.html#id7">科大教程</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apt/sources.list</span><br><span class="line"><span class="comment"># add link</span></span><br><span class="line"><span class="comment"># ctrl+X y enter保存</span></span><br></pre></td></tr></table></figure>

<p>清空缓存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt clean &amp;&amp; sudo apt autoclean</span><br><span class="line">sudo apt-get update /autoremove /upgrade</span><br></pre></td></tr></table></figure>

<h3 id="PPA-vs-repository"><a href="#PPA-vs-repository" class="headerlink" title="PPA vs repository"></a>PPA vs repository</h3><p>to read： <a target="_blank" rel="noopener" href="https://itsfoss.com/ppa-guide/">https://itsfoss.com/ppa-guide/</a></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="Ubuntu20-04-install-old-gcc4-8"><a href="#Ubuntu20-04-install-old-gcc4-8" class="headerlink" title="Ubuntu20.04 install old gcc4.8"></a>Ubuntu20.04 install old gcc4.8</h3><p>寻找支持gcc-4.8的apt源，也就是xenial版本的一个源。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">deb http://dk.archive.ubuntu.com/ubuntu/ xenial main</span><br><span class="line">deb http://dk.archive.ubuntu.com/ubuntu/ xenial universe</span><br><span class="line"></span><br><span class="line">sudo apt update</span><br><span class="line">//会显示 Get:54 http://dk.archive.ubuntu.com/ubuntu xenial/main i386 Packages [1,196 kB]</span><br><span class="line">sudo apt install gcc-4.8</span><br></pre></td></tr></table></figure>

<h3 id="Ubuntu20-04-install-new-glibc-2-35"><a href="#Ubuntu20-04-install-new-glibc-2-35" class="headerlink" title="Ubuntu20.04 install new glibc-2.35"></a>Ubuntu20.04 install new glibc-2.35</h3><p>Ubuntu 22.04 有对应的 glibc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<p>原本的思路是安装<code>gcc-11</code>, 结果发现<code>glibc</code>需要增量安装。需要在node5进行测试。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Unpacking libc6:i386 (2.35-0ubuntu3) over (2.31-0ubuntu9.9) ...</span><br><span class="line">Preparing to unpack .../6-libselinux1_3.3-1build2_amd64.deb ...</span><br><span class="line">De-configuring libselinux1:i386 (3.0-1build2) ...</span><br><span class="line">Unpacking libselinux1:amd64 (3.3-1build2) over (3.0-1build2) ...</span><br><span class="line">tar: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33<span class="string">&#x27; not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span></span><br><span class="line"><span class="string">tar: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&#x27;</span> not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span><br><span class="line">dpkg-deb: error: tar subprocess returned error <span class="built_in">exit</span> status 1</span><br><span class="line">dpkg: error processing archive /tmp/apt-dpkg-install-b0waQ0/7-libselinux1_3.3-1build2_i386.deb (--unpack):</span><br><span class="line"> dpkg-deb --control subprocess returned error <span class="built_in">exit</span> status 2</span><br><span class="line">tar: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33<span class="string">&#x27; not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span></span><br><span class="line"><span class="string">tar: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&#x27;</span> not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span><br><span class="line">dpkg-deb: error: tar subprocess returned error <span class="built_in">exit</span> status 1</span><br><span class="line">dpkg: error processing archive /tmp/apt-dpkg-install-b0waQ0/8-libc-bin_2.35-0ubuntu3_amd64.deb (--unpack):</span><br><span class="line"> dpkg-deb --control subprocess returned error <span class="built_in">exit</span> status 2</span><br><span class="line">Errors were encountered <span class="keyword">while</span> processing:</span><br><span class="line"> /tmp/apt-dpkg-install-b0waQ0/4-libc6_2.35-0ubuntu3_amd64.deb</span><br><span class="line"> /tmp/apt-dpkg-install-b0waQ0/7-libselinux1_3.3-1build2_i386.deb</span><br><span class="line"> /tmp/apt-dpkg-install-b0waQ0/8-libc-bin_2.35-0ubuntu3_amd64.deb</span><br><span class="line">/usr/bin/dpkg: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33<span class="string">&#x27; not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span></span><br><span class="line"><span class="string">/usr/bin/dpkg: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&#x27;</span> not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span><br><span class="line">/usr/bin/gdbus: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33<span class="string">&#x27; not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span></span><br><span class="line"><span class="string">/usr/bin/gdbus: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&#x27;</span> not found (required by /lib/x86_64-linux-gnu/libselinux.so.1)</span><br><span class="line">E: Sub-process /usr/bin/dpkg returned an error code (1)</span><br><span class="line">E: Sub-process dpkg --set-selections returned an error code (1)</span><br><span class="line">E: Couldn<span class="string">&#x27;t revert dpkg selection for approved remove/purge after an error was encountered!</span></span><br></pre></td></tr></table></figure>

<h3 id="Install-newest-gcc"><a href="#Install-newest-gcc" class="headerlink" title="Install newest gcc"></a>Install newest gcc</h3><p><a target="_blank" rel="noopener" href="https://gist.github.com/application2000/73fd6f4bf1be6600a2cf9f56315a2d91">https://gist.github.com/application2000/73fd6f4bf1be6600a2cf9f56315a2d91</a></p>
<h2 id="update-alternatives-设置软件版本"><a href="#update-alternatives-设置软件版本" class="headerlink" title="update-alternatives 设置软件版本"></a>update-alternatives 设置软件版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-6.0 1 --slave /usr/bin/clang++ clang++ /usr/bin/clang++-6.0</span><br><span class="line">sudo update-alternatives --install /usr/bin/clang clang /usr/bin/clang-10 1 --slave /usr/bin/clang++ clang++ /usr/bin/clang++-10</span><br><span class="line">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 20</span><br></pre></td></tr></table></figure>

<p>将某个版本加入gcc候选中，最后的数字是优先级.</p>
<p>运行下面命令切换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config gcc</span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="lock"><a href="#lock" class="headerlink" title="lock"></a>lock</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shaojiemike@snode6 ~/github/llvm-3.5/llvm-project  [01:59:12]</span><br><span class="line">&gt; apt update</span><br><span class="line">Reading package lists... Done</span><br><span class="line">E: Could not open lock file /var/lib/apt/lists/lock - open (13: Permission denied)</span><br><span class="line">E: Unable to lock directory /var/lib/apt/lists/</span><br><span class="line">W: Problem unlinking the file /var/cache/apt/pkgcache.bin - RemoveCaches (13: Permission denied)</span><br><span class="line">W: Problem unlinking the file /var/cache/apt/srcpkgcache.bin - RemoveCaches (13: Permission denied)</span><br></pre></td></tr></table></figure>

<p>sudo 解决</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/feinifi/article/details/121793945">https://blog.csdn.net/feinifi/article/details/121793945</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-16T16:00:00.000Z" title="7/16/2023, 4:00:00 PM">2023-07-16</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.544Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">19 minutes read (About 2811 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/16/Work/Operating%20system/userKernelMode/">User Kernel Mode</a></p><div class="content"><h2 id="内核态"><a href="#内核态" class="headerlink" title="内核态"></a>内核态</h2><p>内核态是计算机系统中的一种特权模式，用于执行操作系统内核的代码和功能。与用户态相比，内核态具有更高的权限和更广泛的访问能力，可以执行一些用户态无法执行的关键任务和操作。下面是从用户态的角度上介绍内核态的功能：</p>
<ol>
<li>系统调用（System Calls）：内核态允许用户程序通过系统调用接口请求操作系统提供的服务和功能。用户程序可以通过系统调用请求文件操作、网络通信、内存管理等操作。当用户程序执行系统调用时，会触发从用户态切换到内核态的转换，以便内核在高权限下执行相应的操作。</li>
<li>资源管理：内核态负责管理计算机系统的各种资源，包括处理器、内存、磁盘、网络等。在内核态下，操作系统可以对这些资源进行分配、调度和释放，确保资源的有效利用和合理分配。</li>
<li>中断处理：当发生硬件中断或异常时，内核态负责处理中断并提供相应的服务。例如，当用户程序需要与设备进行交互时，内核可以响应设备的中断信号，进行数据传输、状态检查等操作。</li>
<li>进程管理：内核态负责创建、销毁和管理进程。它可以调度进程，分配和回收进程所需的资源，并在必要时进行进程间的通信和同步。</li>
<li>内存管理：内核态控制着计算机系统的内存分配和管理。它负责将物理内存分配给进程，并维护虚拟内存和物理内存之间的映射关系。内核还处理内存保护、页面置换、内存回收等任务。</li>
<li>设备驱动程序：内核态包含设备驱动程序，用于与硬件设备进行交互。它允许操作系统通过设备驱动程序来控制和管理硬件设备，如磁盘驱动程序、网络驱动程序等。</li>
<li>安全和权限管理：内核态能够执行与系统安全和权限相关的任务。它可以控制对系统资源的访问权限，并确保用户程序不能越权访问或修改关键数据和系统配置。</li>
</ol>
<p>总的来说，内核态提供了操作系统核心功能的执行环境，拥有更高的权限和更广泛的访问能力，使得操作系统能够管理和控制计算机系统的各个方面，同时为用户程序提供必要的服务和保护。</p>
<h3 id="代码位置"><a href="#代码位置" class="headerlink" title="代码位置"></a>代码位置</h3><p><img src="https://pic.shaojiemike.top/img/20211225203420.png"></p>
<p>在Linux系统中，每个进程的虚拟地址空间中的高位部分通常被映射为内核空间，其中包含了内核态的代码和数据。这个区域通常被称为内核空间或内核页表。内核空间中的内容包括以下两类：</p>
<ol>
<li>内核代码：内核代码是操作系统内核的实现，包括各种系统调用、设备驱动程序和核心功能的代码。这些代码用于提供操作系统的各种服务和功能，如文件系统操作、进程管理、内存管理、网络通信等。内核代码是所有进程共享的，因为它们代表了操作系统的核心部分，为所有进程提供服务。</li>
<li>共享内核数据结构：内核空间中还包含一些共享的内核数据结构，用于维护系统状态和资源管理。例如，进程调度器、内存管理数据结构、文件描述符表等。这些数据结构被多个进程共享，以便内核能够管理和控制系统资源的分配和使用。</li>
</ol>
<p>除了以上共享的内容，内核空间还包含一些每个进程独有的部分，例如：</p>
<ol>
<li>进程描述符（Process Descriptor）：每个进程都有一个唯一的进程描述符，其中包含了进程的状态信息、上下文和其他与进程相关的数据。进程描述符存储在内核空间，每个进程都有自己独立的进程描述符。</li>
<li>用户栈和内核栈：每个进程都有自己的用户栈和内核栈。用户栈用于保存进程在用户态执行时的局部变量和函数调用信息，而内核栈用于保存进程在内核态执行时的上下文信息和函数调用。（内核函数也要嵌套调用）</li>
</ol>
<p>总结起来，Linux进程的高位部分映射了内核空间，其中包含了内核代码、共享的内核数据结构以及每个进程独有的部分，如进程描述符和栈空间。这种映射允许进程与内核进行交互和访问操作系统的功能和服务。</p>
<h3 id="如何共享"><a href="#如何共享" class="headerlink" title="如何共享"></a>如何共享</h3><p>在内核中，代码共享并不是通过动态链接库（.so）的模式来实现的。内核态的代码通常被编译成内核模块或者直接编译进内核映像中，而不是作为独立的可加载库。因此，内核中的代码共享机制与用户空间中的动态链接库不同。</p>
<p>在内核中，代码共享是通过代码复用和内核模块的概念来实现的。内核模块是一种可以动态加载和卸载的代码和数据集合，它可以扩展内核的功能。内核模块可以包含新的设备驱动程序、文件系统、网络协议等，以便在需要时被加载到内核中运行。</p>
<p>内核模块的加载过程可以在运行时根据需要进行，而不需要重新编译整个内核。这样，多个进程可以共享同一个内核模块，从而实现内核代码的共享。当多个进程需要使用某个内核模块时，模块只需要加载一次，然后被多个进程共享调用。</p>
<p>值得注意的是，内核中的代码共享是在内核空间内部进行的，与用户空间的动态链接库不同，它不涉及用户进程的地址空间和加载机制。内核模块的共享是在内核内部完成的，不同进程间可以通过系统调用接口访问共享的内核模块提供的功能和服务。</p>
<p>总结起来，内核中的代码共享是通过内核模块的加载和运行机制来实现的，而不是像用户空间中的动态链接库那样。内核模块可以被多个进程共享调用，从而提供共享的内核功能和服务。</p>
<h2 id="内核态与用户态切换"><a href="#内核态与用户态切换" class="headerlink" title="内核态与用户态切换"></a>内核态与用户态切换</h2><h3 id="切换时机"><a href="#切换时机" class="headerlink" title="切换时机"></a>切换时机</h3><p>内核态与用户态的切换通常由以下几种情况触发：</p>
<ul>
<li>系统调用（System Call）：当用户程序通过系统调用请求操作系统提供的服务时，会触发从用户态到内核态的切换。这是最常见的切换方式。</li>
<li>异常（Exception）和中断（Interrupt）：当发生硬件中断、软件中断（如除零错误）、内存访问错误等异常情况时，CPU会切换到内核态来处理异常。这些异常可以是由程序错误、设备请求或其他条件引起的。</li>
<li>外部事件：例如时钟中断、I&#x2F;O 完成中断等，这些事件可能需要内核处理，因此会导致从用户态切换到内核态。</li>
</ul>
<h3 id="切换的细节"><a href="#切换的细节" class="headerlink" title="切换的细节"></a>切换的细节</h3><p>当进程从用户态切换到内核态，或者从内核态切换回用户态时，涉及到特权级的切换和上下文的保存与恢复。下面是内核态与用户态切换的一般细节：</p>
<ol>
<li><p>特权级切换：内核态拥有更高的特权级别，因此从用户态切换到内核态时，CPU会从当前运行的用户模式切换到内核模式。这种切换会改变CPU的状态，包括特权级、堆栈和指令指针。</p>
</li>
<li><p>上下文保存与恢复：在切换到内核态之前，CPU会保存当前用户态下的进程上下文信息，包括程序计数器（PC）、寄存器的值、堆栈指针等。这些上下文信息保存在进程的内核栈中。</p>
</li>
<li><p>内核态执行：当切换到内核态后，CPU开始执行相应的内核代码，处理请求或异常。在内核态下，操作系统可以访问和操作系统的所有资源和功能，执行必要的操作。</p>
</li>
<li><p>上下文恢复与切换回用户态：当内核态的任务完成后，CPU会从内核栈中恢复之前保存的进程上下文信息。然后，CPU会将特权级切换回用户态，并从保存的程序计数器继续执行用户程序。</p>
</li>
</ol>
<p>需要注意的是，内核态与用户态的切换涉及到CPU和操作系统的底层机制，具体细节可能会因操作系统的设计和架构而有所不同。上述描述是一般情况下的概述，不同的操作系统和处理器架构可能会有特定的实现细节。</p>
<h3 id="开销来源"><a href="#开销来源" class="headerlink" title="开销来源"></a>开销来源</h3><ol>
<li>特权级切换</li>
<li>上下文保存与恢复</li>
<li>由于PTI的存在，内核维护了两套页表。切换到内核态时，可能需要切换内存地址空间的映射关系，例如将用户态的虚拟地址空间映射为内核态的地址空间。这可能涉及页表的切换和TLB（Translation Lookaside Buffer）的刷新，会带来一定的延迟和开销。</li>
</ol>
<h3 id="量化"><a href="#量化" class="headerlink" title="量化"></a>量化</h3><p>内核态与用户态的切换时间在数百到数千个CPU周期之间</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-15T16:00:00.000Z" title="7/15/2023, 4:00:00 PM">2023-07-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.544Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">41 minutes read (About 6223 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/15/Work/Operating%20system/Disk/">Disk</a></p><div class="content"><h2 id="lsblk命令"><a href="#lsblk命令" class="headerlink" title="lsblk命令"></a>lsblk命令</h2><p>MAJ:MIN  主:次 设备号</p>
<p>TYPE：块设备类型，比如disk磁盘，part分区，lvm逻辑卷，rom只读存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk -f # 查看磁盘分区格式，有格式才能挂载成功。</span><br><span class="line">NAME   FSTYPE   LABEL UUID                                 FSAVAIL FSUSE% MOUNTPOINT</span><br><span class="line">sda</span><br><span class="line">├─sda1</span><br><span class="line">└─sda2 ext4           9449ee1e-7cdb-4852-9c60-73959ce812c0   18.1G    93% /</span><br><span class="line">sdb</span><br></pre></td></tr></table></figure>

<h2 id="fdisk命令"><a href="#fdisk命令" class="headerlink" title="fdisk命令"></a>fdisk命令</h2><h2 id="blkid命令"><a href="#blkid命令" class="headerlink" title="blkid命令"></a>blkid命令</h2><p>使用blkid命令对查询设备上所采用文件系统类型进行查询。blkid主要用来对系统的块设备（包括交换分区）所使用的文件系统类型、LABEL、UUID等信息进行查询。要使用这个命令必须安装e2fsprogs软件包。</p>
<h3 id="分区已有文件系统"><a href="#分区已有文件系统" class="headerlink" title="分区已有文件系统"></a>分区已有文件系统</h3><p>直接使用blkid可列出当前系统中所以已挂载文件系统的类型。(或者 check <code>/etc/fstab</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; blkid</span><br><span class="line">/dev/sdb: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;dc35a623-6a3e-f4fe-f9f7-05e102a9c7ec&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdc: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;7772d530-24d2-2064-29a3-9d61c0b6289e&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sda: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;683c1101-69b1-f2c6-586b-155fbda91846&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdd1: UUID=<span class="string">&quot;F51A-FBBA&quot;</span> TYPE=<span class="string">&quot;vfat&quot;</span> PARTUUID=<span class="string">&quot;f377e755-9c1e-41dd-b50b-cb50a095be4c&quot;</span></span><br><span class="line">/dev/sdd2: UUID=<span class="string">&quot;3df43f90-d64c-4061-bbca-2614ecc57f34&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;c599a2f0-9888-4f86-88fb-a49b9cde4666&quot;</span></span><br><span class="line">/dev/sdd3: UUID=<span class="string">&quot;f12ca879-4545-46b7-bb2e-bdcdf771cb96&quot;</span> TYPE=<span class="string">&quot;swap&quot;</span> PARTUUID=<span class="string">&quot;bb5ab1b6-f67b-46fc-aead-14b8b86972ad&quot;</span></span><br><span class="line">/dev/sdd4: UUID=<span class="string">&quot;07fbfa2a-6b48-4423-9260-dc36080b42c4&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;6b4f7a39-1c0f-4fcf-a407-b31e469a3cdc&quot;</span></span><br><span class="line">/dev/sdf: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;86ffe123-2c7f-f7f1-40a0-57a12982fe17&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdg: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;36a06a4f-c84e-0684-8997-2997a68de012&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdh: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;369a926d-1f63-f397-ba4e-3118ef2ecf1d&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sde: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;4dd3f6ca-1e73-2606-ec65-c98badcd77ad&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/md0p1: UUID=<span class="string">&quot;c960e42b-f321-482d-aed4-c90f29e77291&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;d0949a94-c6e4-4621-890b-8d3f2d70fe57&quot;</span></span><br><span class="line">/dev/md0p2: UUID=<span class="string">&quot;addb8c13-8e34-4d8a-995b-101638f2dcbb&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;c6594348-58c5-49c2-9f40-82ce49653b7c&quot;</span></span><br><span class="line">/dev/md0p3: UUID=<span class="string">&quot;3354846e-7bec-45fb-8b59-4c6d60340d0d&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;8012f7e0-7dfa-46c5-b748-ef04d68a31ed&quot;</span></span><br><span class="line">/dev/md0p4: UUID=<span class="string">&quot;def8fb56-701e-4d6c-81d9-ecb765cc4d06&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;f6bb7944-fb1c-42de-af77-545c26303ad2&quot;</span></span><br><span class="line">/dev/md0p5: UUID=<span class="string">&quot;2f0590a9-6490-4758-999f-bdb5ef5954db&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;bbfe02f4-6b6a-4eeb-bb58-92b8b14b0997&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&gt; blkid -o list</span><br><span class="line">device                                                                       fs_type         label            mount point                                                                      UUID</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">/dev/sdb                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sdc                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sda                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sdd1                                                                                         vfat                                       /boot/efi                                                                                             F51A-FBBA</span><br><span class="line">/dev/sdd2                                                                                         ext4                                       /                                                                                                     3df43f90-d64c-4061-bbca-2614ecc57f34</span><br><span class="line">/dev/sdd3                                                                                         swap                                       [SWAP]                                                                                                f12ca879-4545-46b7-bb2e-bdcdf771cb96</span><br><span class="line">/dev/sdd4                                                                                         ext4                                       /tmp                                                                                                  07fbfa2a-6b48-4423-9260-dc36080b42c4</span><br><span class="line">/dev/sdf                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sdg                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sdh                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/sde                                                                                          linux_raid_member    ubuntu-server:0       (not mounted)                                                                                         2d900913-d0a4-4a15-7bd8-46dda015c95e</span><br><span class="line">/dev/md0p1                                                                                        ext4                                       /home                                                                                                 c960e42b-f321-482d-aed4-c90f29e77291</span><br><span class="line">/dev/md0p2                                                                                        ext4                                       /usr                                                                                                  addb8c13-8e34-4d8a-995b-101638f2dcbb</span><br><span class="line">/dev/md0p3                                                                                        ext4                                       /boot                                                                                                 3354846e-7bec-45fb-8b59-4c6d60340d0d</span><br><span class="line">/dev/md0p4                                                                                        ext4                                       /var                                                                                                  def8fb56-701e-4d6c-81d9-ecb765cc4d06</span><br><span class="line">/dev/md0p5                                                                                        ext4                                       /srv                                                                                                  2f0590a9-6490-4758-999f-bdb5ef5954db</span><br></pre></td></tr></table></figure>

<h3 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h3><p>帮助使用者<strong>唯一</strong>的确定系统中的<strong>所有存储设备</strong>，不管它们是什么类型的。它可以标识DVD驱动器，USB存储设备以及你系统中的硬盘设备等。</p>
<p>使用原因包括：设备名并非总是不变的</p>
<h2 id="df-命令"><a href="#df-命令" class="headerlink" title="df 命令"></a>df 命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">shaojiemike@brainiac1 ~/blockFrequency  [08:02:54]</span><br><span class="line">&gt; <span class="built_in">df</span> -lh </span><br><span class="line">文件系统        容量  已用  可用 已用% 挂载点</span><br><span class="line">udev             94G     0   94G    0% /dev</span><br><span class="line">tmpfs            19G  4.3M   19G    1% /run</span><br><span class="line">/dev/sdd2       984G   12G  923G    2% /</span><br><span class="line">tmpfs            95G   88K   95G    1% /dev/shm</span><br><span class="line">tmpfs           5.0M     0  5.0M    0% /run/lock</span><br><span class="line">tmpfs            95G     0   95G    0% /sys/fs/cgroup</span><br><span class="line">/dev/md0p3       20G  347M   19G    2% /boot</span><br><span class="line">/dev/sdd4        53G  319M   50G    1% /tmp</span><br><span class="line">/dev/md0p5       47G   53M   45G    1% /srv</span><br><span class="line">/dev/sdd1       511M  3.6M  508M    1% /boot/efi</span><br><span class="line">/dev/md0p4      590G  5.7G  554G    2% /var</span><br><span class="line">/dev/md0p1      6.5T  5.1T  1.2T   82% /home</span><br><span class="line">/dev/loop0       49M   49M     0  100% /snap/core18/2289</span><br><span class="line">/dev/loop1       58M   58M     0  100% /snap/core20/1360</span><br><span class="line">/dev/loop3       38M   38M     0  100% /snap/snapd/14982</span><br><span class="line">/dev/loop4       38M   38M     0  100% /snap/snapd/15183</span><br><span class="line">/dev/loop2       58M   58M     0  100% /snap/core20/1380</span><br><span class="line">/dev/loop5       61M   61M     0  100% /snap/lxd/21843</span><br><span class="line">/dev/loop7       49M   49M     0  100% /snap/core18/2349</span><br><span class="line">/dev/loop6       62M   62M     0  100% /snap/lxd/22530</span><br><span class="line">tmpfs            19G     0   19G    0% /run/user/1006</span><br><span class="line">tmpfs            19G     0   19G    0% /run/user/1008</span><br><span class="line">tmpfs            19G     0   19G    0% /run/user/1005</span><br></pre></td></tr></table></figure>

<h2 id="snap的机制"><a href="#snap的机制" class="headerlink" title="snap的机制"></a>snap的机制</h2><p>一种新的<a target="_blank" rel="noopener" href="https://www.ubuntukylin.com/news/666-cn.html">安装包管理方式</a>。使用<code>snapcraft</code>将软件打包成snap格式的打包工具集。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+-----------+       +------------+      +------------+</span><br><span class="line">| Developer +------&gt;| Snapcraft  +-----&gt;| Snap Store |</span><br><span class="line">+-----------+       +------------+      +-----+------+</span><br><span class="line">                                              | update     </span><br><span class="line">                                              v       </span><br><span class="line">+-----------+       +------------+      +------------+</span><br><span class="line">| End User  +------&gt;|   Snap     +-----&gt;|   Snapd    |</span><br><span class="line">+-----------+       +-----+------+      +-----+------+</span><br><span class="line">                          | containerize      |       </span><br><span class="line">                          v                   |       </span><br><span class="line">                    +------------+            |       </span><br><span class="line">                    |   Snaps    |&lt;-----------+ manage</span><br><span class="line">                    +------------+     </span><br></pre></td></tr></table></figure>

<h3 id="core"><a href="#core" class="headerlink" title="core"></a>core</h3><p>snap的每个版本软件会，占用一个<code>/dev/loop</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/snap/core18 代表ubuntu 18版本的软件所运行的环境</span><br><span class="line">/snap/core20 代表ubuntu 20版本的软件所运行的环境</span><br></pre></td></tr></table></figure>

<p>Snap应用运行在以Ubuntu<br>为核心的容器里，与各个发行版做到了解耦。因此Snap应用的开发者很开心了，<br>只需保证自己应用在[Ubuntu Core]欢快运行即可，不需要考虑其他发行版的适配。</p>
<h3 id="snapd"><a href="#snapd" class="headerlink" title="snapd"></a>snapd</h3><p>Snap应用由<code>snapd</code>守护进程管理。snapd每天会去Snap Store查本地Snap应<br>用有没有可用更新，如果有，就把更新拿下来，应用到当前Snap应用上。自动更新不可关闭,但是可以设置延迟60天。</p>
<h3 id="lxc-lxd"><a href="#lxc-lxd" class="headerlink" title="lxc&#x2F;lxd"></a>lxc&#x2F;lxd</h3><p><code>lxc</code>是Linux Container的简写，它是一种内核虚拟化技术，可以提供轻量级的虚拟化，以便隔离进程和资源；它不需要提供指令解释机制，没有全虚拟化的复杂性，相当于C++中的NameSpace。<br><code>lxc</code>容器能有效地把操作系统管理的资源划分到不同的组中，并能在不同的组之间平衡有冲突的资源使用需求，因此它可以在单一的主机节点上同时执行多个相互隔离的容器。</p>
<p><code>lxd</code>是基于<code>lxc</code>构筑的容器管理进程，提供镜像、网络、存储、以及容器等能力。<br>  <br>大家可能有个疑问，为什么不用docker容器呢？docker容器原先也是我的首选，但实际操作过程中发现snap包安装所需要的squashfs文件系统在docker中无法mount，会出现如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system does not fully support snapd: cannot mount squashfs imag  </span><br></pre></td></tr></table></figure>

<h2 id="tmpfs"><a href="#tmpfs" class="headerlink" title="tmpfs"></a>tmpfs</h2><p><code>/dev/shm</code>下的tmpfs是内存的一半,是一个临时文件系统，驻留在内存中，所以&#x2F;dev&#x2F;shm&#x2F;这个目录不在硬盘上，而是在内存里。因为是在内存里，所以读写非常快，可以提供较高的访问速度。</p>
<p><code>/sys/fs/cgroup</code>是systemd在代码里自动挂载的。cgroups(Control Groups) 是 linux 内核提供的一种机制，这种机制可以根据需求把一系列系统任务及其子任务整合(或分隔)到按资源划分等级的不同组内，从而为系统资源管理提供一个统一的框架。简单说，cgroups 可以限制、记录任务组所使用的物理资源。</p>
<p><code>/run/user</code>是每个login的用户所需的一些数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">ls</span> /run/user -l</span><br><span class="line">总用量 0</span><br><span class="line">drwx------ 7 qcjiang     qcjiang     360 Jul 11 14:54 1005</span><br><span class="line">drwx------ 7 shaojiemike shaojiemike 780 Jul 11 01:10 1006</span><br><span class="line">drwx------ 7 zwcao       zwcao       360 Jul  9 15:48 1008</span><br><span class="line">drwx------ 7 udfrt       udfrt       200 Jul 11 16:03 1010</span><br></pre></td></tr></table></figure>

<p>利用tmpfs这个特性可以用来提高服务器性能，把一些对读写性能要求较高，但是数据又可以丢失的这样的数据保存在&#x2F;dev&#x2F;shm中，来提高访问速度。</p>
<p>tmpfs用途还是较广的，Linux中可以把一些程序的临时文件放置在tmpfs中，利用tmpfs比硬盘速度快的特点来提升系统性能。比如可以用来放squid程序的缓存文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时调整大小，重启后会恢复正常，恢复为内存一半大小。</span></span><br><span class="line">mount -o remount,size=777M tmpfs /dev/shm</span><br><span class="line"><span class="comment"># 永久修改</span></span><br><span class="line">vim  /etc/fstab </span><br><span class="line"><span class="comment"># 把tmpfs这一行改为：</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults,size=777M     0 0</span><br></pre></td></tr></table></figure>

<h2 id="etc-fstab-解析"><a href="#etc-fstab-解析" class="headerlink" title="&#x2F;etc&#x2F;fstab 解析"></a>&#x2F;etc&#x2F;fstab 解析</h2><p>&#x2F;etc&#x2F;fstab 是专门用配置挂载硬盘的文件</p>
<p>语法为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Device] [Mount Point] [File System Type] [Options] [Dump] [Pass]</span><br><span class="line"></span><br><span class="line">[Device] 包含文件系统的device或者partition </span><br><span class="line">[Mount Point] 挂载的目录，从该目录可以访问设备/分区的内容（注意：swap没有装入点）</span><br><span class="line">[File System Type] 文件系统类型</span><br><span class="line">[Options] mount的选项，默认的defaults</span><br><span class="line">[Dump] 是否开启备份，0 来表示不备份这个区</span><br><span class="line">[Pass]  fsck是否会check该区域，0表示不检查。fsck （文件系统检查）是一种命令行程序，可让您在一个或多个Linux文件系统上执行一致性检查和交互式修复。 它用于检查指定类型文件系统。 在系统无法启动或无法安装分区的情况下，可以使用 fsck 命令修复损坏的文件系统。</span><br></pre></td></tr></table></figure>

<h3 id="Device"><a href="#Device" class="headerlink" title="Device"></a>Device</h3><p>device 有两种表示方式，可以用&#x2F;dev&#x2F;xdx 之类的location 或者 硬件的UUID 来表示，硬件的UUID 可以用<code>blkid</code> 来查询</p>
<p>对于uuid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># / was on /dev/sdd2 during curtin installation  </span></span><br><span class="line">/dev/disk/by-uuid/3df43f90-d64c-4061-bbca-2614ecc57f34 / ext4 defaults 0 0</span><br><span class="line"></span><br><span class="line">&gt; blkid |grep 3df</span><br><span class="line">/dev/sdd2: UUID=<span class="string">&quot;3df43f90-d64c-4061-bbca-2614ecc57f34&quot;</span> TYPE=<span class="string">&quot;ext4&quot;</span> PARTUUID=<span class="string">&quot;c599a2f0-9888-4f86-88fb-a49b9cde4666&quot;</span></span><br></pre></td></tr></table></figure>

<p>对于id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /home was on /dev/md0p1 during curtin installation                                            </span></span><br><span class="line">/dev/disk/by-id/md-uuid-2d900913:d0a44a15:7bd846dd:a015c95e-part1 /home ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /usr was on /dev/md0p2 during curtin installation</span></span><br><span class="line">/dev/disk/by-id/md-uuid-2d900913:d0a44a15:7bd846dd:a015c95e-part2 /usr ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /boot was on /dev/md0p3 during curtin installation</span></span><br><span class="line">/dev/disk/by-id/md-uuid-2d900913:d0a44a15:7bd846dd:a015c95e-part3 /boot ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /var was on /dev/md0p4 during curtin installation</span></span><br><span class="line">/dev/disk/by-id/md-uuid-2d900913:d0a44a15:7bd846dd:a015c95e-part4 /var ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /srv was on /dev/md0p5 during curtin installation</span></span><br><span class="line">/dev/disk/by-id/md-uuid-2d900913:d0a44a15:7bd846dd:a015c95e-part5 /srv ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; blkid |grep a015c95e</span><br><span class="line">/dev/sdb: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;dc35a623-6a3e-f4fe-f9f7-05e102a9c7ec&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdc: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;7772d530-24d2-2064-29a3-9d61c0b6289e&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sda: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;683c1101-69b1-f2c6-586b-155fbda91846&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdf: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;86ffe123-2c7f-f7f1-40a0-57a12982fe17&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdg: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;36a06a4f-c84e-0684-8997-2997a68de012&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sdh: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;369a926d-1f63-f397-ba4e-3118ef2ecf1d&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br><span class="line">/dev/sde: UUID=<span class="string">&quot;2d900913-d0a4-4a15-7bd8-46dda015c95e&quot;</span> UUID_SUB=<span class="string">&quot;4dd3f6ca-1e73-2606-ec65-c98badcd77ad&quot;</span> LABEL=<span class="string">&quot;ubuntu-server:0&quot;</span> TYPE=<span class="string">&quot;linux_raid_member&quot;</span></span><br></pre></td></tr></table></figure>

<p>这里可以看到这7个硬盘的UUID是一样的，说明属于同一个RAID文件系统卷，但是子卷UUID_SUB是不一样的</p>
<p>问题:</p>
<ol>
<li>为什么8块盘里<code>/dev/sdd1</code>第四块被拆成了4份</li>
<li>blkid里的<ol>
<li>UUID_SUB 什么意思</li>
<li>&#x2F;dev&#x2F;md0p1<ol>
<li>好像和GPT分区有关</li>
</ol>
</li>
<li>为什么device里 &#x2F;dev&#x2F;md0p1 没和blkid的对应上</li>
</ol>
</li>
</ol>
<h3 id="File-System-Type"><a href="#File-System-Type" class="headerlink" title="File System Type"></a>File System Type</h3><p>auto, vfat( for FAT partition), ntfs or ntfs-3g( for NTFS partition), ext4 or ext3 or ext2 or jfs,  udf or iso9660 ( for CD&#x2F;DVD), swap</p>
<h2 id="磁盘分区-MBR-vs-GPT"><a href="#磁盘分区-MBR-vs-GPT" class="headerlink" title="磁盘分区 MBR vs GPT"></a>磁盘分区 MBR vs GPT</h2><p>当服务器插入一块硬盘，如果我们想要使用该硬盘，需要先使用磁盘分区管理工具进行磁盘分区，然后格式化分区，把分区挂载到目录</p>
<p>上，才可以正式使用该硬盘存储文件。磁盘分区管理工具有很多，本文主要介绍fdisk，gdisk,parted，并进行比较。</p>
<h3 id="判断分区是GPT还是MBR"><a href="#判断分区是GPT还是MBR" class="headerlink" title="判断分区是GPT还是MBR"></a>判断分区是GPT还是MBR</h3><p><code>fdisk -l</code>和<code>gdisk -l /dev/sda</code>都可以，下面介绍另一种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo parted -l</span><br><span class="line">型号：TOSHIBA AL15SEB120N (scsi)                                                                                 磁盘 /dev/sdd: 1200GB</span><br><span class="line">扇区大小 (逻辑/物理)：512B/512B</span><br><span class="line">分区表：gpt</span><br><span class="line">磁盘标志：</span><br><span class="line"></span><br><span class="line">编号  起始点  结束点  大小    文件系统        名称  标志</span><br><span class="line"> 1    1049kB  538MB   537MB   fat32                 启动, EFI 启动</span><br><span class="line"> 2    538MB   1074GB  1074GB  ext4</span><br><span class="line"> 3    1074GB  1143GB  68.7GB  linux-swap(v1)        交换</span><br><span class="line"> 4    1143GB  1200GB  57.2GB  ext4</span><br><span class="line"></span><br><span class="line">型号：Linux 软件 RAID 数组 (md)</span><br><span class="line">磁盘 /dev/md0: 8401GB</span><br><span class="line">扇区大小 (逻辑/物理)：512B/512B</span><br><span class="line">分区表：gpt</span><br><span class="line">磁盘标志：</span><br><span class="line"></span><br><span class="line">编号  起始点  结束点  大小    文件系统  名称  标志</span><br><span class="line"> 1    1049kB  7147GB  7147GB  ext4</span><br><span class="line"> 2    7147GB  7684GB  537GB   ext4</span><br><span class="line"> 3    7684GB  7705GB  21.5GB  ext4</span><br><span class="line"> 4    7705GB  8349GB  644GB   ext4</span><br><span class="line"> 5    8349GB  8401GB  51.3GB  ext4</span><br></pre></td></tr></table></figure>

<p>可以看出上面的普通硬盘和RAID0都是GPT。#显示Partition Table: msdos，则是MBR分区</p>
<h3 id="MBR-Master-Boot-Record"><a href="#MBR-Master-Boot-Record" class="headerlink" title="MBR(Master Boot Record)"></a>MBR(Master Boot Record)</h3><p>是传统的分区机制，应用于绝大多数使用BIOS引导的PC设备（苹果使用EFI的方式），很多Server服务器即支持BIOS也支持EFI的引导方式。MBR只支持不超过2TB的硬盘。</p>
<p>MBR分区分为:</p>
<ol>
<li>主分区（一块硬盘最多只能创建4个主分区）、</li>
<li>扩展分区（一个扩展分区会占用一个主分区的位置）、</li>
<li>逻辑分区（逻辑分区是基于扩展分区创建出来的，<ol>
<li>先有扩展分区，然后在扩展分区的基础上再创建逻辑分区；</li>
<li>也就是说我们要使用逻辑分区，必须先要创建扩展分区，扩展分区的空间是不能被直接使用的，</li>
<li>我们必须在扩展分区的基础上去建立逻辑分区，才能够被使用）。</li>
</ol>
</li>
<li>在Linux上使用扩展分区和逻辑分区最多可以创建15个分区；</li>
</ol>
<h3 id="GPT-GUID-Partition-Table-分区"><a href="#GPT-GUID-Partition-Table-分区" class="headerlink" title="GPT(GUID Partition Table)分区"></a>GPT(GUID Partition Table)分区</h3><p>解决了MBR的很多缺点；<br>​1. 支持超过2TB的磁盘；<br>​2. 向后兼容MBR；<br>3. GPT分区只支持64位操作系统；</p>
<h3 id="fdisk对-dev-sdb硬盘进行分区"><a href="#fdisk对-dev-sdb硬盘进行分区" class="headerlink" title="fdisk对&#x2F;dev&#x2F;sdb硬盘进行分区"></a>fdisk对&#x2F;dev&#x2F;sdb硬盘进行分区</h3><p><strong>必须</strong>先取消挂载，取消挂载后分区。不然分区结果重启后会消失，文件全没了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /mnt/ <span class="comment">#挂载目录</span></span><br></pre></td></tr></table></figure>

<p>创建一个主分区，一个扩展分区，其中扩展分区包含两个逻辑分区。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br><span class="line">sdb               8:16   0    1G  0 disk </span><br><span class="line">└─sdb1            8:17   0  200M  0 part </span><br></pre></td></tr></table></figure>

<p>sdb这块磁盘大小为1G。而且已有分区sdb1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># fdisk /dev/sdb</span></span><br><span class="line">p              <span class="comment">#打印分区表</span></span><br><span class="line">d         <span class="comment">#因为此磁盘只有一个分区sdb1，所以按d删除时候默认不会让选择要删除的分区，如果有多个分区会提示要删除的分区。</span></span><br><span class="line">p        <span class="comment">#打印分区表，再次查看分区表，发现/dev/sdb1已经被删除</span></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n                  <span class="comment">#新建分区</span></span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)             <span class="comment">#主分区</span></span><br><span class="line">   e   extended                                            <span class="comment">#扩展分区</span></span><br><span class="line">Select (default p): p                                      <span class="comment">#选择新建主分区</span></span><br><span class="line">Partition number (1-4, default 1):                         <span class="comment">#主分区号，会生成/dev/sdb1</span></span><br><span class="line">First sector (2048-2097151, default 2048):                  <span class="comment">#开始扇区，回车默认从2048开始</span></span><br><span class="line">Using default value 2048</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-2097151, default 2097151): +50M     <span class="comment">#分配主分区大小，在此为50M</span></span><br><span class="line">Partition 1 of <span class="built_in">type</span> Linux and of size 50 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n                    <span class="comment">#新建分区</span></span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): e                      <span class="comment">#选择创建扩展分区</span></span><br><span class="line">Partition number (2-4, default 2):          <span class="comment">#扩展分区编号，在此我们直接回车，默认为/dev/sdb2</span></span><br><span class="line">First sector (104448-2097151, default 104448):               <span class="comment">#默认回车，从当前扇区开始</span></span><br><span class="line">Using default value 104448</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (104448-2097151, default 2097151): +500M    <span class="comment">#分配扩展分区大小，在此为500M</span></span><br><span class="line">Partition 2 of <span class="built_in">type</span> Extended and of size 500 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l                         <span class="comment">#新建逻辑分区</span></span><br><span class="line">Adding logical partition 5                    <span class="comment">#默认逻辑分区编号为5</span></span><br><span class="line">First sector (106496-1128447, default 106496):                 <span class="comment">#逻辑分区起始位置</span></span><br><span class="line">Using default value 106496</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (106496-1128447, default 1128447): +200M     <span class="comment">#分配逻辑分区大小，在此为200M</span></span><br><span class="line">Partition 5 of <span class="built_in">type</span> Linux and of size 200 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n     </span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l                   <span class="comment">#新建第二个逻辑分区</span></span><br><span class="line">Adding logical partition 6</span><br><span class="line">First sector (518144-1128447, default 518144): </span><br><span class="line">Using default value 518144</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (518144-1128447, default 1128447):             <span class="comment">#直接回车，默认分配剩余空间</span></span><br><span class="line">Using default value 1128447</span><br><span class="line">Partition 6 of <span class="built_in">type</span> Linux and of size 298 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">...</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048      104447       51200   83  Linux</span><br><span class="line">/dev/sdb2          104448     1128447      512000    5  Extended</span><br><span class="line">/dev/sdb5          106496      516095      204800   83  Linux</span><br><span class="line">/dev/sdb6          518144     1128447      305152   83  Linux</span><br><span class="line"></span><br><span class="line"><span class="comment">#通过如上输出可知，/dev/sdb1为主分区，/dev/sdb2为扩展分区，扩展分区又包含两个逻辑分区/dev/sdb5和/dev/sdb6</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w            <span class="comment">#保存分区信息并退出</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node5 ~]<span class="comment"># lsblk</span></span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdb               8:16   0    1G  0 disk </span><br><span class="line">├─sdb1            8:17   0   50M  0 part </span><br><span class="line">├─sdb2            8:18   0    1K  0 part </span><br><span class="line">├─sdb5            8:21   0  200M  0 part </span><br><span class="line">└─sdb6            8:22   0  298M  0 part </span><br></pre></td></tr></table></figure>

<h3 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h3><p>把&#x2F;dev&#x2F;sdb5格式化成ext4文件系统<br><code>[root@node5 ~]# mkfs.ext4 /dev/sdb5</code></p>
<h3 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /sdb5</span><br><span class="line">mount /dev/sdb5 /sdb5</span><br></pre></td></tr></table></figure>

<h3 id="设置开机自动挂载分区"><a href="#设置开机自动挂载分区" class="headerlink" title="设置开机自动挂载分区"></a>设置开机自动挂载分区</h3><p>磁盘分区使用mount手动挂载之后，还需要把挂载信息写入<code>/etc/fstab</code>文件中，不然重启之后，需要重新挂载。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -a <span class="comment">#重新加载内核</span></span><br></pre></td></tr></table></figure>

<h2 id="RAID-mdadm"><a href="#RAID-mdadm" class="headerlink" title="RAID - mdadm"></a>RAID - mdadm</h2><p>mdadm是一个用于创建、管理、监控RAID设备的工具，它使用linux中的md驱动。mdadm程序是一个独立的程序，能完成所有软件RAID的管理功能。常见功能如下:</p>
<ol>
<li>mdadm –create device options…<ol>
<li>Create a new array from unused devices.</li>
</ol>
</li>
<li>mdadm –manage device options…<ol>
<li>make changes to an existing array.</li>
</ol>
</li>
<li>mdadm –misc options… devices<ol>
<li>report on or modify various md related devices.</li>
</ol>
</li>
</ol>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>配置文件，默认是”&#x2F;etc&#x2F;mdadm.conf”或者是”&#x2F;etc&#x2F;mdadm&#x2F;mdadm.conf”</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> /etc/mdadm/mdadm.conf</span><br><span class="line">ARRAY /dev/md0 metadata=1.2 name=ubuntu-server:0 UUID=2d900913:d0a44a15:7bd846dd:a015c95e</span><br><span class="line">MAILADDR root</span><br></pre></td></tr></table></figure>

<p><code>–metadata=</code>定义组件设备上超级块的类型。对于–create，默认是0.90。</p>
<p><code>0</code>,<code>0.90</code> ： 限制一个RAID中的设备数为28个，限制组件设备大小为2TB</p>
<p><code>1</code>,<code>1.0</code>,<code>1.1</code>,<code>1.2</code> ：不同的子版本号标识在不同的地方存储超级块。1.0在设备的结尾，1.1在设备的开头，1.2在设备的4K处。</p>
<p><code>MAILADDR</code> 使用monitor模式(同时也使–scan选项)时，警报事件发送到的Email地址。</p>
<p><code>sudo mdadm -Ds &gt; /etc/mdadm/mdadm.conf</code></p>
<p> 把查询出来的 RAID 信息写到 mdadm.conf 中</p>
<p> -s 或 –scan 扫描 RAID 设备；-D 或 –detail 查看 RAID 的详细信息</p>
<h3 id="查看当前RAID"><a href="#查看当前RAID" class="headerlink" title="查看当前RAID"></a>查看当前RAID</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">cat</span> /proc/mdstat</span><br><span class="line">Personalities : [raid0] [linear] [multipath] [raid1] [raid6] [raid5] [raid4] [raid10]</span><br><span class="line">md0 : active raid0 sdf[4] sde[3] sdh[6] sdg[5] sda[0] sdc[2] sdb[1]</span><br><span class="line">      8203865600 blocks super 1.2 512k chunks</span><br><span class="line"></span><br><span class="line">unused devices: &lt;none&gt;</span><br></pre></td></tr></table></figure>

<h3 id="RAID0的搭建"><a href="#RAID0的搭建" class="headerlink" title="RAID0的搭建"></a>RAID0的搭建</h3><p>猜测命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdadm –create /dev/md0 –chunk=512 –metadata=1.2 –level=0 –raid-devices=7 /dev/sda /dev/sdb /dev/sdc /dev/sde /dev/sdf /dev/sdg /dev/sdh</span><br></pre></td></tr></table></figure>

<p>说明：使用7块创建RAID0，条带大小是512KB。</p>
<p>创建完之后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; lsblk -l</span><br><span class="line">md0     9:0    0  7.7T  0 raid0</span><br><span class="line">md0p1 259:0    0  7.7T  0 md</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/md0 <span class="comment">#分区</span></span><br><span class="line">mount /dev/md0p1 /home/ <span class="comment">#挂载</span></span><br><span class="line">mount /dev/md0p2 /usr/ <span class="comment">#挂载</span></span><br><span class="line">mount /dev/md0p3 /boot/ <span class="comment">#挂载</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; lsblk -l</span><br><span class="line">md0     9:0    0  7.7T  0 raid0</span><br><span class="line">md0p1 259:0    0  6.5T  0 part  /home</span><br><span class="line">md0p2 259:1    0  500G  0 part  /usr</span><br><span class="line">md0p3 259:2    0   20G  0 part  /boot</span><br><span class="line">md0p4 259:3    0  600G  0 part  /var</span><br><span class="line">md0p5 259:4    0 47.8G  0 part  /srv</span><br></pre></td></tr></table></figure>

<p><code>vi /etc/fstab</code> #设置开机自动挂载</p>
<h3 id="扩容，添加硬盘"><a href="#扩容，添加硬盘" class="headerlink" title="扩容，添加硬盘"></a>扩容，添加硬盘</h3><p>增大RAID 的大小涉及按给定顺序执行下列任务：</p>
<ol>
<li>增加所有组成 RAID 的所有分区的大小，</li>
<li>增加 RAID 本身的大小，</li>
<li>最后增加文件系统的大小。</li>
</ol>
<p>第一步：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdadm /dev/md0 --add /dev/sdc1</span><br></pre></td></tr></table></figure>

<p>说明：给md0增加热备盘sdc1。运行<code>cat /proc/mdstat</code>等到 RAID 同步并一致，然后再继续下一个分区。</p>
<p>第二步：<br>RAID 阵列配置将继续使用原始阵列大小，直到您强制其了解新的可用空间。您可以为 RAID 指定大小或使用最大可用空间。</p>
<p>查看大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mdadm -D /dev/md0 | grep -e <span class="string">&quot;Array Size&quot;</span> -e <span class="string">&quot;Dev Size&quot;</span></span><br></pre></td></tr></table></figure>

<p>将RAID大小增加到最大可用大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mdadm --grow /dev/md0 -z max</span><br></pre></td></tr></table></figure>

<p>第三步: 不确定</p>
<p>更改 Ext2、Ext3 或 Ext4 文件系统的大小(先查看md0分区大小)</p>
<p>先fdisk删除part1分区，新建同名(同分区标号)的分区，First cylinder起始点相同，通过改变终点为最大值来扩容。</p>
<p>将文件系统大小扩展为名为 &#x2F;dev&#x2F;md0 的设备的<strong>最大可用大小</strong>，请输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo resize2fs /dev/md0p1</span><br><span class="line">resize2fs 1.45.5 (07-Jan-2020)</span><br><span class="line">文件系统已经为 1744830464 个块（每块 4k）。无需进一步处理！</span><br></pre></td></tr></table></figure>

<p>如果未指定大小参数，大小将默认为该分区的大小。</p>
<h2 id="loop机制"><a href="#loop机制" class="headerlink" title="loop机制"></a>loop机制</h2><p>Loop设备是一种块设备，但是它并不指向硬盘或者光驱，而是指向一个文件块或者另一种块设备。</p>
<p>回环设备（ ‘loopback device’）允许用户以一个普通磁盘文件虚拟一个块设备。设想一个磁盘设备，对它的所有读写操作都将被重定向到读写一个名为 disk-image 的普通文件而非操作实际磁盘或分区的轨道和扇区。（当然，disk-image 必须存在于一个实际的磁盘上，而这个磁盘必须比虚拟的磁盘容量更大。）回环设备允许你这样使用一个普通文件。</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>将一个Loop设备指向一个文件系统文件，比如iso文件，紧接着就可以通过mount挂载该loop设备到主文件系统的一个目录下了，我们就可以正常访问该镜像中的内容，就像访问一个文件系统一样。</p>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><p><code>losetup -a</code>列出已使用的。</p>
<p>loop设备映射或者指向一个文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个文件</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zeroof=/var/loop.img bs=1M count=10240</span><br><span class="line"><span class="comment"># 使用losetup将文件转化为块设备,获得了一个磁盘</span></span><br><span class="line">losetup /dev/loop0 /var/loop.img</span><br><span class="line"><span class="comment"># 在磁盘上构建文件系统</span></span><br><span class="line"><span class="comment"># 挂载</span></span><br><span class="line"><span class="built_in">mkdir</span> /myloopdev</span><br><span class="line">mount /dev/loop0 /myloopdev</span><br><span class="line"><span class="comment"># 正常使用</span></span><br><span class="line"><span class="comment"># 卸载该磁盘</span></span><br><span class="line">umount /myloopdev</span><br><span class="line"><span class="comment"># 接着删除该loop设备，</span></span><br><span class="line">losetup –d  /dev/loop0</span><br></pre></td></tr></table></figure>

<h3 id="mount-硬盘"><a href="#mount-硬盘" class="headerlink" title="mount 硬盘"></a>mount 硬盘</h3><h2 id="实际操作"><a href="#实际操作" class="headerlink" title="实际操作"></a>实际操作</h2><h3 id="物理挂盘"><a href="#物理挂盘" class="headerlink" title="物理挂盘"></a>物理挂盘</h3><p>注意，推进插入的时候把卡扣打开<br><img src="https://pic.shaojiemike.top/img/20220713134443.png"></p>
<h3 id="命令行处理"><a href="#命令行处理" class="headerlink" title="命令行处理"></a>命令行处理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l <span class="comment"># 看不见新盘</span></span><br><span class="line">lsblk <span class="comment"># 也看不见</span></span><br><span class="line">sudo reboot <span class="comment"># 重启</span></span><br></pre></td></tr></table></figure>

<p>还是找不到？ 还是8块。</p>
<p>猜测：盘坏了吗？</p>
<p>额外找了其他类型的盘，还有160GB的固态插上。确实是四块坏盘。换了借口也无法识别。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo shutdown -h now <span class="comment"># 热拔插还是有风险</span></span><br></pre></td></tr></table></figure>

<p>总算整了5块</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sdi         8:128  0 931.5G  0 disk  </span><br><span class="line">└─sdi1      8:129  0 931.5G  0 part  </span><br><span class="line">sdj         8:144  0 149.1G  0 disk  </span><br><span class="line">├─sdj1      8:145  0   512M  0 part  </span><br><span class="line">└─sdj2      8:146  0 148.6G  0 part  </span><br><span class="line">sdk         8:160  0   1.8T  0 disk  </span><br><span class="line">└─sdk1      8:161  0   1.8T  0 part  </span><br><span class="line">sdl         8:176  0   1.8T  0 disk  </span><br><span class="line">└─sdl1      8:177  0   1.8T  0 part  </span><br><span class="line">sdm         8:192  0   1.8T  0 disk  </span><br><span class="line">└─sdm1      8:193  0   1.8T  0 part </span><br></pre></td></tr></table></figure>

<h3 id="尝试一：-RAID0扩容"><a href="#尝试一：-RAID0扩容" class="headerlink" title="尝试一： RAID0扩容"></a>尝试一： RAID0扩容</h3><p>那sdk为例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo fdisk /dev/sdk <span class="comment">#d 删除分区</span></span><br><span class="line">&gt; sudo mdadm /dev/md0 --add /dev/sdk</span><br><span class="line">mdadm: add new device failed <span class="keyword">for</span> /dev/sdk as 7: Invalid argument</span><br><span class="line"><span class="comment"># 没分区的结构</span></span><br></pre></td></tr></table></figure>

<p>尝试分区后add分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo mdadm /dev/md0 --add /dev/sdk1</span><br><span class="line">mdadm: add new device failed <span class="keyword">for</span> /dev/sdk1 as 7: Invalid argument</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://serverfault.com/questions/649105/mdadm-add-new-device-failed-for-dev-xvdl-as-2-invalid-argument">第二种</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdadm --grow /dev/md0 --level=0 --raid-devices=8 --add /dev/sdk</span><br></pre></td></tr></table></figure>

<p>理论上这样的，但是要reshape，而且和<code>dev.raid.speed_limit_max</code>速度有关。我不确定会不会丢失资料，所以没尝试。</p>
<p>所以没有扩容</p>
<h3 id="尝试二：-普通挂载"><a href="#尝试二：-普通挂载" class="headerlink" title="尝试二： 普通挂载"></a>尝试二： 普通挂载</h3><p>先格式化各个分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; blkid -o list                                                            </span><br><span class="line">/dev/sdi1                                                                    ext4                                 (not mounted)                                                            </span><br><span class="line">/dev/sdl1                                                                    LVM2_member                          (not mounted)                                                            </span><br><span class="line">/dev/sdm1                                                                    LVM2_member                          (not mounted)                                                               </span><br><span class="line">/dev/sdk1                                                                    LVM2_member                          (not mounted)   </span><br></pre></td></tr></table></figure>

<p>sdi&#x2F;l&#x2F;m&#x2F;k 全部格式化为ext4。<code>blkid -o list</code>不是实时的。挂载后通过<code>df -Th</code>查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs.ext4 /dev/sdk1     </span><br><span class="line">sudo mount /dev/sdk1 /addDisk/DiskNo4</span><br></pre></td></tr></table></figure>

<p>修改权限，大家都可以访问（直接777算了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R ogu+r+w+X /addDisk</span><br></pre></td></tr></table></figure>

<p>配置开机启动，<code>blkid -o list</code> 获得uuid</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdk1                                                                    ext4                                 (not mounted)                                                                    ac862e68-9c6f-424a-b4ec-e44e62f7a330</span><br><span class="line">/dev/sdj1                                                                    ext4                                 (not mounted)                                                                    8258b393-2e8e-41d1-9b84-0a7f88986443</span><br><span class="line">/dev/sdl1                                                                    ext4                                 (not mounted)                                                                    5c2e1324-ecc5-40dd-a668-4ec682065d9f</span><br><span class="line">/dev/sdi1                                                                    ext4                                 (not mounted)                                                                    0ae289c5-51f7-4ef2-a07c-6ec8d123e065</span><br></pre></td></tr></table></figure>

<p>修改<code>/etc/fstab</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /addDisk/DiskNo1 was on /dev/sdi1 during curtin installation  </span></span><br><span class="line">/dev/disk/by-uuid/0ae289c5-51f7-4ef2-a07c-6ec8d123e065 /addDisk/DiskNo1 ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /addDisk/DiskNo2 was on /dev/sdl1 during curtin installation  </span></span><br><span class="line">/dev/disk/by-uuid/5c2e1324-ecc5-40dd-a668-4ec682065d9f /addDisk/DiskNo2 ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /addDisk/DiskNo3 was on /dev/sdj1 during curtin installation  </span></span><br><span class="line">/dev/disk/by-uuid/8258b393-2e8e-41d1-9b84-0a7f88986443 /addDisk/DiskNo3 ext4 defaults 0 0</span><br><span class="line"><span class="comment"># /addDisk/DiskNo4 was on /dev/sdk1 during curtin installation  </span></span><br><span class="line">/dev/disk/by-uuid/ac862e68-9c6f-424a-b4ec-e44e62f7a330 /addDisk/DiskNo4 ext4 defaults 0 0</span><br></pre></td></tr></table></figure>

<h2 id="COW-文件系统"><a href="#COW-文件系统" class="headerlink" title="COW 文件系统"></a>COW 文件系统</h2><p>USB启动的系统，会挂载在<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/19782224">COPY-ON-WRITE</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu:/dev$ <span class="built_in">df</span> -lh</span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">udev            126G     0  126G   0% /dev</span><br><span class="line">tmpfs            26G  3.0M   26G   1% /run</span><br><span class="line">/dev/sdc1        29G  2.1G   27G   8% /cdrom -- USB启动的设备</span><br><span class="line">/dev/loop0      2.0G  2.0G     0 100% /rofs</span><br><span class="line">/cow            126G  209M  126G   1% /</span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><ol>
<li>查找未挂载的盘 lsblk</li>
<li>判断硬盘好坏，是否坏道<ol>
<li>检测坏块<code>sudo badblocks -v /dev/sda &gt; badsectors.txt</code></li>
<li>综合评价<code>sudo smartctl -H /dev/sda10</code></li>
</ol>
</li>
<li>格式化硬盘</li>
<li>挂载新分区<ol>
<li>查看已有盘挂载的分区</li>
</ol>
</li>
<li>如何挂载已有分区</li>
</ol>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://forum.ubuntu.org.cn/viewtopic.php?t=487421">https://forum.ubuntu.org.cn/viewtopic.php?t=487421</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/197847">https://bbs.huaweicloud.com/blogs/197847</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/dangelzjj/article/details/104200396">https://blog.csdn.net/dangelzjj/article/details/104200396</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/renshengdezheli/p/13941563.html">https://www.cnblogs.com/renshengdezheli/p/13941563.html</a></p>
<p><a target="_blank" rel="noopener" href="https://linux.cn/article-7961-1.html">https://linux.cn/article-7961-1.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-15T16:00:00.000Z" title="7/15/2023, 4:00:00 PM">2023-07-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.544Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Operating-system/">Operating system</a></span><span class="level-item">an hour read (About 6793 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/15/Work/Operating%20system/filesystem/">File System</a></p><div class="content"><h2 id="文件系统简介"><a href="#文件系统简介" class="headerlink" title="文件系统简介"></a>文件系统简介</h2><p>计算机文件系统是操作系统的一个重要组成部分,它管理计算机存储设备上的文件,负责文件存储、读取和组织等功能。文件系统的主要作用包括:</p>
<ul>
<li>文件存储与寻址:文件系统负责在存储设备上对文件进行存取,需要找到文件在存储设备上的位置。常见的寻址机制有:<ul>
<li>FAT表:使用文件分配表记录每个文件所占用簇的位置。</li>
<li>inode:为每个文件分配一个inode,记录文件存储位置、大小、访问时间等元信息。</li>
</ul>
</li>
<li>文件组织与优化:文件系统负责组织硬盘空间,常见的组织结构包括:<ul>
<li>目录结构:将文件组织成目录&#x2F;子目录的树形层次结构。</li>
<li>碎片整理:通过碎片整理优化空间利用率。</li>
<li>块大小:通过调整块大小来改善IO性能。</li>
</ul>
</li>
<li>访问控制:管理文件访问权限、用户组等信息,确保访问安全。<ul>
<li>高级功能:一些文件系统实现了高级功能,如快照、数据压缩、加密等。</li>
<li>系统完整性:提供一致性检验、崩溃恢复机制来保证文件系统完整可靠。</li>
</ul>
</li>
</ul>
<p>常见的文件系统包括Windows上的FAT、NTFS,Unix&#x2F;Linux上的ext、XFS、Btrfs等。</p>
<p>文件系统的设计对操作系统的性能、安全性有很大影响。一个优秀的文件系统应提供高效的IO访问、良好的安全控制和数据完整性保障。选择正确的文件系统对不同场景也很重要。</p>
<h3 id="评估文件系统"><a href="#评估文件系统" class="headerlink" title="评估文件系统"></a>评估文件系统</h3><ul>
<li>性能:读写速度、响应时间、并发支持如何,可以测试IO性能。</li>
<li>可靠性:数据完整性保证、Crash可恢复性如何,测试崩溃恢复。</li>
<li>安全性:访问控制、防篡改机制如何,测重写、破坏后的数据恢复。</li>
<li>容量:最大文件大小、卷大小、目录容量如何,测试边界极限。</li>
<li>扩展性:可线性扩展还是需要重构,测试大容量情况下的性能。</li>
<li>元数据:元信息组织结构,是否支持快速查找、高级索引。</li>
<li>分配机制:如何分配和回收空间,是否会产生碎片。</li>
<li>一致性:是否保证读写顺序一致性,如何支持缓存与本地IO。</li>
<li>插件机制:是否可以通过插件扩展功能,如压缩、加密等。</li>
<li>兼容性:是否兼容主流平台和老系统,测试迁移和交互兼容性。</li>
</ul>
<h2 id="基本概念：数据分块存储"><a href="#基本概念：数据分块存储" class="headerlink" title="基本概念：数据分块存储"></a>基本概念：数据分块存储</h2><p>文件储存在硬盘上，硬盘的<strong>最小存储单位</strong>叫做”扇区”（Sector）。每个扇区储存512字节（相当于0.5KB）。</p>
<p>但是就像内存读取也不会只读一个字节， 硬盘的存储和读取都是按照Block进行的(比如,4KB即连续八个 sector组成一个 block。)</p>
<h2 id="早期：FAT文件系统"><a href="#早期：FAT文件系统" class="headerlink" title="早期：FAT文件系统"></a>早期：FAT文件系统</h2><p>早期文件分配表（File Allocate Table，FAT）<br><img src="https://pic.shaojiemike.top/img/20221119155509.png"><br>链表结构解决了文件和物理块映射的问题。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>常见的FAT12、FAT16、FAT32格式,用于早期Windows系统。</li>
<li>优点：简单易用,支持跨平台</li>
<li>缺点：非常占用内存, 效率和安全性不高。<ul>
<li>比如 1T 的硬盘，如果块的大小是 1K，那么就需要 1G 个 FAT 条目。</li>
<li>通常每个 FAT 条目还会存一些其他信息，需要 2~3 个字节， FAT条目总共占用 2-3G 的内存空间，才能用来管理 1T 的硬盘空间。</li>
</ul>
</li>
</ul>
<h2 id="常见：基于inode的文件系统"><a href="#常见：基于inode的文件系统" class="headerlink" title="常见：基于inode的文件系统"></a>常见：基于inode的文件系统</h2><p>基于 inode(index node的数据结构) 的传统文件系统。文件数据被存储不同块里面，文件的元数据信息就会被存储在inode里面。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>在Unix&#x2F;Linux中广泛使用的文件系统,如Ext、XFS等。</li>
<li>每个文件都有一个对应的inode,记录文件元信息和数据块位置。</li>
<li>操作系统通过inode找到文件内容,支持权限控制等高级功能。</li>
<li>效率高,安全可靠,但inode会占用一定存储空间。</li>
</ul>
<h3 id="文件操作流程"><a href="#文件操作流程" class="headerlink" title="文件操作流程"></a>文件操作流程</h3><p>由于inode号码与文件名分离</p>
<ul>
<li>删除流程<ul>
<li>删除一个文件名，就会使得inode节点中的”链接数”减1。当这个值减到0，表明没有文件名指向这个inode，系统就会回收这个inode号码，以及其所对应block区域。</li>
<li>直接删除inode，能够起到删除(包含特殊字符)文件的作用<code>find ./* -inum 节点号 -delete</code></li>
</ul>
</li>
<li>移动文件或重命名文件<ul>
<li>只是改变文件名，不影响inode号码；</li>
</ul>
</li>
</ul>
<h3 id="inode存储Block信息"><a href="#inode存储Block信息" class="headerlink" title="inode存储Block信息"></a>inode存储Block信息</h3><p>为了解决数据变化问题，它引入了<strong>3个存储指针设计</strong>。</p>
<p><img src="https://pic.shaojiemike.top/img/20221119163909.png"></p>
<ul>
<li>直接指针可以直接指向数据块本身，数据块就是保存数据的块</li>
<li>间接指针是在前面的指针指针不够的时候才会启用，间接指针可以看成链表那样，间接指针会指向一个个索引块，这块本身又是一个数据块的指针也是只是指向存储数据块。</li>
<li>第3类指针，指向一个二级索引块，二级索引块的指针还可以指向新的索引块</li>
</ul>
<h3 id="大小占用"><a href="#大小占用" class="headerlink" title="大小占用"></a>大小占用</h3><ul>
<li>每个inode节点的大小固定，一般是128字节或256字节。</li>
<li>inode节点的总数，在格式化时就给定，<del>一般是每1KB或每2KB就设置一个inode</del>。</li>
<li>每个文件都必须有一个inode，因此有可能发生inode已经用光，但是硬盘还未存满的情况。这时，就无法在硬盘上创建新文件。</li>
<li>每个inode都有一个号码，操作系统用inode号码来识别不同的文件。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -hi .</span><br><span class="line">Filesystem     Inodes IUsed IFree IUse% Mounted on</span><br><span class="line">/dev/sda2         56M  5.1M   51M   10% /</span><br><span class="line">或者</span><br><span class="line">/dev/sda2      58605568 5321132 53284436   10% /</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个inode节点的大小，一般是128字节或256字节。</span></span><br><span class="line">$ sudo dumpe2fs -h /dev/sda2 | grep <span class="string">&quot;Inode size&quot;</span></span><br><span class="line">dumpe2fs 1.45.5 (07-Jan-2020)</span><br><span class="line">Inode size:               256</span><br></pre></td></tr></table></figure>

<p>58605568&#x2F;256 &#x3D; 222928 个 inode节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ fdisk -l</span><br><span class="line">Disk /dev/sda: 894.26 GiB, 960197124096 bytes, 1875385008 sectors</span><br><span class="line">Disk model: INTEL SSDSC2KB96</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</span><br><span class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: 86F8050E-C9E7-4BDB-8B0C-89E20B013FF6</span><br><span class="line"></span><br><span class="line">Device     Start        End    Sectors   Size Type</span><br><span class="line">/dev/sda1   2048       4095       2048     1M BIOS boot</span><br><span class="line">/dev/sda2   4096 1875382271 1875378176 894.3G Linux filesystem</span><br><span class="line"></span><br><span class="line">$ sudo fdisk -l /dev/sda2</span><br><span class="line">Disk /dev/sda2: 894.26 GiB, 960193626112 bytes, 1875378176 sectors (512 bytes per sector)</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 4096 bytes</span><br><span class="line">I/O size (minimum/optimal): 4096 bytes / 4096 bytes</span><br></pre></td></tr></table></figure>

<p>1875378176&#x2F;228928 &#x3D; 8192(8K) 个 sector 对应一个inode节点</p>
<p>一个inode节点对应 4MB的空间？</p>
<h3 id="目录、软链接、硬链接"><a href="#目录、软链接、硬链接" class="headerlink" title="目录、软链接、硬链接"></a>目录、软链接、硬链接</h3><ul>
<li><strong>目录</strong>：目录是一种特殊的文件，它的inode节点中存储的是文件名和inode号码的对应关系。</li>
<li><strong>软链接</strong>：软链接拥有自己的inode，但是文件内容就是一个快捷方式。<ul>
<li>命令 <code>ln -s /etc/nginx/config link_config</code></li>
<li>文件A和文件B的inode号码虽然不一样，但是文件A的内容是文件B的路径。读取文件A时，系统会自动将访问者导向文件B。因此，无论打开哪一个文件，最终读取的都是文件B。这时，文件A就称为文件B的”软链接”（soft link）或者”符号链接（symbolic link）。</li>
<li>文件A指向文件B的文件名，而不是文件B的inode号码，文件B的inode”链接数”不会因此发生变化。</li>
</ul>
</li>
<li><strong>硬链接</strong>：多个文件名指向同一个inode号码。<ul>
<li>命令 <code>ln main.c link_main.c</code></li>
</ul>
</li>
</ul>
<h3 id="软链接、硬链接区别与使用场景"><a href="#软链接、硬链接区别与使用场景" class="headerlink" title="软链接、硬链接区别与使用场景"></a>软链接、硬链接区别与使用场景</h3><p>在大部分常见场景下,硬链接是更优的选择：</p>
<ol>
<li>硬链接是一个真实文件,不会无效,更可靠。软链接指向的文件移动或删除后会失效。</li>
<li>硬链接与原文件性能一致,软链接需要在查询时重新解析路径。</li>
</ol>
<p>硬链接也有一些限制：</p>
<ol>
<li>不能跨文件系统,软链接可以实现跨文件系统的链接。</li>
<li>目录无法创建硬链接,只能软链接。</li>
</ol>
<h2 id="日志文件系统"><a href="#日志文件系统" class="headerlink" title="日志文件系统"></a>日志文件系统</h2><ul>
<li>NTFS 和 Ext3 是日志文件系统，它们和 FAT 最大的区别在于写入到磁盘中的是日志，而不是数据。</li>
<li>日志文件系统会先把日志写入到内存中一个<strong>高速缓冲区</strong>，定期写入到磁盘。</li>
<li>日志写入是追加式的，不用考虑数据的覆盖。</li>
<li>一段时间内的日志内容，会形成还原点。这种设计大大提高了性能，当然也会有一定的数据冗余。</li>
</ul>
<h3 id="日志文件系统-与-inode-文件系统的关系"><a href="#日志文件系统-与-inode-文件系统的关系" class="headerlink" title="日志文件系统 与 inode 文件系统的关系"></a>日志文件系统 与 inode 文件系统的关系</h3><ol>
<li>日志文件系统是一种技术,可以建立在多种文件系统之上,包括inode文件系统。</li>
<li>inode文件系统是一种文件系统架构,每个文件都有一个inode保存元信息。ext、xfs等都是这种架构。</li>
<li>但两者不是必然关联的,日志文件系统技术也可以用在非inode型文件系统上。</li>
</ol>
<h2 id="常见名词及文件系统：MBR、GPT和FAT、EXT2"><a href="#常见名词及文件系统：MBR、GPT和FAT、EXT2" class="headerlink" title="常见名词及文件系统：MBR、GPT和FAT、EXT2"></a>常见名词及文件系统：MBR、GPT和FAT、EXT2</h2><p>前两者是磁盘分区格式，后两者是文件系统格式。</p>
<p>MBR、GPT是两种比较常见的磁盘分区格式，而且对于磁盘分区而言，目前也主要是这两种格式。一个分区是一个存储设备上的一块独立区域，用户可以针对这块区域进行单独管理。</p>
<ul>
<li>NFS:网络文件系统,允许通过网络访问文件,可应用在分布式系统。</li>
<li>ZFS:引入了pooled storage和checksum等特性的128位文件系统。</li>
<li>HFS:Mac OS使用的层次化文件系统,使用B*树对元数据进行组织。</li>
</ul>
<h3 id="实践：fdisk的结果"><a href="#实践：fdisk的结果" class="headerlink" title="实践：fdisk的结果"></a>实践：fdisk的结果</h3><ul>
<li>“Disk label type”表示当前磁盘的分区形式，</li>
<li>dos表示磁盘分区形式为MBR，</li>
<li>gpt表示磁盘分区形式为GPT</li>
</ul>
<h2 id="Windows-NTFS文件系统"><a href="#Windows-NTFS文件系统" class="headerlink" title="Windows NTFS文件系统"></a>Windows NTFS文件系统</h2><p>New Technology File System (NTFS):Windows NT引入的文件系统,使用主文件表(MFT)来管理文件,支持高级功能如权限控制等。</p>
<ul>
<li>NTFS卷上的任何事物都是文件(为了与平时使用的文件相区别，以下用FILE特指)，</li>
<li>FILE通过主文件表(master file table, MFT)来确定其在卷上的位置，</li>
<li>每个FILE有固定大小，一般为1KB。</li>
<li>FILE记录了文件的所有数据，每个数据以一个属性来表示，如文件名、文件长度、文件的时间等都是属性，文件的内容也是一个属性，每个属性有一个特征码。</li>
<li>属性数据较小时能够存放在FILE记录中，称为驻留的属性，反之为非驻留的属性，通过Data Runs来保存其存储索引表。<ul>
<li>这一点与FAT文件系统不同，FAT文件系统只在目录区保存了文件的首簇号，还要通过FAT表链接关系才能确定文件的全部存放位置。</li>
<li>Data Runs在一个FILE记录存放不下时还可以用扩展属性，增加FILE记录来保存，即一个文件可以有多个FILE记录。</li>
</ul>
</li>
</ul>
<p>NTFS的同层目录采用B+树结构，按文件(夹)名保持有序，通过文件号指向文件夹内的文件。文件夹的目录项较少时可以直接存储在文件夹的FILE记录中，目录项较多时占用数据簇，建立INDX记录，存放各目录项的属性。</p>
<p>NTFS文件系统一共由16个“元文件”构成</p>
<h2 id="Linux常见-EXT文件系统的发展简介"><a href="#Linux常见-EXT文件系统的发展简介" class="headerlink" title="Linux常见 EXT文件系统的发展简介"></a>Linux常见 EXT文件系统的发展简介</h2><h3 id="ext1"><a href="#ext1" class="headerlink" title="ext1"></a>ext1</h3><ul>
<li>优点：1992 年的 ext 使用在 Linux 内核中的新虚拟文件系统（VFS）抽象层。<ul>
<li>与之前的 MINIX 文件系统不同的是，ext 可以处理高达 2 GB 存储空间并处理 255 个字符的文件名。</li>
</ul>
</li>
<li>缺点：原始的时间戳（每个文件仅有一个时间戳，而不是今天我们所熟悉的有 inode、最近文件访问时间和最新文件修改时间的时间戳。）</li>
</ul>
<h3 id="ext2"><a href="#ext2" class="headerlink" title="ext2"></a>ext2</h3><ul>
<li>优点：提供了 GB 级别的最大文件大小和 TB 级别的文件系统大小。</li>
<li>缺点：<ul>
<li>将数据写入到磁盘的时候，系统发生崩溃或断电，则容易发生灾难性的数据损坏。</li>
<li>随着时间的推移，由于<strong>碎片</strong>（单个文件存储在多个位置，物理上其分散在旋转的磁盘上），它们也遭受了严重的性能损失。</li>
</ul>
</li>
</ul>
<h3 id="ext3"><a href="#ext3" class="headerlink" title="ext3"></a>ext3</h3><ul>
<li>2001 年 11 月在 2.4.15 内核版本中被采用到 Linux 内核主线中。</li>
<li>优点：使用<strong>日志</strong>来解决断电数据不一致问题，和 20 世纪 90 年代后期的其它文件系统一样，如微软的 NTFS。</li>
</ul>
<h3 id="ext4"><a href="#ext4" class="headerlink" title="ext4"></a>ext4</h3><ul>
<li>2008年在 2.6.28 内核版本中被加入到了 Linux 主线。</li>
<li>优点：<ul>
<li>支持大文件系统，<ul>
<li>ext3 文件系统使用 32 位寻址，这限制它仅支持 2 TiB 文件大小和 16 TiB 文件系统系统大小</li>
<li>ext4 使用 48 位的内部寻址，理论上可以在文件系统上分配高达 16 TiB 大小的文件，其中文件系统大小最高可达 1000000 TiB（1 EiB）</li>
</ul>
</li>
<li>分配方式改进，显著提高读写性能<ul>
<li>区段(extent)<ul>
<li>是一系列连续的物理块 (最多达 128 MiB，假设块大小为 4 KiB），可以一次性保留和寻址。使用区段而不是 block可以减少给定文件所需的 inode 数量，并显著减少碎片并提高写入大文件时的性能。</li>
</ul>
</li>
<li>多块分配(multiple block allocation)<ul>
<li>ext3 为每一个新分配的块调用一次块分配器。当多个写入同时打开分配器时，很容易导致严重的碎片。</li>
<li>多块分配(multiple block allocation)允许一次性分配大量的连续文件块，以降低碎片并且有利于 RAID 设备的并行写入</li>
</ul>
</li>
<li>延迟分配（delayed block allocation）<ul>
<li>ext4 使用<strong>延迟分配（delayed block allocation）</strong>，这允许它合并写入并更好地决定如何为尚未提交的写入分配块。</li>
<li><strong>延迟分配</strong>允许 ext4 等待分配将写入数据的实际块，直到它准备好将数据提交到磁盘。（相比之下，即使数据仍然在往写入缓存中写入，ext3 也会立即分配块。）</li>
<li>当缓存中的数据累积时，延迟分配块允许文件系统对如何分配块做出更好的选择，<strong>降低碎片</strong>（写入，以及稍后的读）并显著提升性能。</li>
</ul>
</li>
<li>持久的<strong>预分配</strong>( allocation without initialization)<ul>
<li>在为文件预分配磁盘空间时，大部分文件系统必须在创建时将零写入该文件的块中。</li>
<li>ext4 允许替代使用 fallocate()，它保证了空间的可用性（并试图为它找到连续的空间），而<strong>不需要先写入它</strong>。这显著提高了写入和将来读取流和数据库应用程序的写入数据的性能。</li>
</ul>
</li>
</ul>
</li>
<li>提高了对碎片的抵抗力<ul>
<li>ext2 和 ext3 都不直接支持在线碎片整理 —— 即在挂载时会对文件系统进行碎片整理。</li>
<li>ext4 通过 e4defrag 解决了这个问题，且是一个在线、内核模式、文件系统感知、块和区段级别的碎片整理实用程序。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Nas 防止碎片，开启预分配</p>
<p><img src="https://pic.shaojiemike.top/img/20221120200924.png"></p>
<h3 id="实践问题：-Nas-的-ext4-挂载被识别成NTFS"><a href="#实践问题：-Nas-的-ext4-挂载被识别成NTFS" class="headerlink" title="实践问题： Nas 的 ext4 挂载被识别成NTFS"></a>实践问题： Nas 的 ext4 挂载被识别成NTFS</h3><p>估计是有一层转换，类似的软件有  UFS Explorer</p>
<h2 id="磁盘读写原理"><a href="#磁盘读写原理" class="headerlink" title="磁盘读写原理"></a>磁盘读写原理</h2><h3 id="读写操作分层"><a href="#读写操作分层" class="headerlink" title="读写操作分层"></a>读写操作分层</h3><p><img src="https://pic.shaojiemike.top/img/20221119174036.png"></p>
<p>对于磁盘的一次读请求，</p>
<ul>
<li>首先经过虚拟文件系统层（VFS Layer），</li>
<li>其次是具体的文件系统层（例如Ext2），</li>
<li>接下来是Cache层（Page Cache Layer）、</li>
<li>通用块层（Generic Block Layer）、</li>
<li>I&#x2F;O调度层（I&#x2F;O Scheduler Layer）、</li>
<li>块设备驱动层（Block Device Driver Layer），</li>
<li>最后是物理块设备层（Block Device Layer）。</li>
</ul>
<h4 id="Page-Cache层"><a href="#Page-Cache层" class="headerlink" title="Page Cache层"></a>Page Cache层</h4><p><img src="https://pic.shaojiemike.top/img/20221119174739.png"></p>
<ul>
<li>为了提高Linux操作系统对磁盘访问的性能。Cache层在内存中缓存了磁盘上的部分数据。当数据的请求到达时，如果在Cache中存在该数据且是最新的，则直接将数据传递给用户程序，免除了对底层磁盘的操作，提高了性能。</li>
<li>文件Cache分为两个层面，<ul>
<li>一是Page Cache，另一个Buffer Cache，每一个Page Cache包含若干Buffer Cache。</li>
<li>Page Cache主要用来作为文件系统上的文件数据的缓存来用，尤其是针对当进程对文件有read&#x2F;write操作的时候。</li>
<li>Buffer Cache则主要是设计用来在系统对块设备进行读写的时候，对块进行数据缓存的系统来使用。</li>
</ul>
</li>
<li>磁盘Cache有两大功能：预读和回写。<ul>
<li>预读其实就是利用了局部性原理，具体过程是：<ul>
<li>对于每个文件的第一个读请求，系统读入所请求的页面并读入紧随其后的少数几个页面（通常是三个页面），这时的预读称为同步预读。</li>
<li>对于第二次读请求，<ul>
<li>如果所读页面不在Cache中，即不在前次预读的页中，则表明文件访问不是顺序访问，系统继续采用同步预读；</li>
<li>如果所读页面在Cache中，则表明前次预读命中，操作系统把预读页的大小扩大一倍，此时预读过程是异步的，应用程序可以不等预读完成即可返回，只要后台慢慢读页面即可，这时的预读称为异步预读。</li>
</ul>
</li>
<li>任何接下来的读请求都会处于两种情况之一：第一种情况是所请求的页面处于预读的页面中，这时继续进行异步预读；第二种情况是所请求的页面处于预读页面之外，这时系统就要进行同步预读。</li>
</ul>
</li>
<li>回写是通过暂时将数据存在Cache里，然后统一异步写到磁盘中。<ul>
<li>通过这种异步的数据I&#x2F;O模式解决了程序中的计算速度和数据存储速度不匹配的鸿沟，减少了访问底层存储介质的次数，使存储系统的性能大大提高。Linux</li>
<li>2.6.32内核之前，采用pdflush机制来将脏页真正写到磁盘中，什么时候开始回写呢？下面两种情况下，脏页会被写回到磁盘：<ul>
<li>在空闲内存低于一个特定的阈值时，内核必须将脏页写回磁盘，以便释放内存。</li>
<li>当脏页在内存中驻留超过一定的阈值时，内核必须将超时的脏页写会磁盘，以确保脏页不会无限期地驻留在内存中。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="I-O调度层"><a href="#I-O调度层" class="headerlink" title="I&#x2F;O调度层"></a>I&#x2F;O调度层</h3><ul>
<li>I&#x2F;O调度层的功能是管理块设备的请求队列。<ul>
<li>即接收通用块层发出的I&#x2F;O请求，缓存请求并试图合并相邻的请求。</li>
<li>并根据设置好的调度算法，回调驱动层提供的请求处理函数，以处理具体的I&#x2F;O请求。</li>
</ul>
</li>
<li>如果简单地以内核产生请求的次序直接将请求发给块设备的话，那么块设备性能肯定让人难以接受，因为磁盘寻址是整个计算机中最慢的操作之一。</li>
<li>为了优化寻址操作，内核不会一旦接收到I&#x2F;O请求后，就按照请求的次序发起块I&#x2F;O请求。</li>
<li>为此Linux实现了几种I&#x2F;O调度算法，算法基本思想就是通过合并和排序I&#x2F;O请求队列中的请求，以此大大降低所需的磁盘寻道时间，从而提高整体I&#x2F;O性能。</li>
</ul>
<p>常见的I&#x2F;O调度算法包括</p>
<ol>
<li>Noop调度算法（No Operation）、</li>
<li>CFQ（完全公正排队I&#x2F;O调度算法）、</li>
<li>DeadLine（截止时间调度算法）、</li>
<li>AS预测调度算法等。</li>
</ol>
<h2 id="磁盘快速I-O常见机制"><a href="#磁盘快速I-O常见机制" class="headerlink" title="磁盘快速I&#x2F;O常见机制"></a>磁盘快速I&#x2F;O常见机制</h2><p>Linux系统中请求到达磁盘的一次完整过程，期间Linux一般会通过Cache以及排序合并I&#x2F;O请求来提高系统的性能。</p>
<p>其本质就是由于磁盘随机读写慢、顺序读写快的磁盘I&#x2F;O特性。</p>
<h3 id="采用追加写"><a href="#采用追加写" class="headerlink" title="采用追加写"></a>采用追加写</h3><p>在进行系统设计时，良好的读性能和写性能往往不可兼得。在许多常见的开源系统中都是优先在保证写性能的前提下来优化读性能。那么如何设计能让一个系统拥有良好的写性能呢？</p>
<ul>
<li>一个好的办法就是采用追加写，每次将数据添加到文件。</li>
<li>由于完全是顺序的，所以可以具有非常好的写操作性能。</li>
<li>但是这种方式也存在一些缺点：从文件中读一些数据时将会需要更多的时间：<ul>
<li>需要倒序扫描，直到找到所需要的内容。</li>
<li>当然在一些简单的场景下也能够保证读操作的性能：<ul>
<li>数据是被整体访问，比如HDFS</li>
<li>知道文件明确的偏移量，比如Kafka</li>
</ul>
</li>
<li>在面对更复杂的读场景（比如按key）时，如何来保证读操作的性能呢？<ul>
<li>简单的方式是像Kafka那样，将文件数据有序保存，使用二分查找来优化效率；</li>
<li>或者通过建索引的方式来进行优化；</li>
<li>也可以采用hash的方式将数据分割为不同的桶。</li>
</ul>
</li>
<li>以上的方法都能增加读操作的性能，但是由于在数据上强加了数据结构，又会降低写操作的性能。<ul>
<li>比如如果采用索引的方式来优化读操作，那么在更新索引时就需要更新B-tree中的特定部分，这时候的写操作就是随机写。</li>
</ul>
</li>
<li>那么有没有一种办法在保证写性能不损失的同时也提供较好的读性能呢？</li>
<li>一个好的选择就是使用LSM-tree。<ul>
<li>LSM-tree与B-tree相比，LSM-tree牺牲了部分读操作，以此大幅提高写性能。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="文件合并和元数据优化"><a href="#文件合并和元数据优化" class="headerlink" title="文件合并和元数据优化"></a>文件合并和元数据优化</h3><p>目前的大多数文件系统，如XFS&#x2F;Ext4、GFS、HDFS，在元数据管理、缓存管理等实现策略上都侧重大文件。</p>
<h2 id="磁盘碎片"><a href="#磁盘碎片" class="headerlink" title="磁盘碎片"></a>磁盘碎片</h2><h3 id="不同文件系统的比较"><a href="#不同文件系统的比较" class="headerlink" title="不同文件系统的比较"></a>不同文件系统的比较</h3><p>像 FAT 和 FAT32 这类文件系统中，文件紧挨着写入到磁盘中。文件之间没有空间来用于增长或者更新：</p>
<p>NTFS 中在文件之间保留了一些空间，因此有空间进行增长。但因块之间的空间是有限的，碎片也会随着时间出现。</p>
<p>Linux 的日志型文件系统采用了一个不同的方案。与文件相互挨着不同，每个文件分布在磁盘的各处，每个文件之间留下了大量的剩余空间。这就给文件更新和增长留下了很大的空间，碎片很少会发生。</p>
<p>此外，碎片一旦出现了，大多数 Linux 文件系统会尝试将文件和块重新连续起来。</p>
<h3 id="检测命令"><a href="#检测命令" class="headerlink" title="检测命令"></a>检测命令</h3><p>在已经挂载的分区中运行 fsck 将会<strong>严重危害</strong>到你的数据和磁盘。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount /path</span><br><span class="line">fsck -fn /path</span><br></pre></td></tr></table></figure>

<p>大于20%需要整理。<a target="_blank" rel="noopener" href="https://www.aikaiyuan.com/5679.html">批评fsck不准的文章：大文件碎片少才是最重要的</a></p>
<p>NEC 的 Akira Fujita 和 Takashi Sato 在十年前就为 ext4 写了在线整理碎片的工具，因此我们直接拿来用就好了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e4defrag -v /path</span><br></pre></td></tr></table></figure>

<h3 id="碎片整理"><a href="#碎片整理" class="headerlink" title="碎片整理"></a>碎片整理</h3><p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/197465">方法一</a>：整个磁盘文件备份，格式化，重新搬运。(Liunx 会自动将文件进行连续分布排列。)</p>
<p>方法二：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不要中断，很危险</span></span><br><span class="line">sudo e4defrag /</span><br></pre></td></tr></table></figure>

<h2 id="常见实践问题"><a href="#常见实践问题" class="headerlink" title="常见实践问题"></a>常见实践问题</h2><h3 id="为什么出现坏道之后，硬盘会飞速损耗"><a href="#为什么出现坏道之后，硬盘会飞速损耗" class="headerlink" title="为什么出现坏道之后，硬盘会飞速损耗"></a>为什么出现坏道之后，硬盘会飞速损耗</h3><p>坏道分为逻辑坏道，和物理坏道。如果是物理坏道，由于异物或者碰撞导致磁头，盘面受损，会导致物理损坏扩散，应该今早备份数据。</p>
<h3 id="并行下载多个两个文件，存储是交叉的吗？读数据会变慢吗？"><a href="#并行下载多个两个文件，存储是交叉的吗？读数据会变慢吗？" class="headerlink" title="并行下载多个两个文件，存储是交叉的吗？读数据会变慢吗？"></a>并行下载多个两个文件，存储是交叉的吗？读数据会变慢吗？</h3><p>场景问题：</p>
<p>1.同时向机械硬盘拷贝多个文件夹，每个文件夹里都有多个小文件。<br>2.同时解压多个压缩包，每个压缩包有大量的小文件。<br>3.同时安装多个游戏安装包。<br>会不会导致交叉存储？会不会导致碎片增加？会不会导致游玩游戏时读取速度变慢？</p>
<p>一般不用担心，有些文件系统会做碎片整理。然后操作系统的缓存写和预读策略也会优化。</p>
<h3 id="硬盘的寿命"><a href="#硬盘的寿命" class="headerlink" title="硬盘的寿命"></a>硬盘的寿命</h3><p>对于机械硬盘来讲，反复读写、多线程读写等情况对磁盘使用寿命的影响很低，<br>但“高温”、“低温”、“尘土”、“外力冲击（跌落）”等情况，会对磁盘的寿命造成较大的影响。</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%87%8D%E5%AD%A6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%AE%8C/30%20%20%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%EF%BC%9AFAT%E3%80%81NTFS%20%E5%92%8C%20Ext3%20%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F.md">https://learn.lianglianglee.com/%E4%B8%93%E6%A0%8F/%E9%87%8D%E5%AD%A6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F-%E5%AE%8C/30%20%20%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%EF%BC%9AFAT%E3%80%81NTFS%20%E5%92%8C%20Ext3%20%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F.md</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2011/12/inode.html">https://www.ruanyifeng.com/blog/2011/12/inode.html</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/05/19/about-desk-io.html">https://tech.meituan.com/2017/05/19/about-desk-io.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/44267768">https://zhuanlan.zhihu.com/p/44267768</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/197465">https://developer.aliyun.com/article/197465</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-14T16:00:00.000Z" title="7/14/2023, 4:00:00 PM">2023-07-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.540Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">4 minutes read (About 663 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/14/Work/HPC/IPCC/IPCC2022final/">IPCC2022final</a></p><div class="content"><p><img src="https://pic.shaojiemike.top/img/20221203200751.png"></p>
<h2 id="学到的一些亮点"><a href="#学到的一些亮点" class="headerlink" title="学到的一些亮点"></a>学到的一些亮点</h2><p><img src="https://pic.shaojiemike.top/img/20221202184317.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20221202184521.png"></p>
<h2 id="总结反思"><a href="#总结反思" class="headerlink" title="总结反思"></a>总结反思</h2><p>由于决赛是黑盒制度，没有排行榜，也不知道最终算分的例子是多大。我们优化着眼于自己找的清华的大例子，并行的占比在这部分很小。忽略了小例子里，占比比较高的部分的优化。结果最终赛题例子很小。</p>
<p><img src="https://pic.shaojiemike.top/img/20221202185953.png"></p>
<p>如果提前知道元素个数，并行对同一个数组的末尾添加元素可以并行，添加到指定位置之后再统一排序就行。比如山东大学，就是这里快了大约10ms，加上第一次排序快5ms。</p>
<p><img src="https://pic.shaojiemike.top/img/20221203103311.png"></p>
<p>比如信息中心(应该是第一名)的排序，用的是归并的基数排序<img src="https://pic.shaojiemike.top/img/20221203195910.png"></p>
<p>比如青海大学的优化：<img src="https://pic.shaojiemike.top/img/20221202191111.png"></p>
<p>还有高效的排序，怎么实现。<a target="_blank" rel="noopener" href="https://github.com/cermi29/ParallelStableSort">类似</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p><img src="https://pic.shaojiemike.top/img/20221202191656.png"></p>
<p>CSR (压缩稀疏行存储) 矩阵和邻接表在表示图数据结构时,计算和访问性能有些差异:</p>
<ul>
<li>CSR通过压缩行存储机制,可以大幅减少空间占用,节省内存。但索引算术运算负担重一些</li>
<li>邻接表使用链表指针连接相邻节点,追踪任意一条边的开销很低。但总体占用内存空间更大。</li>
<li>CSR访问任意一个元素通过索引计算直接可以定位,兼具稠密和稀疏矩阵的特点。</li>
<li>邻接表的边访问性能更好,通过指针直接遍历一个节点的所有相邻节点。</li>
<li>CSR的预处理时间较短,更易于向量化实现提高效率。</li>
<li>邻接表更灵活,可表示加权图或处理动态变化的图。</li>
<li>CSR矩阵更易进行压缩和剪枝来优化存储,节省内存带宽。</li>
</ul>
<p>所以简单来说,如果图更稠密,数据访问模式更随机,CSR可能会有些优势。如果需要频繁遍历边,图结构变化大,邻接表访问效率可能会更高一些。需要根据具体情况选择合适的表示。</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><p>哎呀，你干嘛！ 今年又<del>西巴了</del>,惜败了，应该是第三名左右。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-14T16:00:00.000Z" title="7/14/2023, 4:00:00 PM">2023-07-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.560Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">5 minutes read (About 705 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/14/Work/software/perf/NUMAperf/">NUMA perf</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>NUMA使用的目的是为了每个进程能使用local内存来实现高性能。但是假如某进程的local内存提前用完了，会导致无法使用其他进程的内存，反而需要SWAP的问题。(一般小例子遇不到)</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/quantfabric/2594323">https://blog.51cto.com/quantfabric/2594323</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/machangwei-8/p/10402644.html">https://www.cnblogs.com/machangwei-8/p/10402644.html</a></p>
<h2 id="NUMA的内存分配策略"><a href="#NUMA的内存分配策略" class="headerlink" title="NUMA的内存分配策略"></a>NUMA的内存分配策略</h2><ol>
<li>缺省(default)：总是在本地节点分配（分配在当前进程运行的节点上）；</li>
<li>绑定(bind)：强制分配到指定节点上；</li>
<li>交叉(interleave)：在所有节点或者指定的节点上交织分配；</li>
<li>优先(preferred)：在指定节点上分配，失败则在其他节点上分配。</li>
</ol>
<p>因为NUMA默认的内存分配策略是优先在进程所在CPU的本地内存中分配，会导致CPU节点之间内存分配不均衡，当某个CPU节点的内存不足时，会导致swap产生，而不是从远程节点分配内存。这就是所谓的swap insanity 现象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ numactl --hardware</span><br><span class="line">available: 2 nodes (0-1)</span><br><span class="line">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47</span><br><span class="line">node 0 size: 64076 MB</span><br><span class="line">node 0 free: 23497 MB</span><br><span class="line">node 1 cpus: 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63</span><br><span class="line">node 1 size: 64503 MB</span><br><span class="line">node 1 free: 37897 MB</span><br><span class="line">node distances:</span><br><span class="line">node   0   1</span><br><span class="line">  0:  10  21</span><br><span class="line">  1:  21  10</span><br><span class="line"></span><br><span class="line"># shaojiemike @ node5 in ~/github/IPCC2022-preliminary/run on git:main o [10:41:54]</span><br><span class="line">$ numactl --show</span><br><span class="line">policy: default</span><br><span class="line">preferred node: current</span><br><span class="line">physcpubind: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63</span><br><span class="line">cpubind: 0 1</span><br><span class="line">nodebind: 0 1</span><br><span class="line">membind: 0 1</span><br></pre></td></tr></table></figure>

<h2 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 遇到内存不够时</span><br><span class="line">numactl –interleave=all ./exe</span><br><span class="line"></span><br><span class="line"># 使用local内存（默认的）</span><br><span class="line">numactl --localalloc ./exe</span><br></pre></td></tr></table></figure>

<h2 id="查看程序的内存的-NUMA情况"><a href="#查看程序的内存的-NUMA情况" class="headerlink" title="查看程序的内存的 NUMA情况"></a>查看程序的内存的 NUMA情况</h2><p>在Linux系统上,可以通过以下常用方法来查看和分析程序的NUMA(非统一内存访问)情况:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">numastat:查看进程和每个NUMA节点的内存分配和访问统计。</span><br><span class="line">numactl: 查看进程NUMA policy和分配策略,可以手动设置策略。</span><br><span class="line">numa_maps:查看进程在每个NUMA节点上的内存映射情况。</span><br><span class="line">mpstat -P ALL:查看每个CPU核心的统计信息。</span><br><span class="line">pidstat -t:查看进程在每个CPU上的执行时间。</span><br><span class="line">perf stat:统计程序在不同CPU上周期数,检查是否均衡。</span><br><span class="line">likwid-perfctr: 细粒度检测程序在不同内存节点的带宽和延迟。</span><br><span class="line">VTune: Intel的性能分析工具,可以检测NUMA的影响。</span><br><span class="line">代码插桩:统计程序对不同节点内存的访问。</span><br><span class="line">numactl --hardware :查看系统NUMA拓扑结构。</span><br></pre></td></tr></table></figure>

<p>通过综合使用这些工具,可以全面分析程序的NUMA性能,例如内存分布不均,访问模式导致的不均衡等,然后进行针对优化。</p>
<h2 id="c-malloc时能手动设置-内存位置"><a href="#c-malloc时能手动设置-内存位置" class="headerlink" title="c++ malloc时能手动设置 内存位置"></a>c++ malloc时能手动设置 内存位置</h2><ol>
<li>libnuma: 直接调用libnuma提供的<code>numa_alloc_onnode()</code>和<code>numa_free()</code>等API,在指定节点上分配释放内存。</li>
<li>mmap</li>
</ol>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-14T16:00:00.000Z" title="7/14/2023, 4:00:00 PM">2023-07-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-30T03:32:00.560Z" title="1/30/2024, 3:32:00 AM">2024-01-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">20 minutes read (About 3059 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/14/Work/software/perf/vtuneOptimize/">VtuneOptimize</a></p><div class="content"><h2 id="vtune的安装和profile"><a href="#vtune的安装和profile" class="headerlink" title="vtune的安装和profile"></a>vtune的安装和profile</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>由于snode0有sudo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /opt/intel/oneapi/setvars.sh</span><br><span class="line">sudo vtune-gui</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://home.ustc.edu.cn/~shaojiemike/posts/nvidiansight/#sudo-ncu-ui-%E4%B8%8D%E8%83%BD%E8%BF%9C%E7%A8%8B%E6%89%93%E5%BC%80">sudo后图形化界面 MobaXterm打不开的原因参考这个</a></p>
<h2 id="Step1-Performance-Snapshot-参数说明"><a href="#Step1-Performance-Snapshot-参数说明" class="headerlink" title="Step1 : Performance Snapshot 参数说明"></a>Step1 : Performance Snapshot 参数说明</h2><p>以IPCC2022 初赛 支撑点计算的baseline为例</p>
<h2 id="Logical-Core-Utilization"><a href="#Logical-Core-Utilization" class="headerlink" title="Logical Core Utilization"></a>Logical Core Utilization</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Effective Logical Core Utilization: 3.8% (2.436 out of 64)</span><br><span class="line">    Effective Physical Core Utilization: 6.4% (2.053 out of 32)</span><br></pre></td></tr></table></figure>

<p>CPU利用率主要是指计算有效占比。为100%意味着所有逻辑CPU都是由应用程序的计算占用。</p>
<h2 id="Microarchitecture-Usage"><a href="#Microarchitecture-Usage" class="headerlink" title="Microarchitecture Usage"></a>Microarchitecture Usage</h2><p>微架构使用指标是一个关键指标，可以帮助评估(以%为单位)你的代码在当前微架构上运行的效率。</p>
<p>微架构的使用可能会受到</p>
<ol>
<li>long-latency memory长延迟访存、</li>
<li>floating-point, or SIMD operations浮点或SIMD操作的影响;</li>
<li>non-retired instructions due to branch mispredictions;由于分支错误预测导致的未退役指令;</li>
<li>instruction starvation in the front-end.前端指令不足。</li>
</ol>
<h3 id="vtune的建议"><a href="#vtune的建议" class="headerlink" title="vtune的建议"></a>vtune的建议</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Microarchitecture Usage: 37.7% of Pipeline Slots</span><br><span class="line">    Retiring: 37.7%</span><br><span class="line">    Front-End Bound: 16.9%</span><br><span class="line">    Back-End Bound: 23.8%</span><br><span class="line">    Memory Bound: 11.9%</span><br><span class="line">    Core Bound: 11.9%</span><br><span class="line">    Bad Speculation: 21.5%</span><br></pre></td></tr></table></figure>

<p>针对<code>Back-End Bound: 23.8%</code>的建议如下：</p>
<p>A significant portion of pipeline slots are remaining empty.<br>(??? 他是指有23.8% empty还是被使用了呢)</p>
<p>When operations take <strong>too long</strong> in the back-end, they introduce <strong>bubbles</strong> in the pipeline that ultimately cause fewer pipeline slots containing useful work to be retired per cycle than the machine is capable to support.</p>
<p>This opportunity cost results in slower execution.</p>
<ol>
<li><strong>Long-latency operation</strong>s like <strong>divides</strong> and <strong>memory operations</strong> can cause this,</li>
<li>as can <strong>too many operations</strong> being directed to a single execution port (for example, more <strong>multiply</strong> operations arriving in the back-end per cycle than the execution unit can support).</li>
</ol>
<p>针对<code>Bad Speculation: 21.5%</code>的建议如下：</p>
<p>A significant proportion of pipeline slots containing <strong>21.5% useful work are being cancelled</strong>.</p>
<p>This can be caused by <strong>mispredicting branches</strong> or by <strong>machine clears</strong>. Note that this metric value may be highlighted due to Branch Resteers issue.</p>
<h3 id="Retiring-metric"><a href="#Retiring-metric" class="headerlink" title="Retiring metric"></a>Retiring metric</h3><p>Retiring metric represents a Pipeline Slots fraction utilized by useful work, meaning the issued uOps that eventually get retired.<br>Retiring metric 表示<strong>有用工作</strong>所使用的Pipeline slot流水线管道的比例，所有发射的uOps最终都会retired。</p>
<p>Ideally, all Pipeline Slots would be attributed to the Retiring category.<br>理想情况下，所有的管道槽都应该归于退休类别。</p>
<p>Retiring of 100% would indicate the maximum possible number of uOps retired per cycle has been achieved. 100%的退役表明每个周期内退役的uop数量达到了可能的最大值。</p>
<p>Maximizing Retiring typically increases the Instruction-Per-Cycle metric.<br>最大化Retiring通常会增加IPC。</p>
<p>Note that a high Retiring value <strong>does not necessary mean no more room</strong> for performance improvement.<br>For example, <strong>Microcode assists</strong> are categorized under Retiring. They hurt performance and can often be avoided.</p>
<p>Microcode assists根据Intel的解释是</p>
<p>当遇到特殊的计算(比如处理非常小的浮点值(所谓的逆法线)时），浮点单元并没有被设置为本机执行这些操作。为此需要在指令流中插入可能有数百个指令长的小程序，对性能会造成很大的影响。</p>
<h3 id="Front-End-Bound"><a href="#Front-End-Bound" class="headerlink" title="Front-End Bound"></a>Front-End Bound</h3><p>Front-End Bound metric represents a slots fraction where the processor’s Front-End undersupplies its Back-End. 该指标表示前端产生的指令是否足以支持后端处理。</p>
<p>Front-End denotes the first part of the processor core responsible for fetching operations that are executed later on by the Back-End part. 前端将指令分解成uops供后端处理。</p>
<p>Within the Front-End, a branch predictor predicts the next address to fetch, cache-lines are fetched from the memory subsystem, parsed into instructions, and lastly decoded into micro-ops (uOps). 在前端中，分支预测器预测下一个要获取的地址，缓存行从内存子系统中获取，解析为指令，最后解码为微操作(uOps)。</p>
<p>Front-End Bound metric denotes unutilized <strong>issue-slots</strong> when there is <strong>no Back-End stall</strong> (bubbles where Front-End delivered no uOps while Back-End could have accepted them). For example, stalls due to <strong>instruction-cache misses</strong> would be categorized as Front-End Bound</p>
<p>Front-End Bound指标表示当后端没有停顿时未使用的<strong>发射槽</strong>(bubbles: 前端没有交付uOps，而发射给后端的)。例如，由于指令缓存未命中而导致的暂停将被归类为Front-End Bound</p>
<h3 id="Back-End-Bound"><a href="#Back-End-Bound" class="headerlink" title="Back-End Bound"></a>Back-End Bound</h3><p>metric represents a Pipeline Slots fraction where no uOps are being delivered due to a lack of required resources for accepting new uOps in the Back-End. 该指标表示后端uops是否出现了因为硬件资源紧张而无法处理的问题。</p>
<p>Back-End is the portion of the processor core where an out-of-order scheduler dispatches ready uOps into their respective execution units, and, once completed, these uOps get retired according to the program order. 后端的乱序执行，顺序Reire模型。</p>
<p>For example, stalls due to <strong>data-cache misses</strong> or stalls due to the <strong>divider unit(除法器？) being overloaded</strong> are both categorized as Back-End Bound. Back-End Bound is further divided into two main categories: Memory Bound and Core Bound.</p>
<h3 id="Memory-Bound"><a href="#Memory-Bound" class="headerlink" title="Memory Bound"></a>Memory Bound</h3><p>This metric shows how memory subsystem issues affect the performance. Memory Bound measures a fraction of slots where pipeline could be stalled due to demand load or store instructions. This accounts mainly for incomplete in-flight memory demand loads that coincide with execution starvation in addition to less common cases where stores could imply back-pressure on the pipeline.</p>
<h3 id="Core-Bound"><a href="#Core-Bound" class="headerlink" title="Core Bound"></a>Core Bound</h3><p>This metric represents how much Core non-memory issues were of a bottleneck. 表明核心的非内存原因成为了瓶颈</p>
<ol>
<li>Shortage in hardware compute resources, 硬件资源的短缺</li>
<li>or dependencies software’s instructions are both categorized under Core Bound. 指令间的依赖</li>
</ol>
<p>Hence it may indicate</p>
<ol>
<li>the machine ran out of an OOO resources,</li>
<li>certain execution units are overloaded</li>
<li>or dependencies in program’s data- or instruction- flow are limiting the performance (e.g. <strong>FP-chained long-latency arithmetic operations</strong>).</li>
</ol>
<h3 id="Bad-Speculation-分支预测错误"><a href="#Bad-Speculation-分支预测错误" class="headerlink" title="Bad Speculation(分支预测错误)"></a>Bad Speculation(分支预测错误)</h3><p>represents a Pipeline Slots fraction wasted due to incorrect speculations.</p>
<p>This includes slots used to issue uOps that do not eventually get retired and slots for which the issue-pipeline was blocked due to <strong>recovery</strong> from an earlier incorrect speculation.</p>
<p>For example, wasted work due to <strong>mispredicted branches</strong> is categorized as a Bad Speculation category. Incorrect data speculation followed by Memory Ordering Nukes is another example.</p>
<p>这里的Nukes, 猜测是数据预取预测错误，带来的访存影响像核爆一样大吧.</p>
<h2 id="Memory-Bound-1"><a href="#Memory-Bound-1" class="headerlink" title="Memory Bound"></a>Memory Bound</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Memory Bound: 11.9% of Pipeline Slots</span><br><span class="line">    L1 Bound: 7.9%</span><br><span class="line">    L2 Bound: 0.2%</span><br><span class="line">    L3 Bound: 2.5%</span><br><span class="line">    DRAM Bound: 2.0%</span><br><span class="line">    Store Bound: 0.3%</span><br><span class="line">    NUMA: % of Remote Accesses: 13.2%</span><br></pre></td></tr></table></figure>

<p>This metric shows how memory subsystem issues affect the performance. Memory Bound measures a fraction of slots where pipeline could be stalled due to demand load or store instructions. 该项表明了有多少流水线的slots因为load或者store指令的需求而被迫等待</p>
<p>This accounts mainly for <strong>incomplete in-flight memory demand loads</strong> that coincide with execution starvation<br>这是指不连续访存吗？</p>
<p>in addition to less common cases where stores could imply back-pressure on the pipeline.</p>
<h3 id="L1-Bound"><a href="#L1-Bound" class="headerlink" title="L1 Bound"></a>L1 Bound</h3><p>This metric shows how often machine was stalled without missing the L1 data cache.<br>在不发生L1 miss的情况下，指令stall的频率。(因为其他原因导致stall？)</p>
<p>The L1 cache typically has the shortest latency. However, in certain cases like loads blocked on older stores, a load might suffer a high latency even though it is being satisfied by the L1. 假设load了一个刚store的值，load指令也会遇到很大的延迟。</p>
<h3 id="L2-Bound"><a href="#L2-Bound" class="headerlink" title="L2 Bound"></a>L2 Bound</h3><p>This metric shows how often machine was stalled on L2 cache. Avoiding cache misses (L1 misses&#x2F;L2 hits) will improve the latency and increase performance.</p>
<h3 id="L3-Bound"><a href="#L3-Bound" class="headerlink" title="L3 Bound"></a>L3 Bound</h3><p>This metric shows how often CPU was stalled on L3 cache, or contended with a sibling Core(与兄弟姐妹核竞争). Avoiding cache misses (L2 misses&#x2F;L3 hits) improves the latency and increases performance.</p>
<h3 id="DRAM-Bound"><a href="#DRAM-Bound" class="headerlink" title="DRAM Bound"></a>DRAM Bound</h3><p>This metric shows how often CPU was stalled on the main memory (DRAM). Caching typically improves the latency and increases performance.</p>
<h3 id="DRAM-Bandwidth-Bound"><a href="#DRAM-Bandwidth-Bound" class="headerlink" title="DRAM Bandwidth Bound"></a>DRAM Bandwidth Bound</h3><p>This metric represents percentage of elapsed time the system spent with high DRAM bandwidth utilization. Since this metric relies on the accurate peak system DRAM bandwidth measurement, explore the Bandwidth Utilization Histogram and make sure the Low&#x2F;Medium&#x2F;High utilization thresholds are correct for your system. You can manually adjust them, if required.</p>
<h3 id="Store-Bound"><a href="#Store-Bound" class="headerlink" title="Store Bound"></a>Store Bound</h3><p>This metric shows how often CPU was stalled on store operations. Even though memory store accesses do not typically stall out-of-order CPUs; there are few cases where stores can lead to actual stalls.</p>
<h3 id="NUMA-of-Remote-Accesses"><a href="#NUMA-of-Remote-Accesses" class="headerlink" title="NUMA: % of Remote Accesses"></a>NUMA: % of Remote Accesses</h3><p>In NUMA (non-uniform memory architecture) machines, memory requests missing LLC may be serviced either by local or remote DRAM. Memory requests to remote DRAM incur much greater latencies than those to local DRAM. It is recommended to keep as much frequently accessed data local as possible. This metric shows <strong>percent of remote accesses, the lower the better.</strong></p>
<p>可以用之前的<br><img src="https://pic.shaojiemike.top/img/20220724194827.png"></p>
<h2 id="Vectorization"><a href="#Vectorization" class="headerlink" title="Vectorization"></a>Vectorization</h2><p>This metric represents the percentage of <strong>packed (vectorized) floating point operations</strong>. 0% means that the code is fully scalar. The metric does not take into account the actual vector length that was used by the code for vector instructions. So if the code is fully vectorized and uses a legacy instruction set that loaded only half a vector length, the Vectorization metric shows 100%.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Vectorization: 23.7% of Packed FP Operations</span><br><span class="line">    Instruction Mix: </span><br><span class="line">    SP FLOPs: 0.9%</span><br><span class="line">    Packed: 99.9%</span><br><span class="line">    128-bit: 0.1%</span><br><span class="line">    256-bit: 99.8%</span><br><span class="line">    512-bit: 0.0%</span><br><span class="line">    Scalar: 0.1%</span><br><span class="line">    DP FLOPs: 2.9%</span><br><span class="line">    Packed: 0.0%</span><br><span class="line">    Scalar: 100.0%</span><br><span class="line">    x87 FLOPs: 0.0%</span><br><span class="line">    Non-FP: 96.2%</span><br><span class="line">    FP Arith/Mem Rd Instr. Ratio: 0.091</span><br><span class="line">    FP Arith/Mem Wr Instr. Ratio: 0.308</span><br></pre></td></tr></table></figure>

<p>针对<code>Vectorization: 23.7%</code>的建议</p>
<p>A significant fraction of floating point arithmetic instructions are scalar. Use <strong>Intel Advisor</strong> to see possible reasons why the code was not vectorized.</p>
<h3 id="SP-FLOPs"><a href="#SP-FLOPs" class="headerlink" title="SP FLOPs"></a>SP FLOPs</h3><p>The metric represents the percentage of single precision floating point operations from all operations executed by the applications. Use the metric for rough estimation of a SP FLOP fraction. If <strong>FMA vector instructions</strong> are used the metric may overcount.</p>
<h3 id="X87-FLOPs"><a href="#X87-FLOPs" class="headerlink" title="X87 FLOPs"></a>X87 FLOPs</h3><p>The metric represents the percentage of x87 floating point operations from all operations executed by the applications. Use the metric for rough estimation of an x87 fraction. If FMA vector instructions are used the metric may overcount.</p>
<p>X87是X86体系结构指令集的<strong>浮点相关子集</strong>。 它起源于8086指令的扩展，以可选的浮点协处理器的形式与相应的x86 cpus配合使用。 这些微芯片的名称在“ 87”中结尾。</p>
<h3 id="FP-Arith-Mem-Rd-Instr-Ratio"><a href="#FP-Arith-Mem-Rd-Instr-Ratio" class="headerlink" title="FP Arith&#x2F;Mem Rd Instr. Ratio"></a>FP Arith&#x2F;Mem Rd Instr. Ratio</h3><p>This metric represents the ratio between arithmetic floating point instructions and memory write instructions. A value less than 0.5 indicates unaligned data access for vector operations, which can negatively impact the performance of vector instruction execution.</p>
<p>小于0.5的值表示向量操作的未对齐数据访问，这可能会对矢量指令执行的性能产生负面影响。</p>
<h2 id="Step2-Hotspots"><a href="#Step2-Hotspots" class="headerlink" title="Step2 : Hotspots"></a>Step2 : Hotspots</h2><p>User-Mode Sampling只能采集单核的数据，来分析算法的优化。</p>
<p>Hardware Event-Based Sampling硬件时间采集能采集全部核心，但是要少于几秒钟？</p>
<p>这个硬件采集慢，而且到一半报错了，发生什么事了？<img src="https://pic.shaojiemike.top/img/20220724201411.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220726222036.png"></p>
<p>网上说是root权限的原因,但是我是用root运行的</p>
<p>反而用普通用户能正常跑Hardware Event-Based Sampling和微架构分析<br><img src="https://pic.shaojiemike.top/img/20220728204538.png"></p>
<h2 id="example"><a href="#example" class="headerlink" title="example"></a>example</h2><p><img src="https://pic.shaojiemike.top/img/20220724202614.png"><br><img src="https://pic.shaojiemike.top/img/20220724204414.png"></p>
<p>手动向量化该区域。</p>
<p>核心时间是 $k*n^2$ 次绝对值和，取最大值</p>
<p>优化思路：</p>
<ol>
<li><p>手动向量化（假设一次处理p个）</p>
<p> 第一个n层取出 k个 <code>rebuilt[i*k+ki]</code> 重复读取到向量寄存器里，</p>
<p> 第二个n层取出k 个 连续的p个，到向量寄存器里。最后不足补0特殊处理，但是一般n都是4的倍数，可能可以不处理。8就要处理了。</p>
<p> 做向量fabs的结果缓存在k个向量寄存器里。</p>
<p> 再对这个k个向量寄存器做横向的向量最大值操作到一个向量寄存器。不足的补0(取最大值不影响)</p>
<p> 最后这一个向量寄存器做寄存器内求和，再加到 <code>chebyshevSum</code> 里.</p>
<p> 这样就实现了p个元素的向量操作。这样一趟共需要3*k个向量寄存器。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dongzhiquan/p/3694858.html">手动数据预取</a></p>
<ol>
<li><code>__builtin_prefetch()</code></li>
</ol>
</li>
<li><p>手动循环展开形成计算访存流水</p>
<ol>
<li>怎么根据输入来规模来展开？</li>
</ol>
</li>
<li><p>分块</p>
</li>
</ol>
<h3 id="访存分析"><a href="#访存分析" class="headerlink" title="访存分析"></a>访存分析</h3><h2 id="github对应项目与赛题"><a href="#github对应项目与赛题" class="headerlink" title="github对应项目与赛题"></a>github对应项目与赛题</h2><h2 id="HPL-PL"><a href="#HPL-PL" class="headerlink" title="HPL-PL"></a>HPL-PL</h2><h3 id="复现机器"><a href="#复现机器" class="headerlink" title="复现机器"></a>复现机器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ lscpu</span><br><span class="line">Architecture:                    x86_64</span><br><span class="line">CPU op-mode(s):                  32-bit, 64-bit</span><br><span class="line">Byte Order:                      Little Endian</span><br><span class="line">Address sizes:                   46 bits physical, 48 bits virtual</span><br><span class="line">CPU(s):                          36</span><br><span class="line">On-line CPU(s) list:             0-35</span><br><span class="line">Thread(s) per core:              1</span><br><span class="line">Core(s) per socket:              18</span><br><span class="line">Socket(s):                       2</span><br><span class="line">NUMA node(s):                    2</span><br><span class="line">Vendor ID:                       GenuineIntel</span><br><span class="line">CPU family:                      6</span><br><span class="line">Model:                           79</span><br><span class="line">Model name:                      Intel(R) Xeon(R) CPU E5-2695 v4 @ 2.10GHz</span><br><span class="line">Stepping:                        1</span><br><span class="line">CPU MHz:                         1296.157</span><br><span class="line">CPU max MHz:                     3300.0000</span><br><span class="line">CPU min MHz:                     1200.0000</span><br><span class="line">BogoMIPS:                        4199.98</span><br><span class="line">Virtualization:                  VT-x</span><br><span class="line">L1d cache:                       1.1 MiB</span><br><span class="line">L1i cache:                       1.1 MiB</span><br><span class="line">L2 cache:                        9 MiB</span><br><span class="line">L3 cache:                        90 MiB</span><br></pre></td></tr></table></figure>

<h3 id="baseline"><a href="#baseline" class="headerlink" title="baseline"></a>baseline</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ gcc --version</span><br><span class="line">gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0</span><br><span class="line">$ gcc -std=c11 conway.c -o Conway</span><br><span class="line">$ ./Conway</span><br><span class="line">……</span><br><span class="line">Iter 997...</span><br><span class="line">Iter 998...</span><br><span class="line">Iter 999...</span><br><span class="line">136527.433000 ms</span><br></pre></td></tr></table></figure>

<h3 id="优化步骤"><a href="#优化步骤" class="headerlink" title="优化步骤"></a>优化步骤</h3><p>由于O3和并行会导致热点代码不可读</p>
<p>在可迭代优化的例子下，根据vtune最大化单核性能。</p>
<p>很明显不是计算密集的应用，怎么形成流水最大化带宽利用，划分<strong>重复利用元素</strong>提高Cache命中率是重点(向量化对计算加速明显)</p>
<p><img src="https://pic.shaojiemike.top/img/20221202184317.png"><br><img src="https://pic.shaojiemike.top/img/20221202184438.png"></p>
<ol>
<li>替换if <code>tmp[i][j] = (!(cnt^3))||((a[i][j]&amp;1)&amp;&amp;(!(cnt^4)));</code></li>
<li>去除中间不必要的拷贝</li>
<li>int 变 char</li>
<li><strong>OMP_PROC_BIND&#x3D;true</strong> 绑定线程到对应local处理器和对应local内存</li>
</ol>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><ol>
<li>实验室同学黄业琦参加了HPC-PL全明星。想复现一下效果</li>
<li>之前Nvidia Nsight用得很爽， 想到vtune的访存优化部分和汇编对应的分析，使用的很少。想从提高计算流水和访存连续流水的角度结合vtune优化。</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/19/">Previous</a></div><div class="pagination-next"><a href="/page/21/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/19/">19</a></li><li><a class="pagination-link is-current" href="/page/20/">20</a></li><li><a class="pagination-link" href="/page/21/">21</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/39/">39</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">388</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Thinking/"><span class="level-start"><span class="level-item">Thinking</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-29T12:58:53.000Z">2024-01-29</time></p><p class="title"><a href="/2024/01/29/OutOfWork/5-VideoEntertainment/AnimeAutoChineseSubtitle/">Anime Auto add Chinese Subtitle</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-25T03:20:42.000Z">2024-01-25</time></p><p class="title"><a href="/2024/01/25/OutOfWork/5-VideoEntertainment/AnimeSuperResolutionFrame/">Anime Super Resolution to 4K &amp; Interpolation to 120 fps</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T14:32:40.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Thinking/2-courage2move/SocialScience/">Social Science</a></p><p class="categories"><a href="/categories/Thinking/">Thinking</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T12:15:22.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/FPGA/">FPGA</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T08:02:52.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/workloadPriority/">Workload Characterization &amp; Priority &amp; Scheduler to CPU/GPU/PIM</a></p><p class="categories"><a href="/categories/Architecture/">Architecture</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>