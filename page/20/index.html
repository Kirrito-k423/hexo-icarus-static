<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.749Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">4 minutes read (About 637 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/network/example/mountNetworkDisk/">Mount Network Disk</a></p><div class="content"><h2 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h2><ul>
<li>The <strong>Server Message Block (SMB)</strong> Protocol is the network file sharing protocol of Microsoft Windows. The set of message packets defining a particular version of the protocol is called a dialect(方言？). </li>
<li>The <strong>Common Internet File System (CIFS)</strong> is a dialect of SMB. <ul>
<li>Both SMB and CIFS are also available on VMS. Both SMB and CIFS are also available on other operating systems like Linux and Android via alternate implementations which are not officially supported by Microsoft.</li>
</ul>
</li>
<li>mount 通过修改 <code>/etc/fstab</code> 文件实现</li>
</ul>
<h2 id="lazy-umount"><a href="#lazy-umount" class="headerlink" title="lazy umount"></a>lazy umount</h2><ul>
<li>分区占用会报错<code>device is busy</code><ul>
<li>先尝试kill相关占用进程 <code>lsof /mountPath | sed -n &#39;2,$p&#39; | awk &#39;&#123;print $2&#125;&#39; | sudo xargs -r kill -9</code></li>
</ul>
</li>
<li><code>umount -l /media/disk</code><ul>
<li>立即从目录结构中实现卸载，即新进程将无法通过&#x2F;media&#x2F;disk访问&#x2F;dev&#x2F;sdb1。</li>
<li>正在访问该文件系统的程序不受影响。即正在操作&#x2F;media&#x2F;disk的进程不会被打断，且仍可以读写&#x2F;dev&#x2F;sdb1中的所有文件。</li>
<li>如果所有进程对&#x2F;media&#x2F;disk的操作都执行完，那么才真正地umount。</li>
<li>由此可知，lazy umount并没有真正实现umount，仅用于特殊需要的情况，而用这种方法来卸载U盘是不安全的。</li>
</ul>
</li>
</ul>
<h2 id="Ubuntu-挂载网络硬盘"><a href="#Ubuntu-挂载网络硬盘" class="headerlink" title="Ubuntu 挂载网络硬盘"></a>Ubuntu 挂载网络硬盘</h2><p>在snode5测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip acsa-med.acsalab.com</span></span><br><span class="line">mount 114.214.236.245:/volume1/acsa-med /acsa-med</span><br><span class="line">  114.214.236.245:/volume1/acsa-med      66T   40T   27T  61% /acsa-med</span><br><span class="line">mount -o soft,proto=rdma,port=2050 10.1.13.1:/home /staff</span><br><span class="line">  10.1.13.1:/home                        35T  8.1G   35T   1% /staff</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载网络共享文件夹Entertainment 到ubuntu空目录/synology，除开root，本地用户yyy也能访问：</span></span><br><span class="line">sudo apt-get install cifs-utils</span><br><span class="line"><span class="comment"># 可以省略 pass。 </span></span><br><span class="line">sudo mount.cifs //synology.acsalab.com/Entertainment /synology -o user=xxx vers=3.0</span><br></pre></td></tr></table></figure>

<ul>
<li>注意: 挂载的时候选择ipv6域名<code>synology.acsalab.com</code>更好, 之前ipv4反而走了WARP的wiregaurd代理导致链接不上</li>
<li>其中<code>uid</code>和<code>domain</code>可以用<code>id</code>命令可知</li>
</ul>
<h3 id="强制取消-CIFS-Share-挂载"><a href="#强制取消-CIFS-Share-挂载" class="headerlink" title="强制取消 CIFS Share 挂载"></a>强制取消 CIFS Share 挂载</h3><p>lazy<code>-l</code>方式unmount所有<code>-a</code> 文件系统为<code>-t cifs</code>的挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount -a -t cifs -l /path/to/share</span><br></pre></td></tr></table></figure>

<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>姜师兄不知道怎么取消挂载后出现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@brainiac1:/home/qcjiang/mnt<span class="comment"># ls -al</span></span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;nas&#x27;</span>: No such device</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 root    root    4096 May 11 15:52 .</span><br><span class="line">drwxr-xr-x 23 qcjiang qcjiang 4096 May 11 15:52 ..</span><br><span class="line">d?????????  ? ?       ?          ?            ? nas</span><br><span class="line"></span><br><span class="line">root@brainiac1:/home/qcjiang/mnt/nas<span class="comment"># ls -al</span></span><br><span class="line"><span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;.&#x27;</span>: No such device</span><br><span class="line"></span><br><span class="line">root@brainiac1:/home/qcjiang/mnt<span class="comment"># lsof /mntSyno</span></span><br><span class="line">lsof: WARNING: can<span class="string">&#x27;t stat() cifs file system /home/qcjiang/mnt/nas</span></span><br><span class="line"><span class="string">      Output information may be incomplete.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>d?????????</code>经常出现在无权限访问时，需要<code>chmod +x /path</code>解决</li>
<li>但是这里是没有处理空cifs挂载，运行<code>umount /home/qcjiang/mnt/nas</code> 即可解决。</li>
</ul>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><p>想将Nas上的盘挂载到</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.749Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/network/">network</a></span><span class="level-item">8 minutes read (About 1233 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/network/vpn/3-cloudflare/">Cloudflare warp proxy</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>Cloudflare 作为全球最大的网络服务提供商，全球大约有30%的网络服务由它提供。</li>
<li>WARP是Cloudflare提供的免费的，没有带宽上限或限制的VPN服务，可以让你在任何地方访问互联网，而不会受到地域限制。<ul>
<li>WARP软件是基于wireguard魔改的。</li>
<li>WARP有安卓和Windows的客户端，但是使用人数过多，体验并不好</li>
<li>Linux下通过WARP代理能实现20MB&#x2F;s的下载速度。</li>
</ul>
</li>
</ul>
<h2 id="WARP-on-Linux"><a href="#WARP-on-Linux" class="headerlink" title="WARP on Linux"></a>WARP on Linux</h2><h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><ul>
<li>缘由：WARP下的PT做种快得多。(不是，是因为网络硬盘，所以下载多少要占用多少上传)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/P3TERX/warp.sh">参考教程</a>。</li>
<li>脚本和所需文件在<code>Z:\shaojiemike\Documents\文献\计算机网络</code>目录下。这里先使用fjw的脚本。</li>
</ul>
<ol>
<li>通过注册脚本<code>register.py</code>，获得私钥和分配的ip</li>
<li>配置wg。其中Endpoint端口可从官方文档中找到，默认的2408很可能被封。<a target="_blank" rel="noopener" href="https://developers.cloudflare.com/cloudflare-one/connections/connect-devices/warp/deployment/firewall/">WARP with firewall · Cloudflare Zero Trust docs</a> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">PrivateKey = xxxx         #register.py的私钥</span><br><span class="line">Address = xxx/32,xxx/128  #register.py的ipv4和ipv6</span><br><span class="line">Table = off              # off禁止wg修改路由表</span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=</span><br><span class="line">AllowedIPs = 0.0.0.0/0,::/0</span><br><span class="line">Endpoint = [2606:4700:d0::a29f:c001]:500    #2408, 1701, 500, 4500</span><br><span class="line">PersistentKeepalive = 25</span><br></pre></td></tr></table></figure></li>
<li>warp使用的不是标准的wg协议，root下运行，需要通过一个nft脚本<code>main.sh</code>修改包的3个字节。<ol>
<li>安装nft <code>apt-get install nftables</code></li>
<li>需要<code>/etc/default/warp-helper</code>文件填写对应的</li>
<li>ROUTING_ID对应register.py的ROUTING_ID。注意三个数之间没空格</li>
<li>UPSTREAM对应<code>wg-conf</code>里Endpoint。比如：</li>
<li><pre><code>  ROUTING_ID=11,45,14
  UPSTREAM=[2606:4700:d0::a29f:c001]:500
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2. 最后开启路由表,Root权限运行` ip route add default dev warp proto static scope link table default`</span><br><span class="line"></span><br><span class="line">## WARP on OpenWRT </span><br><span class="line"></span><br><span class="line">* 目的：为了防止大量流量通过WARP，导致被官方封禁，所以只在OpenWRT上配置WARP分流github的流量。</span><br><span class="line">* 实现思路：</span><br><span class="line">  * 运行python脚本，通过github的API获得所有的github域名ip，</span><br><span class="line">  * 使用iptables的warp_out表，将目的地址为github域名ip路由到WARP的虚拟网卡上。</span><br><span class="line"></span><br><span class="line">### WARP Wireguard Establishment</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">python register.py #自动生成warp-op.conf,warp.conf和warp-helper</span><br><span class="line">mv warp-helper /etc/default</span><br><span class="line"># cat main.sh</span><br><span class="line"># cat warp-op.conf</span><br><span class="line">vim /etc/config/network #填写warp-op.conf内容，默认只转发172.16.0.0/24来测试连接</span><br><span class="line">ifup warp #启动warp, 代替wg-quick up warp.conf</span><br><span class="line">bash main.sh #启动防火墙实现报文头关键三字节修改</span><br><span class="line">nft list ruleset #查看防火墙，是否配置成功</span><br><span class="line">wg #查看warp状态，测试是否连接成果</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
</li>
</ol>
<p>这时还没创建warp_out路由表，所以还不能通过WARP出数据。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/etc/config/network</span></span><br><span class="line">config interface <span class="string">&#x27;warp&#x27;</span></span><br><span class="line">        option proto <span class="string">&#x27;wireguard&#x27;</span></span><br><span class="line">        option private_key <span class="string">&#x27;wKpvFCOk4sf8d/RD001TF7sNQ39bWnllpqaFf8QnHG4=&#x27;</span></span><br><span class="line">        option listen_port <span class="string">&#x27;51825&#x27;</span></span><br><span class="line">        list addresses <span class="string">&#x27;172.16.0.2/32&#x27;</span></span><br><span class="line">        list addresses <span class="string">&#x27;2606:4700:110:8466:d4ea:ffb8:10da:470f/128&#x27;</span></span><br><span class="line">        <span class="comment">#option disabled &#x27;1&#x27; </span></span><br></pre></td></tr></table></figure>
<p>然后WebUI点击apply 或者命令行运行<code>ifconfig warp down &amp;&amp; ifup</code></p>
<h3 id="Network-planning-and-design"><a href="#Network-planning-and-design" class="headerlink" title="Network planning and design"></a>Network planning and design</h3><p>添加了WARP的网络出口后，路由器不在只是通过WAN出数据。防火墙需要更新：<img src="https://pic.shaojiemike.top/img/20230330200503.png"></p>
<ul>
<li>原路返回规则。<ul>
<li>针对有公网ip的接口，需要原路返回。<ul>
<li>配置来自wan和WARP的信报，使用wan和WARP的路由表，优先级3</li>
<li>来自wan的比如来自外部的ssh，为了防止失联。</li>
<li>来自WARP的比如<code>wget --bind-address=WARP_ip</code>来模拟</li>
</ul>
</li>
<li>内网地址没有必要配置，因为通过内网地址访问host，则dst必然也是内网地址。因此会匹配main中的内网地址规则。</li>
</ul>
</li>
<li>wan和WARP的路由表内各自走wan和WARP的网卡</li>
<li>为了使得原本wg正常运行，<code>10:     from all lookup main suppress_prefixlength 1</code><ul>
<li>假如warp_out是defualt规则，该项也是为了防止失联。</li>
</ul>
</li>
<li>创建warp_out的空路由表<code>1000:   from all lookup warp_out</code>,优先级1000</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@tsjOp:~/warp# ip rule</span><br><span class="line">0:      from all lookup local</span><br><span class="line">3:      from 114.214.233.141/22 iif eth1 lookup wan</span><br><span class="line">3:      from 172.16.0.2 iif warp lookup warp</span><br><span class="line">10:     from all lookup main suppress_prefixlength 1</span><br><span class="line">1000:   from all lookup warp_out</span><br><span class="line">32766:  from all lookup main</span><br><span class="line">32767:  from all lookup default</span><br></pre></td></tr></table></figure>

<h3 id="填充warp-out路由表"><a href="#填充warp-out路由表" class="headerlink" title="填充warp_out路由表"></a>填充warp_out路由表</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ip_route</span><br><span class="line"><span class="built_in">mv</span> ../github_ipv4.txt .</span><br><span class="line">python fill_ip_table.py --table warp_out --iface warp --p2p -f github_ipv4.txt</span><br></pre></td></tr></table></figure>

<p>对所有github域名的ip执行类似<code>ip ro add 192.30.252.0/22 dev warp proto static table warp_out</code>操作。</p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mtr www.github.com</span><br><span class="line">ssh -vT git@github.com</span><br><span class="line">git clone https://github.com/llvm/llvm-project</span><br></pre></td></tr></table></figure>

<h3 id="添加到启动项"><a href="#添加到启动项" class="headerlink" title="添加到启动项"></a>添加到启动项</h3><p>修改<code>/etc/rc.local</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Put your custom commands here that should be executed once</span></span><br><span class="line"><span class="comment"># the system init finished. By default this file does nothing.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">sleep</span> 30 &amp;&amp; <span class="built_in">cd</span> /root/warp/ip_route &amp;&amp; python fill_ip_table.py --table warp_out --iface warp --p2p -f github_ipv4.txt</span><br><span class="line"></span><br><span class="line">/root/warp/main.sh <span class="comment">#重新添加防火墙</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>

<h2 id="WARP-on-Windows"><a href="#WARP-on-Windows" class="headerlink" title="WARP on Windows"></a>WARP on Windows</h2><p>基于1.1.1.1 的安装windows版本直接白嫖</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://gist.github.com/iBug/3107fd4d5af6a4ea7bcea4a8090dcc7e">https://gist.github.com/iBug/3107fd4d5af6a4ea7bcea4a8090dcc7e</a></p>
<p>glados</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.753Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">7 minutes read (About 1110 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/software/linux/services/">Services Systemd Systemclt</a></p><div class="content"><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>历史上，Linux 的启动一直采用init进程。<br>下面的命令用来启动服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/apache2 start</span><br><span class="line"># 或者</span><br><span class="line">$ service apache2 start</span><br></pre></td></tr></table></figure>
<p>这种方法有两个缺点。</p>
<p>一是启动时间长。init进程是串行启动，只有前一个进程启动完，才会启动下一个进程。</p>
<p>二是启动脚本复杂。init进程只是执行启动脚本，不管其他事情。脚本需要自己处理各种情况，这往往使得脚本变得很长。</p>
<h3 id="Systemd"><a href="#Systemd" class="headerlink" title="Systemd"></a>Systemd</h3><p>Systemd 就是为了解决这些问题而诞生的。它的设计目标是，为系统的启动和管理提供一套完整的解决方案。</p>
<p>根据 Linux 惯例，字母d是守护进程（daemon）的缩写。 Systemd 这个名字的含义，就是它要守护整个系统。</p>
<p>使用了 Systemd，就不需要再用init了。Systemd 取代了initd，成为系统的第一个进程（PID 等于 1），其他进程都是它的子进程。</p>
<p>Systemd 的优点是功能强大，使用方便，缺点是体系庞大，非常复杂。事实上，现在还有很多人反对使用 Systemd，理由就是它过于复杂，与操作系统的其他部分强耦合，违反”keep simple, keep stupid”的Unix 哲学。<br><img src="https://pic.shaojiemike.top/img/20220628174222.png"></p>
<h3 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h3><p>systemctl是 Systemd 的主命令，用于管理系统。</p>
<p> systemctl - Control the systemd system and service manager</p>
<h3 id="systemctl常见命令"><a href="#systemctl常见命令" class="headerlink" title="systemctl常见命令"></a>systemctl常见命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl is-enabled servicename.service #查询服务是否开机启动</span><br><span class="line">systemctl enable *.service #开机运行服务</span><br><span class="line">systemctl disable *.service #取消开机运行</span><br><span class="line">systemctl start *.service #启动服务</span><br><span class="line">systemctl stop *.service #停止服务</span><br><span class="line">systemctl restart *.service #重启服务</span><br><span class="line">systemctl reload *.service #重新加载服务配置文件</span><br><span class="line">systemctl status *.service #查询服务运行状态</span><br><span class="line">systemctl --failed #显示启动失败的服务</span><br></pre></td></tr></table></figure>
<h3 id="systemctl命令实操"><a href="#systemctl命令实操" class="headerlink" title="systemctl命令实操"></a>systemctl命令实操</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查看相关unit</span><br><span class="line">shaojiemike@tsjNas:~$ systemctl|grep wg</span><br><span class="line">  pkg-wg-quick@wg0.service</span><br><span class="line">       loaded active exited  WireGuard via wg-quick(8) for wg0</span><br><span class="line"></span><br><span class="line"># 查看已经启动的服务</span><br><span class="line">systemctl list-unit-files --state=enabled|grep wg</span><br><span class="line">pkg-wg-quick@.service                     enabled //由于我删除了wg0，所以.service前没wg0</span><br><span class="line"></span><br><span class="line"># 删除服务</span><br><span class="line">sh-4.4#  systemctl disable pkg-wg-quick@.service</span><br><span class="line">Removed symlink /etc/systemd/system/syno-low-priority-packages.target.wants/pkg-wg-quick@wg0.service.</span><br></pre></td></tr></table></figure>

<h3 id="开机启动原理"><a href="#开机启动原理" class="headerlink" title="开机启动原理"></a>开机启动原理</h3><p>Systemd 默认从目录<code>/etc/systemd/system/</code>读取配置文件。但是，里面存放的大部分文件都是符号链接，指向目录<code>/usr/lib/systemd/system/</code>，真正的配置文件存放在那个目录。</p>
<p><code>systemctl enable</code>命令用于在上面两个目录之间，建立符号链接关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl enable clamd@scan.service</span><br><span class="line"># 等同于</span><br><span class="line">$ sudo ln -s &#x27;/usr/lib/systemd/system/clamd@scan.service&#x27; &#x27;/etc/systemd/system/multi-user.target.wants/clamd@scan.service&#x27;</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<p>如果配置文件里面设置了开机启动，<code>systemctl enable</code>命令相当于激活开机启动。</p>
<p>与之对应的，<code>systemctl disable</code>命令用于在两个目录之间，撤销符号链接关系，相当于撤销开机启动。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl disable clamd@scan.service</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<p>配置文件的后缀名，就是该 Unit 的种类，比如<code>sshd.socket</code>。如果省略，Systemd 默认后缀名为<code>.service</code>，所以<code>sshd</code>会被理解成<code>sshd.service</code>。</p>
<h2 id="把程序设置systemctl服务-并开机启动"><a href="#把程序设置systemctl服务-并开机启动" class="headerlink" title="把程序设置systemctl服务,并开机启动"></a>把程序设置systemctl服务,并开机启动</h2><ol>
<li>Systemd 默认从目录<code>/etc/systemd/system/</code>读取配置文件。但是，里面存放的大部分文件都是符号链接，指向目录<code>/usr/lib/systemd/system/</code>，真正的配置文件存放在那个目录。</li>
<li>进入目录<code>/usr/lib/systemd/system</code>,修改<code>webhook.service</code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Webhook receiver for GitHub</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/webhook</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nexus.service  #启动服务</span><br><span class="line">systemctl enable nexus.service #设置开机启动</span><br></pre></td></tr></table></figure>
<code>Loaded: loaded (/etc/systemd/system/webhook.service; enabled;</code>这个<code>enabled</code>就是开机启动的意思</li>
</ol>
<h2 id="查看服务的log"><a href="#查看服务的log" class="headerlink" title="查看服务的log"></a>查看服务的log</h2><p>journalctl - Query the systemd journal</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># root @ snode0 in /etc/systemd/system [17:57:48]</span><br><span class="line">$ journalctl -u webhook.service</span><br><span class="line">-- Logs begin at Mon 2022-06-06 15:54:50 CST, end at Tue 2022-06-28 17:57:50 CST. --</span><br><span class="line">Jun 28 17:30:53 snode0 systemd[1]: Started Webhook receiver for GitHub.</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl reload webhook.service</span><br><span class="line">==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===</span><br><span class="line">Authentication is required to reload &#x27;webhook.service&#x27;.</span><br><span class="line">Multiple identities can be used for authentication:</span><br><span class="line"> 1.  Jun Shi (shijun)</span><br><span class="line"> 2.  Shaojie Tan (shaojiemike)</span><br><span class="line">Choose identity to authenticate as (1-2): 2</span><br><span class="line">Password:</span><br><span class="line">==== AUTHENTICATION COMPLETE ===</span><br><span class="line">Failed to reload webhook.service: Job type reload is not applicable for unit webhook.service.</span><br></pre></td></tr></table></figure>
<p>Simple 类型不能reload</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40741855/article/details/104984071">https://blog.csdn.net/qq_40741855/article/details/104984071</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-11T16:00:00.000Z" title="5/11/2023, 4:00:00 PM">2023-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.753Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">14 minutes read (About 2170 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/11/Work/software/perf/nvidiaNsight/">Nvidia Nsight</a></p><div class="content"><h2 id="Nsight-system-compute-Graph-的关系"><a href="#Nsight-system-compute-Graph-的关系" class="headerlink" title="Nsight system compute &amp; Graph 的关系"></a>Nsight system compute &amp; Graph 的关系</h2><p><img src="https://pic.shaojiemike.top/img/20220513195618.png"></p>
<h3 id="Nsight-Systems"><a href="#Nsight-Systems" class="headerlink" title="Nsight Systems"></a>Nsight Systems</h3><p>All developers should start with Nsight Systems to identify the largest optimization opportunities. Nsight Systems provides developers a <strong>system-wide visualization</strong> of an applications performance. Developers can optimize <strong>bottlenecks</strong> to scale efficiently across any number or size of CPUs and GPUs; from large servers to our smallest SoC. For <strong>further optimizations to compute kernels developers should use Nsight Compute</strong> or to further optimize a graphics workloads, use Nsight Graphics.</p>
<h3 id="Nsight-Compute"><a href="#Nsight-Compute" class="headerlink" title="Nsight Compute"></a>Nsight Compute</h3><p>Nsight Compute is an interactive kernel profiler for CUDA applications. It provides detailed performance metrics and API debugging via a user interface and command line tool. Nsight Compute also provides customizable and data-driven user interface and metric collection that can be extended with analysis scripts for post-processing results.</p>
<h3 id="Nsight-Graphics"><a href="#Nsight-Graphics" class="headerlink" title="Nsight Graphics"></a>Nsight Graphics</h3><p>Nsight Graphics is a standalone application for the debugging, profiling, and analysis of <strong>graphics applications</strong> on Microsoft Windows and Linux. It allows you to optimize the performance of your Direct3D 11, Direct3D 12, DirectX Raytracing 1.1, <strong>OpenGL</strong>, Vulkan, and KHR Vulkan <strong>Ray Tracing</strong> Extension based applications.</p>
<h2 id="Install-Nsight-local"><a href="#Install-Nsight-local" class="headerlink" title="Install Nsight local"></a>Install Nsight local</h2><ol>
<li>check the perf config To collect thread scheduling data and IP (instruction pointer) samples<ol>
<li><code>cat /proc/sys/kernel/perf_event_paranoid</code></li>
<li>如果大于2，临时改变 <code>sudo sh -c &#39;echo 2 &gt;/proc/sys/kernel/perf_event_paranoid&#39;</code>重启会重置</li>
<li>永久修改 <code>sudo sh -c &#39;echo kernel.perf_event_paranoid=2 &gt; /etc/sysctl.d/local.conf&#39;</code></li>
</ol>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/gameworksdownload#?dn=nsight-systems-2022-2">下载Nsight</a><ol>
<li>但是单独下载要会员</li>
<li>下载cuda toolkit,有集成</li>
</ol>
</li>
</ol>
<h2 id="Nsight-System"><a href="#Nsight-System" class="headerlink" title="Nsight System"></a>Nsight System</h2><p>运行 <code>nsight-sys</code></p>
<h3 id="使用基本说明"><a href="#使用基本说明" class="headerlink" title="使用基本说明"></a>使用基本说明</h3><p>勾选了CUDA-trace等选项<br><img src="https://pic.shaojiemike.top/img/20220521143324.png"></p>
<p>可以从整体上看资源的使用情况，</p>
<p>将鼠标放在上面会有<strong>具体</strong>的数值或者名称的解释</p>
<p><img src="https://pic.shaojiemike.top/img/20220521143753.png"><br><img src="https://pic.shaojiemike.top/img/20220521144435.png"></p>
<p>比较有用的是能看出 PCIE, GPU DRAM Bandwidth, Warp的使用情况。</p>
<p>由于没有根据kernel function区分，很难读。为此提供了NVTX来给代码打标签</p>
<h3 id="The-NVIDIA-Tools-Extension-Library-NVTX-使用"><a href="#The-NVIDIA-Tools-Extension-Library-NVTX-使用" class="headerlink" title="The NVIDIA Tools Extension Library (NVTX)使用"></a>The NVIDIA Tools Extension Library (NVTX)使用</h3><p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-visual-studio-edition/2020.1/nvtx/index.html">https://docs.nvidia.com/nsight-visual-studio-edition/2020.1/nvtx/index.html</a><br>头文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;nvToolsExt.h&gt;</span><br></pre></td></tr></table></figure>

<p>需要标记代码前后加入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nvtxRangePush(&quot;checkResult&quot;); //nvtxRangePushA,nvtxRangePushW,nvtxRangePushEx 好像都差不多</span><br><span class="line">checkResult&lt;&lt;&lt;dim3(row_num / TPBX, col_num / TPBY, 1), dim3(TPBX, TPBY, 1)&gt;&gt;&gt;(row_num, col_num, result);</span><br><span class="line">cudaDeviceSynchronize(); </span><br><span class="line">nvtxRangePop();</span><br></pre></td></tr></table></figure>

<p>注意NVTX是作用在<strong>CPU线程</strong>上的，无法在GPU里用。</p>
<p>注意需要 <code>g++ -o testnv -I/usr/local/cuda/include -L/usr/local/cuda/lib64 -lnvToolsExt testnv.cpp</code>。或者修改cmake来实现同样的效果</p>
<h3 id="NVTX问题"><a href="#NVTX问题" class="headerlink" title="NVTX问题"></a>NVTX问题</h3><p><img src="https://pic.shaojiemike.top/img/20220521153540.png"></p>
<p>怎么不在同一竖直方向上？GPU还先跑是什么情况</p>
<h2 id="Nsight-Compute-1"><a href="#Nsight-Compute-1" class="headerlink" title="Nsight Compute"></a>Nsight Compute</h2><p>Nsight Systems 就是nvprof的继任者，NVIDIA最新的用于监测 kernel timeline的工具。NVIDIA 计算能力7.5及以上的GPU设备不再支持nvprof工具进行性能剖析，提示使用Nsight Compute作为替代品.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ncu # 命令行</span><br><span class="line">ncu-ui</span><br></pre></td></tr></table></figure>

<h3 id="使用Nsight-Compute-CLI-nv-nsight-cu-cli-ncu-输出数据"><a href="#使用Nsight-Compute-CLI-nv-nsight-cu-cli-ncu-输出数据" class="headerlink" title="使用Nsight Compute CLI (nv-nsight-cu-cli &#x2F; ncu) 输出数据"></a>使用Nsight Compute CLI (nv-nsight-cu-cli &#x2F; ncu) 输出数据</h3><p><code>nv-nsight-cu-cli -&gt; ncu</code><br>下面是一个使用样例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/NVIDIA-Nsight-Compute/nv-nsight-cu-cli -o mnist -f --csv --profile-from-start off /usr/bin/python3 mnist.py</span><br></pre></td></tr></table></figure>

<p>其中-o是为了输出.nsight-cuprof-report文件用于后续的可视化查看，-f为强制覆盖原有文件，–csv可是在console输出除 timeline 以外数据的时候以逗号分隔数据，方便拷贝至csv文件， –profile-from-start的使用方法和Nsight System以及nvprof一样。其余flag信息可见<a target="_blank" rel="noopener" href="https://docs.nvidia.com/nsight-compute/NsightComputeCli/index.html">https://docs.nvidia.com/nsight-compute/NsightComputeCli/index.html</a> 。</p>
<p>上面的例子会生成mnist.nsight-cuprof-report文件。</p>
<p>注意</p>
<p>最前面的可执行文件需要绝对路径，如上面的python3需要使用 &#x2F;usr&#x2F;bin&#x2F;python3。<br>生成过程中可能会产生很大的临时文件（几十G）。如果本次磁盘空间不够，可以设置如下环境变量来调整存储临时文件的地址。没有找到能直接使用 Nsight Compute 修改临时文件地址的方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export /TMPDIR=/path/for/tmp</span><br></pre></td></tr></table></figure>

<h3 id="ncu与nvprof命令行抓取参数的映射表"><a href="#ncu与nvprof命令行抓取参数的映射表" class="headerlink" title="ncu与nvprof命令行抓取参数的映射表"></a>ncu与nvprof命令行抓取参数的映射表</h3><p><a target="_blank" rel="noopener" href="https://www.freesion.com/article/34871449930/">https://www.freesion.com/article/34871449930/</a></p>
<h3 id="ncu-ui教程"><a href="#ncu-ui教程" class="headerlink" title="ncu-ui教程"></a>ncu-ui教程</h3><p>为了显示原代码makefile添加 <code>-g -G</code>选项<br>对应CmakeList.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target_compile_options(better PUBLIC $&lt;$&lt;COMPILE_LANGUAGE:CUDA&gt;:--extended-lambda</span><br><span class="line">    -G -src-in-ptx</span><br><span class="line">    &gt;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yan31415/article/details/109491749">https://blog.csdn.net/yan31415/article/details/109491749</a></p>
<h3 id="ncu-ui表格-图"><a href="#ncu-ui表格-图" class="headerlink" title="ncu-ui表格&amp;图"></a>ncu-ui表格&amp;图</h3><p><img src="https://pic.shaojiemike.top/img/20220521160243.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220521161200.png"><br>我不明白我的SMEM怎么不是从DRAM来的， 而且峰值怎么这么低？</p>
<p>这个错误也是令人迷惑<br>The memory access pattern for loads from L1TEX to L2 is not optimal. The granularity of an L1TEX request to L2 is a 128 byte cache line. That is 4 consecutive 32-byte sectors per L2 request. However, this kernel only accesses an average of 3.7 sectors out of the possible 4 sectors per cache line. Check the Source Counters section for uncoalesced loads and try to minimize how many cache lines need to be accessed per memory request.</p>
<p><img src="https://pic.shaojiemike.top/img/20220521163326.png"></p>
<p>不知道为什么有1%和2% 的bank conflict</p>
<p>可以看到 SMEM， Register，Block Size是怎么影响GPU Warp的分配调度的。<br><img src="https://pic.shaojiemike.top/img/20220521163505.png"><br>上图没有拖累，吃满了64个warp。</p>
<p>关于if语句<br><img src="https://pic.shaojiemike.top/img/20220521163918.png"><br>if语句只要warp里执行相同就行。</p>
<p>可以提示出不连续访问的地方。(这里是这样设计的，已经避免了绝大部分的不连续访问)<br><img src="https://pic.shaojiemike.top/img/20220521164456.png"></p>
<p>显示stall最多的指令是什么以及在等待什么。还有执行最多的指令<br><img src="https://pic.shaojiemike.top/img/20220521164627.png"></p>
<p>假如 file mismatched 手动选择文件就行<br><img src="https://pic.shaojiemike.top/img/20220521165836.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220521170004.png"></p>
<p>stall的信息，感觉就这些有点用。(其中sb是scoreboard的意思)</p>
<h2 id="ncu-ui-分析汇编"><a href="#ncu-ui-分析汇编" class="headerlink" title="ncu-ui 分析汇编"></a>ncu-ui 分析汇编</h2><h3 id="PTX-SASS汇编说明"><a href="#PTX-SASS汇编说明" class="headerlink" title="PTX&amp;SASS汇编说明"></a>PTX&amp;SASS汇编说明</h3><p>有两种汇编</p>
<p>请看PTX SASS一文</p>
<h3 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h3><p><img src="https://pic.shaojiemike.top/img/20220522095802.png"></p>
<p>可以通过指令执行数或者采样率来得知，执行最多的指令。</p>
<p>鼠标悬停可以知道具体命令的含义</p>
<h3 id="Ex1-for循环头"><a href="#Ex1-for循环头" class="headerlink" title="Ex1: for循环头"></a>Ex1: for循环头</h3><p><img src="https://pic.shaojiemike.top/img/20220522101042.png"></p>
<h3 id="Ex2-for-loop-kernel"><a href="#Ex2-for-loop-kernel" class="headerlink" title="Ex2: for-loop kernel"></a>Ex2: for-loop kernel</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdata[Regular_local_index]=arr_data[Regular_global_index];</span><br></pre></td></tr></table></figure>

<p>该从DRAM里读取到SMEM的指令对应的PTX和SASS代码<br><img src="https://pic.shaojiemike.top/img/20220522105005.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cvt.f32.u16 d, a;   // convert 16-bit unsigned to 32-bit float</span><br></pre></td></tr></table></figure>

<h3 id="问题：无效self-mov？"><a href="#问题：无效self-mov？" class="headerlink" title="问题：无效self-mov？"></a>问题：无效self-mov？</h3><p><img src="https://pic.shaojiemike.top/img/20220522101410.png"></p>
<p>为了隐藏延迟？</p>
<p>直接原因是PTX翻译成SASS。一条mov变多条了</p>
<p><img src="https://pic.shaojiemike.top/img/20220522103503.png"></p>
<h2 id="CUDA-Visual-Profiler"><a href="#CUDA-Visual-Profiler" class="headerlink" title="CUDA Visual Profiler"></a>CUDA Visual Profiler</h2><p>老一代debugger工具，逐渐被Nsight淘汰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nvprof # 命令行,nsys 之前的名称叫做 nvprof</span><br><span class="line">nvvp</span><br></pre></td></tr></table></figure>

<p>在more里有建议</p>
<h3 id="nvprof捕获信息存储"><a href="#nvprof捕获信息存储" class="headerlink" title="nvprof捕获信息存储"></a>nvprof捕获信息存储</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nvprof --analysis-metrics -o  nbody-analysis.nvprof ./nbody --benchmark -numdevices=2 -i=1</span><br><span class="line"># 下面输出 .qdrep 文件</span><br><span class="line">nsys profile --stats=true --force-overwrite=true  -o baseline-report ./single-thread-vector-add</span><br></pre></td></tr></table></figure>

<h2 id="CUDA-Visual-Profiler-问题"><a href="#CUDA-Visual-Profiler-问题" class="headerlink" title="CUDA Visual Profiler 问题"></a>CUDA Visual Profiler 问题</h2><p>&#x3D;&#x3D;7196&#x3D;&#x3D; Warning: Some profiling data are not recorded. Make sure cudaProfilerStop() or cuProfilerStop() is called before application exit to flush profile data.<br>解决方法在程序末尾加cudaDeviceReset()或者cudaProfilerStop()</p>
<h2 id="Nsight-Compute-问题"><a href="#Nsight-Compute-问题" class="headerlink" title="Nsight Compute 问题"></a>Nsight Compute 问题</h2><h3 id="OpenGL-没有安装"><a href="#OpenGL-没有安装" class="headerlink" title="OpenGL 没有安装"></a>OpenGL 没有安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Warning: Failed to get OpenGL version. OpenGL version 2.0 or higher is required.</span><br><span class="line">OpenGL version is too low (0). Falling back to Mesa software rendering.</span><br><span class="line">qt.qpa.plugin: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;&quot; even though it was found.</span><br><span class="line">This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: offscreen, wayland-egl, wayland, wayland-xcomposite-egl, wayland-xcomposite-glx, xcb.</span><br></pre></td></tr></table></figure>

<p>解决办法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libxcb-xinerama0</span><br><span class="line">sudo apt install libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-render-util0</span><br></pre></td></tr></table></figure>

<h3 id="Qt插件缺失"><a href="#Qt插件缺失" class="headerlink" title="Qt插件缺失"></a>Qt插件缺失</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">qt.qpa.plugin: Could not load the Qt platform plugin &quot;xcb&quot; in &quot;&quot; even though it was found.</span><br><span class="line">This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.</span><br><span class="line"></span><br><span class="line">Available platform plugins are: xcb.</span><br><span class="line"></span><br><span class="line">Application could not be initialized!</span><br><span class="line">    This is likely due to missing Qt platform dependencies.</span><br><span class="line">    For a list of dependencies, please refer to https://doc.qt.io/qt-5/linux-requirements.html</span><br><span class="line">    To view missing libraries, set QT_DEBUG_PLUGINS=1 and re-run the application.</span><br></pre></td></tr></table></figure>

<p>按照说明 <code>export QT_DEBUG_PLUGINS=1</code>再次运行, 显示具体问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cannot load library /staff/shaojiemike/Install/cuda_11.7.0_515.43.04_linux/nsight-compute-2022.2.0/host/linux-desktop-glibc_2_11_3-x64/Plugins/platforms/libqxcb.so: (libxcb-xinput.so.0: cannot open shared object file: No such file or directory)</span><br></pre></td></tr></table></figure>

<p>解决 <code>sudo apt-get install libxcb-xinput0</code></p>
<h3 id="kernel没权限profile"><a href="#kernel没权限profile" class="headerlink" title="kernel没权限profile"></a>kernel没权限profile</h3><p>mobaXterm打开，每个核函数都会出现ERR_NVGPUCTRPERM - The user does not have permission to profile on the target device这个错误</p>
<ol>
<li>说要用sudo，或者最新的NV</li>
</ol>
<h3 id="sudo-ncu-ui-不能远程打开"><a href="#sudo-ncu-ui-不能远程打开" class="headerlink" title="sudo ncu-ui 不能远程打开"></a>sudo ncu-ui 不能远程打开</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ncu-ui</span><br><span class="line">MobaXterm X11 proxy: Authorisation not recognised</span><br><span class="line">qt.qpa.xcb: could not connect to display localhost:10.0</span><br></pre></td></tr></table></figure>

<p>解决办法(原因是sudo相当于切换到root用户，丢失了xauth信息)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ xauth list</span><br><span class="line">snode0/unix:12  MIT-MAGIC-COOKIE-1  84941f1f8be97d19436356685f75b884</span><br><span class="line">snode0/unix:13  MIT-MAGIC-COOKIE-1  5172ee2c7364b055cd37538b460f7741</span><br><span class="line">snode0/unix:11  MIT-MAGIC-COOKIE-1  589f3b5ab852f24ca3710c53e6439260</span><br><span class="line">hades1/unix:10  MIT-MAGIC-COOKIE-1  9346adec202bd65250f3d21239025750</span><br><span class="line">snode0/unix:10  MIT-MAGIC-COOKIE-1  52285c563f1688741fa1b434ed2b7b2c</span><br><span class="line"></span><br><span class="line">sudo -s # 切换</span><br><span class="line">xauth add snode0/unix:10  MIT-MAGIC-COOKIE-1  52285c563f1688741fa1b434ed2b7b2c # 补全xauth</span><br><span class="line"># 正常执行 xauth有用的总是最后一个</span><br></pre></td></tr></table></figure>
<p><img src="https://pic.shaojiemike.top/img/20220606170556.png"></p>
<h3 id="Error-0-UnsupportedGpu"><a href="#Error-0-UnsupportedGpu" class="headerlink" title="Error 0: UnsupportedGpu"></a>Error 0: UnsupportedGpu</h3><p>原因是 <a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/nsight-unsupported-gpu/163617">软件对GPU的支持是逐步</a>的需要安装最新的。</p>
<p>不支持的Nsight的可以尝试老的debugger工具 CUDA Visual Profiler</p>
<h3 id="Error-Profiling-is-not-supported-on-this-device"><a href="#Error-Profiling-is-not-supported-on-this-device" class="headerlink" title="Error: Profiling is not supported on this device"></a>Error: Profiling is not supported on this device</h3><p>Pascal support was deprecated, then dropped from Nsight Compute after Nsight Compute 2019.5.1.</p>
<p>The profiling tools that support Pascal in the CUDA Toolkit 11.1 and later are <code>nvprof</code> and <code>visual profiler</code>.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>NVTX问题</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/tools-overview">https://developer.nvidia.com/tools-overview</a></p>
<p><a target="_blank" rel="noopener" href="https://www.365seal.com/y/zyn1yxJQn3.html">https://www.365seal.com/y/zyn1yxJQn3.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-10T16:00:00.000Z" title="5/10/2023, 4:00:00 PM">2023-05-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.729Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 484 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/10/OutOfWork/5-VideoEntertainment/5-tmm/">TinyMediaManager</a></p><div class="content"><h2 id="docker-compose-in-Portainer"><a href="#docker-compose-in-Portainer" class="headerlink" title="docker-compose in Portainer"></a>docker-compose in Portainer</h2><p>使用<a target="_blank" rel="noopener" href="https://github.com/romancin/tinymediamanager-docker/blob/master/docker-compose.yaml">github的版本</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tinymediamanager_service:</span><br><span class="line">    image: romancin/tinymediamanager:latest</span><br><span class="line">    container_name: tinymediamanager</span><br><span class="line">    ports:</span><br><span class="line">      - 5803:5800</span><br><span class="line">    environment:</span><br><span class="line">      - USER_ID=0</span><br><span class="line">      - GROUP_ID=0</span><br><span class="line">      - PASSWORD=acsa1411</span><br><span class="line">      - TZ=Europe/Madrid</span><br><span class="line">      - VNC_PASSWORD=password <span class="comment">#建议去除</span></span><br><span class="line">    volumes:</span><br><span class="line">      - /bt:/bt</span><br><span class="line">      - /share/Container/tinymediamanager:/config:rw</span><br><span class="line">      - /share/Container/tinymediamanager/media:/media:rw</span><br></pre></td></tr></table></figure>
<p>VNC 网页默认密码 <code>password</code></p>
<h3 id="口口字体问题"><a href="#口口字体问题" class="headerlink" title="口口字体问题"></a>口口字体问题</h3><p>进入容器内bash，安装字体</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it  tinymediamanager bash</span><br><span class="line">wget https://mirrors.aliyun.com/alpine/edge/testing/x86_64/font-wqy-zenhei-0.9.45-r2.apk</span><br><span class="line">apk add --allow-untrusted font-wqy-zenhei-0.9.45-r2.apk</span><br><span class="line"><span class="comment">#  fc-list 查看字体</span></span><br></pre></td></tr></table></figure>
<p>然后先将字体改成最后几个， 然后再改语言。</p>
<p>然后restart容器。注意不是重启stack（会删除容器，重启创建</p>
<h2 id="tmm-on-Windows"><a href="#tmm-on-Windows" class="headerlink" title="tmm on Windows"></a>tmm on Windows</h2><p>利用网络挂载文件夹，用<a target="_blank" rel="noopener" href="https://www.tinymediamanager.org/download/">tMM软件</a>刮削.</p>
<p>要注意<strong>动漫</strong>属于<strong>电视剧</strong></p>
<h3 id="多季度动漫管理"><a href="#多季度动漫管理" class="headerlink" title="多季度动漫管理"></a>多季度动漫管理</h3><p><img src="https://pic.shaojiemike.top/img/20221127083143.png"></p>
<p>基础命名规则如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">剧集英文名 （上映年份）/这是文件夹</span><br><span class="line">---Specials /这是文件夹，存放OVA，特典，剧场版之类</span><br><span class="line">------剧集英文名 S00E01.mp4</span><br><span class="line">------剧集英文名 S00E02.mp4</span><br><span class="line">------......</span><br><span class="line">---Season 01 /这是文件夹，有几季就建几个文件夹</span><br><span class="line">------剧集英文名 S01E01.mp4</span><br><span class="line">------剧集英文名 S01E01.mp4</span><br><span class="line">------......</span><br><span class="line">---Season 02 /同上</span><br><span class="line">------剧集英文名 S02E01.mp4</span><br><span class="line">------剧集英文名 S02E02.mp4</span><br><span class="line">------......</span><br></pre></td></tr></table></figure>
<p>其中Specials里，视频文件后的S00表示这是“特典”，后面的E01代表“第几个特典”。</p>
<p>请根据<a target="_blank" rel="noopener" href="https://thetvdb.com/">TheTVDB</a>里的数据确定你的ova视频的编号。</p>
<p><img src="https://pic.shaojiemike.top/img/20221127083534.png"></p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p><img src="https://pic.shaojiemike.top/img/20221126163953.png"></p>
<p>在<a target="_blank" rel="noopener" href="https://dnschecker.org/#A/api.themoviedb.org">DNS索引网站</a>查看域名的中国服务器IP地址</p>
<p>实际ping速度，修改win10的hosts文件在<code>C:\WINDOWS\system32\drivers\etc</code></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv18956570/">https://www.bilibili.com/read/cv18956570/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-10T16:00:00.000Z" title="5/10/2023, 4:00:00 PM">2023-05-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.753Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">16 minutes read (About 2374 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/10/Work/software/manager/docker/">Docker</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>基于 Go 语言 并遵从 Apache2.0 协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上。</p>
<h3 id="structure"><a href="#structure" class="headerlink" title="structure"></a>structure</h3><p><img src="https://pic.shaojiemike.top/img/20220306200924.png"></p>
<h3 id="Docker-vs-VMWare"><a href="#Docker-vs-VMWare" class="headerlink" title="Docker vs VMWare"></a>Docker vs VMWare</h3><p>相对于传统虚拟机，Docker 没有硬件虚拟化&#x2F;hypervisor，可以运行在物理机、虚拟机, 甚至嵌套运行在 Docker 容器内，并且其不携带操作系统的，会轻巧很多。而且调用资源时利用 <code>Docker Engine</code> 去调用宿主的的资源，这时候过程是虚拟内存-&gt;真正物理内存。</p>
<p><img src="https://assets-global.website-files.com/5efc3ccdb72aaa7480ec8179/5f03f585f55f79c8b17ae7d2_containers-blog.png" alt="Image title">{ align&#x3D;left }<img src="https://images.contentstack.io/v3/assets/blt300387d93dabf50e/bltb6200bc085503718/5e1f209a63d1b6503160c6d5/containers-vs-virtual-machines.jpg" alt="Image title2">{ align&#x3D;right }</p>
<h3 id="Potential-Linux-Kernel-Compatibility-Issues"><a href="#Potential-Linux-Kernel-Compatibility-Issues" class="headerlink" title="Potential Linux Kernel Compatibility Issues"></a>Potential Linux Kernel Compatibility Issues</h3><p>!!! question “ how docker run different ubuntu version <strong>Sharing the same running kernel</strong>? no SW conficts?”</p>
<pre><code> If your host kernel is &quot;**compatible enough**&quot; with the software in the container you want to run it will work; otherwise, it won&#39;t.[^1] So what does &quot;compatible enough&quot; mean? It depends on what requests the program makes of the kernel (system calls) and** what features it expects the kernel to support**. Some programs make requests that will break things; others don&#39;t. 
</code></pre>
<p>!!! example “Compatibility”</p>
<pre><code>on an Ubuntu 18.04 (kernel 4.19) or similar host:[^1]
  `docker run centos:7 bash` works fine.
  ` docker run centos:6 bash` fails with `exit code 139`, meaning it terminated with a segmentation violation signal; this is because the `4.19 kernel` doesn&#39;t support something that that build of bash tried to do.
  `docker run centos:6 ls` works fine because it&#39;s not making a request the kernel can&#39;t handle, as bash was.
  If you try `docker run centos:6 bash` on an older kernel, say 4.9 or earlier, you&#39;ll find it will work fine.
</code></pre>
<h2 id="Portainer-统一管理"><a href="#Portainer-统一管理" class="headerlink" title="Portainer 统一管理"></a>Portainer 统一管理</h2><ul>
<li>安装Portainer Community Edition (CE)而不是Portainer Business Edition (BE)</li>
<li><a target="_blank" rel="noopener" href="https://docs.portainer.io/start/install/server/docker/wsl">WSL的安装</a>和linux类似  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 Portainer Server 将用于存储其数据库的卷</span></span><br><span class="line">docker volume create portainer_data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载并安装 Portainer Server 容器, 9000为WebUI端口， 8000 是可选的，仅当您计划将边缘计算功能与边缘代理一起使用时才需要。</span></span><br><span class="line">docker run -d -p 8000:8000 -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /portainer_data:/data portainer/portainer-ce:2.11.1</span><br></pre></td></tr></table></figure></li>
<li>Portainer里的docker部署: 建议使用 Stacks 下的 docker-compose 来进行</li>
</ul>
<p>!!! warning “端口映射”</p>
<pre><code>`2333:8000` 为 容器内部端口`8000`，宿主机端口为`2333`
</code></pre>
<p>!!! tip “远程WebUI访问”</p>
<pre><code>默认部署在 `http://localhost:9000`, 可以如下操作来部署 `http://222.195.72.218:9000/#!/home`

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># docker在服务器上时，可以关闭防火墙访问，也可以ssh代理到本地</span><br><span class="line">brainiac1# ufw status</span><br><span class="line">Status: inactive</span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安裝 docker</span></span><br><span class="line">curl -sSL get.docker.com | sh</span><br><span class="line"><span class="comment"># 將目前使用者新增到 docker 群組內，需要重新登入才會生效</span></span><br><span class="line">sudo usermod -aG docker <span class="variable">$USER</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安裝 docker-compose</span></span><br><span class="line">sudo curl -L <span class="string">&quot;https://github.com/docker/compose/releases/download/<span class="subst">$(curl -sL https://api.github.com/repos/docker/compose/releases/latest | grep tag_name | cut -d&#x27;<span class="string">&quot;&#x27; -f 4)/docker-compose-<span class="subst">$(uname -s)</span>-<span class="subst">$(uname -m)</span>&quot;</span> -o /usr/local/bin/docker-compose</span></span></span><br><span class="line"><span class="subst"><span class="string">sudo chmod +x /usr/local/bin/docker-compose</span></span></span><br></pre></td></tr></table></figure>

<h2 id="Relationship"><a href="#Relationship" class="headerlink" title="Relationship"></a>Relationship</h2><figure markdown>
  ![dockerTripleThing](https://www.markbuckler.com/img/docker_high_level.png)
  <figcaption>Dockerfile & Image & Container</figcaption>
</figure>

<ul>
<li>Image like a static configed&#x2F;compiled software using dockerfile&#x2F;gcc. </li>
<li>And container is a running process that we can control.</li>
</ul>
<h2 id="Dockfile"><a href="#Dockfile" class="headerlink" title="Dockfile"></a>Dockfile</h2><p>First, <strong>write an installation script for all of your dependencies</strong>. This script is written with Docker specific syntax and is called a Dockerfile(1).<br>{ .annotate }</p>
<ol>
<li>A Dockerfile is a script used to <strong>create a Docker image</strong>, which is a lightweight, standalone, and executable package that includes everything needed to run a piece of software, including the code, runtime, system tools, system libraries, and settings.</li>
</ol>
<figure markdown>
  ![Building image using Dockerfile](https://iximiuz.com/you-need-containers-to-build-an-image/kdpv.png)
  <figcaption>Building image using Dockerfile</figcaption>
</figure>

<p>??? example “Dockerfile”</p>
<pre><code>Here&#39;s a simple Dockerfile code snippet(**it&#39;s usually built on official base image**):

<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Use an official base image</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:<span class="number">20.04</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set environment variables</span></span><br><span class="line"><span class="keyword">ENV</span> MY_ENV_VARIABLE my_value</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run commands to install packages and set up the environment</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get install -y \</span></span><br><span class="line"><span class="language-bash">    package1 \</span></span><br><span class="line"><span class="language-bash">    package2 \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; <span class="built_in">rm</span> -rf /var/lib/apt/lists/*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy files from your local machine to the container</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> local_directory /container_directory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the working directory</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Expose a port</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the command to run when the container starts</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;command_to_start_application&quot;</span>]</span></span><br></pre></td></tr></table></figure>

In this example, and more [options](https://docs.docker.com/engine/reference/builder/):

- `FROM` specifies the base image, in this case, Ubuntu 20.04.
- `ENV` sets an environment variable.
- `RUN` executes commands to install packages.
- `COPY` copies files from your local machine to the container.
- `WORKDIR` sets the working directory within the container.
- `EXPOSE` specifies that the container will listen on port 8080.
- `CMD` defines the command that will be executed when the container starts.
</code></pre>
<h2 id="cheat-sheet"><a href="#cheat-sheet" class="headerlink" title="cheat sheet"></a>cheat sheet</h2><p><img src="https://pic.shaojiemike.top/img/20220306200737.png"></p>
<h3 id="查看容器出错日志"><a href="#查看容器出错日志" class="headerlink" title="查看容器出错日志"></a>查看容器出错日志</h3><p>后接容器ID</p>
<p><code>docker logs --tail 1000  1fed0d4782cf</code></p>
<h2 id="docker-build"><a href="#docker-build" class="headerlink" title="docker build"></a>docker build</h2><p>Then, run these commands to build a Docker image of your environment by using <code>docker build</code>. </p>
<p>??? note “Dockfile Path”</p>
<pre><code>docker build 基本的格式为 `docker build [ 选项 ] 路径`，该命令将读取指定路径下(包括子目录)的 Dockerfile，并将该路径下所有内容发送给 Docker 服务端，由服务端来创建镜像。因此一般建议放置 Dockerfile 的目录为空目录。也可以通过 `.dockerignore` 文件(每一行添加一条匹配模式)来让 Docker 忽略路径下的目录和文件。
</code></pre>
<p>??? example “option”</p>
<pre><code>[option](https://docs.docker.com/engine/reference/commandline/build/#build-with-url) like

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker build -t myrepo/myapp /tmp/test1/</span><br><span class="line">$ docker build -t username/image_name:tag_name .</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="docker-build-use-proxy"><a href="#docker-build-use-proxy" class="headerlink" title="docker build use proxy"></a>docker build use proxy</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build --network=host\</span><br><span class="line">    --build-arg http_proxy=http://127.0.0.1:7890 \</span><br><span class="line">    --build-arg https_proxy=http://127.0.0.1:7890 \</span><br><span class="line">    --build-arg <span class="string">&quot;NO_PROXY=localhost,127.0.0.1,.example.com&quot;</span> \</span><br><span class="line">    -t ithemal:latest .</span><br></pre></td></tr></table></figure>

<p>You also can set the proxy in the Dockerfile.[^6]</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> http_proxy <span class="string">&quot;http://127.0.0.1:7890&quot;</span></span><br><span class="line"><span class="keyword">ENV</span> https_proxy <span class="string">&quot;https://127.0.0.1:7890&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="docker-tag"><a href="#docker-tag" class="headerlink" title="docker tag"></a>docker tag</h3><p>镜像的完整 tag 不仅包含镜像名字, 还指明了镜像从哪里来, 要到哪里去, 就像一个 URL。可以通过 -t 选项指定镜像的标签信息，譬如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br></pre></td></tr></table></figure>

<h2 id="docker-run"><a href="#docker-run" class="headerlink" title="docker run"></a>docker run</h2><p>Once successfully built, you can instantiate copies of this image as many times as you would like by using <code>docker run</code> to create Docker containers.</p>
<p><img src="https://linuxhandbook.com/content/images/2021/05/docker-container-lifecycle-diagram.png" alt="Container Lifecycle">[^2] </p>
<p>??? example “option”</p>
<pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用镜像nginx:latest以交互模式启动一个容器,在容器内执行/bin/bash命令。</span></span><br><span class="line">runoob@runoob:~$ docker run -it nginx:latest /bin/bash</span><br></pre></td></tr></table></figure>

- `-i`: 以交互模式运行容器，通常与 `-t` 同时使用；
- `-t`: 为容器重新分配一个伪输入终端，通常与 `-i` 同时使用；
- `-d`: 后台运行容器，并返回容器ID；
- `-P`: 随机端口映射，容器内部端口随机映射到主机的端口
- `-p`: 指定端口映射，格式为：`主机(宿主)端口:容器端口`
- `--name=&quot;nginx-lb&quot;`: 为容器指定一个名称；
- `-e username=&quot;ritchie&quot;`: 设置环境变量；
</code></pre>
<h3 id="docker-Volumes"><a href="#docker-Volumes" class="headerlink" title="docker Volumes"></a>docker Volumes</h3><p><a target="_blank" rel="noopener" href="https://docs.docker.com/storage/volumes/">volumes</a> allow me to interact with data outside of the docker container. </p>
<p>??? question “Volumes is better than bind mounts”</p>
<pre><code>1. Volumes are easier to **back up or migrate** than bind mounts.
2. Volumes work on both Linux and Windows containers.
So [option](https://docs.docker.com/engine/reference/commandline/run/) `-v` is better than `--mount`
</code></pre>
<p>??? example “options”</p>
<pre><code><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> \</span></span><br><span class="line"><span class="language-bash">-v &lt;path to datasets&gt;:/datasets \</span></span><br><span class="line"><span class="language-bash">-v &lt;path to approx-vision&gt;:/approx-vision \</span></span><br><span class="line"><span class="language-bash">-it mbuckler/approx-vision \</span></span><br><span class="line"><span class="language-bash">/bin/bash</span></span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="docker-push-pull"><a href="#docker-push-pull" class="headerlink" title="docker push&#x2F;pull"></a>docker push&#x2F;pull</h2><p>It is in these containers that you will run or develop your code. If you would like other people to be able to use your Docker image you can push to DockerHub (with <code>docker push</code>), and if you want to use someone else’s image you can pull from DockerHub (with <code>docker pull</code>).[^4]</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><h3 id="AllForOne"><a href="#AllForOne" class="headerlink" title="AllForOne"></a>AllForOne</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">docker_name=<span class="string">&quot;mihoyo-bbs&quot;</span></span><br><span class="line">docker stop <span class="variable">$&#123;docker_name&#125;</span></span><br><span class="line">docker <span class="built_in">rm</span> <span class="variable">$&#123;docker_name&#125;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[5;36mOrz 旧容器(镜像)已清理\033[0m&quot;</span></span><br><span class="line"></span><br><span class="line">time_now=$(<span class="built_in">date</span> <span class="string">&quot;+%m%d%H&quot;</span>)</span><br><span class="line">docker build -f dockerfile --tag <span class="variable">$&#123;docker_name&#125;</span>:<span class="string">&quot;<span class="variable">$&#123;time_now&#125;</span>&quot;</span> .</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[5;36mOrz 镜像重建完成\033[0m&quot;</span></span><br><span class="line"></span><br><span class="line">docker run -itd \</span><br><span class="line">	--name <span class="variable">$&#123;docker_name&#125;</span> \</span><br><span class="line">	--log-opt max-size=1m \</span><br><span class="line">	-v $(<span class="built_in">pwd</span>):/var/app \</span><br><span class="line">	<span class="variable">$&#123;docker_name&#125;</span>:<span class="string">&quot;<span class="variable">$&#123;time_now&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;\033[5;36mOrz 镜像启动完成\033[0m&quot;</span></span><br><span class="line">docker ps -a <span class="comment">#顯示目前的 container 及狀態</span></span><br><span class="line">docker logs <span class="variable">$&#123;docker_name&#125;</span> -f <span class="comment"># -f, --follow         Follow log output</span></span><br></pre></td></tr></table></figure>

<h3 id="hackergame2020-的源码的dockerfile"><a href="#hackergame2020-的源码的dockerfile" class="headerlink" title="hackergame2020 的源码的dockerfile"></a>hackergame2020 的源码的dockerfile</h3><p><img src="https://pic.shaojiemike.top/img/20211024201741.png"></p>
<h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/docker/docker-compose.html">Compose</a> 是用于定义和运行多容器 Docker 应用程序的工具。<strong>需要额外安装</strong>。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。</p>
<p>??? example “compose file”</p>
<pre><code>AutoMihoyoBBS[^5]

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mihoyo-bbs:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">darkatse/mihoyo-bbs</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CRON_SIGNIN=30</span> <span class="number">9</span> <span class="string">*</span> <span class="string">*</span> <span class="string">*</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MULTI=TRUE</span></span><br><span class="line">    <span class="attr">volumes:</span> <span class="comment"># 将主机的数据卷或着文件挂载到容器里。</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/var/app</span></span><br><span class="line">    <span class="attr">logging:</span> <span class="comment"># driver：指定服务容器的日志记录驱动程序，默认值为json-file</span></span><br><span class="line">      <span class="attr">driver:</span> <span class="string">&quot;json-file&quot;</span></span><br><span class="line">      <span class="attr">options:</span></span><br><span class="line">        <span class="attr">max-size:</span> <span class="string">&quot;1m&quot;</span> <span class="comment"># 最多1m个文件,当达到文件限制上限，会自动删除旧得文件。</span></span><br></pre></td></tr></table></figure>
</code></pre>
<p>??? example “deploy”</p>
<pre><code>`docker-compose logs -f`命令来查看程序输出。 `-f, --follow         Follow log output`

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up -d </span><br><span class="line"><span class="comment"># 执行 docker-compose up 命令来启动并运行整个应用程序。</span></span><br><span class="line"><span class="comment"># 在后台执行该服务可以加上 -d 参数</span></span><br><span class="line">Creating network <span class="string">&quot;automihoyobbs_default&quot;</span> with the default driver</span><br><span class="line">Pulling mihoyo-bbs (darkatse/mihoyo-bbs:)...</span><br><span class="line">latest: Pulling from darkatse/mihoyo-bbs</span><br><span class="line">df9b9388f04a: Pull complete</span><br><span class="line">a1ef3e6b7a02: Pull complete</span><br><span class="line">7a687728470e: Pull complete</span><br><span class="line">4ecf30de1710: Pull complete</span><br><span class="line">a1f99e431609: Pull complete</span><br><span class="line">7e9141a60a66: Pull complete</span><br><span class="line">7aa39aec04ec: Pull complete</span><br><span class="line">a75b4b3d5690: Pull complete</span><br><span class="line">dee0a6b07871: Pull complete</span><br><span class="line">abed80702fed: Pull complete</span><br><span class="line">Digest: sha256:10958801df87675c390a8cdcc153c2f87a41af92d35f9f2cf9b7758aa3e10d1b</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> darkatse/mihoyo-bbs:latest</span><br><span class="line">Creating automihoyobbs_mihoyo-bbs_1 ... <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="启动docker并通过xhost保持tmux连接"><a href="#启动docker并通过xhost保持tmux连接" class="headerlink" title="启动docker并通过xhost保持tmux连接"></a>启动docker并通过xhost保持tmux连接</h2><p><code>docker/docker_connect.sh</code> 或者 <a target="_blank" rel="noopener" href="https://blog.csdn.net/winter2121/article/details/118223637">https://blog.csdn.net/winter2121/article/details/118223637</a></p>
<p>What if I want to use X forwarding from within a Docker container?[^4]</p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Got-permission-denied-while-trying-to-connect-to-the-Docker-daemon-socket"><a href="#Got-permission-denied-while-trying-to-connect-to-the-Docker-daemon-socket" class="headerlink" title="Got permission denied while trying to connect to the Docker daemon socket"></a>Got permission denied while trying to connect to the Docker daemon socket</h3><ol>
<li>sudo 运行</li>
<li>加入docker用户组<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker     #添加docker用户组</span><br><span class="line">sudo gpasswd -a $USER docker     #将登陆用户加入到docker用户组中</span><br><span class="line">newgrp docker     #更新用户组</span><br><span class="line">docker ps    #测试docker命令是否可以使用sudo正常使用</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="sudo-password-in-docker-image"><a href="#sudo-password-in-docker-image" class="headerlink" title="sudo password in docker image"></a>sudo password in docker image</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28721699/root-password-inside-a-docker-container">https://stackoverflow.com/questions/28721699/root-password-inside-a-docker-container</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhangshengrong.com/p/AvN6YAOWam/">https://www.zhangshengrong.com/p/AvN6YAOWam/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xzl9811wl/article/details/107060382">https://blog.csdn.net/xzl9811wl/article/details/107060382</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1395434">https://cloud.tencent.com/developer/article/1395434</a></p>
<p>[^1]: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32841982/how-can-docker-run-distros-with-different-kernels">How can Docker run distros with different kernels?</a></p>
<p>[^2]: <a target="_blank" rel="noopener" href="https://linuxhandbook.com/container-lifecycle-docker-commands/#what-are-docker-containers-again">Docker Commands for Managing Container Lifecycle (Definitive Guide)</a></p>
<p>[^4]: <a target="_blank" rel="noopener" href="https://www.markbuckler.com/post/docker-use/">Developing in Docker</a></p>
<p>[^6]: <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1806455">https://cloud.tencent.com/developer/article/1806455</a> &amp; <a target="_blank" rel="noopener" href="http://www.debugself.com/2018/01/17/docker_network/">http://www.debugself.com/2018/01/17/docker_network/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-10T16:00:00.000Z" title="5/10/2023, 4:00:00 PM">2023-05-10</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.753Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a few seconds read (About 50 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/10/Work/software/visualization/vue/">Vue</a></p><div class="content"><h2 id="vue-chart"><a href="#vue-chart" class="headerlink" title="vue-chart"></a>vue-chart</h2><p><a target="_blank" rel="noopener" href="https://stackblitz.com/edit/vue-echarts-vue-3?file=src/App.vue">https://stackblitz.com/edit/vue-echarts-vue-3?file=src%2FApp.vue</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-09T16:00:00.000Z" title="5/9/2023, 4:00:00 PM">2023-05-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.725Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">2 minutes read (About 275 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/09/OutOfWork/3-homepage/3-homepage/">Homepage great template</a></p><div class="content"><h2 id="个人网站的需求分析"><a href="#个人网站的需求分析" class="headerlink" title="个人网站的需求分析"></a>个人网站的需求分析</h2><h3 id="功能需求"><a href="#功能需求" class="headerlink" title="功能需求"></a>功能需求</h3><ol>
<li>博客的标签和分类是必须的</li>
<li>搜索功能、评论功能(Mkdocs <strong>内置搜索</strong>)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/feathericons/feather#client-side-javascript">icon support</a> and <a target="_blank" rel="noopener" href="https://retrolog.io/blog/creating-a-hugo-theme-from-scratch/">usage</a></li>
</ol>
<h3 id="个人需求"><a href="#个人需求" class="headerlink" title="个人需求"></a>个人需求</h3><ol>
<li>少图片的冷淡风</li>
<li>但是要有彩色或者加粗等功能来体现文中的重要程度。(Mkdocs 的提示框真好用)</li>
</ol>
<h2 id="个人主页"><a href="#个人主页" class="headerlink" title="个人主页"></a>个人主页</h2><ol>
<li>基于<a target="_blank" rel="noopener" href="https://squidfunk.github.io/mkdocs-material/">Mkdocs</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ppoffice/hexo-theme-icarus">Hexo icarus</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/adityatelange/hugo-PaperMod/">Hugo PaperMod</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/blinkfox/hexo-theme-matery">Hexo matery</a></li>
</ol>
<p>??? example “mkdocs”</p>
<pre><code>  1. https://101.lug.ustc.edu.cn/
  2. https://docs.acsalab.com/
  3. https://jia.je/
</code></pre>
<h2 id="部署位置"><a href="#部署位置" class="headerlink" title="部署位置"></a>部署位置</h2><h3 id="cloudflare-pages"><a href="#cloudflare-pages" class="headerlink" title="cloudflare pages"></a>cloudflare pages</h3><ol>
<li>不同于之前的<a target="_blank" rel="noopener" href="https://findhao.net/easycoding/2609">教程</a>, 创建位置有所调整。<ol>
<li><code>Workers &amp; Pages</code> 下 <code>create an application</code>, choose the <code>Pages</code> tab and follow the git connection tutorial.</li>
<li>最大的优点是集成了github和mkdocs，可以直接运行<code>mkdocs build</code> 实现<a target="_blank" rel="noopener" href="https://shaojiemike.pages.dev/">部署</a>。</li>
</ol>
</li>
</ol>
<h3 id="GitHub-pages"><a href="#GitHub-pages" class="headerlink" title="GitHub pages"></a>GitHub pages</h3><p><a target="_blank" rel="noopener" href="https://kirrito-k423.github.io/">https://kirrito-k423.github.io/</a></p>
<h2 id="使用自己的域名"><a href="#使用自己的域名" class="headerlink" title="使用自己的域名"></a>使用自己的域名</h2><p>替换<code>shaojiemike.pages.dev</code> 变成自己的域名 <code>shaojiemike.top</code>: cloudflare pages 下直接提供<code>Custom domains</code> 的解析 <code>CNAME www shaojiemike.pages.dev</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-09T16:00:00.000Z" title="5/9/2023, 4:00:00 PM">2023-05-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.753Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a minute read (About 204 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/09/Work/software/visualization/visualization-ranking/">Visualization Ranking</a></p><div class="content"><h2 id="Goal"><a href="#Goal" class="headerlink" title="Goal"></a>Goal</h2><p>横向条形图排序赛跑叫Bar chart race</p>
<h2 id="visualization-using-echart"><a href="#visualization-using-echart" class="headerlink" title="visualization using echart"></a>visualization using echart</h2><ol>
<li>完整的中文官方教程和丰富的插件和相关项目</li>
<li>可以支持vue</li>
<li>支持动态折线图和动态柱状图</li>
</ol>
<h2 id="visualization-using-d3-js"><a href="#visualization-using-d3-js" class="headerlink" title="visualization using d3.js"></a>visualization using d3.js</h2><p>参考<a target="_blank" rel="noopener" href="https://github.com/Jannchie/Historical-ranking-data-visualization-based-on-d3.js">项目</a></p>
<p>但是好像是静态的，而且只有一个排序的柱状图</p>
<h2 id="visualization-using-anichart"><a href="#visualization-using-anichart" class="headerlink" title="visualization using anichart"></a>visualization using anichart</h2><p>参考<a target="_blank" rel="noopener" href="https://anichart.vercel.app/guide/render-the-chart.html">文档</a>, 使用<a target="_blank" rel="noopener" href="https://github.com/Kirrito-k423/leetcode-ranking-visualization-anichart">template项目</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/Kirrito-k423/leetcode-ranking-visualization-anichart.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install Dependencies</span></span><br><span class="line">npm install -g pnpm</span><br><span class="line">pnpm i</span><br><span class="line">pnpm build <span class="comment"># error</span></span><br></pre></td></tr></table></figure>

<p>由于项目还在开发，暂时不进一步尝试</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-06T16:00:00.000Z" title="5/6/2023, 4:00:00 PM">2023-05-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-12-12T08:55:40.737Z" title="12/12/2023, 8:55:40 AM">2023-12-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Programming/">Programming</a></span><span class="level-item">41 minutes read (About 6140 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/06/Work/HPC/cuda/cudaProgram/">Cuda Program</a></p><div class="content"><h2 id="Nvidia-经典优化"><a href="#Nvidia-经典优化" class="headerlink" title="Nvidia 经典优化"></a>Nvidia 经典优化</h2><p>Optimizing Parallel Reduction in CUDA - Mark Harris</p>
<p><img src="https://pic.shaojiemike.top/img/20220511211558.png"></p>
<p>详细见SC07 <a target="_blank" rel="noopener" href="https://www.enseignement.polytechnique.fr/profs/informatique/Eric.Goubault/Cours09/CUDA/SC07_CUDA_5_Optimization_Harris.pdf">PDF</a></p>
<h2 id="并行计算课程-CUDA"><a href="#并行计算课程-CUDA" class="headerlink" title="并行计算课程-CUDA"></a>并行计算课程-CUDA</h2><p><a target="_blank" rel="noopener" href="http://202.38.64.11/~xuyun/GPU_Computing.pdf">http://202.38.64.11/~xuyun/GPU_Computing.pdf</a> 密码pa22</p>
<ol>
<li>GPU线程的创建与调度使用硬件而不是操作系统，速度很快（PowerPC创建线程需要37万个周期）</li>
</ol>
<h3 id="常见的优化方法"><a href="#常见的优化方法" class="headerlink" title="常见的优化方法"></a>常见的优化方法</h3><h3 id="shared-memory-matrix-multiplication"><a href="#shared-memory-matrix-multiplication" class="headerlink" title="shared memory matrix multiplication"></a>shared memory matrix multiplication</h3><h3 id="Global-Memory：coalesced-access"><a href="#Global-Memory：coalesced-access" class="headerlink" title="Global Memory：coalesced access"></a>Global Memory：coalesced access</h3><p>利用好每个block里的thread，全部每个线程各自读取自己对齐(Starting address for a region must be a multiple of region size 不一定是自己用的)数据到shared memory开辟的总空间。由于需要的数据全部合力读取进来了，计算时正常使用需要的读入的数据。</p>
<p>特别是对于结构体</p>
<p>使用SoA(structure of arrays)而不是AoS（array of structures）<br>如果结构体实在不能对齐使用 <code>__align(X)</code>, where X &#x3D; 4, 8, or 16.强制对齐</p>
<p>有无采用对齐shared读取，有10倍的加速。</p>
<p><img src="https://pic.shaojiemike.top/img/20220505203920.png"></p>
<p>由于需要对齐读取，3float是12字节，所以只能拆成三份。</p>
<p><img src="https://pic.shaojiemike.top/img/20220519000548.png"></p>
<p>对于small Kernel和访存瓶颈的Kernel影响很大</p>
<h3 id="隐藏延迟的方法"><a href="#隐藏延迟的方法" class="headerlink" title="隐藏延迟的方法"></a>隐藏延迟的方法</h3><ol>
<li>增加SM上线程数量，</li>
<li>block数&gt; SM数，这样所有的multiprocessors至少有一个block执行</li>
<li>threads&#x2F;block&gt;128 。原因：机器上一般有最多4个Warp调度器&#x3D;4*32&#x3D;128</li>
<li>threadsInblock&#x3D;N*WarpSize&#x3D;N*32</li>
<li>在 SM 上的 TB 越多越好，让 Thread Block 不停的跑我们的利用率就会高。</li>
<li>但是如果 Thread Block 太多，我们每一个 SM 能分配的寄存器就会变少，所以就会发生 Register Spill, 使用更高级的 L1、L2 Cache 去代替 Registers。所以 TB 不能太多，需要减少 Register Spill 的次数。<ol>
<li>资源占用率不要太高（最多一半？</li>
</ol>
</li>
<li>多使用 <code>__syncthreads</code></li>
<li>最好的参数需要self-tuning出来</li>
</ol>
<h3 id="shared-memory-In-Stencil-Computing"><a href="#shared-memory-In-Stencil-Computing" class="headerlink" title="shared memory In Stencil Computing"></a>shared memory In Stencil Computing</h3><p><img src="https://pic.shaojiemike.top/img/20220519000613.png"></p>
<h3 id="shared-memory-bank-conflit"><a href="#shared-memory-bank-conflit" class="headerlink" title="shared memory bank conflit"></a>shared memory bank conflit</h3><p>如果没有bank冲突的话，共享内存的访存速度将会非常的快，大约比全局内存的访问延迟低100多倍，但是速度没有寄存器快。然而，如果在使用共享内存时发生了bank冲突的话，性能将会降低很多很多。</p>
<h3 id="shared-memory-原理"><a href="#shared-memory-原理" class="headerlink" title="shared memory 原理"></a>shared memory 原理</h3><p>GPU 的共享内存，实际上是 32 块内存条通过并联组成的，每个时钟周期都可以读取一个 int。第 i 块内存，负责 addr % 32 &#x3D;&#x3D; i 的数据。这样交错存储，可以保证随机访问时，访存能够尽量分摊到 32 个块。</p>
<p>如果在block内多个线程访问的地址落入到同一个bank内，那么就会访问同一个bank就会产生bank conflict，这些访问将是变成串行，在实际开发调式中非常主要bank conflict.</p>
<p>处理方法非常简单，我们不要把 shared memory 开辟的空间设置成 32 的倍数即可（线性同余方程，原理也很好理解）或者修改bank的size大小，默认是4字节</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__host__ cudaError_t cudaDeviceSetSharedMemConfig ( cudaSharedMemConfig config )</span><br></pre></td></tr></table></figure>

<p>其中 cudaSharedMemConfi为一个枚举型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cudaSharedMemBankSizeDefault = 0</span><br><span class="line">cudaSharedMemBankSizeFourByte = 1</span><br><span class="line">cudaSharedMemBankSizeEightByte = 2</span><br></pre></td></tr></table></figure>

<p> 只支持在host端进行调用，不支持在device端调用。<br>CUDA API中还支持获取bank size大小：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__host__  __device__ cudaError_t cudaDeviceGetSharedMemConfig ( cudaSharedMemConfig ** pConfig )</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42730667/article/details/106171382">https://blog.csdn.net/weixin_42730667/article/details/106171382</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000007533157">https://segmentfault.com/a/1190000007533157</a></p>
<p>值得注意的是：</p>
<ol>
<li>多个线程同时访问同一个bank中<strong>相同</strong>的数组元素 <strong>不会</strong>产生bank conflict，将会出发广播</li>
<li>同一个 warp 的不同线程会访问到同一个 bank 的<strong>不同</strong>地址就会<strong>发生</strong> bank conflict</li>
</ol>
<h3 id="容易发生bank-conflit的情况"><a href="#容易发生bank-conflit的情况" class="headerlink" title="容易发生bank conflit的情况"></a>容易发生bank conflit的情况</h3><ol>
<li>数据类型是4字节，但是不是单位步长</li>
<li><img src="https://pic.shaojiemike.top/img/20220511235932.png"></li>
<li>数据类型是1字节，步长是1<img src="https://pic.shaojiemike.top/img/20220512000042.png"></li>
</ol>
<h3 id="zerocopy"><a href="#zerocopy" class="headerlink" title="zerocopy"></a>zerocopy</h3><p>如果我们数据只会在 GPU 产生和使用，我们不需要来回进行拷贝。</p>
<p><a target="_blank" rel="noopener" href="https://migocpp.wordpress.com/2018/06/08/cuda-memory-access-global-zero-copy-unified/">https://migocpp.wordpress.com/2018/06/08/cuda-memory-access-global-zero-copy-unified/</a></p>
<p>简而言之，在 host 使用命令：cudaHostRegisterMapped<br>之后用 cudaHostGetDevicePointer 进行映射<br>最后解除绑定 cudaHostUnregister</p>
<p>即，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// First, pin the memory (or cudaHostAlloc instead)</span><br><span class="line">cudaHostRegister(h_a, …, cudaHostRegisterMapped);</span><br><span class="line">cudaHostRegister(h_b, …, cudaHostRegisterMapped);</span><br><span class="line">cudaHostRegister(h_c, …, cudaHostRegisterMapped);</span><br><span class="line"></span><br><span class="line">cudaHostGetDevicePointer(&amp;a, h_a, 0);</span><br><span class="line">cudaHostGetDevicePointer(&amp;b, h_b, 0);</span><br><span class="line">cudaHostGetDevicePointer(&amp;c, h_c, 0);</span><br><span class="line"></span><br><span class="line">kernel&lt;&lt;&lt;...&gt;&gt;&gt;(a, b, c);</span><br><span class="line">cudaDeviceSynchronize();</span><br><span class="line"></span><br><span class="line">// unpin/release host memory</span><br><span class="line">cudaHostUnregister(h_a);</span><br><span class="line">cudaHostUnregister(h_b);</span><br><span class="line">cudaHostUnregister(h_c);</span><br></pre></td></tr></table></figure>

<h3 id="cuda-warp-shuffle"><a href="#cuda-warp-shuffle" class="headerlink" title="cuda warp shuffle"></a>cuda warp shuffle</h3><p>只要两个thread在 同一个warp中，允许thread直接读其他thread的寄存器值，这种比通过shared Memory进行thread间的通讯效果更好，latency更低，同时也不消耗额外的内存资源来执行数据交换。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Bruce_0712/article/details/64926471">https://blog.csdn.net/Bruce_0712/article/details/64926471</a></p>
<h3 id="GPU-编译器相对于CPU编译器简单一些"><a href="#GPU-编译器相对于CPU编译器简单一些" class="headerlink" title="GPU 编译器相对于CPU编译器简单一些"></a>GPU 编译器相对于CPU编译器简单一些</h3><p>可能要手动循环展开, 消除分支，GPU分支预测几乎没有</p>
<p><code>#pragma unroll</code> 一句即可展开</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ol start="2">
<li><p>thread 和硬件的关系？</p>
</li>
<li><p>shared memory位置和cache的关系（根据GA100，L1 data cache&#x3D;shared memory）</p>
<ol>
<li>联合访问搬数据，没有cache line的概念吗？</li>
</ol>
</li>
<li><p>shared memory VS streaming Multiprocessor</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41598072/article/details/82877655">https://blog.csdn.net/qq_41598072/article/details/82877655</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/junparadox/article/details/50540602">https://blog.csdn.net/junparadox/article/details/50540602</a></li>
</ol>
</li>
<li><p>一个SM有2048个线程？</p>
<ol>
<li><img src="https://pic.shaojiemike.top/img/20220409155719.png"></li>
</ol>
</li>
</ol>
<h2 id="设备参数"><a href="#设备参数" class="headerlink" title="设备参数"></a>设备参数</h2><h3 id="Cuda-Version-GPU-Version"><a href="#Cuda-Version-GPU-Version" class="headerlink" title="Cuda Version &amp; GPU Version"></a>Cuda Version &amp; GPU Version</h3><p>在 <code>CMakeLists.txt</code>里设置 <code>set (CMAKE_CUDA_ARCHITECTURES 61)</code>可用的最大版本号以获得最好的驱动支持。</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/CUDA">https://en.wikipedia.org/wiki/CUDA</a></p>
<h3 id="max-block-max-thread"><a href="#max-block-max-thread" class="headerlink" title="max block &amp; max thread"></a>max block &amp; max thread</h3><p>通过cuda-samples运行输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 下载对应nvcc对应的cuda version的版本</span><br><span class="line">git clone https://github.com/NVIDIA/cuda-samples.git</span><br><span class="line">cd</span><br><span class="line">make -j16</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># shaojiemike @ snode0 in ~/github/cuda-samples-11.0 [23:08:29]</span><br><span class="line">$ ./bin/x86_64/linux/release/deviceQuery</span><br><span class="line">./bin/x86_64/linux/release/deviceQuery Starting...</span><br><span class="line"></span><br><span class="line"> CUDA Device Query (Runtime API) version (CUDART static linking)</span><br><span class="line"></span><br><span class="line">Detected 7 CUDA Capable device(s)</span><br><span class="line"></span><br><span class="line">Device 0: &quot;Tesla P40&quot;</span><br><span class="line">  CUDA Driver Version / Runtime Version          11.4 / 11.0</span><br><span class="line">  CUDA Capability Major/Minor version number:    6.1</span><br><span class="line">  Total amount of global memory:                 22919 MBytes (24032378880 bytes)</span><br><span class="line">  (30) Multiprocessors, (128) CUDA Cores/MP:     3840 CUDA Cores</span><br><span class="line">  GPU Max Clock rate:                            1531 MHz (1.53 GHz)</span><br><span class="line">  Memory Clock rate:                             3615 Mhz</span><br><span class="line">  Memory Bus Width:                              384-bit</span><br><span class="line">  L2 Cache Size:                                 3145728 bytes (3 Gbytes)</span><br><span class="line">  Maximum Texture Dimension Size (x,y,z)         1D=(131072), 2D=(131072, 65536), 3D=(16384, 16384, 16384)</span><br><span class="line">  Maximum Layered 1D Texture Size, (num) layers  1D=(32768), 2048 layers</span><br><span class="line">  Maximum Layered 2D Texture Size, (num) layers  2D=(32768, 32768), 2048 layers</span><br><span class="line">  Total amount of constant memory:               65536 bytes (64 Kbytes)</span><br><span class="line">  Total amount of shared memory per block:       49152 bytes (48 Kbytes)</span><br><span class="line">  Total shared memory per multiprocessor(SM):    98304 bytes (96 Kbytes)</span><br><span class="line">  Total number of registers available per block: 65536</span><br><span class="line">  Warp size:                                     32</span><br><span class="line">  Maximum number of threads per multiprocessor:  2048</span><br><span class="line">  Maximum number of threads per block:           1024</span><br><span class="line">  Max dimension size of a thread block (x,y,z): (1024, 1024, 64)</span><br><span class="line">  Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)</span><br><span class="line">  Maximum memory pitch:                          2147483647 bytes (2 Gbytes)</span><br><span class="line">  Texture alignment:                             512 bytes</span><br><span class="line">  Concurrent copy and kernel execution:          Yes with 2 copy engine(s)</span><br><span class="line">  Run time limit on kernels:                     No</span><br><span class="line">  Integrated GPU sharing Host Memory:            No</span><br><span class="line">  Support host page-locked memory mapping:       Yes</span><br><span class="line">  Alignment requirement for Surfaces:            Yes</span><br><span class="line">  Device has ECC support:                        Enabled</span><br><span class="line">  Device supports Unified Addressing (UVA):      Yes</span><br><span class="line">  Device supports Managed Memory:                Yes</span><br><span class="line">  Device supports Compute Preemption:            Yes</span><br><span class="line">  Supports Cooperative Kernel Launch:            Yes</span><br><span class="line">  Supports MultiDevice Co-op Kernel Launch:      Yes</span><br><span class="line">  Device PCI Domain ID / Bus ID / location ID:   0 / 4 / 0</span><br><span class="line">  Compute Mode:</span><br><span class="line">     &lt; Default (multiple host threads can use ::cudaSetDevice() with device simultaneously) &gt;</span><br></pre></td></tr></table></figure>

<p>核心Pascal GP102</p>
<h3 id="各种参数什么意思？"><a href="#各种参数什么意思？" class="headerlink" title="各种参数什么意思？"></a>各种参数什么意思？</h3><ol>
<li>Texture和贴图有关？</li>
<li>global memory 显存</li>
<li>Constant memory: 为特殊的read-only不变量存储来加速，当所有线程同时访问相同的值时，固定内存也是最有效的。</li>
<li>Texture memory：同理为read-only贴图资源，最初是为OpenGL和DirectX渲染设计的</li>
</ol>
<h2 id="CUDA-程序执行的逻辑空间结构"><a href="#CUDA-程序执行的逻辑空间结构" class="headerlink" title="CUDA 程序执行的逻辑空间结构"></a>CUDA 程序执行的逻辑空间结构</h2><!-- <div align="center">
<img src="https://pic.shaojiemike.top/img/20220120182538.png" height="70%" width="70%" >
</div> -->

<p><img src="https://pic.shaojiemike.top/img/20220120182538.png?60"></p>
<p>Host 指“CPU和CPU直接调用的内存”两部分的集合</p>
<p>Device 指“GPU和GPU直接调用的内存”两部分的集合，感觉可以看作显存。<br><img src="https://pic.shaojiemike.top/img/20220120202703.png?60"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dim3 grid((nx + block.x - 1) / block.x, (ny + block.y - 1) / block.y);</span><br></pre></td></tr></table></figure>

<h3 id="Block和Thread的理解"><a href="#Block和Thread的理解" class="headerlink" title="Block和Thread的理解"></a>Block和Thread的理解</h3><ol>
<li>cuda Block 级别相当于 C++ 线程，数目可以设置比较大，调度依靠 GPU ，方式类似于 CPU 调度 threads</li>
<li>cuda Thread 级别相当于 SIMD，有数目上限，受限于 cuda core 的数目和一些维度参数</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Max dimension size of a thread block (x,y,z): (1024, 1024, 64)</span><br><span class="line">Max dimension size of a grid size    (x,y,z): (2147483647, 65535, 65535)</span><br></pre></td></tr></table></figure>

<h3 id="使用grid来解决数据数比线程数多的问题"><a href="#使用grid来解决数据数比线程数多的问题" class="headerlink" title="使用grid来解决数据数比线程数多的问题"></a>使用grid来解决数据数比线程数多的问题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int loopCount = .....;</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line"></span><br><span class="line">int block_dim = ...;</span><br><span class="line">int grid_dim = (loopCount - 1) / block_dim + 1;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">call_kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;();</span><br><span class="line"></span><br><span class="line">__global__ void saxpy(int n, float a, float *x, float *y) &#123;</span><br><span class="line">	for (int i = blockIdx.x * blockDim.x + threadIdx.x; i &lt; n; i += blockDim.x * gridDim.x) &#123;</span><br><span class="line">		y[i] = a * x[i] + y[i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="WARP模型——资源调度模型"><a href="#WARP模型——资源调度模型" class="headerlink" title="WARP模型——资源调度模型"></a>WARP模型——资源调度模型</h2><ol>
<li>Nvidia把32个threads组成一个warp，warp是调度和运行的基本单元。warp中所有threads并行的执行相同的指令。一个warp需要占用一个SM运行，多个warps需要轮流进入SM。由SM的硬件warp scheduler负责调度。目前每个warp包含32个threads（Nvidia保留修改数量的权利）。所以，一个GPU上resident thread最多只有 SM*warp个。</li>
<li>大量的thread可能会被分配到不同的SM，<ol>
<li><strong>同一个block中的threads必然在同一个SM中并行（SIMT）执行</strong></li>
<li>每个thread拥有它自己的程序计数器和状态寄存器，并且用该线程自己的数据执行指令，这就是所谓的Single Instruction Multiple Thread。</li>
</ol>
</li>
<li>一个SP可以执行一个thread，但是实际上并不是所有的thread能够在同一时刻执行</li>
<li>Warp内会自动同步？</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(30) Multiprocessors, (128) CUDA Cores/MP:     3840 CUDA Cores</span><br><span class="line">Warp size:                                     32</span><br><span class="line">Maximum number of threads per multiprocessor:  2048</span><br><span class="line">Maximum number of threads per block:           1024</span><br><span class="line">Max dimension size of a thread block (x,y,z): (1024, 1024, 64) # 是x,y,z 各自最大值</span><br><span class="line">Total amount of shared memory per block:       49152 bytes (48 Kbytes)</span><br><span class="line">Total shared memory per multiprocessor(SM):    98304 bytes (96 Kbytes)</span><br><span class="line">Total number of registers available per block: 65536</span><br></pre></td></tr></table></figure>

<h3 id="thread-block-和-Warp-和-core-SM的关系"><a href="#thread-block-和-Warp-和-core-SM的关系" class="headerlink" title="thread block 和 Warp 和 core SM的关系"></a>thread block 和 Warp 和 core SM的关系</h3><ol>
<li><p>为什么一个SM上只有128核但是能同时有1024个线程.</p>
</li>
<li><p>对于P40 一个SM有4个Warp调度器，这是不是意味着，一个SM同时只能有4个，也就是最多128个线程。然而一个SM不是最多2048个thread吗？那岂不是要串行。</p>
<ol>
<li>一个SM发射的32个线程能在小于32个core上运行吗？不能</li>
</ol>
</li>
<li><p>GPU core有多线程吗？ 应该是没有的</p>
<ol>
<li>首先GPU core其实只是CPU里的ALU</li>
<li>Warp调度器当只有4个cuda core需要<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/62147624/how-many-cuda-cores-is-used-to-process-a-cuda-warp">花费8个周期来运行一条指令</a>。<ol>
<li>这4个ALU的core其实实现了SIMD的效果</li>
</ol>
</li>
<li><a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/how-do-cuda-cores-on-a-sm-execute-warps-concurrently/20803/6">Warp调度原理</a></li>
</ol>
</li>
<li><p>虽然我们遗憾的发现 GPU core没有多线程，但是对于Pascal架构的SM只有一种32位的core。我们很容易猜想到对于Int8和Int16是不是有SIMD</p>
<ol>
<li>NVIDIA Tesla P100 can perform FP16 arithmetic at <strong>twice</strong> the throughput of FP32.</li>
<li>Tesla P40 and NVIDIA Titan X, Tesla P4 all support instructions that can perform integer dot products on 2- and <strong>4-element 8-bit vectors</strong>, with accumulation into a 32-bit integer.</li>
<li>可以通过<a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/mixed-precision-programming-cuda-8/">cuda8 DP2A and DP4A</a> 等函数编程</li>
<li><a target="_blank" rel="noopener" href="https://www.studocu.com/row/document/sichuan-university-of-science-engineering/computer-science/introduction-to-cuda-10-tensor-core-mixed-precision/6088325">https://www.studocu.com/row/document/sichuan-university-of-science-engineering/computer-science/introduction-to-cuda-10-tensor-core-mixed-precision/6088325</a></li>
</ol>
</li>
<li><p>一个core上能有几个thread并行，是32个吗？还是像CPU一样超线程是2个。还是没有</p>
<ol>
<li>后面这个回答要么是错误的，要么</li>
<li><a target="_blank" rel="noopener" href="https://streamhpc.com/blog/2017-01-24/many-threads-can-run-gpu/">在GPU core上有4到10个线程。</a></li>
<li>原因简单来说是GPU的行为没有CPU那么复杂，可以设计多一点</li>
<li>而且GPU core相当于没有调度器的CPU core是只能数据并行的(SIMD)</li>
<li>CPU 2个线程的设计，只是为了提高利用率</li>
<li>GPU 多线程的设计主要是为了隐藏访存延迟<ol>
<li>由于GPU核数多，导致每个核对应的cache小而且，由于没有复杂的核调度结构来预取</li>
<li>所以通过多线程来隐藏延迟</li>
</ol>
</li>
</ol>
</li>
<li><p>虽然可能一个SM最多有128*16以上线程的能力，但是考虑到寄存器，shared memory等的调度。</p>
<ol>
<li>Nvidia做出了如下<a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/question-about-threads-per-block-and-warps-per-sm/77491">限制</a><ol>
<li><strong>Most recent GPUs (excepting Turing) allow a hardware limit of 64 warps per SM</strong></li>
</ol>
</li>
<li>假设1个block有992线程也就是 992&#x2F;32&#x3D;31个warp, 由于有64个的上限.所以一个SM只能有2个block，而不能有更多。</li>
</ol>
</li>
<li><p>我们只能指定block和thread。但是具体怎么划分和调度是由GPU决定的？(我不知道有没有选项)</p>
<ol>
<li><strong>同一个block中的threads必然在同一个SM中并行（SIMT）执行</strong>，来共享shared memory</li>
<li>当然也可以舍弃shared memory的快速访存，来使用更多的计算核(SM&amp;core)并行。这取决于具体问题。</li>
<li>根据前面的问题2，如果为了shared memory硬塞进一个SM会导致串行的问题。<ol>
<li>即便串行也会更快？</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="GP102"><a href="#GP102" class="headerlink" title="GP102"></a>GP102</h3><p><img src="https://pic.shaojiemike.top/img/20220512220943.png"><br>图中红框是一个SM, 绿点是core</p>
<ol>
<li>P40有30个SM，每个SM有4*32&#x3D;128个核。<br><img src="https://pic.shaojiemike.top/img/20220512220904.png"></li>
</ol>
<h3 id="限制的参数"><a href="#限制的参数" class="headerlink" title="限制的参数"></a>限制的参数</h3><p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#features-and-technical-specifications__technical-specifications-per-compute-capability">https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#features-and-technical-specifications__technical-specifications-per-compute-capability</a></p>
<table>
<thead>
<tr>
<th>限制</th>
<th>具体值</th>
</tr>
</thead>
<tbody><tr>
<td>Maximum number of threads per block</td>
<td>1024</td>
</tr>
<tr>
<td>Maximum number of resident blocks per SM</td>
<td>16&#x2F;32</td>
</tr>
<tr>
<td>Maximum number of resident warps per SM</td>
<td>64&#x2F;32</td>
</tr>
<tr>
<td>Maximum number of resident threads per SM</td>
<td>2048&#x2F;1024</td>
</tr>
<tr>
<td>Maximum number of 32-bit registers per thread</td>
<td>255</td>
</tr>
<tr>
<td>Maximum amount of shared memory per thread block</td>
<td>48KB&#x2F;96KB&#x2F;64KB</td>
</tr>
</tbody></table>
<h2 id="编程语法"><a href="#编程语法" class="headerlink" title="编程语法"></a>编程语法</h2><h3 id="函数前缀"><a href="#函数前缀" class="headerlink" title="函数前缀"></a>函数前缀</h3><p>与函数调用设备有关<br><img src="https://pic.shaojiemike.top/img/20220504203555.png"></p>
<table>
<thead>
<tr>
<th>函数前缀名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>__ global__</td>
<td>指定函数是CPU上调用，GPU上执行</td>
</tr>
<tr>
<td>__ device__</td>
<td>指定函数是GPU上调用，GPU上执行</td>
</tr>
<tr>
<td>__ host __</td>
<td>指定函数是CPU上调用，CPU上执行(最正常的函数，平常就省略不写)</td>
</tr>
</tbody></table>
<p>如果一个函数不加修饰，默认他是 <code>_device_</code> 函数，正如上面的 main 一样。</p>
<h3 id="变量修饰符"><a href="#变量修饰符" class="headerlink" title="变量修饰符"></a>变量修饰符</h3><table>
<thead>
<tr>
<th>变量修饰符</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>__ device__</td>
<td>数据存放在显存中，所有的线程都可以访问，而且CPU也可以通过运行时库访问</td>
</tr>
<tr>
<td>__ shared__</td>
<td>数据存放在共享存储器在，只有在所在的块内的线程可以访问，其它块内的线程不能访问</td>
</tr>
<tr>
<td>__ constant__</td>
<td>数据存放在常量存储器中，可以被所有的线程访问，也可以被CPU通过运行时库访问</td>
</tr>
<tr>
<td>Texture</td>
<td>纹理内存（Texture Memory）也是一种只读内存。</td>
</tr>
<tr>
<td>&#x2F;</td>
<td>没有限定符，那表示它存放在寄存器或者本地存储器中，在寄存器中的数据只归线程所有，其它线程不可见。</td>
</tr>
</tbody></table>
<h3 id="SMEM-静态与动态声明"><a href="#SMEM-静态与动态声明" class="headerlink" title="SMEM 静态与动态声明"></a>SMEM 静态与动态声明</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// array with a fixed size</span><br><span class="line">__shared__ float s_in[34];</span><br><span class="line">// allocate the array dynamically,</span><br><span class="line">extern __shared__ float s_in[];</span><br></pre></td></tr></table></figure>
<p>动态的<code>s_in</code>大小，在kernel的第三个参数指定<code>smemSize</code>字节数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int smemSize = (TPB + 2)*sizeof(float);</span><br><span class="line">ddKernel &lt;&lt;&lt; (n+TPB-1)/TPB, TPB, smemSize&gt;&gt;&gt; (args)</span><br></pre></td></tr></table></figure>
<h3 id="配置运算符"><a href="#配置运算符" class="headerlink" title="配置运算符"></a>配置运算符</h3><p><img src="https://pic.shaojiemike.top/img/20220120195454.png"><br><img src="https://pic.shaojiemike.top/img/20220120195629.png"></p>
<p> 执行配置运算符 <code>&lt;&lt;&lt; &gt;&gt;&gt;</code>，用来传递内核函数的执行参数。执行配置有四个参数，</p>
<p> 第一个参数声明<strong>网格</strong>的大小，</p>
<p> 第二个参数声明<strong>块</strong>的大小，</p>
<p> 第三个参数声明动态分配的<strong>共享存储器</strong>大小，默认为 0，</p>
<p> 最后一个参数声明<strong>执行的流</strong>，默认为 0.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add&lt;&lt;&lt;grid,block&gt;&gt;&gt;(a,b);</span><br></pre></td></tr></table></figure>

<h4 id="stream"><a href="#stream" class="headerlink" title="stream"></a>stream</h4><p><img src="https://pic.shaojiemike.top/img/20220120200109.png"></p>
<h3 id="CUDA内置变量"><a href="#CUDA内置变量" class="headerlink" title="CUDA内置变量"></a>CUDA内置变量</h3><table>
<thead>
<tr>
<th>变量</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td>gridDim</td>
<td>gridDim 是一个包含三个元素 x,y,z 的结构体，分别表示网格在x,y,z 三个方向上的尺寸(一般只有2维度)</td>
</tr>
<tr>
<td>blockDim</td>
<td>blockDim 也是一个包含三个元素 x,y,z 的结构体，分别表示块在x,y,z 三个方向上的尺寸</td>
</tr>
<tr>
<td>blockIdx</td>
<td>blockIdx 也是一个包含三个元素 x,y,z 的结构体，分别表示当前线程块在网格中 x,y,z 三个方向上的索引</td>
</tr>
<tr>
<td>threadIdx</td>
<td>是一个包含三个元素 x,y,z 的结构体，分别表示当前线程在其所在块中 x,y,z 三个方向上的索引</td>
</tr>
<tr>
<td>warpSize</td>
<td>在计算能力为 1.0 的设备中，这个值是24，在 1.0 以上的设备中，这个值是 32</td>
</tr>
</tbody></table>
<p>三维的举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__global__ void kernel() &#123;  </span><br><span class="line">   printf(&quot;Block (%d,%d,%d) of (%d,%d,%d), Thread (%d,%d,%d) of (%d,%d,%d)\n&quot;,  </span><br><span class="line">          blockIdx.x, blockIdx.y, blockIdx.z,  </span><br><span class="line">          gridDim.x, gridDim.y, gridDim.z,  </span><br><span class="line">          threadIdx.x, threadIdx.y, threadIdx.z,  </span><br><span class="line">          blockDim.x, blockDim.y, blockDim.z);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">int main() &#123;  </span><br><span class="line">   kernel&lt;&lt;&lt;dim3(2, 1, 1), dim3(2, 2, 2)&gt;&gt;&gt;();  </span><br><span class="line">   cudaDeviceSynchronize();  </span><br><span class="line">   return 0;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (0,0,0) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (1,0,0) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (0,1,0) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (1,1,0) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (0,0,1) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (1,0,1) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (0,1,1) of (2,2,2)  </span><br><span class="line">Block (0,0,0) of (2,1,1), Thread (1,1,1) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (0,0,0) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (1,0,0) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (0,1,0) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (1,1,0) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (0,0,1) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (1,0,1) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (0,1,1) of (2,2,2)  </span><br><span class="line">Block (1,0,0) of (2,1,1), Thread (1,1,1) of (2,2,2)</span><br></pre></td></tr></table></figure>

<p>二维的例子,最后一个维度都是 0, 我们使用结果的时候不使用 z 维度即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__global__ void kernel() &#123;  </span><br><span class="line">   printf(&quot;Block (%d,%d,%d) of (%d,%d,%d), Thread (%d,%d,%d) of (%d,%d,%d)\n&quot;,  </span><br><span class="line">          blockIdx.x, blockIdx.y, blockIdx.z,  </span><br><span class="line">          gridDim.x, gridDim.y, gridDim.z,  </span><br><span class="line">          threadIdx.x, threadIdx.y, threadIdx.z,  </span><br><span class="line">          blockDim.x, blockDim.y, blockDim.z);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">int main() &#123;  </span><br><span class="line">   kernel&lt;&lt;&lt;dim3(2, 3, 1), dim3(2, 1, 1)&gt;&gt;&gt;();  </span><br><span class="line">   cudaDeviceSynchronize();  </span><br><span class="line">   return 0;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Block (1,2,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (1,2,0) of (2,3,1), Thread (1,0,0) of (2,1,1)  </span><br><span class="line">Block (0,2,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (0,2,0) of (2,3,1), Thread (1,0,0) of (2,1,1)  </span><br><span class="line">Block (0,1,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (0,1,0) of (2,3,1), Thread (1,0,0) of (2,1,1)  </span><br><span class="line">Block (1,0,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (1,0,0) of (2,3,1), Thread (1,0,0) of (2,1,1)  </span><br><span class="line">Block (0,0,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (0,0,0) of (2,3,1), Thread (1,0,0) of (2,1,1)  </span><br><span class="line">Block (1,1,0) of (2,3,1), Thread (0,0,0) of (2,1,1)  </span><br><span class="line">Block (1,1,0) of (2,3,1), Thread (1,0,0) of (2,1,1)</span><br></pre></td></tr></table></figure>

<h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p>调用 GPU 的函数声明和定义不要分离，写在同一个文件里。分开(如：CUDA_SEPARABLE_COMPILATION)可能影响内联导致性能损失。</p>
<h3 id="访存"><a href="#访存" class="headerlink" title="访存"></a>访存</h3><p><img src="https://pic.shaojiemike.top/img/20220504210154.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__host____device__cudaError_t 	cudaMalloc ( void** devPtr, size_t size )</span><br><span class="line">cudaMallocPitch() //分配二维数组空间并自动对齐</span><br><span class="line">//在显存中为待运算的数据以及需要存放结果的变量开辟显存空间。</span><br><span class="line">__host____device__cudaError_t cudaFree ( void* devPtr )</span><br><span class="line">__host__cudaError_t cudaMemcpy ( void* dst, const void* src, size_t count, cudaMemcpyKind kind )</span><br></pre></td></tr></table></figure>

<p> where <strong>kind</strong> specifies the direction of the copy, and must be one of <strong>cudaMemcpyHostToHost</strong>, <strong>cudaMemcpyHostToDevice</strong>, <strong>cudaMemcpyDeviceToHost</strong>, <strong>cudaMemcpyDeviceToDevice</strong>, or <strong>cudaMemcpyDefault</strong>. Passing <strong>cudaMemcpyDefault</strong> is recommended, in which case the type of transfer is inferred from the pointer values. However, cudaMemcpyDefault is only allowed on systems that support unified virtual addressing. Calling cudaMemcpy() with dst and src pointers that do not match the direction of the copy results in an undefined behavior.</p>
<p> cudaMemcpy可以自动实现同步工作，可以省去cudaDeviceSynchronize。</p>
<p>可以通过 <code>cudaMallocManaged(&amp;a, sizeof(int) * 12)</code>申请在 Host 和 Device 上都直接使用的<a target="_blank" rel="noopener" href="https://developer.nvidia.com/blog/unified-memory-in-cuda-6/">Unified Memory</a>。性能多数情况会损失。</p>
<h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__host____device__cudaError_t 	cudaDeviceSynchronize ( void )</span><br><span class="line">//Wait for compute device to finish.</span><br><span class="line"></span><br><span class="line">__syncthreads() //block内线程快速同步</span><br></pre></td></tr></table></figure>

<h3 id="字符打印输出"><a href="#字符打印输出" class="headerlink" title="字符打印输出"></a>字符打印输出</h3><p>很明显CPU和GPU打印是异步的，需要同步。</p>
<p>而且cuda暂时不支持cout等流输出语句。</p>
<h3 id="Debug打印"><a href="#Debug打印" class="headerlink" title="Debug打印"></a>Debug打印</h3><p><code>cudaError_t</code>是不能理解的输出。 cuda samples 里面提供了 <code>helper_cuda.h</code> 头文件解决问题。 Debug 的时候也可以直接把 gridDim 改成 1, 更方便</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># CMakeLists.txt</span><br><span class="line">target_include_directories(hello PUBLIC /usr/local/cuda/samples/common/inc)</span><br><span class="line"></span><br><span class="line">checkCudaErrors(cudaDeviceSynchronize());</span><br></pre></td></tr></table></figure>

<h3 id="时间统计打印"><a href="#时间统计打印" class="headerlink" title="时间统计打印"></a>时间统计打印</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cudaEvent_t begin, end;</span><br><span class="line">cudaEventCreate(&amp;begin);</span><br><span class="line">cudaEventCreate(&amp;end);</span><br><span class="line"></span><br><span class="line">cudaEventRecord(begin);</span><br><span class="line"></span><br><span class="line">// do sth</span><br><span class="line"></span><br><span class="line">cudaEventRecord(end);</span><br><span class="line">cudaEventSynchronize (end);</span><br><span class="line"></span><br><span class="line">float elapsedTime;</span><br><span class="line">cudaEventElapsedTime (&amp;elapsed, begin, end);</span><br><span class="line">elapsedTime /= 1000;</span><br><span class="line"></span><br><span class="line">cudaEventDestroy (end);</span><br><span class="line">cudaEventDestroy (begin);</span><br><span class="line"></span><br><span class="line">return elapsedTime;</span><br></pre></td></tr></table></figure>

<h3 id="函数指针和lambda算子"><a href="#函数指针和lambda算子" class="headerlink" title="函数指针和lambda算子"></a>函数指针和lambda算子</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Func</span>&gt;  </span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">kernel</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> n, Func func)</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x * blockIdx.x + threadIdx.x;  </span><br><span class="line">        i &lt; n; i += blockDim.x * gridDim.x) &#123;  </span><br><span class="line">       <span class="built_in">func</span>(arr, i);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">funcop1</span> &#123;  </span><br><span class="line">   <span class="function">__device__ <span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> i)</span> </span>&#123;  </span><br><span class="line">       arr[i] = i;  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">funcop2</span> &#123;  </span><br><span class="line">   <span class="function">__device__ <span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> *arr, <span class="type">int</span> i)</span> </span>&#123;  </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;%d %f\n&quot;</span>, arr[i], <span class="built_in">sinf</span>(arr[i]));  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line">kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;(arr, n, funcop1&#123;&#125;); </span><br><span class="line">kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;(arr, n, funcop2&#123;&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lambda算子</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">Func</span>&gt;  </span><br><span class="line"><span class="function">__global__ <span class="type">void</span> <span class="title">kernel</span><span class="params">(<span class="type">int</span> n, Func func)</span> </span>&#123;  </span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> i = blockDim.x * blockIdx.x + threadIdx.x;  </span><br><span class="line">        i &lt; n; i += blockDim.x * gridDim.x) &#123;  </span><br><span class="line">       <span class="built_in">func</span>(i);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;(n, [=] __device__ (<span class="type">int</span> i) &#123;  </span><br><span class="line">       arr[i] = i;  </span><br><span class="line">   &#125;);</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;(n, [=] __device__ (<span class="type">int</span> i) &#123;  </span><br><span class="line">       <span class="built_in">printf</span>(<span class="string">&quot;%d, %f\n&quot;</span>, i, <span class="built_in">sinf</span>(arr[i]));  </span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// lambda算子例子2</span><br><span class="line">template &lt;class Func&gt;  </span><br><span class="line">__global__ void kernel(int n, Func func) &#123;  </span><br><span class="line">   for (int i = blockDim.x * blockIdx.x + threadIdx.x;  </span><br><span class="line">        i &lt; n; i += blockDim.x * gridDim.x) &#123;  </span><br><span class="line">       func(i);  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">kernel&lt;&lt;&lt;grid_dim, block_dim&gt;&gt;&gt;(n, [x = x_dev.data(), y = y_dev.data()] __device__ (int index)&#123;  </span><br><span class="line">       x[index] = x[index] + y[index];  </span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="cuda-容器的实现——thrust"><a href="#cuda-容器的实现——thrust" class="headerlink" title="cuda 容器的实现——thrust"></a>cuda 容器的实现——thrust</h3><p>STL 容器 cuda 并没有很好的适配和实现，CUDA对应的叫做thrust 库被称为： Template library for CUDA</p>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/thrust/index.html">https://docs.nvidia.com/cuda/thrust/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://thrust.github.io/doc/namespacethrust.html">https://thrust.github.io/doc/namespacethrust.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">thrust::host_vector&lt;float&gt; x_host(n);</span><br><span class="line">thrust::generate(x_host.begin(), x_host.end(), []&#123;return std::rand() / 3.0;&#125;);</span><br><span class="line"></span><br><span class="line">thrust::device_vector&lt;float&gt; x_dev(n); </span><br><span class="line">x_dev = x_host;</span><br></pre></td></tr></table></figure>

<h3 id="全局变量传递"><a href="#全局变量传递" class="headerlink" title="全局变量传递"></a>全局变量传递</h3><p>GPU计算的全局变量 <code>sum</code>最后传递到CPU的 <code>result</code>里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__device__ float sum = 0;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    float result = 0;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">cudaMemcpyFromSymbol(&amp;result, sum, sizeof(float), 0, cudaMemcpyDeviceToHost);</span><br></pre></td></tr></table></figure>

<h3 id="常见原子操作"><a href="#常见原子操作" class="headerlink" title="常见原子操作"></a>常见原子操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">atomicAdd (dst, src)</span><br><span class="line">atomicSub(dst, src)</span><br><span class="line">atomicOr(dst, src)</span><br><span class="line">atomicAnd(dst, src)</span><br><span class="line">atomicXor(dst, src)</span><br><span class="line">atomicMax(dst, src)</span><br><span class="line">atomicMin(dst, src)</span><br></pre></td></tr></table></figure>

<p>他们都有返回值，返回违背更改前的数值。</p>
<p>也可以通过 <code>atomicCAS</code>自定义原子操作。但是前面的原子操作有特殊设计的，会基于blockDim和gridDim,并行各块串行执行然后规约。</p>
<h2 id="单卡多GPU的实现"><a href="#单卡多GPU的实现" class="headerlink" title="单卡多GPU的实现"></a>单卡多GPU的实现</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> gpu_numbers = <span class="built_in">cudaGetDeviceCount</span>();</span><br><span class="line"><span class="type">int</span> *pointers[gpu_numbers];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> index = <span class="number">0</span>; index &lt; gpu_numbers; ++index) &#123;</span><br><span class="line">   <span class="built_in">cudaSetDevice</span>(index);</span><br><span class="line">   <span class="built_in">cudaMalloc</span>(&amp;pointers[index], size);</span><br><span class="line">&#125;<span class="comment">//在各自卡上声明空间</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> indexi = <span class="number">0</span>; indexi &lt; gpu_numbers; ++indexi) &#123;</span><br><span class="line">   <span class="built_in">cudaSetDevice</span>(indexi); <span class="comment">//设置当前卡</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> indexj = <span class="number">0</span>; indexj &lt; gpu_numbers; ++indexj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (indexi == indexj)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">      <span class="built_in">cudaDeviceEnablePeerAccess</span>(indexj, <span class="number">0</span>); <span class="comment">//打通indexj与当前卡的访问</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> index = <span class="number">1</span>; index &lt; gpu_numbers; ++index) &#123;</span><br><span class="line">   <span class="built_in">cudaMemcpyAsync</span>(pointers[<span class="number">0</span>], pointers[index], size, cudaMemcpyDeviceToDevice); <span class="comment">//非阻塞memoryCopy，在这里实现device0到其他的广播</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指定某卡运行程序"><a href="#指定某卡运行程序" class="headerlink" title="指定某卡运行程序"></a>指定某卡运行程序</h2><p>通过环境变量实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export CUDA_VISIBLE_DEVICES=1</span><br><span class="line">export CUDA_VISIBLE_DEVICES=0,1 # 多卡</span><br><span class="line">CUDA_VISIBLE_DEVICES=1 ./cuda_executable</span><br></pre></td></tr></table></figure>

<h2 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h2><p>现有cuda 是兼容 C++17 语法的，可以减少移植工作量<br><img src="https://pic.shaojiemike.top/img/20220504204514.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export CUDA_ROOT=/usr/local/cuda/bin</span><br><span class="line">export PATH=$CUDA_ROOT:$PATH</span><br><span class="line">which nvcc</span><br><span class="line">nvcc -V</span><br><span class="line">nvcc src.cu -o a.out</span><br><span class="line">./a.out</span><br></pre></td></tr></table></figure>

<p>发现版本太老了不支持更新的gcc，自己安装最新cuda</p>
<h2 id="nvcc优化选项"><a href="#nvcc优化选项" class="headerlink" title="nvcc优化选项"></a>nvcc优化选项</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">target_compile_options($&#123;exe&#125;  PUBLIC $&lt;$&lt;COMPILE_LANGUAGE:CUDA&gt;:</span><br><span class="line">			-Xptxas </span><br><span class="line">			-O3 </span><br><span class="line">			-v </span><br><span class="line">			--use_fast_math</span><br><span class="line">	&gt;)</span><br></pre></td></tr></table></figure>
<h3 id="fast-math"><a href="#fast-math" class="headerlink" title="fast math"></a>fast math</h3><p><code>–-use_fast_math</code>对于频繁的数学函数：三角函数、快速傅立叶变换、幂次、根号有5~15%的效率提升。</p>
<h3 id="ECC"><a href="#ECC" class="headerlink" title="ECC"></a>ECC</h3><p>ECC(error correcting code,  错误检查和纠正)能够提高数据的正确性，随之而来的是可用内存的减少和性能上的损失。对于Tesla系列伺服器该功能默认开启。</p>
<p>通过命令 nvidia-smi -i n</p>
<p>可查看第n个个显卡的简要信息（详细信息可通过 nvidia-smi -q -i 0获取），其中有一项是volatile Uncorr. ECC, 可通过该选项查看当前配置。</p>
<p>通过 nvidia-smi -i n -e 0&#x2F;1 可关闭(0)&#x2F;开启(1)第n号GPU的ECC模式。</p>
<p>通过实践，关闭ECC程序的性能能得到13%~15%的提升。</p>
<h2 id="CUDA实例"><a href="#CUDA实例" class="headerlink" title="CUDA实例"></a>CUDA实例</h2><h3 id="CUDA项目"><a href="#CUDA项目" class="headerlink" title="CUDA项目"></a>CUDA项目</h3><p><a target="_blank" rel="noopener" href="https://github.com/Kirrito-k423/StencilAcc">https://github.com/Kirrito-k423/StencilAcc</a></p>
<h3 id="一维的例子"><a href="#一维的例子" class="headerlink" title="一维的例子"></a>一维的例子</h3><p>2^m次个数组的数，怎么求和。</p>
<p>先将数据分成多个block,每个block里面进行第一遍归约。</p>
<p>第二个for的作用</p>
<p> for 循环中的算法就是将数组的后一半加到前一半上去,然后再在前一半中的后一半加到前一半的前一半中…</p>
<p> 这中被称为“对数归约”,循环完成后一个block 中的和是sPartials[0]的值.</p>
<p> 接着，将这个值导出到out中.</p>
<p><img src="https://pic.shaojiemike.top/img/20220120210401.png"><br><img src="https://pic.shaojiemike.top/img/20220120210632.png"></p>
<h2 id="CUDA使用的常见问题"><a href="#CUDA使用的常见问题" class="headerlink" title="CUDA使用的常见问题"></a>CUDA使用的常见问题</h2><h3 id="Install-CUDA-Toolkit-without-sudo"><a href="#Install-CUDA-Toolkit-without-sudo" class="headerlink" title="Install CUDA Toolkit without sudo"></a>Install CUDA Toolkit without sudo</h3><ol>
<li>Download your runfile according to your OS（<br><code>lsb_release -a</code> <code>unname -a</code>） in here(<a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-downloads?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=20.04&target_type=runfile_local">https://developer.nvidia.com/cuda-downloads?target_os=Linux&amp;target_arch=x86_64&amp;Distribution=Ubuntu&amp;target_version=20.04&amp;target_type=runfile_local</a>).</li>
<li>Run <code>md5sum</code> on your run file to make sure it is not corrupted. The correct checksum is on your CUDA download page. Note, somehow, this file is easily being corrupted. Make sure to check it.</li>
<li>Execute the <code>runfile</code> with the <code>--toolkitpath</code> option, <strong>where the path</strong> is where you would like the toolkit to sit on. Thus, there is no root requirement. –toolkit is to only install CUDA toolkit (no driver). The <code>--override</code> option might not be needed but if there is warning you might want to turn it on.<br><code>bash cuda_10.0.130_410.48_linux --silent --override --toolkit --toolkitpath=$HOME/Install/cuda10</code></li>
<li>In your <code>bashrc</code> or <code>zshrc</code> file, specify the three PATHs</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PATH=/usr/local/cuda/bin:$PATH</span><br><span class="line">CPATH=/usr/local/cuda/include:$CPATH </span><br><span class="line">LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH</span><br></pre></td></tr></table></figure>

<h3 id="Install-pre-CUDA-Toolkit"><a href="#Install-pre-CUDA-Toolkit" class="headerlink" title="Install pre CUDA Toolkit"></a>Install pre CUDA Toolkit</h3><p><a target="_blank" rel="noopener" href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/95939378">https://zhuanlan.zhihu.com/p/95939378</a></p>
<h3 id="Failed-to-initialize-NVML-Driver-library-version-mismatch"><a href="#Failed-to-initialize-NVML-Driver-library-version-mismatch" class="headerlink" title="Failed to initialize NVML: Driver&#x2F;library version mismatch"></a>Failed to initialize NVML: Driver&#x2F;library version mismatch</h3><p><img src="https://pic.shaojiemike.top/img/20220127174948.png"></p>
<h3 id="driver-version-VS-runtime-version"><a href="#driver-version-VS-runtime-version" class="headerlink" title="driver version VS runtime version?"></a>driver version VS runtime version?</h3><p><img src="https://pic.shaojiemike.top/img/20220123210917.png"></p>
<p>cuda有两套主要的API，</p>
<p>一套是 the <strong>driver</strong> API (e.g. libcuda.so on linux and <strong>nvidia-smi</strong>) is installed by the <strong>GPU driver installer.</strong> 识别GPU硬件的驱动</p>
<p>另一套是 the <strong>runtime</strong> API (e.g. libcudart.so on linux, and also <strong>nvcc</strong>) is installed by the <strong>CUDA toolkit installer</strong> (which may also have a GPU driver installer bundled in it). 提供cuda编程的各种常用函数库和接口</p>
<p>关系：</p>
<ol>
<li>两者不是必须一致。</li>
<li>CUDA Driver Version应该是跟着GPU驱动走的，Runtime Version取决于当前设置。Driver Version一般 &gt;&#x3D; Runtime Version, 否则insufficient。</li>
<li>软件运行时调用的应该是Runtime Version。</li>
</ol>
<h3 id="check-driver-version-VS-runtime-version"><a href="#check-driver-version-VS-runtime-version" class="headerlink" title="check driver version VS runtime version"></a>check driver version VS runtime version</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># runtime version</span><br><span class="line">nvcc -V</span><br><span class="line">cat /usr/local/cuda/version.txt</span><br><span class="line"># driver version</span><br><span class="line">nvidia-smi</span><br><span class="line">cat /proc/driver/nvidia/version</span><br><span class="line">modinfo nvidia|grep version:</span><br></pre></td></tr></table></figure>

<h4 id="how-to-download-driver-version"><a href="#how-to-download-driver-version" class="headerlink" title="how to download driver version"></a>how to download driver version</h4><p>windows:<br><a target="_blank" rel="noopener" href="https://www.nvidia.com/Download/driverResults.aspx/185108/en-us">https://www.nvidia.com/Download/driverResults.aspx/185108/en-us</a></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzkyMDE2OTA3Mw==&mid=2247507610&idx=1&sn=755193a7dcd1cad4a165e97e1732121b&chksm=c1946184f6e3e892ad65417c24ab329700e25e755e595a991984ecc3303a90c2dd946cba6001&mpshare=1&scene=24&srcid=05073XR8nAsQu7SWEpiog9Wa&sharer_sharetime=1683440747315&sharer_shareid=63ffea37fc31f685dff5e527826646aa#rd">实例：手写 CUDA 算子，让 Pytorch 提速 20 倍</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/#function-parameters">https://docs.nvidia.com/cuda/cuda-c-programming-guide/#function-parameters</a></p>
<p>例子代码:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/chivier/cutests">https://github.com/chivier/cutests</a></p>
<p><a target="_blank" rel="noopener" href="https://chivier.github.io/2022/02/20/2022/2202-CudaProgramming/">https://chivier.github.io/2022/02/20/2022/2202-CudaProgramming/</a></p>
<p><a target="_blank" rel="noopener" href="https://chivier.github.io/2022/04/11/2022/2204-GPU%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/">https://chivier.github.io/2022/04/11/2022/2204-GPU%E7%A8%8B%E5%BA%8F%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/</a></p>
<p><a target="_blank" rel="noopener" href="https://comzyh.com/blog/archives/967/">https://comzyh.com/blog/archives/967/</a></p>
<p><a target="_blank" rel="noopener" href="https://itlanyan.com/cuda-enable-disable-ecc/">https://itlanyan.com/cuda-enable-disable-ecc/</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/19/">Previous</a></div><div class="pagination-next"><a href="/page/21/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/19/">19</a></li><li><a class="pagination-link is-current" href="/page/20/">20</a></li><li><a class="pagination-link" href="/page/21/">21</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/37/">37</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">361</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">29</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">481</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">36</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-08T13:13:26.000Z">2023-12-08</time></p><p class="title"><a href="/2023/12/08/OutOfWork/5-VideoEntertainment/CalibreAndItsPuginsForEhentaiBooks/">Calibre and its Pugins for e-hentai Books</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-07T12:34:56.000Z">2023-12-07</time></p><p class="title"><a href="/2023/12/07/OutOfWork/3-homepage/blogWebsiteBuilderOrSSG/dokuwiki/">Dokuwiki: </a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-06T08:10:02.000Z">2023-12-06</time></p><p class="title"><a href="/2023/12/06/OutOfWork/4-devices/nas/UgreenNas/">Ugreen Nas</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-12-03T09:31:21.000Z">2023-12-03</time></p><p class="title"><a href="/2023/12/03/OutOfWork/3-homepage/deployment/webDesign4customizeMarkdownGrammarInSSG/">Web Design 4 : Customize Markdown Grammar In SSG</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-11-30T21:48:21.000Z">2023-11-30</time></p><p class="title"><a href="/2023/11/30/OutOfWork/3-homepage/deployment/webDesign3FutureFeatures/">Web Design 3 : Future Features</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">222</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2023 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>