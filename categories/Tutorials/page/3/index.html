<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Category: Tutorials - SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">Tutorials</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-09-06T16:00:00.000Z" title="9/6/2023, 4:00:00 PM">2023-09-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.921Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">5 minutes read (About 741 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/09/06/Work/software/linux-apps/email/">Script: Email notifications when machine is free</a></p><div class="content"><h2 id="outline"><a href="#outline" class="headerlink" title="outline"></a>outline</h2><p>login to free <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/7484492/sending-email-from-smtp-server-without-the-need-to-enter-password">SMTP server</a>(qq, google) to send email to others.</p>
<h2 id="send-email-using-command-line"><a href="#send-email-using-command-line" class="headerlink" title="send email using command line"></a>send email using command line</h2><ol>
<li>check <code>ping mail.ustc.edu.cn</code></li>
<li>MUST : set gmail open to support <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/595410/troubleshooting-ssmtp-authorization-failed">SMTP</a> and <a target="_blank" rel="noopener" href="https://support.google.com/mail/thread/4477145/no-app-passwords-under-security-signing-in-to-google-panel?hl=en">apppassword</a><ol>
<li>or config qq email</li>
</ol>
</li>
</ol>
<h3 id="IMAP-POP3-or-SMTP"><a href="#IMAP-POP3-or-SMTP" class="headerlink" title="IMAP, POP3 or SMTP"></a>IMAP, POP3 or SMTP</h3><h3 id="mailutils"><a href="#mailutils" class="headerlink" title="mailutils"></a>mailutils</h3><p>According to <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/12917/how-to-send-mail-from-the-command-line">ref1</a>. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install ca-certificates</span></span><br><span class="line"><span class="comment"># After new a google accounts, </span></span><br><span class="line"><span class="comment"># config according to ref1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mailutils</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Hello world&quot;</span> | mail -s <span class="string">&quot;Test&quot;</span> shaojiemike@mail.ustc.edu.cn</span><br></pre></td></tr></table></figure>

<p>send but the same, more crazy thing is the <code>-v</code> and <code>-d</code> flag is not supported. and <code>--debug-level=trace0</code> isn’t <a target="_blank" rel="noopener" href="https://mailutils.org/wiki/Debug_level">recognized</a>. many same question in <a target="_blank" rel="noopener" href="https://serverfault.com/questions/1116431/cant-send-email-on-ubuntu-with-mail-command">StackOverflow</a></p>
<p><code>sudo tail -n 30 /var/log/mail.log</code> or <code>mail.error</code> show more info.</p>
<h3 id="ssmtp"><a href="#ssmtp" class="headerlink" title="ssmtp"></a>ssmtp</h3><p>We try <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/732677/unable-to-send-a-email-through-the-command-line-on-ubuntu-desktop/732782#732782">ref2</a> <code>ssmtp</code>, <code>sudo vim /etc/ssmtp/ssmtp.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TLS_CA_FILE=/etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">root=shaojieemail@gmail.com</span><br><span class="line">mailhub=smtp.gmail.com:587</span><br><span class="line">rewriteDomain=gmail.com</span><br><span class="line">AuthUser=shaojieemail</span><br><span class="line">AuthPass=&#123;apppassword&#125;</span><br><span class="line">FromLineOverride=YES</span><br><span class="line">UseSTARTTLS=Yes</span><br><span class="line">UseTLS=YES</span><br><span class="line">hostname=snode6</span><br></pre></td></tr></table></figure>

<p>The config get work but not well configed, e.g., <a target="_blank" rel="noopener" href="https://ubuntuforums.org/showthread.php?t=2319203">TLS_CA_FILE</a></p>
<p>sending a email using gmail took about 13 mins.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ssmtp 943648187@qq.com &lt; mail.txt</span><br><span class="line">......</span><br><span class="line">[-&gt;] Received: by snode6 (sSMTP sendmail emulation); Wed, 06 Sep 2023 15:42:05 +0800</span><br><span class="line">[-&gt;] From: <span class="string">&quot;Shaojie Tan&quot;</span> &lt;shaojiemike@gmail.com&gt;</span><br><span class="line">[-&gt;] Date: Wed, 06 Sep 2023 15:42:05 +0800</span><br><span class="line">[-&gt;] <span class="built_in">test</span> server email sending</span><br><span class="line">[-&gt;]</span><br><span class="line">[-&gt;] .</span><br><span class="line">[&lt;-] 250 2.0.0 OK  1693986323 5-20020a17090a1a4500b0026b4ca7f62csm11149314pjl.39 - gsmtp</span><br><span class="line">[-&gt;] QUIT</span><br><span class="line">[&lt;-] 221 2.0.0 closing connection 5-20020a17090a1a4500b0026b4ca7f62csm11149314pjl.39 - gsmtp</span><br></pre></td></tr></table></figure>

<h3 id="sendmail"><a href="#sendmail" class="headerlink" title="sendmail"></a>sendmail</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sendmail 94364818s7@qq.com &lt; mail.txt</span><br><span class="line">sendmail: Authorization failed (535 5.7.8  https://support.google.com/mail/?p=BadCredentials e7-20020a170902b78700b001c0c79b386esm8725297pls.95 - gsmtp)</span><br></pre></td></tr></table></figure>

<p>get to work after well config gmail setting.</p>
<h3 id="Speed-Compare"><a href="#Speed-Compare" class="headerlink" title="Speed Compare"></a>Speed Compare</h3><table>
<thead>
<tr>
<th>command</th>
<th>snode6 time(mins)</th>
<th>icarus1</th>
</tr>
</thead>
<tbody><tr>
<td>mail</td>
<td>4</td>
<td>1s</td>
</tr>
<tr>
<td>ssmtp</td>
<td>13</td>
<td></td>
</tr>
<tr>
<td>sendmail</td>
<td>6</td>
<td></td>
</tr>
</tbody></table>
<h2 id="send-email-by-python"><a href="#send-email-by-python" class="headerlink" title="send email by python"></a>send email by python</h2><p><a target="_blank" rel="noopener" href="https://github.com/TheRainstorm/ustc-epc-bot-openwrt">ref</a> using QQ apppassword and python.</p>
<h2 id="email-notifications"><a href="#email-notifications" class="headerlink" title="email notifications"></a>email notifications</h2><ol>
<li><p><strong>Create a Bash Script</strong>: Create a Bash script that checks the CPU usage and sends an email if it’s below 30%. For example, create a file named <code>cpu_check.sh</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get CPU usage percentage</span></span><br><span class="line">cpu_usage=$(top -b -n 1 | grep <span class="string">&#x27;%Cpu(s):&#x27;</span> | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | <span class="built_in">cut</span> -d<span class="string">&#x27;.&#x27;</span> -f1)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;cpu_usage : <span class="variable">$&#123;cpu_usage&#125;</span> on <span class="subst">$(hostname)</span>&quot;</span></span><br><span class="line"><span class="comment"># Check if CPU usage is below 30%</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$cpu_usage</span>&quot;</span> -lt 30 ]; <span class="keyword">then</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;beyond threshold : <span class="variable">$&#123;cpu_usage&#125;</span> on &quot;</span></span><br><span class="line">    <span class="comment"># Send an email</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;CPU usage is <span class="variable">$&#123;cpu_usage&#125;</span> below 30% on <span class="subst">$(hostname)</span>&quot;</span> | mail -s <span class="string">&quot;Low CPU Usage Alert on <span class="subst">$(hostname)</span>&quot;</span> your_email@example.com</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>Make the script executable:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x cpu_check.sh</span><br></pre></td></tr></table></figure>

<p>Modify <code>your_email@example.com</code> with your actual email address.</p>
</li>
<li><p><strong>Schedule the Script</strong>: Use the <code>cron</code> scheduler to run the script at regular intervals. Edit your crontab by running:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>Add an entry to run the script, for example, every 5 minutes:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * /staff/shaojiemike/test/cpu_check.sh &gt;&gt; /staff/shaojiemike/test/cpu_check.log</span><br><span class="line"><span class="comment"># Run every 15 minutes during working hours (9 am to 7 pm)</span></span><br><span class="line">*/15 9-19 * * * /path/to/your/script.sh</span><br></pre></td></tr></table></figure>

<p>Replace <code>/path/to/cpu_check.sh</code> with the actual path to your Bash script.</p>
</li>
<li><p><strong>Save and Exit</strong>: Save the crontab file and exit the text editor.</p>
</li>
</ol>
<p>Now, the script will run every 5 minutes (adjust the cron schedule as needed) and send an email notification if the CPU usage is below 50%. You should receive an email when the condition is met.</p>
<p>Please note that this is a basic example, and you can modify the script to include more details or customize the notification further as needed. Additionally, ensure that your server is configured to send emails; you may need to configure SMTP settings for the <code>mail</code> or <code>sendmail</code> command to work correctly.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-09-05T16:00:00.000Z" title="9/5/2023, 4:00:00 PM">2023-09-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.925Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 425 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/09/05/Work/software/simulator/zsim_bug/">Zsim-tlb: bug</a></p><div class="content"><h2 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h2><p>zsim-tlb simulate in icarus0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pinbin: build/opt/zsim.cpp:816: LEVEL_BASE::VOID VdsoCallPoint(LEVEL_VM::THREADID): Assertion `vdsoPatchData[tid].level<span class="string">&#x27; failed.</span></span><br><span class="line"><span class="string">Pin app terminated abnormally due to signal 6.</span></span><br></pre></td></tr></table></figure>

<h3 id="locate-error"><a href="#locate-error" class="headerlink" title="locate error"></a>locate error</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VOID <span class="title function_">VdsoCallPoint</span><span class="params">(THREADID tid)</span> &#123;</span><br><span class="line">	<span class="comment">//level=0,invalid</span></span><br><span class="line">    assert(vdsoPatchData[tid].level);</span><br><span class="line">    vdsoPatchData[tid].level++;</span><br><span class="line">    <span class="comment">// info(&quot;vDSO internal callpoint, now level %d&quot;, vdsoPatchData[tid].level); //common</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>vDSO</code>  (virtual dynamic shared object) is a kernel machanism for exporting a carefully set kernel space routines (eg. not secret api, <code>gettid()</code> and <code>gettimeofday()</code>) to user<br> spapce to eliminate the performance penalty of user-kernel mode switch according to <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/VDSO">wiki</a>. <code>vDSO</code></li>
<li>You can use some <code>__vdso_getcpu()</code> C library, and kernel will <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man7/vdso.7.html">auto move it to user-space</a></li>
<li><code>vDSO</code> overcome <code>vsyscall</code>(first linux-kernel machanism to accelerate syscall) drawback.</li>
<li>In zsim, <code>vDSO</code> have only four function <code>enum VdsoFunc &#123;VF_CLOCK_GETTIME, VF_GETTIMEOFDAY, VF_TIME, VF_GETCPU&#125;;</code></li>
</ul>
<h3 id="vDSO-simulate-part"><a href="#vDSO-simulate-part" class="headerlink" title="vDSO simulate part"></a>vDSO simulate part</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Instrumentation function, called for EVERY instruction</span></span><br><span class="line">VOID <span class="title function_">VdsoInstrument</span><span class="params">(INS ins)</span> &#123;</span><br><span class="line">    ADDRINT insAddr = INS_Address(ins);	<span class="comment">//get ins addr</span></span><br><span class="line">    <span class="keyword">if</span> (unlikely(insAddr &gt;= vdsoStart &amp;&amp; insAddr &lt; vdsoEnd)) &#123;</span><br><span class="line">		<span class="comment">//INS is vdso syscall</span></span><br><span class="line">        <span class="keyword">if</span> (vdsoEntryMap.find(insAddr) != vdsoEntryMap.end()) &#123;</span><br><span class="line">            VdsoFunc func = vdsoEntryMap[insAddr];</span><br><span class="line">			<span class="comment">//call VdsoEntryPoint function</span></span><br><span class="line">			<span class="comment">//argv are: tid ,func(IARG_UINT32),arg0(LEVEL_BASE::REG_RDI),arg1(LEVEL_BASE::REG_RSI) </span></span><br><span class="line">            INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) VdsoEntryPoint, IARG_THREAD_ID, IARG_UINT32, (<span class="type">uint32_t</span>)func, IARG_REG_VALUE, LEVEL_BASE::REG_RDI, IARG_REG_VALUE, LEVEL_BASE::REG_RSI, IARG_END);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (INS_IsCall(ins)) &#123;	<span class="comment">//call instruction</span></span><br><span class="line">            INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) VdsoCallPoint, IARG_THREAD_ID, IARG_END);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (INS_IsRet(ins)) &#123;	<span class="comment">//Ret instruction</span></span><br><span class="line">            INS_InsertCall(ins, IPOINT_BEFORE, (AFUNPTR) VdsoRetPoint, IARG_THREAD_ID, IARG_REG_REFERENCE, LEVEL_BASE::REG_RAX <span class="comment">/* return val */</span>, IARG_END);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Warn on the first vsyscall code translation</span></span><br><span class="line">    <span class="keyword">if</span> (unlikely(insAddr &gt;= vsyscallStart &amp;&amp; insAddr &lt; vsyscallEnd &amp;&amp; !vsyscallWarned)) &#123;</span><br><span class="line">        warn(<span class="string">&quot;Instrumenting vsyscall page code --- this process executes vsyscalls, which zsim does not virtualize!&quot;</span>);</span><br><span class="line">        vsyscallWarned = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>INS_Address</code> is from <code>pin-kit</code>, but <code>INS_InsertCall</code> is pin api.</p>
<h3 id="try"><a href="#try" class="headerlink" title="try:"></a>try:</h3><p><code>.level</code> is just show the level of nested vsyscall. I think comment the <code>assert</code> which trigerd when <code>callfunc</code> before <code>entryfunc</code> is just fun.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-09-05T16:00:00.000Z" title="9/5/2023, 4:00:00 PM">2023-09-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.909Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">2 minutes read (About 320 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/09/05/Work/Programming/1-env/c/conda/">Conda</a></p><div class="content"><h2 id="Install-miniconda"><a href="#Install-miniconda" class="headerlink" title="Install miniconda"></a>Install miniconda</h2><p>According to the <a target="_blank" rel="noopener" href="https://docs.conda.io/en/latest/miniconda.html">official website</a>, </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line">bash Miniconda3-latest-Linux-x86_64.sh</span><br><span class="line"><span class="comment"># choose local path to install, maybe ~/.local</span></span><br><span class="line"><span class="comment"># init = yes, will auto modified the .zshrc to add the miniconda to PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If you&#x27;d prefer that conda&#x27;s base environment not be activated on startup,</span></span><br><span class="line"><span class="comment">#    set the auto_activate_base parameter to false:</span></span><br><span class="line">conda config --<span class="built_in">set</span> auto_activate_base <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>you need to close all terminal(all windows in one section including all split windows), and reopen a terminal will take effect;</p>
<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><p>使用以下命令创建一个名为”myenv”的虚拟环境（您可以将”myenv”替换为您喜欢的环境名称）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda create --name myenv python=3.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># list existed env</span></span><br><span class="line">conda <span class="built_in">env</span> list</span><br></pre></td></tr></table></figure>

<h3 id="激活环境"><a href="#激活环境" class="headerlink" title="激活环境"></a>激活环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate name</span><br></pre></td></tr></table></figure>

<h2 id="环境包的生成和使用"><a href="#环境包的生成和使用" class="headerlink" title="环境包的生成和使用"></a>环境包的生成和使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda list -e &gt; requirements.txt</span><br><span class="line">conda install --<span class="built_in">yes</span> --file requirements.txt</span><br></pre></td></tr></table></figure>

<h3 id="在conda命令无效时使用pip命令来代替"><a href="#在conda命令无效时使用pip命令来代替" class="headerlink" title="在conda命令无效时使用pip命令来代替"></a>在conda命令无效时使用pip命令来代替</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> requirement; <span class="keyword">do</span> conda install --<span class="built_in">yes</span> <span class="variable">$requirement</span> || pip install <span class="variable">$requirement</span>; <span class="keyword">done</span> &lt; requirements.txt</span><br></pre></td></tr></table></figure>

<p>The double pipe (“<code>||</code>”) is a control operator that represents the logical OR operation. It is used to execute a command or series of commands only if the previous command or pipeline has <strong>failed</strong> or has returned a <strong>non-zero</strong> status code.</p>
<h3 id="保存和复制conda环境的配置"><a href="#保存和复制conda环境的配置" class="headerlink" title="保存和复制conda环境的配置"></a>保存和复制conda环境的配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda <span class="built_in">env</span> <span class="built_in">export</span> &gt; freeze.yml</span><br><span class="line">conda <span class="built_in">env</span> create -f freeze.yml</span><br></pre></td></tr></table></figure>


<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mao_Jonah/article/details/89502380">https://blog.csdn.net/Mao_Jonah/article/details/89502380</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-09-05T16:00:00.000Z" title="9/5/2023, 4:00:00 PM">2023-09-05</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.913Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">4 minutes read (About 594 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/09/05/Work/Programming/1-env/terminal/terminal/">Terminal</a></p><div class="content"><h2 id="terminal-mouse-scroll-messy-code"><a href="#terminal-mouse-scroll-messy-code" class="headerlink" title="terminal mouse scroll messy code"></a>terminal mouse scroll messy code</h2><p>滚轮乱码，是tmux <code>set mouse on</code>的原因</p>
<p>进入tmux后退出，并运行<code>reset</code>即可</p>
<h2 id="command-output"><a href="#command-output" class="headerlink" title="command output"></a>command output</h2><p>在用python使用curses写多进程进度条的时候遇到几个问题<br><img src="https://pic.shaojiemike.top/img/20220325222152.png"></p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stdscr = curses.initscr() # 不要设置为全局变量</span><br><span class="line"># 而且 使用set_win unset_win 保持区域换行的行为</span><br></pre></td></tr></table></figure>

<h3 id="n-r-回车-换行的区别"><a href="#n-r-回车-换行的区别" class="headerlink" title="\n \r 回车 换行的区别"></a>\n \r 回车 换行的区别</h3><ol>
<li>符号 ASCII码 意义<ol>
<li>\n 10 换行NL<ol>
<li>换行 \n 本义是光标往下一行（不一定到下一行行首），n的英文newline，控制字符可以写成LF，即Line Feed</li>
</ol>
</li>
<li>\r 13 回车CR<ol>
<li>回车 \r 本义是光标重新回到本行开头，r的英文return，控制字符可以写成CR，即Carriage Return</li>
</ol>
</li>
</ol>
</li>
<li>在不同的操作系统这几个字符表现不同<ol>
<li>在WIN系统下，这两个字符就是表现的本义，</li>
<li>在UNIX类系统，换行\n就表现为光标下一行并回到行首，</li>
<li>在MAC上，\r就表现为回到本行开头并往下一行，至于ENTER键的定义是与操作系统有关的。通常用的Enter是两个加起来。</li>
</ol>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\n: UNIX 系统行末结束符</span><br><span class="line">\n\r: window 系统行末结束符</span><br><span class="line">\r: MAC OS 系统行末结束符</span><br></pre></td></tr></table></figure>

<h2 id="check-process-create-time"><a href="#check-process-create-time" class="headerlink" title="check process create time"></a>check process create time</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -eo pid,lstart,cmd |grep bhive</span><br><span class="line">date</span><br></pre></td></tr></table></figure>
<h2 id="kill-all-process-by-name"><a href="#kill-all-process-by-name" class="headerlink" title="kill all process by name"></a>kill all process by name</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ps -ef | grep &#x27;bhive-re&#x27; | grep -v grep | awk &#x27;&#123;print $2&#125;&#x27; | sudo xargs -r kill -9</span><br></pre></td></tr></table></figure>

<h2 id="sudo-的问题"><a href="#sudo-的问题" class="headerlink" title="sudo 的问题"></a>sudo 的问题</h2><h3 id="sudo后找不到命令"><a href="#sudo后找不到命令" class="headerlink" title="sudo后找不到命令"></a>sudo后找不到命令</h3><p>当你使用sudo去执行一个程序时，处于安全的考虑，这个程序将在一个新的、最小化的环境中执行，也就是说，诸如PATH这样的环境变量，在sudo命令下已经被重置成默认状态了。</p>
<p>添加所需要的路径(如 &#x2F;usr&#x2F;local&#x2F;bin）到&#x2F;etc&#x2F;sudoers文件”secure_path”下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Defaults    secure_path = /sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin</span><br></pre></td></tr></table></figure>
<h2 id="teminal-read-code"><a href="#teminal-read-code" class="headerlink" title="teminal read code"></a>teminal read code</h2><h3 id="ctags-函数跳转"><a href="#ctags-函数跳转" class="headerlink" title="ctags + 函数跳转"></a>ctags + 函数跳转</h3><ol>
<li>安装ctags <code>sudo apt-get install exuberant-ctags</code></li>
<li>生成函数名索引文件 <code>ctags -R . /path/another/include</code> will generate <code>tags</code> file</li>
</ol>
<h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;set tags=<span class="variable">$PWD</span>/tags&quot;</span> &gt;&gt; ~/.vimrc</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">vim ~/.vimrc</span><br><span class="line"><span class="comment"># set tags=~/Download/llvm-project-main/llvm/tags</span></span><br></pre></td></tr></table></figure>

<h3 id="vim-使用"><a href="#vim-使用" class="headerlink" title="vim 使用"></a>vim 使用</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Ctrl + ] <span class="comment"># forword</span></span><br><span class="line">Ctrl + t <span class="comment"># 返回</span></span><br></pre></td></tr></table></figure>

<h3 id="vscode-tools"><a href="#vscode-tools" class="headerlink" title="vscode tools"></a>vscode tools</h3><p>ctags tools</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-24T16:00:00.000Z" title="8/24/2023, 4:00:00 PM">2023-08-24</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.925Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">28 minutes read (About 4183 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/24/Work/software/perf/perf/">Perf</a></p><div class="content"><h2 id="perf-介绍"><a href="#perf-介绍" class="headerlink" title="perf 介绍"></a>perf 介绍</h2><p>Perf是Linux下的一个性能分析工具(profiler)。基于Linux 内核perf_event子系统实现。</p>
<p>Perf不仅能够分析 PMU 事件(硬件事件)，也能分析各种软件事件，如进程切换、pagefault、网络、文件IO等。</p>
<p><img src="https://pic.shaojiemike.top/img/20220801152818.png"></p>
<h2 id="常用perf命令"><a href="#常用perf命令" class="headerlink" title="常用perf命令"></a>常用perf命令</h2><h3 id="间隔选项"><a href="#间隔选项" class="headerlink" title="间隔选项"></a>间隔选项</h3><p><code>-I 100</code> 以100ms为间隔打印数据</p>
<h3 id="性能事件的属性"><a href="#性能事件的属性" class="headerlink" title="性能事件的属性"></a>性能事件的属性</h3><p>硬件性能事件由处理器中的PMU提供支持。由于现代处理器的主频非常高，再加上深度流水线机制，从性能事件被触发，到处理器响应 PMI中断，流水线上可能已处理过数百条指令。</p>
<p>那么PMI中断采到的指令地址就不再是<strong>触发性能事件的那条指令的地址了</strong>，而且可能具有非常严重的偏差。</p>
<p>为了解决这个问题，Intel处理器通过<strong>PEBS机制</strong>实现了高精度事件采样。PEBS通过硬件在计数器溢出时将处理器现场直接保存到内存（而不是在响应中断时才保存寄存器现场），从而使得 perf能够采到真正触发性能事件的那条指令的地址，提高了采样精度。</p>
<p>在默认条件下，perf不使用PEBS机制。用户如果想要使用高精度采样，需要在指定性能事件时，在事件名后添加后缀”:p”或”:pp”。Perf在采样精度上定义了4个级别，如下表所示。</p>
<p>级别描述</p>
<pre><code>  0 无精度保证
  1 采样指令与触发性能事件的指令之间的偏差为常数（:p）
  2 需要尽量保证采样指令与触发性能事件的指令之间的偏差为0（:pp）
  3 保证采样指令与触发性能事件的指令之间的偏差必须为0（:ppp）
  性能事件的精度级别目前的X86处理器，包括Intel处理器与AMD处理器均仅能实现前 3 个精度级别。
</code></pre>
<p>除了精度级别以外，性能事件还具有其它几个属性，均可以通过”event: X”的方式予以指定。</p>
<p>标志属性</p>
<pre><code>  u 仅统计用户空间程序触发的性能事件
  k 仅统计内核触发的性能事件，有些根据寄存器计数器获得的数值，无法区分内核态还是用户态产生。
  uk 测量两者的合
  h 仅统计Hypervisor触发的性能事件
  G 在KVM虚拟机中，仅统计Guest系统触发的性能事件
  H 仅统计 Host 系统触发的性能事件
  p 精度级别
</code></pre>
<h3 id="perf-list"><a href="#perf-list" class="headerlink" title="perf list"></a>perf list</h3><p>列出可采集事件(to be used in -e).</p>
<p>常用的集合事件 Metric Groups: <code>perf list metricgroup</code></p>
<h3 id="perf-stat"><a href="#perf-stat" class="headerlink" title="perf stat"></a>perf stat</h3><p>可以列出程序运行的基本分析数据，或者特殊指明事件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> ./bin/pivot <span class="string">&quot;../run/uniformvector-2dim-5h.txt&quot;</span></span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 236.736000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line"></span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;./bin/pivot ../run/uniformvector-2dim-5h.txt&#x27;</span>:</span><br><span class="line"></span><br><span class="line">          7,445.60 msec task-clock                <span class="comment">#   30.814 CPUs utilized</span></span><br><span class="line">               188      context-switches          <span class="comment">#    0.025 K/sec</span></span><br><span class="line">                33      cpu-migrations            <span class="comment">#    0.004 K/sec</span></span><br><span class="line">               678      page-faults               <span class="comment">#    0.091 K/sec</span></span><br><span class="line">    14,181,698,360      cycles                    <span class="comment">#    1.905 GHz                      (75.63%)</span></span><br><span class="line">    46,455,227,542      instructions              <span class="comment">#    3.28  insn per cycle           (74.37%)</span></span><br><span class="line">     2,008,507,493      branches                  <span class="comment">#  269.758 M/sec                    (74.18%)</span></span><br><span class="line">        13,872,537      branch-misses             <span class="comment">#    0.69% of all branches          (75.82%)</span></span><br><span class="line"></span><br><span class="line">       0.241629599 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       7.448593000 seconds user</span><br><span class="line">       0.000000000 seconds sys</span><br></pre></td></tr></table></figure>

<p>Using Metric Groups: <code>perf stat -M Summary,TLB  --metric-only ./exe</code></p>
<p><code>--metric-only</code> will just print calculated metric without raw data.</p>
<h3 id="perf-record"><a href="#perf-record" class="headerlink" title="perf record"></a>perf record</h3><p>Run a command and record its profile into <code>perf.data</code></p>
<p><img src="https://pic.shaojiemike.top/img/20220801160433.png"></p>
<p>must add <code>perf record -g xxx</code> to generate perf report topdown graph</p>
<p>不指定 <code>-e</code> 默认 <code>-e cycles:u</code> 。要统计全部的周期使用 <code>-e cycles:uk</code></p>
<p>注意周期和指令统计的是多核的。选项<code>-a</code>可以指定所有核。</p>
<p>cycles和task-clock基本差不多<br><img src="https://pic.shaojiemike.top/img/20220814160342.png"></p>
<p>在测试时加上 <code>uppp</code> 的p提高精度，防止采样偏移到其他指令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perf record -g -e branch-misses:uppp ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br><span class="line">perf record -g -e task-clock:uppp ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br></pre></td></tr></table></figure>

<p>可以看出分支失败在for循环这里<br><img src="https://pic.shaojiemike.top/img/20220801221232.png"></p>
<p><code>echo 0 &gt; /proc/sys/kernel/kptr_restrict</code> is needed.</p>
<h3 id="perf-report"><a href="#perf-report" class="headerlink" title="perf report"></a>perf report</h3><p>Read <code>perf.data</code> (created by perf record) and display the profile</p>
<p>可交互的命令行。不仅可以显示出汇编和原代码的对应关系，还可以jump自动跳转</p>
<!-- ![](https://pic.shaojiemike.top/img/20220801161146.png) -->

<p><img src="https://pic.shaojiemike.top/img/20230823173138.png"></p>
<h3 id="perf-annotate"><a href="#perf-annotate" class="headerlink" title="perf annotate"></a>perf annotate</h3><ol>
<li>program compiled in <code>-g</code> flag</li>
<li><code>perf annotate</code> can show each line execution cycles percentage</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20230823172840.png"></p>
<h3 id="percentage-at-the-end-of-each-line"><a href="#percentage-at-the-end-of-each-line" class="headerlink" title="percentage at the end of each line"></a>percentage at the end of each line</h3><p>When you select many metric using <code>-e</code> option, but there is limited PMU hardware to use. So perf using <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/33679408/perf-what-do-n-percent-records-mean-in-perf-stat-output">Event multiplexing</a><br>to measure parttime data to estimate the full data. the <code>%</code> is the <code>parttime / fulltime</code></p>
<h3 id="pmc-tools"><a href="#pmc-tools" class="headerlink" title="pmc-tools"></a>pmc-tools</h3><p><a target="_blank" rel="noopener" href="https://github.com/brendangregg/pmc-cloud-tools">pmc-tools</a></p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>Because of perf estimation, when numbers bigger than <code>10^9</code>, the math relationship is more convincible.</p>
<h3 id="Integer-Operations-per-seconds-IntOps"><a href="#Integer-Operations-per-seconds-IntOps" class="headerlink" title="Integer Operations per seconds (IntOps)"></a>Integer Operations per seconds (IntOps)</h3><p>??? failure “No integer-ralated state But float in perf list”</p>
<pre><code>  1. [perf is hard to measure int](https://stackoverflow.com/questions/48811754/are-there-integer-performance-counters-on-current-intel-cpus)
  2. [Check raw hardware event codes (to be used with -rNNN) also difficult choice](https://stackoverflow.com/questions/4335011/measuring-flops-of-an-application-with-the-linux-perf-tool)

  ![](https://pic.shaojiemike.top/shaojiemike/2023/11/9b8be6dd1ae6e1b4a11ba7754a357cc7.png)
</code></pre>
<p>??? warning “Roofline: PMU &amp; Perf”</p>
<pre><code>maybe we should further research Integer PMU events. Or just use VTune

![](https://pic.shaojiemike.top/shaojiemike/2023/11/8fb6589960bc5234207d26bf1a60c263.png)[^1]
</code></pre>
<h3 id="TLB-miss-rate"><a href="#TLB-miss-rate" class="headerlink" title="TLB miss rate"></a>TLB miss rate</h3><p><a target="_blank" rel="noopener" href="https://community.intel.com/t5/Software-Tuning-Performance/Perf-counters-for-measuring-TLB-miss-rate/m-p/1256403">reference</a> inspire me in snode6</p>
<ul>
<li>Total number of memory references ( X ) &#x3D; <code>mem_uops_retired.all_loads</code> + <code>mem_uops_retired.all_stores</code></li>
<li>Total number of memory references that missed in TLB ( Y ) &#x3D; <code>mem_uops_retired.stlb_miss_loads</code> + <code>mem_uops_retired.stlb_miss_stores</code></li>
<li>TLB miss rate &#x3D; Y&#x2F;X</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">perf <span class="built_in">stat</span> \</span><br><span class="line">    -e mem_uops_retired.all_loads \</span><br><span class="line">    -e mem_uops_retired.all_stores \</span><br><span class="line">    -e mem_uops_retired.stlb_miss_loads \</span><br><span class="line">    -e mem_uops_retired.stlb_miss_stores xxx</span><br></pre></td></tr></table></figure>

<p>according to the following experience, <code>mem_uops_retired.stlb_miss_stores</code> is equal to <code>dtlb_store_misses.miss_causes_a_walk</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ perf <span class="built_in">stat</span> -e mem_uops_retired.all_loads -e mem_uops_retired.all_stores -e mem_uops_retired.stlb_miss_loads -e mem_uops_retired.stlb_miss_stores -e dtlb_load_misses.miss_causes_a_walk\</span><br><span class="line">    -e dtlb_store_misses.miss_causes_a_walk \</span><br><span class="line">    -e itlb_misses.miss_causes_a_walk  \</span><br><span class="line">    -e dtlb_load_misses.walk_duration \</span><br><span class="line">    -e dtlb_store_misses.walk_duration \</span><br><span class="line">    -e itlb_misses.walk_duration \</span><br><span class="line">    -e instructions:uk \</span><br><span class="line">    -e cycles:uk ./bigJump.exe 1 10 500</span><br><span class="line">Number <span class="built_in">read</span> from <span class="built_in">command</span> line: 1 10 (N,J should not big, [0,5] is best.)</span><br><span class="line">result 0</span><br><span class="line"> Performance counter stats <span class="keyword">for</span> <span class="string">&#x27;./bigJump.exe 1 10 500&#x27;</span>:</span><br><span class="line"></span><br><span class="line">           3253636      mem_uops_retired.all_loads                                     (41.53%)</span><br><span class="line">         529570049      mem_uops_retired.all_stores                                     (41.62%)</span><br><span class="line">             59111      mem_uops_retired.stlb_miss_loads                                     (41.71%)</span><br><span class="line">         471688964      mem_uops_retired.stlb_miss_stores                                     (33.50%)</span><br><span class="line">            101474      dtlb_load_misses.miss_causes_a_walk                                     (33.56%)</span><br><span class="line">         477591045      dtlb_store_misses.miss_causes_a_walk                                     (33.47%)</span><br><span class="line">             61667      itlb_misses.miss_causes_a_walk                                     (33.37%)</span><br><span class="line">           5591102      dtlb_load_misses.walk_duration                                     (33.28%)</span><br><span class="line">       16489869334      dtlb_store_misses.walk_duration                                     (33.22%)</span><br><span class="line">           2202174      itlb_misses.walk_duration                                     (33.22%)</span><br><span class="line">        3712587926      instructions:uk           <span class="comment">#    0.34  insn per cycle           (41.52%)</span></span><br><span class="line">       10791067051      cycles:uk                                                     (41.52%)</span><br></pre></td></tr></table></figure>

<h3 id="perf测量-page-walk-时间占比"><a href="#perf测量-page-walk-时间占比" class="headerlink" title="perf测量 page walk 时间占比"></a>perf测量 page walk 时间占比</h3><p>脚本如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Intel(R) Xeon(R) CPU E5-2695 v4 @ 2.10GHz</span></span><br><span class="line">USER=<span class="string">&quot;/staff/qcjiang/codes/PIA_workspace&quot;</span></span><br><span class="line">APP=<span class="string">&quot;<span class="variable">$USER</span>/workloads/pagerank/cpp/pagerank <span class="variable">$USER</span>/workloads/pagerank/test/barabasi-100000-pr-p.txt&quot;</span></span><br><span class="line">perf <span class="built_in">stat</span> \</span><br><span class="line">    -e dtlb_load_misses.miss_causes_a_walk\</span><br><span class="line">    -e dtlb_store_misses.miss_causes_a_walk \</span><br><span class="line">    -e itlb_misses.miss_causes_a_walk  \</span><br><span class="line">    -e dtlb_load_misses.walk_duration \</span><br><span class="line">    -e dtlb_store_misses.walk_duration \</span><br><span class="line">    -e itlb_misses.walk_duration \</span><br><span class="line">    -e instructions:uk \</span><br><span class="line">    -e cycles:uk \</span><br><span class="line">    <span class="variable">$APP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dtlb_load_misses.walk_duration</span></span><br><span class="line"><span class="comment"># [Cycles when PMH(Page Miss Handling) is busy with page walks Spec update: BDM69]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Intel(R) Xeon(R) Platinum 8358 CPU @ 2.60GH</span></span><br><span class="line">perf <span class="built_in">stat</span>\</span><br><span class="line">    -e dtlb_load_misses.walk_completed\</span><br><span class="line">    -e dtlb_load_misses.walk_active\</span><br><span class="line">    -e dtlb_store_misses.walk_completed\</span><br><span class="line">    -e dtlb_store_misses.walk_active\</span><br><span class="line">    -e itlb_misses.walk_completed\</span><br><span class="line">    -e itlb_misses.walk_active\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># different perf on hades0 AMD cpu</span></span><br><span class="line"><span class="comment"># AMD do not have the page walk time record</span></span><br><span class="line">perf <span class="built_in">stat</span>\</span><br><span class="line"> -e ls_l1_d_tlb_miss.all\</span><br><span class="line"> -e l1_dtlb_misses\</span><br><span class="line"> -e l2_dtlb_misses\</span><br><span class="line"> -e l2_itlb_misses\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if2m\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if4k\</span><br><span class="line"> -e bp_l1_tlb_miss_l2_tlb_miss.if1g\</span><br><span class="line"> -e ls_tablewalker.dc_type0\</span><br><span class="line"> -e ls_tablewalker.dc_type1\</span><br><span class="line"> -e ls_tablewalker.dside\</span><br><span class="line"> -e ls_tablewalker.ic_type0\</span><br><span class="line"> -e ls_tablewalker.ic_type1\</span><br><span class="line"> -e ls_tablewalker.iside -e instructions:uk -e cycles:uk /staff/shaojiemike/github/DAMOV/workloads/gemm/gemm 2000</span><br></pre></td></tr></table></figure>

<p>统计TLB miss的性能事件可以帮助分析程序是否存在地址翻译方面的性能瓶颈。STLB miss通常表示存储指令无法利用局部性,访问了过多随机地址。优化程序的数据访问模式可以减少TLB miss。</p>
<p><code>-I 100</code> 以100ms为间隔打印数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./investigation/pagewalk/tlbstat -c <span class="string">&#x27;/staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1&#x27;</span></span><br><span class="line"><span class="built_in">command</span> is /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/sssp.inj -f /staff/shaojiemike/github/sniper_PIMProf/PIMProf/gapbs/benchmark/kron-20.wsg -n1</span><br><span class="line">K_CYCLES   K_INSTR      IPC DTLB_WALKS ITLB_WALKS K_DTLBCYC  K_ITLBCYC  DTLB% ITLB%</span><br><span class="line">186001     83244       0.45 753584     63         27841      1          14.97  0.00</span><br><span class="line">229121     89734       0.39 1009100    213        31103      10         13.58  0.00</span><br><span class="line">6233833    3629907     0.58 1227653    316159     45877      8347        0.74  0.13</span><br><span class="line">16579329   8756681     0.53 10860225   524414     264655     15348       1.60  0.09</span><br></pre></td></tr></table></figure>

<ul>
<li>obs1: 前期读取数据部分DTLB大</li>
<li>obs2: cycle数前面是单核，后面是32核。而且读取时与计算时的core动态频率也不同。<ul>
<li>根据<code>lscpu</code>的结果。最高3.3GHz, min 1.2GHz. <code>2*32*33/12 = 176 ~ 165</code>。符合预期。</li>
</ul>
</li>
<li>obs3: 可以不考虑kernel。内核操作（malloc空间）的浮动很大。</li>
</ul>
<h3 id="为什么强调是Retired"><a href="#为什么强调是Retired" class="headerlink" title="为什么强调是Retired"></a>为什么强调是Retired</h3><p>在Intel处理器中,不是所有的存储指令(store uops)都会退休(retire)执行。具体来说,有以下几种情况:</p>
<ol>
<li>存储指令被重排序或规避了,没有真正执行,所以不会退休。</li>
<li>存储指令执行期间遇到异常,被取消了,同样不会退休。</li>
<li>优化后的微操作 fusion 可能会 cancel 掉冗余的存储指令,这些指令也不会退休。</li>
<li>硬件优化会将多个存储指令合并(coalescing)为一个存储指令执行,其它冗余指令不会退休。</li>
</ol>
<p>综上所述,不是所有的存储指令都会 retirement,其中有一部分指令因为各种原因被取消或合并了。</p>
<p>所以这个事件“Retired store uops” 特别强调统计的是执行完整并退休的存储指令。只统计退休的存储指令,可以更准确地反映程序实际进行了存储操作的次数。如果包含被取消的指令,会引入噪声,影响分析结果。</p>
<p>此外,TLB miss只发生在指令真正要执行时,那时已经可以确定指令确实会退休,不会被取消。</p>
<h2 id="进阶应用："><a href="#进阶应用：" class="headerlink" title="进阶应用："></a>进阶应用：</h2><p>改变数据规模好方式，统计该函数花费的cycle，斜率即CPE(cycles per element)</p>
<h3 id="Perf-stat例子-通过CPE估计L1-Cache-latency"><a href="#Perf-stat例子-通过CPE估计L1-Cache-latency" class="headerlink" title="Perf stat例子: 通过CPE估计L1 Cache latency"></a>Perf stat例子: 通过CPE估计L1 Cache latency</h3><p>改变链表的长度n，统计该函数花费的cycle，斜率即CPE(cycles per element)</p>
<p><img src="https://pic.shaojiemike.top/img/20220801155626.png"><br><img src="https://pic.shaojiemike.top/img/20220801155729.png"></p>
<h3 id="Perf-stat例子-通过CPE估计分支预测失败惩罚"><a href="#Perf-stat例子-通过CPE估计分支预测失败惩罚" class="headerlink" title="Perf stat例子: 通过CPE估计分支预测失败惩罚"></a>Perf stat例子: 通过CPE估计分支预测失败惩罚</h3><p><img src="https://pic.shaojiemike.top/img/20220801155711.png"><br><img src="https://pic.shaojiemike.top/img/20220801155913.png"></p>
<h2 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ perf record -g ./bin/pivot <span class="string">&quot;../run/uniformvector-2dim-5h.txt&quot;</span></span><br><span class="line">WARNING: Kernel address maps (/proc/&#123;kallsyms,modules&#125;) are restricted,</span><br><span class="line">check /proc/sys/kernel/kptr_restrict and /proc/sys/kernel/perf_event_paranoid.</span><br><span class="line"></span><br><span class="line">Samples <span class="keyword">in</span> kernel <span class="built_in">functions</span> may not be resolved <span class="keyword">if</span> a suitable vmlinux</span><br><span class="line">file is not found <span class="keyword">in</span> the buildid cache or <span class="keyword">in</span> the vmlinux path.</span><br><span class="line"></span><br><span class="line">Samples <span class="keyword">in</span> kernel modules won<span class="string">&#x27;t be resolved at all.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If some relocation was applied (e.g. kexec) symbols may be misresolved</span></span><br><span class="line"><span class="string">even with a suitable vmlinux or kallsyms file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Couldn&#x27;</span>t record kernel reference relocation symbol</span><br><span class="line">Symbol resolution may be skewed <span class="keyword">if</span> relocation was used (e.g. kexec).</span><br><span class="line">Check /proc/kallsyms permission or run as root.</span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 240.525000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line">[ perf record: Woken up 1 <span class="built_in">times</span> to write data ]</span><br><span class="line">[ perf record: Captured and wrote 2.794 MB perf.data (30470 samples) ]</span><br></pre></td></tr></table></figure>

<p>在不改变 <code>/proc/sys/kernel</code> 的时候</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo perf record ./bin/pivot &quot;../run/uniformvector-2dim-5h.txt&quot;</span><br><span class="line">dim = 2, n = 500, k = 2</span><br><span class="line">Using time : 389.349000 ms</span><br><span class="line">max : 143 351 58880.823709</span><br><span class="line">min : 83 226 21884.924801</span><br><span class="line">[ perf record: Woken up 1 times to write data ]</span><br><span class="line">[ perf record: Captured and wrote 1.909 MB perf.data (49424 samples) ]</span><br></pre></td></tr></table></figure>

<h2 id="超算使用perf分析"><a href="#超算使用perf分析" class="headerlink" title="超算使用perf分析"></a>超算使用perf分析</h2><p>有时候由于架构不同超算不能使用vtune，</p>
<h3 id="srun"><a href="#srun" class="headerlink" title="srun"></a>srun</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -p IPCC -N 1 -n 1 -c 64 -t 1  perf record -g ../build/bin/pivot uniformvector-4dim-1h.txt</span><br></pre></td></tr></table></figure>

<p>没有生成perf.data文件。终端末尾输出一堆乱码，不懂（后面知道了乱码是因为没有指定 <code>-o</code> 输出，默认竟然输出到命令行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srun -p IPCC -N 1 -n 1 -c 64 -t 1  /usr/bin/bash</span><br></pre></td></tr></table></figure>

<p>申请bash然后运行一样结果</p>
<h3 id="salloc"><a href="#salloc" class="headerlink" title="salloc"></a>salloc</h3><p>这样可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/github/MarchZnver1/IPCC2022-preliminary/run (main*) [07:38:46]           </span><br><span class="line">&gt; salloc -p IPCC -N 1 -t 10:00                                            </span><br><span class="line">salloc: Granted job allocation 2175282                                       </span><br><span class="line">salloc: Waiting for resource configuration                                         </span><br><span class="line">salloc: Nodes fb0101 are ready for job                                     </span><br><span class="line">bash-4.2$ ls                                                             </span><br><span class="line">check.py  manual.log  refer-2dim-5h.txt  refer-4dim-1h.txt  result.txt  run.2022-08-10.log  run_case1.sh  run-ipcc-mpi.sh  run-ipcc.sh  run-mpi.sh  run.sh  uniformvector-2dim-5h.txt  uniformvector-4dim-1h.txt   </span><br><span class="line">bash-4.2$ perf record -g ../build/bin/pivot uniformvector-4dim-1h.txt</span><br></pre></td></tr></table></figure>

<p>但实际在登录节点跑的，有ssh不上去</p>
<h3 id="sbatch"><a href="#sbatch" class="headerlink" title="sbatch"></a>sbatch</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#SBATCH -p IPCC</span><br><span class="line">#SBATCH -t 3:00</span><br><span class="line">#SBATCH --nodes=1</span><br><span class="line">#SBATCH --exclude=</span><br><span class="line">#SBATCH --cpus-per-task=64</span><br><span class="line">#SBATCH --mail-type=FAIL</span><br><span class="line">#SBATCH --mail-user=ta1ly@mail.ustc.edu.cn</span><br><span class="line"></span><br><span class="line">source /public1/soft/modules/module.sh</span><br><span class="line">module purge</span><br><span class="line"></span><br><span class="line">module load gcc/8.1.0</span><br><span class="line">module load mpich/3.1.4-gcc8.1.0</span><br><span class="line"></span><br><span class="line">logname=vtune</span><br><span class="line">export OMP_PROC_BIND=close; export OMP_PLACES=cores</span><br><span class="line">perf record -g -e task-clock:uppp /public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/uniformvector-4dim-1h.txt |tee ./$logname</span><br></pre></td></tr></table></figure>

<p>返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ipcc22_0029@ln121 ~/slurm  [11:18:06]</span><br><span class="line">&gt; cat slurm-2180072.out </span><br><span class="line">Error:</span><br><span class="line">task-clock:uppp: PMU Hardware doesn&#x27;t support sampling/overflow-interrupts. Try &#x27;perf stat&#x27;</span><br></pre></td></tr></table></figure>

<p>修改指令为 <code>perf record -g -o perfData -e task-clock:upp</code> 支持 <code>pp</code></p>
<h3 id="分析CVT"><a href="#分析CVT" class="headerlink" title="分析CVT"></a>分析CVT</h3><p><img src="https://pic.shaojiemike.top/img/20220814155514.png"></p>
<p>感觉寄存器才用到10，还可以展开一次。</p>
<h3 id="分析CVT变sub"><a href="#分析CVT变sub" class="headerlink" title="分析CVT变sub"></a>分析CVT变sub</h3><p><img src="https://pic.shaojiemike.top/img/20220814164135.png"></p>
<p>为了形成add流水，编译器把sub都改成add了。</p>
<p><code>vmovaps      0xf98(%rip),%ymm9        # 81a0 &lt;blockSize+0x20&gt; </code> 应该是从静态变量里读的。</p>
<h3 id="分析再展开一次float"><a href="#分析再展开一次float" class="headerlink" title="分析再展开一次float"></a>分析再展开一次float</h3><p><img src="https://pic.shaojiemike.top/img/20220814171830.png"></p>
<p><img src="https://pic.shaojiemike.top/img/5abb94364cd2a094b030879b154a880.jpg"><br>结果已经不对了，而且也没快(还是和资源流水有关吧，寄存器也吃紧了，sub都没在一起)</p>
<p>但是说明 <code>unroll_SumDistance(j)</code> 这种写法是能在汇编层面实现展开的</p>
<h3 id="对比分析再展开一次double"><a href="#对比分析再展开一次double" class="headerlink" title="对比分析再展开一次double"></a>对比分析再展开一次double</h3><p>由于寄存器更加紧张，load都不能再一起， <code>ymm9</code> 寄存器不够。<br><img src="https://pic.shaojiemike.top/img/20220817193944.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220817194451.png"><br>第一条红色的vadd感觉可以放下来。可能add和sub是公用同一个流水？</p>
<h3 id="perf-stat-1"><a href="#perf-stat-1" class="headerlink" title="perf stat"></a>perf stat</h3><p>单节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#x27;/public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/case2/uniformvector-4dim-1h.txt&#x27;:</span><br><span class="line"></span><br><span class="line">        73,637.63 msec task-clock:u              #   54.327 CPUs utilized          </span><br><span class="line">                0      context-switches:u        #    0.000 K/sec                  </span><br><span class="line">                0      cpu-migrations:u          #    0.000 K/sec                  </span><br><span class="line">            9,433      page-faults:u             #    0.128 K/sec                  </span><br><span class="line">  192,614,020,152      cycles:u                  #    2.616 GHz                      (83.34%)</span><br><span class="line">    4,530,181,367      stalled-cycles-frontend:u #    2.35% frontend cycles idle     (83.32%)</span><br><span class="line">   25,154,915,770      stalled-cycles-backend:u  #   13.06% backend cycles idle      (83.33%)</span><br><span class="line">  698,720,546,628      instructions:u            #    3.63  insn per cycle         </span><br><span class="line">                                                 #    0.04  stalled cycles per insn  (83.34%)</span><br><span class="line">   27,780,261,977      branches:u                #  377.256 M/sec                    (83.33%)</span><br><span class="line">       11,900,773      branch-misses:u           #    0.04% of all branches          (83.33%)</span><br><span class="line"></span><br><span class="line">      1.355446229 seconds time elapsed</span><br><span class="line"></span><br><span class="line">     73.465281000 seconds user</span><br><span class="line">      0.181156000 seconds sys</span><br></pre></td></tr></table></figure>

<p>两个节点的perf数据感觉有问题， <code>perf record</code> 结果也很奇怪<br><img src="https://pic.shaojiemike.top/img/20220814160918.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Performance counter stats for &#x27;mpirun -n 2 /public1/home/ipcc22_0029/shaojiemike/github/IPCC2022-preliminary/build/bin/pivot /public1/home/ipcc22_0029/shaojiemike/slurm/case2/uniformvector-4dim-1h.txt&#x27;:</span><br><span class="line"></span><br><span class="line">             51.37 msec task-clock:u              #    0.060 CPUs utilized          </span><br><span class="line">                 0      context-switches:u        #    0.000 K/sec                  </span><br><span class="line">                 0      cpu-migrations:u          #    0.000 K/sec                  </span><br><span class="line">             2,278      page-faults:u             #    0.044 M/sec                  </span><br><span class="line">        39,972,793      cycles:u                  #    0.778 GHz                      (84.56%)</span><br><span class="line">         2,747,434      stalled-cycles-frontend:u #    6.87% frontend cycles idle     (85.16%)</span><br><span class="line">        10,620,259      stalled-cycles-backend:u  #   26.57% backend cycles idle      (88.39%)</span><br><span class="line">        58,479,982      instructions:u            #    1.46  insn per cycle         </span><br><span class="line">                                                  #    0.18  stalled cycles per insn  (89.18%)</span><br><span class="line">        14,068,620      branches:u                #  273.884 M/sec                    (77.31%)</span><br><span class="line">           365,530      branch-misses:u           #    2.60% of all branches          (75.40%)</span><br><span class="line"></span><br><span class="line">       0.850258803 seconds time elapsed</span><br><span class="line"></span><br><span class="line">       0.015115000 seconds user</span><br><span class="line">       0.038139000 seconds sys</span><br></pre></td></tr></table></figure>

<h3 id="具体分析例子"><a href="#具体分析例子" class="headerlink" title="具体分析例子"></a>具体分析例子</h3><p>对于精心展开的手动向量化代码(理应用满了avx2的16个YMM*寄存器)</p>
<p>但是 <code>-march=znver1</code> 还是有1&#x2F;3的加速。</p>
<p><img src="https://pic.shaojiemike.top/img/20220810205433.png"></p>
<p>可以发现变快的代码几点区别（可能和相同类型指令在一起执行，没什么关系）</p>
<ol>
<li>load的形式变了，没有采用了<code>insertf128</code>。(0.71 下降到 0.06)</li>
<li>load的次数变少了(vmaxpd 地址元素实现，减少指令数)</li>
<li>指令没有被拆分的那么散，更紧凑了。</li>
</ol>
<p>下面是核心展开两次的代码：<br><img src="https://pic.shaojiemike.top/img/20220810211341.png"><br>快速的代码</p>
<ol>
<li>load统一load快？而且在循环外围load，，无需load(vmax地址元素实现)</li>
<li>从sub指令可以看出，是编译器是很想一起load，但是只有16个.（ymm0是总和，ymm9是掩码</li>
</ol>
<p>综合来看<strong>指令数减少</strong>了许多(看截图，快的36条指令， 慢的54条指令)。性能瓶颈在<strong>指令退休</strong>？？<br><img src="https://pic.shaojiemike.top/img/20220810212911.png"><br>可以perf stat来验证<br><img src="https://pic.shaojiemike.top/img/20220811110002.png"><br>可以看出IPC基本没变。<br><img src="https://pic.shaojiemike.top/img/20220811110153.png"></p>
<p>这样就可以解释为什么数据重用加上 <code>-march=znver1</code> 变快了，但是原本的没变快。因为数据重用多了n*n的许多的数据读取，然后该选项合并消减了许多指令(直接隐含到vmaxpd里了)，所以有加速。但是原本的实现基本没有数据读取，自然没得优化，所以基本没加速。</p>
<h2 id="机器的IPC影响因素"><a href="#机器的IPC影响因素" class="headerlink" title="机器的IPC影响因素"></a>机器的IPC影响因素</h2><p>可以看出优化了有些许变化，主要原因是不同指令的Throughput不同(每个周期能执行的指令数)。</p>
<p><img src="https://pic.shaojiemike.top/img/20220812074940.png"><br>核数竟然就是 <code>userTime/elapsedTime</code> 这也太粗暴了吧。</p>
<p>运行不同的例子，执行的程序内代码的权重和类型不同，IPC有所不同。(小例子有400&#x2F;600的时间都在MPI_Init, 自然IPC会低一些)</p>
<p><img src="https://pic.shaojiemike.top/img/20220812080417.png"></p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="限制选项"><a href="#限制选项" class="headerlink" title="限制选项"></a>限制选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">perf_event_paranoid setting is 4:</span><br><span class="line">  -1: Allow use of (almost) all events by all <span class="built_in">users</span></span><br><span class="line">      Ignore mlock <span class="built_in">limit</span> after perf_event_mlock_kb without CAP_IPC_LOCK</span><br><span class="line">&gt;= 0: Disallow raw and ftrace <span class="keyword">function</span> tracepoint access</span><br><span class="line">&gt;= 1: Disallow CPU event access</span><br><span class="line">&gt;= 2: Disallow kernel profiling</span><br></pre></td></tr></table></figure>

<p>编辑 <code>/etc/sysctl.conf</code> 文件，加入<br><code>kernel.perf_event_paranoid = -1</code><br>保存文件并退出。然后，你可以通过重新加载 sysctl 配置来使设置生效：<br><code>sudo sysctl -p</code></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>实验室同学袁福焱组会汇报</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141694060">https://zhuanlan.zhihu.com/p/141694060</a></p>
<p>[^1]: <a target="_blank" rel="noopener" href="https://people.inf.ethz.ch/markusp/teaching/263-2300-ETH-spring14/slides/08-perfcounters.pdf">Performance Counters and applying the Roofline Model</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-21T16:00:00.000Z" title="8/21/2023, 4:00:00 PM">2023-08-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.925Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 488 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/21/Work/software/manager/git/git-data-code-separate/">Git Submodule: Data &amp; Code Repository Separate</a></p><div class="content"><h2 id="Just-follow-my-mind"><a href="#Just-follow-my-mind" class="headerlink" title="Just follow my mind"></a>Just follow my mind</h2><ol>
<li>parent repository ignore the sub directory in <code>.gitignore</code></li>
<li>Normal git usage in child repository, eg. <code>init commit push</code></li>
<li>submodule for what?<ol>
<li>for auto upload and init multi-subgit to target git commit</li>
</ol>
</li>
</ol>
<h2 id="submodule"><a href="#submodule" class="headerlink" title="submodule"></a>submodule</h2><p>submodule is <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87053283">hard to use</a> when it will be blocked under big sub-srepository.</p>
<p>I recommend to use <code>.gitignore</code> or just use <code>ln -s xxx yyy</code></p>
<h2 id="chatgpt-balabala"><a href="#chatgpt-balabala" class="headerlink" title="chatgpt balabala"></a>chatgpt balabala</h2><p>Adding a Git repository inside another Git repository, often referred to as a “submodule,” is a way to manage a separate repository as a part of your main project. This is particularly useful when you want to include another project within your project and keep them separate.</p>
<p>Here’s how you can add a submodule and set up <code>.gitignore</code> for the outer repository:</p>
<ol>
<li><p><strong>Add a Submodule</strong>:</p>
<p> Navigate to the root of your outer Git repository and run the following command:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add &lt;repository_url&gt; &lt;submodule_path&gt;</span><br></pre></td></tr></table></figure>

<p> Replace <code>&lt;repository_url&gt;</code> with the URL of the repository you want to add as a submodule, and <code>&lt;submodule_path&gt;</code> with the relative path within your outer repository where you want to place the submodule.</p>
</li>
<li><p><strong>Update and Initialize Submodule</strong>:</p>
<p> After adding the submodule, you need to update and initialize it:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git submodule update --init --recursive</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> This command fetches the submodule’s content and initializes it.</p>
</li>
<li><p><strong>Set Up <code>.gitignore</code></strong>:</p>
<p> To ignore the submodule’s content and avoid committing it to the outer repository, you need to add the submodule path to the <code>.gitignore</code> file of the outer repository. For example, if your submodule is located in a directory called “submodule_folder,” add the following line to the <code>.gitignore</code> file:</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">submodule_folder/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Working with Submodules</strong>:</p>
<p> When you clone the outer repository on another system or share it with others, they will need to run <code>git submodule update --init --recursive</code> to fetch and initialize the submodule’s content.</p>
<p> To make changes to the submodule, navigate into the submodule directory and work as you would in a regular Git repository. When you commit changes in the submodule, you will need to push them to its remote repository. After that, commit the updated submodule reference in the outer repository.</p>
<p> To update the submodule to the latest version available, you can navigate into the submodule directory and run <code>git pull origin master</code> (or the appropriate branch) to update its content. Then, commit the updated reference in the outer repository.</p>
</li>
</ol>
<p>Remember that submodules have their own independent version control, so you need to manage them separately. Submodules provide a way to incorporate external projects into your main project while keeping their development and versioning separate.</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-20T16:00:00.000Z" title="8/20/2023, 4:00:00 PM">2023-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.921Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">3 minutes read (About 387 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/20/Work/software/linux/LinuxCommand/">LinuxCommand: system info</a></p><div class="content"><h2 id="硬盘-挂载空间"><a href="#硬盘-挂载空间" class="headerlink" title="硬盘&#x2F;挂载空间"></a>硬盘&#x2F;挂载空间</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df -h .</span><br></pre></td></tr></table></figure>

<h2 id="各个文件夹空间"><a href="#各个文件夹空间" class="headerlink" title="各个文件夹空间"></a>各个文件夹空间</h2><p>deep为1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">du -h -d .</span><br></pre></td></tr></table></figure>

<h2 id="进程查看与kill"><a href="#进程查看与kill" class="headerlink" title="进程查看与kill"></a>进程查看与kill</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># thi</span></span><br><span class="line">ps aux | grep 1499321</span><br><span class="line">ps -auxf | grep -nB 10 -E <span class="string">&#x27;python[3]?|PID&#x27;</span></span><br><span class="line"><span class="built_in">kill</span> -9 </span><br></pre></td></tr></table></figure>

<p>ps aux linux command whill show no zero cpu usage when the process is sleeping beacuse of its <a target="_blank" rel="noopener" href="https://superuser.com/questions/117913/ps-aux-output-meaning">snapshots mechanism</a></p>
<h2 id="apt-get-problems"><a href="#apt-get-problems" class="headerlink" title="apt-get problems"></a>apt-get problems</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dpkg: 处理归档 /var/cache/apt/archives/bat_0.12.1-1build1_arm64.deb (--unpack)时出错：</span><br><span class="line"> 正试图覆盖 /usr/.crates2.json，它同时被包含于软件包 ripgrep 11.0.2-1build1</span><br><span class="line">dpkg-deb: 错误: 粘贴 子进程被信号(断开的管道) 终止了</span><br><span class="line">在处理时有错误发生：</span><br><span class="line"> /var/cache/apt/archives/bat_0.12.1-1build1_arm64.deb</span><br><span class="line">E: Sub-process /usr/bin/dpkg returned an error code (1)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get purge -h</span><br><span class="line"><span class="comment"># jsonfile conflict purge - Remove packages and config files</span></span><br></pre></td></tr></table></figure>

<h2 id="tree"><a href="#tree" class="headerlink" title="tree"></a>tree</h2><h3 id="deep-size"><a href="#deep-size" class="headerlink" title="deep size"></a>deep size</h3><p>tree -L DepthSIze Folder_Path</p>
<h2 id="so文件分析"><a href="#so文件分析" class="headerlink" title="so文件分析"></a>so文件分析</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分析symbols </span></span><br><span class="line">nm -gDC intel64/gcc4.8/*</span><br></pre></td></tr></table></figure>

<ul>
<li>-g：显示全局符号表。</li>
<li>-D：显示动态符号表。</li>
<li>-C：将 C++ 符号名还原成源代码中的名称。</li>
</ul>
<p>综合来看，使用 <code>nm -gDC &lt;filename&gt;</code> 命令可以查看一个二进制可执行文件或者共享库中的全局符号表和动态符号表，并将包含其中的 C++ 符号名还原成源代码中的名称。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shaojiemike@snode6 ~/github/gem5  [10:49:56]</span><br><span class="line">&gt; nm /usr/local/lib/libprotobuf.a |c++filt|grep google::protobuf::MessageFactory::InternalRegisterGeneratedFile</span><br><span class="line">                 U google::protobuf::MessageFactory::InternalRegisterGeneratedFile(char const*, void (*)(std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;))</span><br><span class="line">0000000000000e00 T google::protobuf::MessageFactory::InternalRegisterGeneratedFile(char const*, void (*)(std::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; const&amp;))</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析子so</span></span><br><span class="line">ldd .so</span><br></pre></td></tr></table></figure>

<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-20T16:00:00.000Z" title="8/20/2023, 4:00:00 PM">2023-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.921Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a few seconds read (About 105 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/20/Work/software/linux/linuxCMDquickActions/">Linux CMD:quick actions</a></p><div class="content"><h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p>more in <a target="_blank" rel="noopener" href="https://linuxhandbook.com/find-exec-command/">blog</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -<span class="built_in">type</span> f -size +10M -<span class="built_in">exec</span> <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>&#123;&#125;</code> is a placeholder that is used to hold results given by the find command. </li>
<li><code>\;</code> says that for each found result, the [command] is executed</li>
</ol>
<h2 id="sed-awk"><a href="#sed-awk" class="headerlink" title="sed , awk"></a>sed , awk</h2><h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-20T16:00:00.000Z" title="8/20/2023, 4:00:00 PM">2023-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.913Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">20 minutes read (About 3055 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/20/Work/Programming/4-compile/construction%20tool/make/">Make</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>make 和 makefile 是 Linux 系统下 C&#x2F;C++ 工程的编译工具，它们用来自动化配置实验环境，编译项目文件。makefile 文件描述了项目<strong>文件之间的依赖关系和编译规则</strong>，make 命令根据 makefile 文件的内容执行编译任务123。相对于 cmake 等其他的编译工具，make 和 makefile 有以下几个特点：</p>
<ul>
<li>make 和 makefile 是 GNU 的标准工具，可以在多种平台上使用。</li>
<li>make 和 makefile 可以根据文件时间戳自动发现更新过的文件而减少编译的工作量。</li>
<li>make 和 makefile 可以灵活地定义变量、函数和条件判断等，实现复杂的编译逻辑</li>
</ul>
<p>对于复杂的项目，能通过makefile文件将</p>
<ul>
<li>实验环境Build，(提前设置相关路径参数)<ul>
<li>wget&#x2F;git 下载相关文件到对应目录</li>
<li>apt install</li>
</ul>
</li>
<li>样例测试test，</li>
<li>整体运行&#x2F;Benchmark运行run,</li>
<li>环境清理clean 统一起来</li>
</ul>
<h2 id="Makefile-执行流程"><a href="#Makefile-执行流程" class="headerlink" title="Makefile 执行流程"></a>Makefile 执行流程</h2><ul>
<li>make的默认目标是makefile中的第一个目标，而其它目标一般是由这个目标连带出来的。</li>
</ul>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不实际运行，但是打印会运行的命令</span></span><br><span class="line">make -f makefile.llvm -n</span><br><span class="line"><span class="comment"># -W 假设某个文件是最新的，不需要重新编译。常见结合 -n 使用</span></span><br><span class="line">make inj -f makefile.llvm -n -W svm.inj</span><br></pre></td></tr></table></figure>

<p>打印debug信息，makefile如何选择决策</p>
<ul>
<li><code>--debug=v</code> 输出的信息包括哪个makefile被解析，不需要被重编译的依赖文件（或是依赖目标）等。</li>
<li><code>--debug=i</code> implicit，输出使用的隐含规则过程。</li>
<li><code>--debug=m</code> 输出make读取makefile，更新makefile，执行makefile的信息。</li>
</ul>
<h2 id="Makefile-隐含规则"><a href="#Makefile-隐含规则" class="headerlink" title="Makefile 隐含规则"></a>Makefile 隐含规则</h2><ul>
<li>“隐含规则”也就是一种惯例，make会按照这种“惯例”心照不喧地来运行，那怕我们的Makefile中没有书写这样的规则。<ul>
<li>例如，把[.c]文件编译成[.o]文件这一规则，你根本就不用写出来，make会自动推导出这种规则，并生成我们需要的[.o]文件。</li>
<li>将头文件变成<code>.gch</code> <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1475342/problem-with-makefile-making-gch-files-instead-of-o-files">precompiled headers</a></li>
</ul>
</li>
<li>许多的隐含规则都是使用了“后缀规则”来定义的<ul>
<li>变量<code>.SUFFIXES</code>存储了默认的依赖目标，可以修改。默认的后缀列表是：<code>.out,.a, .ln, .o, .c, .cc, .C, .p, .f, .F, .r, .y, .l, .s, .S, .mod, .sym, .def, .h, .info, .dvi, .tex, .texinfo, .texi, .txinfo, .w, .ch .web, .sh, .elc, .el</code></li>
<li>要让make知道一些特定的后缀，我们可以使用伪目标”.SUFFIXES”来定义或是删除，如：</li>
</ul>
</li>
</ul>
<ol>
<li>把后缀.hack和.win加入后缀列表中的末尾。</li>
</ol>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">SUFFIXES: .hack .win</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>先删除默认后缀，后定义自己的后缀列表。</li>
</ol>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.SUFFIXES: # 删除默认的后缀</span></span><br><span class="line"><span class="section">.SUFFIXES: .c .o .h # 定义自己的后缀</span></span><br></pre></td></tr></table></figure>

<h3 id="模式规则"><a href="#模式规则" class="headerlink" title="模式规则"></a>模式规则</h3><ul>
<li>常见使用模式规则来定义一个隐含规则</li>
<li>至少在规则的目标定义中要包含”%”</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%.o : %.c ; &lt;command ......&gt;</span><br></pre></td></tr></table></figure>

<h3 id="老式风格的”后缀规则”"><a href="#老式风格的”后缀规则”" class="headerlink" title="老式风格的”后缀规则”"></a>老式风格的”后缀规则”</h3><ul>
<li>后缀规则是一个比较老式的定义隐含规则的方法。<ul>
<li>后缀规则会被模式规则逐步地取代。因为模式规则更强更清晰。为了和老版本的Makefile兼容，GNU make同样兼容于这些东西。</li>
</ul>
</li>
<li>后缀规则有两种方式：”双后缀”和”单后缀”。<ul>
<li>双后缀规则定义了一对后缀：目标文件的后缀和依赖目标（源文件）的后缀。如”.c.o”相当于”%o : %c”。</li>
<li>单后缀规则只定义一个后缀，也就是源文件的后缀。如”.c”相当于”% : %.c”。</li>
</ul>
</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.cpp.o:</span></span><br><span class="line">  <span class="variable">$(CPPCOMPILE)</span> -c <span class="variable">$(COMPILEOPTION)</span> <span class="variable">$(INCLUDEDIR)</span> <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="section">.c.o:</span></span><br><span class="line"> <span class="variable">$(CCOMPILE)</span> -c <span class="variable">$(COMPILEOPTION)</span> <span class="variable">$(INCLUDEDIR)</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Makefile编写技巧"><a href="#Makefile编写技巧" class="headerlink" title="Makefile编写技巧"></a>Makefile编写技巧</h2><h3 id="Makefile框架"><a href="#Makefile框架" class="headerlink" title="Makefile框架"></a>Makefile框架</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SIM_ROOT ?= <span class="variable">$(<span class="built_in">shell</span> readlink -f &quot;<span class="variable">$(CURDIR)</span>&quot;)</span> <span class="comment">#当前工作目录的绝对路径。</span></span><br><span class="line">CLEAN=<span class="variable">$(<span class="built_in">findstring</span> clean,<span class="variable">$(MAKECMDGOALS)</span>)</span> <span class="comment">#？？？</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> common/Makefile.common</span><br><span class="line"></span><br><span class="line"><span class="variable">$(STANDALONE)</span>: <span class="variable">$(LIB_CARBON)</span> <span class="variable">$(LIB_SIFT)</span> <span class="variable">$(LIB_DECODER)</span></span><br><span class="line"> @<span class="variable">$(MAKE)</span> <span class="variable">$(MAKE_QUIET)</span> -C <span class="variable">$(SIM_ROOT)</span>/standalone <span class="comment">#进入standalone目录，执行Makefile文件</span></span><br></pre></td></tr></table></figure>

<p>Makefile.common文件中的内容如下：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="variable">$(SIM_ROOT)</span>/Makefile.config</span><br><span class="line"></span><br><span class="line">DIRECTORIES := $&#123;shell find <span class="variable">$(SIM_ROOT)</span>/common -type d -print&#125; <span class="comment">#查找common目录下的所有子目录</span></span><br><span class="line">LIBCARBON_SOURCES = <span class="variable">$(<span class="built_in">foreach</span> <span class="built_in">dir</span>,<span class="variable">$(DIRECTORIES)</span>,$(<span class="built_in">wildcard</span> <span class="variable">$(dir)</span>/*.cc)</span>) \</span><br><span class="line"> <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(SIM_ROOT)</span>/common/config/*.cpp)</span> <span class="comment"># 把变量DIRECTORIES中的每个目录下的所有.cc文件和$(SIM_ROOT)/common/config目录下的所有.cpp文件赋值给变量LIBCARBON_SOURCES</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FLAGS</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(SNIPER_TARGET_ARCH)</span>,ia32)</span><br><span class="line">  <span class="comment"># Add -march=i686 to enable some extra instructions that allow for implementation of 64-bit atomic adds</span></span><br><span class="line">  CXXFLAGS += -m32 -march=i686 -DTARGET_IA32 <span class="comment"># Include paths</span></span><br><span class="line">  LD_FLAGS += -m32</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(SNIPER_TARGET_ARCH)</span>,intel64)</span><br><span class="line">  CXXFLAGS += -fPIC -DTARGET_INTEL64</span><br><span class="line">  LD_FLAGS +=</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build rules for dependency generation</span></span><br><span class="line"><span class="section">%.d: %.cpp</span></span><br><span class="line"> <span class="variable">$(_MSG)</span> &#x27;[DEP   ]&#x27; <span class="variable">$(<span class="built_in">subst</span> $(<span class="built_in">shell</span> readlink -f <span class="variable">$(SIM_ROOT)</span>)</span>/,,<span class="variable">$(<span class="built_in">shell</span> readlink -f <span class="variable">$@</span>)</span>) <span class="comment">#把$@的绝对路径中的$(SIM_ROOT)的绝对路径部分替换为空字符串，便于打印</span></span><br><span class="line"> <span class="variable">$(_CMD)</span> <span class="variable">$(CXX)</span> -MM -MG <span class="variable">$(CPPFLAGS)</span> <span class="variable">$(CXXFLAGS)</span> <span class="variable">$&lt;</span> | sed -n <span class="string">&quot;H;$$ &#123;g;s@.*:\(.*\)@<span class="variable">$*</span>.o <span class="variable">$@</span>: \$$\(wildcard\1\)@;p&#125;&quot;</span> &gt;<span class="variable">$@</span></span><br><span class="line"> <span class="comment"># 用$(CXX)编译器对$&lt;文件进行依赖分析，并把结果通过sed命令进行处理，然后输出到$@文件</span></span><br></pre></td></tr></table></figure>

<p>Makefile.config 如下</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 架构判断</span></span><br><span class="line">ARCH_QUERY=<span class="variable">$(<span class="built_in">shell</span> uname -m)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(ARCH_QUERY)</span>,i686)</span><br><span class="line">SNIPER_TARGET_ARCH = ia32</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(ARCH_QUERY)</span>,x86_64)</span><br><span class="line">SNIPER_TARGET_ARCH ?= intel64</span><br><span class="line"><span class="comment">#SNIPER_TARGET_ARCH = ia32</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$(<span class="built_in">error</span> Unknown target arch: <span class="variable">$(ARCH_QUERY)</span>)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局的路径</span></span><br><span class="line">PIN_HOME ?= xxx</span><br><span class="line">PIN_ROOT := <span class="variable">$(PIN_HOME)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译器</span></span><br><span class="line">CC ?= gcc</span><br><span class="line">CXX ?= g++</span><br><span class="line"></span><br><span class="line"><span class="comment"># DEBUG输出</span></span><br><span class="line"><span class="keyword">ifneq</span> (<span class="variable">$(DEBUG_SHOW_COMPILE)</span>,)  <span class="comment"># 如果变量DEBUG_SHOW_COMPILE不为空，如make DEBUG_SHOW_COMPILE=1 使用</span></span><br><span class="line">  SHOW_COMPILE=1</span><br><span class="line">  MAKE_QUIET=     <span class="comment"># 使用情形：$(MAKE) $(MAKE_QUIET) -C pin clean</span></span><br><span class="line">  _MSG=@echo &gt;/dev/null   <span class="comment"># 使用情形：$(_MSG) &#x27;[CLEAN ] pin&#x27;</span></span><br><span class="line">  _CMD=       <span class="comment"># 使用情形：$(_CMD) git clone --quiet xxx</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  SHOW_COMPILE=</span><br><span class="line">  MAKE_QUIET=--quiet</span><br><span class="line">  _MSG=@echo</span><br><span class="line">  _CMD=@</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p>打印make的详细信息<code>make DEBUG_SHOW_COMPILE=1 DEBUG=1 -j 16|tee make.log |my_hl</code></p>
<h3 id="打印make时每项依赖文件的情况"><a href="#打印make时每项依赖文件的情况" class="headerlink" title="打印make时每项依赖文件的情况"></a>打印make时每项依赖文件的情况</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sums up number of passes and fails</span></span><br><span class="line"><span class="comment"># cut 命令用于从文件的每一行剪切字节、字符和字段并将这些字节、字符和字段写至标准输出。其中 -d (--delimiter)参数指定分隔符(默认TAB)，-f （--fields）参数指定要显示的字段。因此，cut -d\  -f 2 的意思是以空格为分隔符，显示第二个字段。</span></span><br><span class="line"><span class="comment"># uniq -c 统计不重复词(PASS\|FAIL)的出现</span></span><br><span class="line"><span class="section">test-score: test-all</span></span><br><span class="line"> @<span class="variable">$(MAKE)</span> test-all | cut -d\  -f 2 | grep &#x27;PASS\|FAIL&#x27; | sort | uniq -c</span><br><span class="line"></span><br><span class="line"><span class="comment"># Result output strings</span></span><br><span class="line">PASS = \033[92mPASS\033[0m</span><br><span class="line">FAIL = \033[91mFAIL\033[0m</span><br><span class="line"></span><br><span class="line"><span class="comment"># Need to be able to build kernels, if this fails rest not run</span></span><br><span class="line"><span class="section">test-build: all</span></span><br><span class="line"> @echo <span class="string">&quot; <span class="variable">$(PASS)</span> Build&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现在Makefile里下载"><a href="#实现在Makefile里下载" class="headerlink" title="实现在Makefile里下载"></a>实现在Makefile里下载</h3><p>根据是否存在文件来执行makefile语句</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ROAD_URL = http://www.dis.uniroma1.it/challenge9/data/USA-road-d/USA-road-d.USA.gr.gz</span><br><span class="line"><span class="variable">$(RAW_GRAPH_DIR)</span>/USA-road-d.USA.gr.gz:</span><br><span class="line"> wget -P <span class="variable">$(RAW_GRAPH_DIR)</span> <span class="variable">$(ROAD_URL)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(RAW_GRAPH_DIR)</span>/USA-road-d.USA.gr: <span class="variable">$(RAW_GRAPH_DIR)</span>/USA-road-d.USA.gr.gz</span><br><span class="line"> cd <span class="variable">$(RAW_GRAPH_DIR)</span></span><br><span class="line"> gunzip &lt; <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(GRAPH_DIR)</span>/road.sg: <span class="variable">$(RAW_GRAPH_DIR)</span>/USA-road-d.USA.gr converter</span><br><span class="line"> ./converter -f <span class="variable">$&lt;</span> -b <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<h2 id="目录下所有源文件编译成单独的可执行文件"><a href="#目录下所有源文件编译成单独的可执行文件" class="headerlink" title="目录下所有源文件编译成单独的可执行文件"></a>目录下所有源文件编译成单独的可执行文件</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#before run, mkdir build &amp;&amp; cd build</span></span><br><span class="line"> </span><br><span class="line">CFLAGS = -g -O0</span><br><span class="line"> </span><br><span class="line"><span class="comment">#source files dir</span></span><br><span class="line">SRC_DIR = ../</span><br><span class="line"><span class="comment">#Makefile dir, generally build</span></span><br><span class="line">BUILD_DIR = ./</span><br><span class="line"> </span><br><span class="line"><span class="comment">#get ../example.c 不能寻找子文件夹的文件，需要shell find</span></span><br><span class="line">SRCS = <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(SRC_DIR)</span>*.c)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#delete .c, then become ../example</span></span><br><span class="line"><span class="comment"># :.c = .o的意思是C文件對應相應的.o文件</span></span><br><span class="line">FILENAME = $(SRCS:.c=)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#replace src dir with dest dir, then become ./example</span></span><br><span class="line">PROGS = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(BUILD_DIR)</span>,$(<span class="built_in">notdir</span> <span class="variable">$(FILENAME)</span>)</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: all</span></span><br><span class="line"><span class="section">all: <span class="variable">$(PROGS)</span></span></span><br><span class="line">    @echo <span class="string">&quot;-- build all .c files&quot;</span> <span class="comment"># makefile中命令前加一个@的作用是不让make显示出要执行的命令</span></span><br><span class="line"> @echo Building for x86 architecture <span class="comment"># echo 无需“”</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$(BUILD_DIR)</span>%: <span class="variable">$(SRC_DIR)</span>%.c</span><br><span class="line">    gcc <span class="variable">$(CFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>

<p>另一种写法</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">CC=mpicc</span><br><span class="line">CXX=mpicxx</span><br><span class="line">OPENMP=-fopenmp</span><br><span class="line">SOURCES:=<span class="variable">$(<span class="built_in">shell</span> find $(.)</span> -name &#x27;*.c&#x27;)</span><br><span class="line">SOURCESCXX:=<span class="variable">$(<span class="built_in">shell</span> find $(.)</span> -name &#x27;*.cpp&#x27;)</span><br><span class="line"><span class="comment"># SRCS := $(shell find $(SRC_DIRS) -name *.cpp -or -name *.c -or -name *.s)</span></span><br><span class="line">LIB=-lm</span><br><span class="line">OBJS=$(SOURCES:%.c=%)</span><br><span class="line">OBJS+=$(SOURCESCXX:%.cpp=%)</span><br><span class="line">DEBUG=-g</span><br><span class="line"></span><br><span class="line">SRC_DIR_1 = ./Lab1</span><br><span class="line">SRCS_1 = <span class="variable">$(<span class="built_in">shell</span> find $(.)</span> -name &#x27;*.c&#x27;)</span><br><span class="line">FILENAME_1 = $(SRCS_1:.c=)</span><br><span class="line"></span><br><span class="line"><span class="comment"># lab1 : $(FILENAME_1)</span></span><br><span class="line"><span class="comment">#  @echo $(SRCS_1)</span></span><br><span class="line"><span class="comment">#  @echo &quot;lab1编译完成&quot;</span></span><br><span class="line"><span class="comment">#  if [ ! -d &quot;build&quot; ]; then mkdir build; fi</span></span><br><span class="line"><span class="comment">#  mv $(FILENAME_1) build</span></span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(OBJS)</span></span><br><span class="line"> @echo <span class="variable">$(SOURCES)</span> <span class="variable">$(SOURCESCXX)</span></span><br><span class="line"> @echo <span class="string">&quot;编译完成&quot;</span></span><br><span class="line"> @echo <span class="variable">$(OBJS)</span></span><br><span class="line"> if [ ! -d <span class="string">&quot;build&quot;</span> ]; then mkdir build; fi</span><br><span class="line"> mv <span class="variable">$(OBJS)</span> build</span><br><span class="line"></span><br><span class="line"><span class="section">%: %.c</span></span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(DEBUG)</span> <span class="variable">$(OPENMP)</span> <span class="variable">$&lt;</span> <span class="variable">$(LIB)</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">%: %.cpp</span></span><br><span class="line"> <span class="variable">$(CXX)</span> <span class="variable">$(DEBUG)</span> <span class="variable">$(OPENMP)</span> <span class="variable">$&lt;</span> <span class="variable">$(LIB)</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean showVariable</span></span><br><span class="line"></span><br><span class="line"><span class="section">showVariable:</span></span><br><span class="line"> @echo <span class="variable">$(SOURCES)</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean: </span></span><br><span class="line"> rm -rf build</span><br></pre></td></tr></table></figure>

<h2 id="多个文件变一个可执行文件"><a href="#多个文件变一个可执行文件" class="headerlink" title="多个文件变一个可执行文件"></a>多个文件变一个可执行文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MPICC = mpicc</span><br><span class="line"></span><br><span class="line">LIB = -lm </span><br><span class="line">C_FLAGS= -O3 -mavx2 -fopenmp $(LIB)</span><br><span class="line"></span><br><span class="line">SRC_DIR = src</span><br><span class="line">BUILD_DIR = build/bin</span><br><span class="line">SRCS = $(wildcard $(SRC_DIR)/*.c)</span><br><span class="line">OBJ = $(SRCS:.c=.o)</span><br><span class="line"></span><br><span class="line">pivot: $&#123;SRCS&#125;</span><br><span class="line"> echo &quot;compiling $(SRC_DIR) $&#123;FILENAME&#125;&quot;</span><br><span class="line"> $(MPICC) $^ $(C_FLAGS) -o $(BUILD_DIR)/pivot</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ make pivot -C ..</span><br><span class="line">make: 进入目录“/home/shaojiemike/github/IPCC2022-preliminary”</span><br><span class="line">echo &quot;compiling src src/Combination src/heapSort src/SunDistance src/MPI src/pivot&quot;</span><br><span class="line">compiling src src/Combination src/heapSort src/SunDistance src/MPI src/pivot</span><br><span class="line">mpicc src/Combination.c src/heapSort.c src/SunDistance.c src/MPI.c src/pivot.c -O3 -mavx2 -fopenmp -lm  -o build/bin/pivot</span><br></pre></td></tr></table></figure>

<h3 id="更复杂"><a href="#更复杂" class="headerlink" title="更复杂"></a>更复杂</h3><p>保留.o文件，区分Flag与lib</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">CC = g++</span><br><span class="line">MPICC = mpicc</span><br><span class="line"></span><br><span class="line">C_FLAGS= -O3 -fopenmp </span><br><span class="line">LIB = -lgomp</span><br><span class="line"></span><br><span class="line">INCLUDEPATH = feGRASS</span><br><span class="line">SRC_DIR = feGRASS</span><br><span class="line">BUILD_DIR = build/bin</span><br><span class="line"></span><br><span class="line">SRCS = $(wildcard $(SRC_DIR)/*.cpp)</span><br><span class="line">OBJ = $(SRCS:.cpp=.o)</span><br><span class="line">DEBUG_OBJ = $(SRCS:.cpp=_debug.o)</span><br><span class="line">TIME_OBJ = $(SRCS:.cpp=_time.o)</span><br><span class="line">FILENAME = $(SRCS:.cpp=)</span><br><span class="line"></span><br><span class="line">.DEFAULT_GOAL := all</span><br><span class="line">all : $&#123;OBJ&#125;</span><br><span class="line"> echo &quot;compiling $(SRC_DIR) $&#123;FILENAME&#125;&quot;</span><br><span class="line"> $(CC) $^ $(LIB) -o $(BUILD_DIR)/main</span><br><span class="line"></span><br><span class="line">debugPrint: $&#123;DEBUG_OBJ&#125;</span><br><span class="line"> echo &quot;compiling $(SRC_DIR) $&#123;FILENAME&#125;&quot;</span><br><span class="line"> $(CC) $^ $(LIB) -o $(BUILD_DIR)/main</span><br><span class="line"></span><br><span class="line">timePrint: $&#123;TIME_OBJ&#125;</span><br><span class="line"> echo &quot;compiling $(SRC_DIR) $&#123;FILENAME&#125;&quot;</span><br><span class="line"> $(CC) $^ $(LIB) -o $(BUILD_DIR)/main</span><br><span class="line"></span><br><span class="line">%.o: %.cpp</span><br><span class="line"> $(CC) $(C_FLAGS) -c $&lt; -o $@ </span><br><span class="line">%_debug.o: %.cpp</span><br><span class="line"> $(CC) -DDEBUG -DTIME $(C_FLAGS) -c $&lt; -o $@ </span><br><span class="line">%_time.o: %.cpp</span><br><span class="line"> $(CC) -DTIME $(C_FLAGS) -c $&lt; -o $@ </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">checkdirs: $(BUILD_DIR)</span><br><span class="line">$(BUILD_DIR):</span><br><span class="line"> @mkdir -p $@</span><br><span class="line"></span><br><span class="line">.PHONY: clean</span><br><span class="line">clean:</span><br><span class="line"> rm -rf $(BUILD_DIR)/main $&#123;SRC_DIR&#125;/*.o</span><br></pre></td></tr></table></figure>

<h3 id="将obj与src分离"><a href="#将obj与src分离" class="headerlink" title="将obj与src分离"></a>将obj与src分离</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">CC = g++</span><br><span class="line">MPICC = mpicc</span><br><span class="line"></span><br><span class="line">C_FLAGS= -O3 -fopenmp </span><br><span class="line">LIB = -lgomp</span><br><span class="line"><span class="comment"># C_FLAGS= -fopenmp $(LIB) $(debugFlag)</span></span><br><span class="line"><span class="comment"># C_FLAGS= -O3 -march=znver1 -mavx2 -fopenmp $(LIB) $(debugFlag)</span></span><br><span class="line"></span><br><span class="line">INCLUDEPATH = feGRASS</span><br><span class="line">SRC_DIR = feGRASS</span><br><span class="line">BUILD_DIR = build/bin</span><br><span class="line">OBJ_DIR = build/obj</span><br><span class="line"></span><br><span class="line">SRCS = <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(SRC_DIR)</span>/*.cpp)</span></span><br><span class="line">TMP = <span class="variable">$(<span class="built_in">patsubst</span> %.cpp,$&#123;OBJ_DIR&#125;/%.cpp,$(<span class="built_in">notdir</span> $&#123;SRCS&#125;)</span>)</span><br><span class="line"><span class="comment"># example： $(patsubst %.cpp,%.d,$(patsubst %.c,%.d,$(patsubst %.cc,%.d,$(LIBCARBON_SOURCES)))) </span></span><br><span class="line"><span class="comment"># 意思是把$(LIBCARBON_SOURCES)变量中的所有.cpp,.c,.cc文件名替换为.d文件名</span></span><br><span class="line">HEADERS = <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(SRC_DIR)</span>/*.h)</span></span><br><span class="line">OBJ = $(TMP:.cpp=.o)</span><br><span class="line">DEBUG_OBJ = $(TMP:.cpp=_debug.o)</span><br><span class="line">TIME_OBJ = $(TMP:.cpp=_time.o)</span><br><span class="line">FILENAME = $(TMP:.cpp=)</span><br><span class="line"></span><br><span class="line"><span class="variable">$(info    SRCS is: <span class="variable">$(SRCS)</span>)</span></span><br><span class="line"><span class="variable">$(info    OBJ is: <span class="variable">$(OBJ)</span>)</span></span><br><span class="line"><span class="variable">$(info    HEADERS is: <span class="variable">$(HEADERS)</span>)</span></span><br><span class="line"></span><br><span class="line">.DEFAULT_GOAL := main</span><br><span class="line">main : <span class="variable">$(OBJ)</span></span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(OBJ)</span> <span class="variable">$(LIB)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">debugPrint: <span class="variable">$(DEBUG_OBJ)</span></span></span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(DEBUG_OBJ)</span> <span class="variable">$(LIB)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">timePrint: <span class="variable">$(TIME_OBJ)</span></span></span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(TIME_OBJ)</span> <span class="variable">$(LIB)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">mpi: <span class="variable">$(SRCS)</span></span></span><br><span class="line"> <span class="variable">$(MPICC)</span> <span class="variable">$^</span> <span class="variable">$(C_FLAGS)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">debugMpi: <span class="variable">$(SRCS)</span></span></span><br><span class="line"> <span class="variable">$(MPICC)</span> -DDEBUG -DTIME <span class="variable">$^</span> <span class="variable">$(C_FLAGS)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">timeMpi: <span class="variable">$(SRCS)</span></span></span><br><span class="line"> <span class="variable">$(MPICC)</span> -DTIME <span class="variable">$^</span> <span class="variable">$(C_FLAGS)</span> -o <span class="variable">$(BUILD_DIR)</span>/main</span><br><span class="line"></span><br><span class="line"><span class="section">$&#123;OBJ_DIR&#125;/%.o: $&#123;SRC_DIR&#125;/%.cpp <span class="variable">$(HEADERS)</span></span></span><br><span class="line"> <span class="variable">$(CC)</span> <span class="variable">$(C_FLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span> </span><br><span class="line"><span class="section">$&#123;OBJ_DIR&#125;/%_debug.o: $&#123;SRC_DIR&#125;/%.cpp <span class="variable">$(HEADERS)</span></span></span><br><span class="line"> <span class="variable">$(CC)</span> -DDEBUG -DTIME <span class="variable">$(C_FLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span> </span><br><span class="line"><span class="section">$&#123;OBJ_DIR&#125;/%_time.o: $&#123;SRC_DIR&#125;/%.cpp <span class="variable">$(HEADERS)</span></span></span><br><span class="line"> <span class="variable">$(CC)</span> -DTIME <span class="variable">$(C_FLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">checkdirs: <span class="variable">$(BUILD_DIR)</span></span></span><br><span class="line"><span class="variable">$(BUILD_DIR)</span>:</span><br><span class="line"> @mkdir -p <span class="variable">$(BUILD_DIR)</span></span><br><span class="line"> @mkdir -p <span class="variable">$(OBJ_DIR)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line"> rm -rf <span class="variable">$(BUILD_DIR)</span>/main <span class="variable">$(OBJ_DIR)</span>/*.o</span><br></pre></td></tr></table></figure>

<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol>
<li><code>$(foreach var,list,text)</code>的语法来对list中的每个元素执行text，并用var来引用当前元素1。你也可以用</li>
<li><code>$(wildcard pattern)</code>的语法来匹配指定模式的文件，并返回其列表</li>
<li><code>$(subst from,to,text)</code>的语法来把text中的from替换为to</li>
<li><code>$(patsubst pattern,replacement,text)</code>的语法来把text中匹配pattern的部分替换为replacement</li>
<li><code>include &lt;filenames&gt;</code> ，make 在处理程序的时候，文件列表中的任意一个文件不存在的时候或者是没有规则去创建这个文件的时候，make 程序将会提示错误并保存退出；</li>
<li><code>-include &lt;filenames&gt;</code>，当包含的文件不存在或者是没有规则去创建它的时候，make 将会继续执行程序，只有真正由于不能完成终极目标重建的时候我们的程序才会提示错误保存退出；</li>
<li>addprefix的功能增加前缀，例如<code>$(addprefix -I,./Inc)</code>执行后为 <code>-I ./Inc</code><ol>
<li><code>OUTPUT_FILES = $(addsuffix .out, $(addprefix $(OUTPUT_DIR)/, $(BENCH_MAINNAME)))</code></li>
</ol>
</li>
<li>文件名处理函数 dir, notdir, suffix, basename （网站basename例子写错了）<ol>
<li><a target="_blank" rel="noopener" href="https://www.zhaixue.cc/makefile/makefile-filename-function.html">https://www.zhaixue.cc/makefile/makefile-filename-function.html</a></li>
</ol>
</li>
<li><code>.PHONY: clean</code>是为了有clean名称的文件时，防止把<code>make clean</code>理解成生成clean文件，而不是使用clean规则。</li>
<li>一个Makefile文件里通常会有多个目标，一般会选择第一个作为默认目标。所以一般第一个写<code>all</code></li>
<li>赋值符号   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">= 是最基本的赋值</span><br><span class="line">:= 是覆盖之前的值</span><br><span class="line">?= 是如果没有被赋值过就赋予等号后面的值</span><br><span class="line">+= 是添加等号后面的值</span><br></pre></td></tr></table></figure></li>
<li>makefile中命令前加一个@的作用是不让make显示出要执行的命令</li>
<li><code>$@</code> is the name of the target being generated, and<code>$&lt;</code> the first prerequisite (usually a source file). You can find a list of all these special variables in the GNU Make manual.</li>
</ol>
<p> For example, consider the following declaration:</p>
<p> <code>all: library.cpp main.cpp</code></p>
<p> In this case:</p>
<p> <code>$@</code> evaluates to all</p>
<p> <code>$&lt;</code> evaluates to library.cpp</p>
<p> <code>$^</code> evaluates to library.cpp main.cpp</p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Makefile:22: *** missing separator.  Stop.</span><br></pre></td></tr></table></figure>

<p>命令开头要用Tab，不是空格。别用vscode，用vim写</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
https://blog.csdn.net/ET_Endeavoring/article/details/98989066
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-08-15T16:00:00.000Z" title="8/15/2023, 4:00:00 PM">2023-08-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-12T08:55:37.921Z" title="1/12/2024, 8:55:37 AM">2024-01-12</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">a minute read (About 164 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/08/15/Work/software/linux/cpu-time/">Cpu Time</a></p><div class="content"><h2 id="Situation"><a href="#Situation" class="headerlink" title="Situation"></a>Situation</h2><p>It is all started with two confusing situation.</p>
<ul>
<li>I found out using <code>ps aux | grep -v process_name</code>, the process is in <code>Sl+</code> state. But the cpu usage is not zero.</li>
<li><code>watch &quot;ps aux |grep 3496617&quot;</code> always show the same cpu usage percentage, which is very confusing beacause <code>htop</code> always show up-down value. and <code>pidstat -p 3516617</code> show cpu% less than 100%.</li>
</ul>
<h2 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h2><ol>
<li>figure out how <code>htop</code> calculate the cpu usage percentage of a process.</li>
<li>why <code>ps</code> and <code>pidstat</code> choose different calculate ways.</li>
</ol>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/141586/what-does-utilization-mean-in-htop-if-only-1-process-can-execute-at-a-time">https://unix.stackexchange.com/questions/141586/what-does-utilization-mean-in-htop-if-only-1-process-can-execute-at-a-time</a></p>
<h2 id="Result-Explanation"><a href="#Result-Explanation" class="headerlink" title="Result &amp; Explanation"></a>Result &amp; Explanation</h2><h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>上面回答部分<strong>来自ChatGPT-3.5</strong>，没有进行正确性的交叉校验。</p>
<div id='refer-anchor'></div>

<p>无</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/Tutorials/page/2/">Previous</a></div><div class="pagination-next"><a href="/categories/Tutorials/page/4/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/Tutorials/">1</a></li><li><a class="pagination-link" href="/categories/Tutorials/page/2/">2</a></li><li><a class="pagination-link is-current" href="/categories/Tutorials/page/3/">3</a></li><li><a class="pagination-link" href="/categories/Tutorials/page/4/">4</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/Tutorials/page/12/">12</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">382</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">38</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">20</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">50</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-10T12:00:31.000Z">2024-01-10</time></p><p class="title"><a href="/2024/01/10/Work/Programming/2-languageGrammar/OpenCLBasic/">OpenCL Basic</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-10T08:18:51.000Z">2024-01-10</time></p><p class="title"><a href="/2024/01/10/Work/Architecture/GPU/huaweiDaVinci/">Huawei GPU : DaVinci</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-09T15:38:04.000Z">2024-01-09</time></p><p class="title"><a href="/2024/01/09/Work/Programming/6-deploy/pipPackage/">Build and release your Pip Package</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-05T07:17:06.000Z">2024-01-05</time></p><p class="title"><a href="/2024/01/05/Work/Programming/2-languageGrammar/cudaExeModel/">The CUDA Execution Model</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-04T02:55:54.000Z">2024-01-04</time></p><p class="title"><a href="/2024/01/04/Work/Architecture/performanceModel/GPUPerformanceModel/">CPU / GPU Performance Model based on Interval Analysis</a></p><p class="categories"><a href="/categories/Architecture/">Architecture</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>