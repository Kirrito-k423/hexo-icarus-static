<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Category: toLearn - SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Categories</a></li><li class="is-active"><a href="#" aria-current="page">toLearn</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-04-26T16:00:00.000Z" title="4/26/2023, 4:00:00 PM">2023-04-26</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.293Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">12 minutes read (About 1797 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/Work/software/simulator/gem5/">Gem5</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>GEM5是一款模块化的离散事件驱动全系统模拟器，由C++与python编写</li>
<li>它结合了M5（多处理器模拟器）和GEMS（存储层次模拟器）中最优秀的部分，是一款高度可配置、集成多种ISA和多种CPU模型的体系结构模拟器。<ul>
<li>M5是由Michigan大学开发的一款开源的多处理机模拟器，受到了业内的广泛关注，很多高水平论文都采用M5作为研究工具。</li>
<li>另一方面，Wisconsin推出的GEMS能够对储存层次进行详细而灵活的模拟，包括对多种不同的cache一致性协议和互联模型的支持。</li>
<li>目前的GEM5是M5和GEMS的一个紧耦合版本。</li>
</ul>
</li>
<li>GEM5已经能够支持多种商用ISA，包括X86、ARM、ALPHA、MIPS、Power、SPARC等，并且能够在X86、ARM、ALPHA上加载操作系统。</li>
</ul>
<h3 id="可选配置-灵活性"><a href="#可选配置-灵活性" class="headerlink" title="可选配置(灵活性)"></a>可选配置(灵活性)</h3><ul>
<li>灵活性是指gem5提供了多种CPU模型、系统模型以及存储器模型。<ul>
<li>CPU模型：Atomic、Timing、In-order、<strong>O3（Out of Order）</strong>。<ul>
<li><code>AtomicSimple</code>是最简单规模的模型，一个cycle完成一条指令的执行，memory 模型比较理想化，访存操作为原子性操作。适用于快速功能模拟。</li>
<li><code>TimingSimple</code>模拟器也是无流水线的模拟，但是使用了存储器访问时序模型，用以统计存储器访问延迟。</li>
<li><code>In-Order</code>模型是GEM5模拟的新特性，强调指令时序与仿真精度，流水级为默认五级流水：取值、译码、执行、访存、写回。并且模拟了cache部件、执行部件、分支预测部件等。</li>
<li><code>O3</code>模拟器是流水级模拟，O3模拟器模拟了乱序执行和超标量执行的指令间依赖，以及运行在多CPU上的并发执行的多线程。<ul>
<li>默认7级流水：取值、译码、重命名、发射、执行、写回、提交。</li>
<li>模拟了物理寄存器文件、IO、LSQ、ROB功能部件池等。</li>
<li>主要参数为流水管道间延迟、硬件线程数、IQ&#x2F;LSQ&#x2F;ROB项数、FU延迟、物理寄存器重命名、分支预测、访存依赖预测等。</li>
</ul>
</li>
</ul>
</li>
<li>系统模型：SE（System-call emulation）、FS（Full System）。</li>
<li>存储模型：Classic、Ruby。<ul>
<li>M5的Classic mode存储器是最简单的模型，它提供了简洁快速的可配置性。</li>
<li>GEMS的Ruby模型注重于精确度并且支持不同的cache一致性协议。<ul>
<li>Ruby存储模型支持庞大阵列的互联拓扑，包括两个不同的网络模型：Simple网络与Garnet网络。<ul>
<li>Simple网络对链路、路由延迟与链路带宽进行建模，但并不建模路由资源竞争与流控。</li>
<li>Garnet网络详细建模路由微架构，包括所有相关的资源竞争与流控时序。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="基本模式"><a href="#基本模式" class="headerlink" title="基本模式"></a>基本模式</h3><ul>
<li><strong>System Call Emulation (SE) Mode</strong><ul>
<li>In this mode, one only needs to specify the binary file to be simulated. This binary file can be statically&#x2F;dynamically linked.</li>
</ul>
</li>
<li><strong>full-system mode</strong><ul>
<li>This mode simulates a complete system which provides an operating system based simulation environment.</li>
<li><a target="_blank" rel="noopener" href="https://shaojiemike.notion.site/fs-py-b4574f51316e4ea2841eceec441a78a0">very slow</a>, rendering it impractical for deployment in real-world applications.</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time ./build/ARM/gem5.fast configs/example/se.py --cmd=/home/shaojiemike/test/llvmVSgem5/MV/MV_gem5 -n 32 --cpu-type=O3CPU --l1d_size=64kB --l1i_size=16kB --caches</span><br></pre></td></tr></table></figure>

<ul>
<li>L1d cache是每个核单独64KB（原因见后图）。但其实默认cache结构是L2共享的</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>在源目录下运行<code>scons build/&lt;config&gt;/&lt;binary&gt;</code> 建立模拟器。<ul>
<li><code>&lt;config&gt;</code> gem5的配置文件，如<code>ARM</code>，<code>X86</code>等</li>
<li><code>&lt;binary&gt;</code> 模拟器的类型，有如下<ul>
<li><code>gem5.debug</code> 有关闭了优化，使gdb一类的工具更易于调试；</li>
<li><code>gem5.opt</code>有打开优化，但保留了调试输出和断言；</li>
<li><code>gem5.fast</code>去除了调试工具；</li>
<li><code>gem5.prof</code>用于与gprof共同使用</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scons build/ARM/gem5.fast --debug=presub --verbose -j 32</span><br></pre></td></tr></table></figure>

<h2 id="输入参数"><a href="#输入参数" class="headerlink" title="输入参数"></a>输入参数</h2><h3 id="gem5-安装的默认配置"><a href="#gem5-安装的默认配置" class="headerlink" title="gem5 安装的默认配置"></a>gem5 安装的默认配置</h3><p>可选选项在<code>./build/ARM/gem5.fast configs/example/se.py -h</code>或者 <code>configs/common/Options.py</code> 中查看</p>
<p>常规的配置：</p>
<ul>
<li>多级cache</li>
<li>CPU<ul>
<li>频率，核数</li>
<li>指令发射宽度<ul>
<li>commitWidth, decodeWidth, dispatchWidth, fetchWidth, issueWidth,</li>
<li>renameWidth, squashWidth, wbWidth     ,</li>
</ul>
</li>
<li>端口模型的部件类型以及个数</li>
</ul>
</li>
<li>内存</li>
</ul>
<h3 id="cache設置"><a href="#cache設置" class="headerlink" title="cache設置"></a>cache設置</h3><ul>
<li>只指定大小是沒用的，需要在L1cache 前加上 “–caches”，在l2cache前加上 “–l2cache“。命令結果類似</li>
<li>默认cache是没有开硬件预取HWP的，类型通过<code>--list-hwp-types</code>查看。可以指定L1L2cache的HWP类型，如<code>--l1d-hwp-type=TaggedPrefetcher</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">build/X86/gem5.opt configs/example/se.py </span><br><span class="line">  --caches --l1d_size=32kB --l1i_size=32kB </span><br><span class="line">  --l2cache --l2_size=256kB </span><br><span class="line">  --l3_size=8192kB  <span class="comment"># l3 在 se里是不生效的</span></span><br><span class="line">  -c tests/test-progs/hello/bin/x86/linux/hello </span><br><span class="line"></span><br><span class="line"><span class="comment"># 建议将L3大小并入L2来模拟cycle的下限</span></span><br><span class="line">build/X86/gem5.opt configs/example/se.py </span><br><span class="line">  --caches --l1d_size=32kB --l1i_size=32kB </span><br><span class="line">  --l2cache --l2_size=256kB+8192kB</span><br><span class="line">  -c tests/test-progs/hello/bin/x86/linux/hello</span><br></pre></td></tr></table></figure>

<p>进阶配置：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wyj7260/article/details/8515245">多核模拟时，配置独占cache</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wyj7260/article/details/8499088">增加共享L3</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/wyj7260/article/details/8501338">添加共享的L3cache，并将L2cache改为独立的</a></li>
</ol>
<h2 id="输出文件"><a href="#输出文件" class="headerlink" title="输出文件"></a>输出文件</h2><p>运行完SE模式，默认会在指令路径下生成<code>m5out</code>文件夹，其中各文件大致含义如下：</p>
<ul>
<li><code>config.ini</code>或者<code>config.json</code> 运行指令的系统参数<ul>
<li>Contains a list of every SimObject created for the simulation and the values for its parameters.</li>
<li><code>json</code>格式的文件能比较好的理清config的重要设置</li>
<li><code>[system.cpu]</code> 有CPU的具体设置</li>
<li><code>[system.mem_ctrls.dram]</code> 有DRAM读取数据的具体设置</li>
<li><code>[system.membus]</code> BUS的相关设置</li>
</ul>
</li>
<li><code>stats.txt</code>  模拟结果数据(具体的周期数等)<ul>
<li>A text representation of all of the gem5 statistics registered for the simulation.</li>
<li><code>system.clk_domain.clock      1000  # Clock period in ticks (Tick)</code></li>
<li><code>system.cpu_clk_domain.clock  500   # Clock period in ticks (Tick)</code></li>
</ul>
</li>
<li><code>fs/proc/lscpu</code> 模拟系统配置(类似lscpu)</li>
<li><code>config.dot.*</code> 模拟的系统结构<ul>
<li><code>config.dot</code> 是以文字展示</li>
<li><code>config.dot.pdf</code> 和 <code>config.dot.svg</code> 都是以图片表示<img src="https://pic.shaojiemike.top/img/20230503164705.png" alt="aliyuncs1"></li>
<li><code>config.dot.svg</code> 能展示每个部件的细节参数 <img src="https://pic.shaojiemike.top/img/20230503171754.png" alt="aliyuncs2"></li>
</ul>
</li>
</ul>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/ivy_reny/article/details/54312352">博客</a>, 如果<code>se.py</code>無法滿足要求，可以自己<a target="_blank" rel="noopener" href="https://blog.csdn.net/ivy_reny/article/details/54312297">編寫脚本</a></p>
<h2 id="CPU参数解释"><a href="#CPU参数解释" class="headerlink" title="CPU参数解释"></a>CPU参数解释</h2><h3 id="各阶段发射宽度"><a href="#各阶段发射宽度" class="headerlink" title="各阶段发射宽度"></a>各阶段发射宽度</h3><p>commitWidth, decodeWidth, dispatchWidth, fetchWidth, issueWidth, renameWidth, squashWidth, wbWidth</p>
<p>下面是行数占比最大的几个部分</p>
<h3 id="branchPred"><a href="#branchPred" class="headerlink" title="branchPred"></a>branchPred</h3><ul>
<li>BTBEntries</li>
</ul>
<h3 id="decoder"><a href="#decoder" class="headerlink" title="decoder"></a>decoder</h3><h3 id="fuPool"><a href="#fuPool" class="headerlink" title="fuPool"></a>fuPool</h3><ul>
<li>fuction pool 类似乱序执行的端口模型，ARM下的O3模拟的fuPool如下<br><img src="https://pic.shaojiemike.top/img/20230503203337.png" alt="ARM-O3-fuPool"></li>
</ul>
<h2 id="gem5-模拟器误差来源分析"><a href="#gem5-模拟器误差来源分析" class="headerlink" title="gem5 模拟器误差来源分析"></a>gem5 模拟器误差来源分析</h2><h3 id="运行真实周期数"><a href="#运行真实周期数" class="headerlink" title="运行真实周期数"></a>运行真实周期数</h3><ul>
<li>使用<code>perf stat test.exe</code>, 可参考本博客perf文章</li>
</ul>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ivy_reny/category_6666068.html">https://blog.csdn.net/ivy_reny/category_6666068.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wyj7260/category_1301132.html">https://blog.csdn.net/wyj7260/category_1301132.html</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-04-23T16:00:00.000Z" title="4/23/2023, 4:00:00 PM">2023-04-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.185Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">a minute read (About 129 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/23/OutOfWork/5-VideoEntertainment/5-Synology/">Synology terminal</a></p><div class="content"><h2 id="配置开机启动项"><a href="#配置开机启动项" class="headerlink" title="配置开机启动项"></a>配置开机启动项</h2><p>编写脚本<code>/var/services/homes/shaojiemike/wgReboot.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip ro add default via 222.195.90.254 dev eth0 table eth0-table</span><br><span class="line">ip ro a 114.214.233.0/24 via 222.195.90.254 dev eth0  src 222.195.90.2 table main</span><br><span class="line">wg-quick up wg1</span><br><span class="line">ip ro d default via 222.195.90.254 dev eth0  src 222.195.90.2 table main</span><br></pre></td></tr></table></figure>

<ul>
<li>执行权限<code>chmod +x</code></li>
<li>群晖WebUI -&gt; 控制面板 -&gt; 任务计划 -&gt; 新增 -&gt; 触发的任务<ul>
<li>选择Root、开机事件</li>
<li><code>bash /var/services/homes/shaojiemike/wgReboot.sh</code></li>
</ul>
</li>
</ul>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-04-23T16:00:00.000Z" title="4/23/2023, 4:00:00 PM">2023-04-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.301Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">7 minutes read (About 1031 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/23/Work/software/linux-sys/rebootTask/">Reboot Task</a></p><div class="content"><h2 id="最简单-etc-rc-lo­cal"><a href="#最简单-etc-rc-lo­cal" class="headerlink" title="最简单&#x2F;etc&#x2F;rc.lo­cal"></a>最简单&#x2F;etc&#x2F;rc.lo­cal</h2><p>默认是不开启的，文件<code>/etc/rc.lo­cal</code>默认也不存在</p>
<h3 id="开启-etc-rc-lo­cal功能"><a href="#开启-etc-rc-lo­cal功能" class="headerlink" title="开启&#x2F;etc&#x2F;rc.lo­cal功能"></a>开启&#x2F;etc&#x2F;rc.lo­cal功能</h3><ul>
<li>ubuntu18.04不再使用initd管理系统，改用systemd</li>
<li>systemd有rc-local的配置文件，只需链接到<code>/etc/systemd/system</code>目录下启动即可<ul>
<li><code>ln -fs /lib/systemd/system/rc-local.service /etc/systemd/system/rc-local.service</code></li>
</ul>
</li>
</ul>
<h3 id="使用-etc-rc-lo­cal功能"><a href="#使用-etc-rc-lo­cal功能" class="headerlink" title="使用&#x2F;etc&#x2F;rc.lo­cal功能"></a>使用&#x2F;etc&#x2F;rc.lo­cal功能</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> /etc/rc.local</span><br><span class="line"><span class="built_in">chmod</span> 755 /etc/rc.local</span><br><span class="line">vim /etc/rc.local</span><br><span class="line">    eg. <span class="comment">#!/bin/bash  echo &quot;test rc &quot; &gt; /var/test.log</span></span><br></pre></td></tr></table></figure>
<h2 id="crontab-reboot"><a href="#crontab-reboot" class="headerlink" title="crontab @reboot"></a>crontab @reboot</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br><span class="line">@reboot /home/user/test.sh</span><br></pre></td></tr></table></figure>
<h2 id="initd-启动管理系统"><a href="#initd-启动管理系统" class="headerlink" title="initd 启动管理系统"></a>initd 启动管理系统</h2><ul>
<li>init.d目录包含许多系统各种服务的启动和停止脚本。它控制着所有从acpid到x11-common的各种事务。</li>
<li>注意：ubuntu18.04不再使用initd管理系统，改用systemd</li>
</ul>
<h3 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h3><ul>
<li><code>/etc/init.d</code>目录下建立文件<code>test</code><ul>
<li>按照README编写脚本</li>
<li>赋予执行权限<code>sudo chmod +x  /etc/init.d/test</code></li>
</ul>
</li>
</ul>
<h3 id="设置脚本启动"><a href="#设置脚本启动" class="headerlink" title="设置脚本启动"></a>设置脚本启动</h3><p>方法一：使用update-rc.d 命令将脚本放到启动脚本中去（debian中可以使用更新的insserv）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /etc/init.d</span><br><span class="line">$ <span class="built_in">sudo</span> update-rc.d <span class="built_in">test</span> defaults 95</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注：其中数字95是脚本启动的顺序号，按照自己的需要相应修改即可。在你有多个启动脚本，而它们之间又有先后启动的依赖关系时你就知道这个数字的具体作用了。更多说明建议看man update-rc.d。</p>
</blockquote>
<p>方法二：手动在rc*.d中建立软连接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -s <span class="built_in">test</span> ../rc5.d/S95test</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>rc*.d</code>，*代表启动级别，在不同启动级别启动，<br>K开头的脚本文件代表运行级别加载时需要关闭的，<br>S开头的代表相应级别启动时需要执行，<br>数字代表顺序</p>
</blockquote>
<h3 id="卸载启动脚本的方法："><a href="#卸载启动脚本的方法：" class="headerlink" title="卸载启动脚本的方法："></a>卸载启动脚本的方法：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /etc/init.d</span><br><span class="line">$ <span class="built_in">sudo</span> update-rc.d -f <span class="built_in">test</span> remove</span><br></pre></td></tr></table></figure>

<h3 id="手动调用脚本"><a href="#手动调用脚本" class="headerlink" title="手动调用脚本"></a>手动调用脚本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/test start</span><br><span class="line">/etc/init.d/test stop</span><br><span class="line">/etc/init.d/test restart</span><br></pre></td></tr></table></figure>





<h2 id="systemd-服务管理系统"><a href="#systemd-服务管理系统" class="headerlink" title="systemd 服务管理系统"></a>systemd 服务管理系统</h2><p>使用sudo systemctl enable xxx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">systemctl is-enabled servicename.service <span class="comment">#查询服务是否开机启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> *.service <span class="comment">#开机运行服务</span></span><br><span class="line">systemctl <span class="built_in">disable</span> *.service <span class="comment">#取消开机运行</span></span><br><span class="line">systemctl start *.service <span class="comment">#启动服务</span></span><br><span class="line">systemctl stop *.service <span class="comment">#停止服务</span></span><br><span class="line">systemctl restart *.service <span class="comment">#重启服务</span></span><br><span class="line">systemctl reload *.service <span class="comment">#重新加载服务配置文件</span></span><br><span class="line">systemctl status *.service <span class="comment">#查询服务运行状态</span></span><br><span class="line">systemctl --failed <span class="comment">#显示启动失败的服务</span></span><br></pre></td></tr></table></figure>

<h3 id="systemctl-开机启动原理"><a href="#systemctl-开机启动原理" class="headerlink" title="systemctl 开机启动原理"></a>systemctl 开机启动原理</h3><ul>
<li>Systemd 默认从目录<code>/etc/systemd/system/</code>读取配置文件。</li>
<li>但是，里面存放的大部分文件都是符号链接，指向目录<ul>
<li><code>/usr/lib/systemd/system/</code>，真正的配置文件存放在那个目录。</li>
</ul>
</li>
</ul>
<p><code>systemctl enable</code>命令用于在上面两个目录之间，建立符号链接关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl enable clamd@scan.service</span><br><span class="line"># 等同于</span><br><span class="line">$ sudo ln -s &#x27;/usr/lib/systemd/system/clamd@scan.service&#x27; &#x27;/etc/systemd/system/multi-user.target.wants/clamd@scan.service&#x27;</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>
<ul>
<li>如果配置文件里面设置了开机启动，<code>systemctl enable</code>命令相当于激活开机启动。</li>
<li>与之对应的，<code>systemctl disable</code>命令用于在两个目录之间，撤销符号链接关系，相当于撤销开机启动。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; $ sudo systemctl disable clamd@scan.service</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure></li>
<li>配置文件的后缀名，就是该 Unit 的种类，比如<code>sshd.socket</code>。<ul>
<li>如果省略，Systemd 默认后缀名为<code>.service</code>，所以<code>sshd</code>会被理解成<code>sshd.service</code>。</li>
</ul>
</li>
</ul>
<h3 id="把程序设置systemctl服务-并开机启动"><a href="#把程序设置systemctl服务-并开机启动" class="headerlink" title="把程序设置systemctl服务,并开机启动"></a>把程序设置systemctl服务,并开机启动</h3><p>进入目录<code>/usr/lib/systemd/system</code>,修改<code>webhook.service</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Webhook receiver for GitHub</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/usr/local/bin/webhook</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>这里有几个模块:</p>
<ul>
<li>[Unit] 区块：启动顺序与依赖关系。</li>
<li>[Service] 区块：启动行为,如何启动，启动类型。</li>
<li>[Install] 区块，定义如何安装这个配置文件，即怎样做到开机启动。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nexus.service  #启动服务</span><br><span class="line">systemctl enable nexus.service #设置开机启动</span><br></pre></td></tr></table></figure>
<p><code>Loaded: loaded (/etc/systemd/system/webhook.service; enabled;</code>这个<code>enabled</code>就是开机启动的意思</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://neucrack.com/p/91">https://neucrack.com/p/91</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-25T16:00:00.000Z" title="3/25/2023, 4:00:00 PM">2023-03-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.353Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">21 minutes read (About 3219 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/25/Work/network/vpn/OpenWRT/">OpenWRT on router</a></p><div class="content"><h2 id="OpenWRT-Installation-on-router"><a href="#OpenWRT-Installation-on-router" class="headerlink" title="OpenWRT Installation on router"></a>OpenWRT Installation on router</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>原理在路由器的两个flash(firmware和firmware1)的两个系统里，写入一个支持图形化OpenWRT的新系统</p>
<h3 id="查看路由器型号是否支持"><a href="#查看路由器型号是否支持" class="headerlink" title="查看路由器型号是否支持"></a>查看路由器型号是否支持</h3><p><strong>查看系统型号</strong>[^1]：路由器默认是魔改的openwrt的系统：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@XiaoQiang:~# <span class="built_in">cat</span> /etc/os-release</span><br><span class="line">NAME=<span class="string">&quot;OpenWrt&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;18.06-SNAPSHOT&quot;</span></span><br><span class="line">ID=<span class="string">&quot;openwrt&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;lede openwrt&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;OpenWrt 18.06-SNAPSHOT&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;18.06-snapshot&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;http://openwrt.org/&quot;</span></span><br><span class="line">BUG_URL=<span class="string">&quot;http://bugs.openwrt.org/&quot;</span></span><br><span class="line">SUPPORT_URL=<span class="string">&quot;http://forum.lede-project.org/&quot;</span></span><br><span class="line">BUILD_ID=<span class="string">&quot;unknown&quot;</span></span><br><span class="line">LEDE_BOARD=<span class="string">&quot;mediatek/mt7622&quot;</span></span><br><span class="line">LEDE_ARCH=<span class="string">&quot;aarch64_cortex-a53_neon-vfpv4&quot;</span></span><br><span class="line">LEDE_TAINTS=<span class="string">&quot;no-all glibc busybox&quot;</span></span><br><span class="line">LEDE_DEVICE_MANUFACTURER=<span class="string">&quot;OpenWrt&quot;</span></span><br><span class="line">LEDE_DEVICE_MANUFACTURER_URL=<span class="string">&quot;http://openwrt.org/&quot;</span></span><br><span class="line">LEDE_DEVICE_PRODUCT=<span class="string">&quot;Generic&quot;</span></span><br><span class="line">LEDE_DEVICE_REVISION=<span class="string">&quot;v0&quot;</span></span><br><span class="line">LEDE_RELEASE=<span class="string">&quot;OpenWrt 18.06-SNAPSHOT unknown&quot;</span></span><br></pre></td></tr></table></figure>

<p>刷入OpenWRT后：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@ax6s:~# <span class="built_in">cat</span> /etc/os-release</span><br><span class="line">NAME=<span class="string">&quot;OpenWrt&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;22.03.2&quot;</span></span><br><span class="line">ID=<span class="string">&quot;openwrt&quot;</span></span><br><span class="line">ID_LIKE=<span class="string">&quot;lede openwrt&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;OpenWrt 22.03.2&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;22.03.2&quot;</span></span><br><span class="line">HOME_URL=<span class="string">&quot;https://openwrt.org/&quot;</span></span><br><span class="line">BUG_URL=<span class="string">&quot;https://bugs.openwrt.org/&quot;</span></span><br><span class="line">SUPPORT_URL=<span class="string">&quot;https://forum.openwrt.org/&quot;</span></span><br><span class="line">BUILD_ID=<span class="string">&quot;r19803-9a599fee93&quot;</span></span><br><span class="line">OPENWRT_BOARD=<span class="string">&quot;mediatek/mt7622&quot;</span></span><br><span class="line">OPENWRT_ARCH=<span class="string">&quot;aarch64_cortex-a53&quot;</span></span><br><span class="line">OPENWRT_TAINTS=<span class="string">&quot;&quot;</span></span><br><span class="line">OPENWRT_DEVICE_MANUFACTURER=<span class="string">&quot;OpenWrt&quot;</span></span><br><span class="line">OPENWRT_DEVICE_MANUFACTURER_URL=<span class="string">&quot;https://openwrt.org/&quot;</span></span><br><span class="line">OPENWRT_DEVICE_PRODUCT=<span class="string">&quot;Generic&quot;</span></span><br><span class="line">OPENWRT_DEVICE_REVISION=<span class="string">&quot;v0&quot;</span></span><br><span class="line">OPENWRT_RELEASE=<span class="string">&quot;OpenWrt 22.03.2 r19803-9a599fee93&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="路由器开启dropbear"><a href="#路由器开启dropbear" class="headerlink" title="路由器开启dropbear"></a>路由器开启dropbear</h3><p>dropbear 是一种轻量级sshd服务</p>
<p><img src="https://pic.shaojiemike.top/img/20221031221343.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nvram <span class="built_in">set</span> ssh_en=1  <span class="comment"># 不是1也退出1</span></span><br><span class="line">/etc/init.d/dropbear start <span class="comment"># 脚本start段里增加了判断,稳定版不让启动直接退出</span></span><br><span class="line">netstat -n <span class="comment"># 查看22端口</span></span><br></pre></td></tr></table></figure>

<p>修改<code>/etc/dropbear/authorized_keys</code> 来添加ssh公钥</p>
<h3 id="Redmi-Ax6s实操"><a href="#Redmi-Ax6s实操" class="headerlink" title="Redmi-Ax6s实操"></a>Redmi-Ax6s实操</h3><p>参考<a target="_blank" rel="noopener" href="https://openwrt.org/toh/xiaomi/ax3200">教程</a>，和具体的<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1q94y1f7fj/?spm_id_from=333.788&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3">视频</a></p>
<article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>Step1</p>
</div>
        <div class="message-body">
            <ol>
<li>installing a beta version of the stock firmware (<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/YangWang92/AX6S-unlock/master/miwifi_rb03_firmware_stable_1.2.7.bin">miwifi_rb03_firmware_stable_1.2.7_closedbeta.bin</a>)上传文件安装<img src="https://pic.shaojiemike.top/img/20221031163246.png"></li>
</ol>

        </div>
    </article>

<article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>Step2</p>
</div>
        <div class="message-body">
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line">import sys</span><br><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.version_info &lt; (3,7):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;python version is not supported&quot;</span>, file=sys.stderr)</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># credit goes to zhoujiazhao:</span></span><br><span class="line"><span class="comment"># https://blog.csdn.net/zhoujiazhao/article/details/102578244</span></span><br><span class="line"></span><br><span class="line">salt = &#123;<span class="string">&#x27;r1d&#x27;</span>: <span class="string">&#x27;A2E371B0-B34B-48A5-8C40-A7133F3B5D88&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;others&#x27;</span>: <span class="string">&#x27;d44fb0960aa0-a5e6-4a30-250f-6d2df50a&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_salt(sn):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;/&quot;</span> not <span class="keyword">in</span> sn:</span><br><span class="line">        <span class="built_in">return</span> salt[<span class="string">&quot;r1d&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> <span class="string">&quot;-&quot;</span>.<span class="built_in">join</span>(reversed(salt[<span class="string">&quot;others&quot;</span>].<span class="built_in">split</span>(<span class="string">&quot;-&quot;</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def calc_passwd(sn):</span><br><span class="line">    passwd = sn + get_salt(sn)</span><br><span class="line">    m = hashlib.md5(passwd.encode())</span><br><span class="line">    <span class="built_in">return</span> m.hexdigest()[:8]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != 2:</span><br><span class="line">        <span class="built_in">print</span>(f<span class="string">&quot;Usage: &#123;sys.argv[0]&#125; &lt;S/N&gt;&quot;</span>)</span><br><span class="line">        sys.exit(1)</span><br><span class="line"></span><br><span class="line">    serial = sys.argv[1]</span><br><span class="line">    <span class="built_in">print</span>(calc_passwd(serial))</span><br></pre></td></tr></table></figure>
        </div>
    </article>

<article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>Step3</p>
</div>
        <div class="message-body">
            <p><img src="https://pic.shaojiemike.top/img/20221031165332.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">XiaoQiang login: root</span><br><span class="line">Password:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BusyBox v1.25.1 (2021-10-25 11:02:56 UTC) built-in shell (ash)</span><br><span class="line"></span><br><span class="line">-----------------------------------------------------</span><br><span class="line">    Welcome to XiaoQiang!</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">$$$$$$\  $$$$$$$\  $$$$$$$$\      $$\      $$\        $$$$$$\  $$\   $$\</span><br><span class="line">$$  __$$\ $$  __$$\ $$  _____|     $$ |     $$ |      $$  __$$\ $$ | $$  |</span><br><span class="line">$$ /  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ /  $$ |$$ |$$  /</span><br><span class="line">$$$$$$$$ |$$$$$$$  |$$$$$\         $$ |     $$ |      $$ |  $$ |$$$$$  /</span><br><span class="line">$$  __$$ |$$  __$$&lt; $$  __|        $$ |     $$ |      $$ |  $$ |$$  $$&lt;</span><br><span class="line">$$ |  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ |  $$ |$$ |\$$\</span><br><span class="line">$$ |  $$ |$$ |  $$ |$$$$$$$$\       $$$$$$$$$  |       $$$$$$  |$$ | \$$\</span><br><span class="line">\__|  \__|\__|  \__|\________|      \_________/        \______/ \__|  \__|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@XiaoQiang:~# <span class="built_in">ls</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
        </div>
    </article>

<article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>Step4</p>
</div>
        <div class="message-body">
            <ol>
<li><p>通过cat &#x2F;proc&#x2F;mtd，知道对应关系</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@XiaoQiang:/tmp# <span class="built_in">cat</span> /proc/mtd</span><br><span class="line">dev:    size   erasesize  name</span><br><span class="line">mtd0: 07f80000 00020000 <span class="string">&quot;ALL&quot;</span></span><br><span class="line">mtd1: 00080000 00020000 <span class="string">&quot;Bootloader&quot;</span></span><br><span class="line">mtd2: 00040000 00020000 <span class="string">&quot;Config&quot;</span></span><br><span class="line">mtd3: 00040000 00020000 <span class="string">&quot;Bdata&quot;</span></span><br><span class="line">mtd4: 00040000 00020000 <span class="string">&quot;Factory&quot;</span></span><br><span class="line">mtd5: 00040000 00020000 <span class="string">&quot;crash&quot;</span></span><br><span class="line">mtd6: 00040000 00020000 <span class="string">&quot;crash_syslog&quot;</span></span><br><span class="line">mtd7: 00040000 00020000 <span class="string">&quot;cfg_bak&quot;</span></span><br><span class="line">mtd8: 00400000 00020000 <span class="string">&quot;kernel0&quot;</span></span><br><span class="line">mtd9: 00400000 00020000 <span class="string">&quot;kernel1&quot;</span></span><br><span class="line">mtd10: 01a00000 00020000 <span class="string">&quot;rootfs0&quot;</span></span><br><span class="line">mtd11: 01a00000 00020000 <span class="string">&quot;rootfs1&quot;</span></span><br><span class="line">mtd12: 02600000 00020000 <span class="string">&quot;overlay&quot;</span></span><br><span class="line">mtd13: 01b80000 00020000 <span class="string">&quot;obr&quot;</span></span><br><span class="line">mtd14: 00c1c000 0001f000 <span class="string">&quot;ubi_rootfs&quot;</span></span><br><span class="line">mtd15: 021e8000 0001f000 <span class="string">&quot;data&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>备份，其中Factory中存储了EEPROM的数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /dev/mtd4 &gt; Factory.dump</span><br><span class="line"><span class="built_in">cat</span> /dev/mtd3 &gt; Bdata.dump</span><br><span class="line"></span><br><span class="line"><span class="comment">#on windows</span></span><br><span class="line">scp root@192.168.33.193:/tmp/factory.bin .</span><br><span class="line">scp root@192.168.33.228:/tmp/factory.bin .</span><br></pre></td></tr></table></figure></li>
</ol>

        </div>
    </article>

<article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>Step5</p>
</div>
        <div class="message-body">
            <ol>
<li><p>路由器ssh终端，配置环境变量</p>
<pre><code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nvram写入flash</span></span><br><span class="line"><span class="comment"># Enable uart and boot_wait, useful for testing or recovery if you have an uart adapter!</span></span><br><span class="line">nvram <span class="built_in">set</span> ssh_en=1</span><br><span class="line"><span class="comment"># 设置串口打开，以便ssh失败时，硬件debug</span></span><br><span class="line">nvram <span class="built_in">set</span> uart_en=1 </span><br><span class="line">nvram <span class="built_in">set</span> boot_wait=on</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set kernel1 as the booting kernel</span></span><br><span class="line">nvram <span class="built_in">set</span> flag_boot_success=1</span><br><span class="line">nvram <span class="built_in">set</span> flag_try_sys1_failed=0</span><br><span class="line">nvram <span class="built_in">set</span> flag_try_sys2_failed=0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Commit our nvram changes</span></span><br><span class="line">nvram commit</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>电脑本地准备传输可执行文件(开启了ssh服务，直接scp传上去即可)</p>
<ol>
<li>Rename the file <a target="_blank" rel="noopener" href="http://downloads.openwrt.org/releases/22.03.2/targets/mediatek/mt7622/openwrt-22.03.2-mediatek-mt7622-xiaomi_redmi-router-ax6s-squashfs-factory.bin">openwrt-mediatek-mt7622-xiaomi_redmi-router-ax6s-squashfs-factory.bin</a> you previously downloaded to your computer to <code>factory.bin</code></li>
<li>in the same directory where the file factory.bin is located, run the following command <code>python -m http.server</code></li>
</ol>
</li>
<li><p>路由器ssh终端，配置环境变量接受并运行</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget http://&lt;IP address of your computer&gt;:8000/factory.bin</span><br><span class="line">mtd -r write factory.bin firmware</span><br></pre></td></tr></table></figure>
</li>
<li><p>完成后重启，默认ip变成<code>192.168.1.1</code></p>
</li>
<li><p>失败加上<code>nvram set &quot;boot_fw1=run boot_rd_img;bootm&quot;</code> 重来</p>
</li>
</ol>

        </div>
    </article>

<h2 id="WireGuard-Server-in-OpenWRT"><a href="#WireGuard-Server-in-OpenWRT" class="headerlink" title="WireGuard Server in OpenWRT"></a>WireGuard Server in OpenWRT</h2><h3 id="OpenWRT换软件安装源"><a href="#OpenWRT换软件安装源" class="headerlink" title="OpenWRT换软件安装源"></a>OpenWRT换软件安装源</h3><p>修改<code>/etc/opkg/distfeeds.conf</code>的配置，<a target="_blank" rel="noopener" href="https://doc.embedfire.com/openwrt/user_manal/zh/latest/User_Manual/openwrt/opkg.html">参考</a></p>
<p>下面为x86软路由的源(由于是snapshot的安装不了，<a target="_blank" rel="noopener" href="https://www.right.com.cn/forum/thread-8250249-1-1.html">内核不匹配</a>)，如果是arm的需要看对应架构代号。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src/gz openwrt_core https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/targets/x86/64/packages</span><br><span class="line">src/gz openwrt_base https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/packages/x86_64/base</span><br><span class="line">src/gz openwrt_luci https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/packages/x86_64/luci</span><br><span class="line">src/gz openwrt_packages https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/packages/x86_64/packages</span><br><span class="line">src/gz openwrt_routing https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/packages/x86_64/routing</span><br><span class="line">src/gz openwrt_telephony https://mirrors.ustc.edu.cn/openwrt/releases/22.03.3/packages/x86_64/telephony</span><br></pre></td></tr></table></figure>

<p>比如ax6s</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ax6s ~]$ <span class="built_in">cat</span> /etc/opkg/distfeeds.conf</span><br><span class="line">src/gz openwrt_core https://downloads.openwrt.org/releases/22.03.2/targets/mediatek/mt7622/packages</span><br><span class="line">src/gz openwrt_base https://downloads.openwrt.org/releases/22.03.2/packages/aarch64_cortex-a53/base</span><br><span class="line">src/gz openwrt_luci https://downloads.openwrt.org/releases/22.03.2/packages/aarch64_cortex-a53/luci</span><br><span class="line">src/gz openwrt_packages https://downloads.openwrt.org/releases/22.03.2/packages/aarch64_cortex-a53/packages</span><br><span class="line">src/gz openwrt_routing https://downloads.openwrt.org/releases/22.03.2/packages/aarch64_cortex-a53/routing</span><br><span class="line">src/gz openwrt_telephony https://downloads.openwrt.org/releases/22.03.2/packages/aarch64_cortex-a53/telephony</span><br></pre></td></tr></table></figure>

<p>可以通过<code>cat /etc/os-release</code>查看, 上面的如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# cat /etc/os-release</span><br><span class="line">NAME=&quot;OpenWrt&quot;</span><br><span class="line">VERSION=&quot;SNAPSHOT&quot; # snapshot是开发版的意思</span><br><span class="line">PRETTY_NAME=&quot;OpenWrt SNAPSHOT&quot;</span><br><span class="line">VERSION_ID=&quot;snapshot&quot;</span><br><span class="line">BUILD_ID=&quot;r5636-25f88e06f&quot;</span><br><span class="line">OPENWRT_BOARD=&quot;x86/64&quot;</span><br><span class="line">OPENWRT_ARCH=&quot;x86_64&quot;</span><br><span class="line"></span><br><span class="line">[root@ax6s ~]$ cat /etc/os-release</span><br><span class="line">NAME=&quot;OpenWrt&quot;</span><br><span class="line">VERSION=&quot;22.03.2&quot;</span><br><span class="line">PRETTY_NAME=&quot;OpenWrt 22.03.2&quot;</span><br><span class="line">VERSION_ID=&quot;22.03.2&quot;</span><br><span class="line">BUILD_ID=&quot;r19803-9a599fee93&quot;</span><br><span class="line">OPENWRT_BOARD=&quot;mediatek/mt7622&quot;</span><br><span class="line">OPENWRT_ARCH=&quot;aarch64_cortex-a53&quot;</span><br></pre></td></tr></table></figure>

<h3 id="WireGuard安装服务端程序"><a href="#WireGuard安装服务端程序" class="headerlink" title="WireGuard安装服务端程序"></a>WireGuard安装服务端程序</h3><ol>
<li><p><a target="_blank" rel="noopener" href="https://drive.google.com/drive/folders/1eyIxVfyzO4nyzaT1sSr6xWf50_5YJN7g">eSir精品小包固件下载地址(感谢esir的辛勤付出)</a></p>
<ol>
<li>内置了wireguard(使用对等节点的公私钥加密)</li>
</ol>
</li>
<li><p>OpenWrt安装WireGuard命令(eSir精品小包已集成WireGuard,无需安装)</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install luci-proto-wireguard luci-app-wireguard wireguard kmod-wireguard wireguard-tools</span><br><span class="line">reboot</span><br><span class="line"></span><br><span class="line"><span class="comment"># x86</span></span><br><span class="line">opkg install wireguard luci-app-wireguard luci-i18n-wireguard-zh-cn wireguard-tools</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="WireGuard服务端设置"><a href="#WireGuard服务端设置" class="headerlink" title="WireGuard服务端设置"></a>WireGuard服务端设置</h3><article class="message is-primary">
        <div class="message-header"><p><i class="fa-solid fa-pen-to-square mr-2"></i>具体步骤</p>
</div>
        <div class="message-body">
            <ol>
<li>配置WG服务器端公私钥<img src="https://pic.shaojiemike.top/img/20220823200631.png"></li>
<li>OpenWrt的luci界面配置服务器节点<img src="https://pic.shaojiemike.top/img/20220823200822.png"><img src="https://pic.shaojiemike.top/img/20220823200850.png"><img src="https://pic.shaojiemike.top/img/20220823201004.png"><img src="https://pic.shaojiemike.top/img/20220823201044.png"></li>
<li>OpenWrt-网络-防火墙设置<img src="https://pic.shaojiemike.top/img/20220823201224.png"><ol>
<li>如果OpenWrt做主路由，还需要在<strong>防火墙-&gt;通信规则</strong>中开放端口<img src="https://pic.shaojiemike.top/img/20220823201448.png"></li>
<li>假如是旁路由，需要设置端口转发<img src="https://pic.shaojiemike.top/img/20220823201541.png"></li>
</ol>
</li>
<li>为每个客户端节点创建密钥<img src="https://pic.shaojiemike.top/img/20220823201733.png"></li>
<li>OpenWrt-&gt;网络-&gt;接口，修改原本的WG0设置。修改Peers<img src="https://pic.shaojiemike.top/img/20220823202000.png"><ol>
<li>左下角<code>更多选项</code>选择预共享密钥，添加</li>
<li>由于不能同时用，所以每个机器要单独配置，不能公用</li>
</ol>
</li>
</ol>

        </div>
    </article>

<h3 id="WireGuard客户端设置"><a href="#WireGuard客户端设置" class="headerlink" title="WireGuard客户端设置"></a>WireGuard客户端设置</h3><p>客户端模板文件<code>test.conf</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[Interface]</span><br><span class="line">Address = 192.168.100.2 约定的IP</span><br><span class="line">PrivateKey = cprivatekey文件内容 </span><br><span class="line">DNS = 路由器IP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Peer]</span><br><span class="line">PublicKey = spublickey文件内容  </span><br><span class="line"></span><br><span class="line">AllowedIPs = 0.0.0.0/0</span><br><span class="line">//上面代表所有流量走WG。如果启用下面这行代码,表示只有192.168.2.0/24, 192.168.100.0/24这两个子网的IP走WireGuard</span><br><span class="line">//逗号前是家庭局域网的IP段，后面是VPN的IP段</span><br><span class="line">//AllowedIPs = 192.168.2.0/24, 192.168.100.0/24</span><br><span class="line"></span><br><span class="line">PresharedKey=sharedkey内容</span><br><span class="line">Endpoint = 公网IP（动态域名）:端口号</span><br><span class="line">PersistentKeepalive = 25</span><br></pre></td></tr></table></figure>

<h3 id="WireGuard配置匹配一览图"><a href="#WireGuard配置匹配一览图" class="headerlink" title="WireGuard配置匹配一览图"></a>WireGuard配置匹配一览图</h3><p><code>&quot;[Interface] Address&quot; is the address that gets assigned to the (virtual) network interface (e.g. wg0).</code><br>简单来说客户端和服务器端约定的相同的虚拟地址来通信。<br><img src="https://pic.shaojiemike.top/img/20221031233627.png"><br>注意防火墙放行端口<br><img src="https://pic.shaojiemike.top/img/20230201110425.png"><br><a target="_blank" rel="noopener" href="https://www.wireguard.com/install/">官方客户端软件下载</a></p>
<h3 id="WireGuard常见问题"><a href="#WireGuard常见问题" class="headerlink" title="WireGuard常见问题"></a>WireGuard常见问题</h3><p>注意：如果连接不上</p>
<ol>
<li>首先保证路由器有网，不是路由器下的电脑有网<ol>
<li>上次师兄的电脑开了OpenVPN上网，导致路由器ipv6能ping通，但是不能上网</li>
</ol>
</li>
<li>注意防火墙，一个是wan口允许某几个端口进来(wg连接请求)。另一个是wan能到wg，wg也能到wan，才能实现上网<ol>
<li>至于和lan的关系，如果需要通过wg访问lan口下的设备(nas，电脑)再打开即可。</li>
</ol>
</li>
</ol>
<h2 id="Clash-in-OpenWrt"><a href="#Clash-in-OpenWrt" class="headerlink" title="Clash in OpenWrt"></a>Clash in OpenWrt</h2><ul>
<li>安装版本来自<a target="_blank" rel="noopener" href="https://github.com/vernesong/OpenClash">github</a></li>
<li>但是由于DDNS会出问题，所以关闭了。(可以考虑2次wireguard蹭网和clash for linux)</li>
<li>BT,PT有时也会被代理，需要注意。</li>
</ul>
<h3 id="安装编译好的-IPK-文件（openwrt-的软件包）"><a href="#安装编译好的-IPK-文件（openwrt-的软件包）" class="headerlink" title="安装编译好的 IPK 文件（openwrt 的软件包）"></a>安装编译好的 IPK 文件（openwrt 的软件包）</h3><p>安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#iptables</span></span><br><span class="line">opkg update</span><br><span class="line">opkg install coreutils-nohup bash iptables dnsmasq-full curl ca-certificates ipset ip-full iptables-mod-tproxy iptables-mod-extra libcap libcap-bin ruby ruby-yaml kmod-tun kmod-inet-diag unzip luci-compat luci luci-base</span><br><span class="line"></span><br><span class="line"><span class="comment">#nftables</span></span><br><span class="line">opkg update</span><br><span class="line">opkg install kmod-nft-tproxy</span><br><span class="line"></span><br><span class="line">wget https://github.com/vernesong/OpenClash/releases/download/v0.45.59-beta/luci-app-openclash_0.45.59-beta_all.ipk</span><br><span class="line">root@ax6s:/tmp# opkg install luci.ipk</span><br><span class="line">Installing luci-app-openclash (0.45.59-beta) to root...</span><br><span class="line">Configuring luci-app-openclash.</span><br><span class="line">cfg117882</span><br></pre></td></tr></table></figure>

<p>重启后出现<img src="https://pic.shaojiemike.top/img/20221101155643.png"></p>
<p>注意不会代理ping，所以ping不通的话，可以用curl来测试代理是否生效。https失败可以尝试http</p>
<h3 id="安装问题"><a href="#安装问题" class="headerlink" title="安装问题"></a>安装问题</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Collected errors:</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /etc/hotplug.d/ntp/25-dnsmasqsec</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /etc/init.d/dnsmasq</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /usr/lib/dnsmasq/dhcp-script.sh</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /usr/sbin/dnsmasq</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /usr/share/acl.d/dnsmasq_acl.json</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /usr/share/dnsmasq/dhcpbogushostname.conf</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * check_data_file_clashes: Package dnsmasq-full wants to install file /usr/share/dnsmasq/rfc6761.conf</span><br><span class="line">        But that file is already provided by package  * dnsmasq</span><br><span class="line"> * opkg_install_cmd: Cannot install package luci-app-openclash.</span><br></pre></td></tr></table></figure>

<p>解决办法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg remove dnsmasq &amp;&amp; opkg install dnsmasq-full </span><br></pre></td></tr></table></figure>

<h2 id="DDNS-in-OpenWRT"><a href="#DDNS-in-OpenWRT" class="headerlink" title="DDNS in OpenWRT"></a>DDNS in OpenWRT</h2><h3 id="DDNS简介"><a href="#DDNS简介" class="headerlink" title="DDNS简介"></a>DDNS简介</h3><p>Dynamic DNS： 根據網際網路的域名訂立規則，域名必須跟從固定的IP位址。但動態DNS系統為動態網域提供一個固定的名稱伺服器（Name server），透過即時更新，使外界使用者能夠連上動態使用者的網址。</p>
<p><a target="_blank" rel="noopener" href="https://keesenz.com/2020/1067.html">cloudflare动态域名</a> 或者<a target="_blank" rel="noopener" href="https://blog.csdn.net/pzhier/article/details/111570930">阿里云动态域名</a>的DDNS都是很好的选择。</p>
<h3 id="定时脚本实现DDNS"><a href="#定时脚本实现DDNS" class="headerlink" title="定时脚本实现DDNS"></a>定时脚本实现DDNS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ax6s ~]$ <span class="built_in">cat</span> ddns.sh</span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">Network=wan@eth0</span><br><span class="line"></span><br><span class="line">Date=`<span class="built_in">echo</span> $<span class="string">&#x27;\n\n&#x27;</span> &gt;&gt; /tmp/ddns_ipv4`</span><br><span class="line">Date=`<span class="built_in">echo</span> <span class="string">&quot;<span class="subst">$(date)</span>&quot;</span> &gt;&gt; /tmp/ddns_ipv4`</span><br><span class="line">IPv4=`ip a|grep -A 2 <span class="variable">$&#123;Network&#125;</span>|sed -n <span class="string">&#x27;3p&#x27;</span>|awk  <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> |sed -e <span class="string">&#x27;s/\/[0-9]*//&#x27;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$IPv4</span> &gt;&gt; /tmp/ddns_ipv4</span><br><span class="line">IPv6=`ip a|grep -A 4 <span class="variable">$&#123;Network&#125;</span>|sed -n <span class="string">&#x27;5p&#x27;</span>|awk  <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> |sed -e <span class="string">&#x27;s/\/[0-9]*//&#x27;</span>`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$IPv6</span> &gt;&gt; /tmp/ddns_ipv4</span><br><span class="line"></span><br><span class="line">curl -v http://v6.sync.afraid.org/u/4TY5…………tKF/?address=<span class="variable">$&#123;IPv6&#125;</span> 2&gt;&amp;1 &gt;&gt; /tmp/ddns_ipv4</span><br><span class="line">curl -v http://sync.afraid.org/u/M8uh9Zf…………ryjxs/?address=<span class="variable">$&#123;IPv4&#125;</span> 2&gt;&amp;1 &gt;&gt; /tmp/ddns_ipv4</span><br></pre></td></tr></table></figure>

<p>修改<code>crontab -e</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin</span><br><span class="line">4,9,14,19,24,29,34,39,44,49,54,59 * * * * <span class="built_in">sleep</span> 11 ; /root/ddns.sh</span><br></pre></td></tr></table></figure>

<h3 id="OpenWRT-为局域网设备设置IPv6-DDNS"><a href="#OpenWRT-为局域网设备设置IPv6-DDNS" class="headerlink" title="OpenWRT 为局域网设备设置IPv6 DDNS"></a>OpenWRT 为局域网设备设置IPv6 DDNS</h3><p>脚本围绕，打印邻居路由表命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ax6s ~]$ ip -6 neigh | grep 2c:f0:5d</span><br><span class="line">2001:da8:d800:611:1818:61b6:6422:56a1 dev br-lan lladdr 2c:f0:5d:ac:1d:2c DELAY</span><br><span class="line">2001:da8:d800:611:5464:f7ab:9560:a646 dev br-lan lladdr 2c:f0:5d:ac:1d:2c STALE</span><br><span class="line">2001:da8:d800:611:4d13:ead8:9aaf:bfc4 dev br-lan lladdr 2c:f0:5d:ac:1d:2c REACHABLE</span><br><span class="line">2001:da8:d800:611:a063:863f:caa3:4a73 dev br-lan lladdr 2c:f0:5d:ac:1d:2c STALE</span><br><span class="line">2001:da8:d800:611:8c75:4f49:f9d0:42b6 dev br-lan lladdr 2c:f0:5d:ac:1d:2c STALE</span><br></pre></td></tr></table></figure>

<p>新建 <code>/usr/lib/ddns/dynamic_dns_iphelper.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">get_ip</span></span>()&#123;</span><br><span class="line">    MAC=<span class="variable">$1</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$MAC</span>&quot;</span> = <span class="string">&quot;&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    IP=$(ip -6 neigh | grep -i <span class="variable">$MAC</span> | grep -v <span class="string">&quot;fe80:&quot;</span> | grep -E <span class="string">&quot;REACHABLE|STALE&quot;</span> | <span class="built_in">cut</span> -d<span class="string">&quot; &quot;</span> -f1 | grep -m 1 -E -o <span class="string">&quot;([0-9a-fA-F]&#123;1,4&#125;(:?))&#123;8&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$IP</span>&quot;</span> = <span class="string">&quot;&quot;</span> ]</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">        IP=$(mac_to_ipv6_ll <span class="variable">$MAC</span> $(get_ip_prefix))</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$IP</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">mac_to_ipv6_ll</span></span>() &#123;</span><br><span class="line">    PREFIX=<span class="string">&quot;fe80::&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> = 2 ]; <span class="keyword">then</span></span><br><span class="line">        PREFIX=<span class="variable">$2</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    IFS=<span class="string">&#x27;:&#x27;</span>; <span class="built_in">set</span> <span class="variable">$1</span>; <span class="built_in">unset</span> IFS</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;$PREFIX<span class="subst">$(printf %02x $((0x$1 ^ 2)</span>))<span class="variable">$2</span>:<span class="variable">$&#123;3&#125;</span>ff:fe<span class="variable">$4</span>:$5<span class="variable">$6</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="title">get_ip_prefix</span></span>() &#123;</span><br><span class="line">    IP_PREFIX=$(ip -6 addr | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | grep <span class="string">&#x27;::1&#x27;</span> | grep -m 1 -E -o <span class="string">&quot;([0-9a-fA-F]&#123;1,4&#125;(:?))&#123;4&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$IP_PREFIX</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> != <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> `get_ip <span class="variable">$1</span>`</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>新建 <code>/usr/lib/ddns/getip_demo.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"> </span><br><span class="line">. /usr/lib/ddns/dynamic_dns_iphelper.sh</span><br><span class="line"><span class="comment"># 遵循 EUI-64 的设备使用这个方式 可以获取到静态后缀的IPv6地址</span></span><br><span class="line"><span class="comment"># 00:00:00:00:00:00修改为目标设备的MAC地址</span></span><br><span class="line"><span class="built_in">echo</span> $(mac_to_ipv6_ll <span class="string">&quot;00:00:00:00:00:00&quot;</span> $(get_ip_prefix))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"> </span><br><span class="line">. /usr/lib/ddns/dynamic_dns_iphelper.sh</span><br><span class="line"><span class="comment"># 00:00:00:00:00:00修改为目标设备的MAC地址</span></span><br><span class="line"><span class="comment"># 不遵循 EUI-64 的设备 可以获取到动态IPv6地址</span></span><br><span class="line"><span class="built_in">echo</span> `get_ip <span class="string">&quot;00:00:00:00:00:00&quot;</span>`</span><br></pre></td></tr></table></figure>

<p>脚本<code>chmod +x</code>就行<img src="https://pic.shaojiemike.top/img/20230104210347.png"></p>
<h2 id="School-Network"><a href="#School-Network" class="headerlink" title="School Network"></a>School Network</h2><ul>
<li>根据学校的网络通各个端口的说明，0号端口没有经过NAT，登录之后获得公网ipv4。但是IPv4封了许多端口(至少ssh的22端口是不行的)</li>
<li>IPv6是直接可以ssh访问的。</li>
</ul>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=F8z74oE71Gg&t=19s">https://www.youtube.com/watch?v=F8z74oE71Gg&amp;t=19s</a></p>
<p><a target="_blank" rel="noopener" href="https://xiumu.org/technology/openwrt-set-for-local-area-network-lan-equipment-ipv6-ddns.shtml">https://xiumu.org/technology/openwrt-set-for-local-area-network-lan-equipment-ipv6-ddns.shtml</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-25T15:46:51.000Z" title="3/25/2023, 3:46:51 PM">2023-03-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.357Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">a few seconds read (About 51 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/25/Work/network/vpn/OpenWRTNetworkManage/">OpenWRTNetworkManage</a></p><div class="content"><p><a href="#refer-anchor"><sup>2</sup></a><br>觉得有意义写，先占个位子</p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><div id='refer-anchor'></div>
无

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-02-11T23:41:06.000Z" title="2/11/2023, 11:41:06 PM">2023-02-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.353Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">3 minutes read (About 516 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/11/Work/network/Protocol/webdav/">Webdav</a></p><div class="content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="Webdav"><a href="#Webdav" class="headerlink" title="Webdav"></a>Webdav</h3><p>WebDAV由互联网工程任务组的工作组在RFC 4918中定义。是基于Web的分布式编写和版本控制（WebDAV）是超文本传输协议（HTTP）的扩展，</p>
<p>WebDAV协议为用户在服务器上创建，更改和移动文档提供了一个框架。有利于用户间协同编辑和管理存储在万维网服务器文档。</p>
<p>WebDAV协议最重要的功能包括：</p>
<ul>
<li><p>维护作者或修改日期的属性、名字空间管理、集合和覆盖保护。</p>
</li>
<li><p>维护属性包括创建、删除和查询文件信息等。</p>
</li>
<li><p>名字空间管理处理在服务器名称空间内复制和移动网页的能力。</p>
</li>
<li><p>集合（Collections）处理各种资源的创建、删除和列举。</p>
</li>
<li><p>覆盖保护处理与锁定文件相关的方面。</p>
</li>
<li><p>可以使用https来保证安全</p>
</li>
</ul>
<h3 id="Samba-CIFS"><a href="#Samba-CIFS" class="headerlink" title="Samba &#x2F; CIFS"></a>Samba &#x2F; CIFS</h3><p>局域网传输，没有加密</p>
<h2 id="群晖开启WebDaV"><a href="#群晖开启WebDaV" class="headerlink" title="群晖开启WebDaV"></a>群晖开启WebDaV</h2><p>参考<a target="_blank" rel="noopener" href="https://kb.synology.cn/zh-cn/DSM/tutorial/How_to_access_files_on_Synology_NAS_with_WebDAV">教程</a>, 开启 https 5555 端口, http 5556端口</p>
<p>设置特殊用户keeweb来访问下载文件夹keeweb下内容。如<code>https://10.0.233.3:5555/keeweb/1.txt</code></p>
<h3 id="windows挂载"><a href="#windows挂载" class="headerlink" title="windows挂载"></a>windows挂载</h3><p>安装<a target="_blank" rel="noopener" href="https://www.raidrive.com/download">RaiDrive</a></p>
<h2 id="测速"><a href="#测速" class="headerlink" title="测速"></a>测速</h2><h3 id="大文件"><a href="#大文件" class="headerlink" title="大文件"></a>大文件</h3><p>在1.63GB大文件的时候，SMB能稳定的跑满千兆全速<br><img src="https://pic.shaojiemike.top/img/20230212084506.png"></p>
<h3 id="2M中文件"><a href="#2M中文件" class="headerlink" title="2M中文件"></a>2M中文件</h3><p>首先通过<code>split</code>来拆分文件来测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">split -b 2M 1.mkv split.mkv</span><br></pre></td></tr></table></figure>
<p>在2M的时候，WebDav有些许优势<br><img src="https://pic.shaojiemike.top/img/20230212084420.png"></p>
<h3 id="4K小碎片"><a href="#4K小碎片" class="headerlink" title="4K小碎片"></a>4K小碎片</h3><p>在4K的时候，WebDav较大优势<br><img src="https://pic.shaojiemike.top/img/20230212084328.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><ol>
<li>网上有传言 <a target="_blank" rel="noopener" href="https://serverdiary.com/featured/webdav-vs-samba-cifs-file-system-write-and-read-speed-test/">WebDav 比 SMB快 8~9倍</a>，但是有人质疑是缓存的原因</li>
<li>keepass同步可以通过坚果云的WebDav</li>
</ol>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://www.rmnof.com/article/better-ways-to-use-webdav/">https://www.rmnof.com/article/better-ways-to-use-webdav/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-01-31T16:00:00.000Z" title="1/31/2023, 4:00:00 PM">2023-01-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.349Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">24 minutes read (About 3650 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/31/Work/network/0-basic/ipv6/">IPV4 &amp;&amp; IPV6</a></p><div class="content"><h2 id="IPV4"><a href="#IPV4" class="headerlink" title="IPV4"></a>IPV4</h2><p>展示了A、B、C类IP地址的二进制表示和它们的特征：</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>地址范围</th>
<th>网络数</th>
<th>主机数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>0xxxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</td>
<td>1-126</td>
<td>2^24-2</td>
<td>第一位为0</td>
</tr>
<tr>
<td>B</td>
<td>10xxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</td>
<td>128-191</td>
<td>2^16-2</td>
<td>前两位为10</td>
</tr>
<tr>
<td>C</td>
<td>110xxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</td>
<td>192-223</td>
<td>2^8-2</td>
<td>前三位为110</td>
</tr>
<tr>
<td>D</td>
<td>1110xxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</td>
<td>224-239</td>
<td>不适用</td>
<td>用于多播</td>
</tr>
<tr>
<td>E</td>
<td>11110xxx.xxxxxxxx.xxxxxxxx.xxxxxxxx</td>
<td>240-255</td>
<td>不适用</td>
<td>保留用于实验和未来使用</td>
</tr>
</tbody></table>
<p>在这个表格中：</p>
<ul>
<li>A类地址的范围是从 <code>0.0.0.0</code> 到 <code>127.255.255.255</code>，第一位必须是0。</li>
<li>B类地址的范围是从 <code>128.0.0.0</code> 到 <code>191.255.255.255</code>，前两位必须是10。</li>
<li>C类地址的范围是从 <code>192.0.0.0</code> 到 <code>223.255.255.255</code>，前三位必须是110。</li>
</ul>
<p>D类和E类地址用于特殊用途，不用于普通的网络和主机地址分配。</p>
<h2 id="拥抱ipv6"><a href="#拥抱ipv6" class="headerlink" title="拥抱ipv6"></a>拥抱ipv6</h2><p>ipv6 原本是为了解决ipv4不足而提出的：</p>
<ul>
<li>IPv4的地址范围是<code>0.0.0.0~255.255.255.255</code>，其地址总量约43亿个（2的32次方），这其中还要刨去私有网段、网络ID、广播ID、保留网段、本地环回、组播地址等特殊地址段，最终的实际可用地址约为25.68亿个，全球互联网设备数是远超这个的。所以一方面设计了私有地址来上网</li>
<li>另一方面就是ipv6。IPv6的地址长度为128位，虽然地址长度仅仅是IPv4的4倍（IPv4是32位的），但IPv6的地址总量却达到了惊人的$2^{128}$。换一种更通俗的说法：地球上每一平方米，都可以分到10^26次方个IPv6地址，夸张一点来说，可以给每一粒尘埃都分配到一个地址。</li>
</ul></div><a class="article-more button is-small is-size-7" href="/2023/01/31/Work/network/0-basic/ipv6/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-01-11T04:26:24.000Z" title="1/11/2023, 4:26:24 AM">2023-01-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.181Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">a few seconds read (About 28 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/11/OutOfWork/5-VideoEntertainment/audio/">Audio</a></p><div class="content"><p>基本的音视频编码知识</p></div><a class="article-more button is-small is-size-7" href="/2023/01/11/OutOfWork/5-VideoEntertainment/audio/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-01-01T16:00:00.000Z" title="1/1/2023, 4:00:00 PM">2023-01-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.269Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">19 minutes read (About 2775 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/01/Work/Miscellaneous/info/video/">Video</a></p><div class="content"><h2 id="视频信息软件Mediainfo"><a href="#视频信息软件Mediainfo" class="headerlink" title="视频信息软件Mediainfo"></a>视频信息软件Mediainfo</h2><p>同样是1080P 25帧，码率不同，大小差异很大。<br><img src="https://pic.shaojiemike.top/img/20221116083218.png"></p>
<p>或者(有时候会失效，eg 720P)</p>
<p><img src="https://pic.shaojiemike.top/img/20221116083643.png"></p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><h3 id="CRF"><a href="#CRF" class="headerlink" title="CRF"></a>CRF</h3><p>CRF(英文：constant ratefactor 意思：压缩质量)是动态码率，要看你拍摄的视频画面抖动切换的程度，如果比较安静就20，动的厉害就25。</p>
<p>crf18就接近无损，字幕组惯用20-22，crf23是默认值。 CRF的值越小，视频将会越清晰 当然视频质量就会更大。</p>
<p><img src="https://pic.shaojiemike.top/img/20230102162838.png"></p>
<h3 id="2-pass"><a href="#2-pass" class="headerlink" title="2-pass"></a>2-pass</h3><p>2-pass通过两次编码，第一次编码是先对整个文件进行扫描，记录一些统计信息，第二次编码时根据前面记录的统计信息再进行编码。这么做虽然转换时间会漫长，但压出的片子会有更好的画质，画面细节更好，而且体积会更小。</p>
<p>常用于非实时转码的情景。</p>
<h2 id="视频压缩实践"><a href="#视频压缩实践" class="headerlink" title="视频压缩实践"></a>视频压缩实践</h2><p>疫情线上参会邮件投递Presentation视频，邮件大小限制100MB。PPT生成的过大</p>
<h3 id="格式工厂-Format-Factory-压缩"><a href="#格式工厂-Format-Factory-压缩" class="headerlink" title="格式工厂(Format Factory)压缩"></a>格式工厂(Format Factory)压缩</h3><p>直接自定义导入导出，默认设置就行（确定分辨率不变的情况下，大小无法限制）。视频部分就只有原来五分之一(中间)，而且完全看不出损失。<br><img src="https://pic.shaojiemike.top/img/20230102102531.png"></p>
<p>如果要最小大小，选择“转mp4”，然后“输出设置”选择“低质量和大小”，最后在分辨率选回原来的分辨率。</p>
<p>如果不熟悉H.265的参数设置，压缩后不一定比H.264小。</p>
<p>PS: H.264中熵编码有两种方法：</p>
<ol>
<li>一种是对所有的待编码的符号采用统一的VLC（UVLC ：Universal VLC），</li>
<li>另一种是采用内容自适应的二进制算术编码（CABAC：Context-Adaptive Binary Arithmetic Coding）。CABAC是<strong>可选项</strong>。</li>
</ol>
<p>CABAC动态的根据内容的码率能在效能与压缩效率上取得相当大的改善空间，但是顺序处理造成资料依存性（Data Dependency）偏高。</p>
<h3 id="FFmpeg命令行"><a href="#FFmpeg命令行" class="headerlink" title="FFmpeg命令行"></a>FFmpeg命令行</h3><p>已知大小需求来计算需要压缩的码率。直接设置压缩后的平均码率就行，常见软件有：小丸工具箱，HandBrake, 剪映</p>
<p>首先需要知道<strong>如何计算码率</strong></p>
<p><img src="https://pic.shaojiemike.top/img/20230102112312.png"><br><img src="https://pic.shaojiemike.top/img/20230111121547.png"></p>
<p>ffmpeg是一个自由软件，可以运行音频、视频多种格式的录影、转换、流功能，包含</p>
<ul>
<li>libavcodec–这是一个用于多个项目中的音频、视频的解码器库，</li>
<li>libavformat–一个音频和视频格式转换库。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 视频流码率 500k, 音频流码率 50k</span><br><span class="line">ffmpeg -i huawei_report_English_video.mp4 -c:v libx264 -b:v 500k -b:a 50k out_500k.mp4    </span><br><span class="line"># 或者设置最大最小</span><br><span class="line">ffmpeg -i huawei_report_English_video.mp4 -minrate 100K -maxrate 500K -bufsize 2000K out.mp4</span><br></pre></td></tr></table></figure>
<p>结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">-rw-r--r--  1 shaojiemike staff 119M Jan  2 16:59 huawei_report_English_video.mp4</span><br><span class="line">-rw-r--r--  1 shaojiemike staff  50M Jan  2 17:23 out_500k.mp4</span><br><span class="line">-rw-r--r--  1 shaojiemike staff  24M Jan  2 17:14 out.mp4</span><br><span class="line"></span><br><span class="line">$ ffmpeg -i out_500k.mp4 -hide_banner</span><br><span class="line">  Duration: 00:12:25.68, start: 0.000000, bitrate: 553 kb/s</span><br><span class="line">    Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 1280x720 [SAR 1:1 DAR 16:9], 493 kb/s, 30.30 fps, 30.30 tbr, 30303 tbn, 60.61 tbc (default)</span><br><span class="line">    Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 50 kb/s (default)</span><br><span class="line"></span><br><span class="line"># shaojiemike @ snode6 in ~/test/ffmpeg [17:14:42] C:1</span><br><span class="line">$ ffmpeg -i out.mp4 -hide_banner</span><br><span class="line">  Duration: 00:12:25.68, start: 0.000000, bitrate: 269 kb/s</span><br><span class="line">    Stream #0:0(und): Video: h264 (High) (avc1 / 0x31637661), yuv420p, 1280x720 [SAR 1:1 DAR 16:9], 125 kb/s, 30.30 fps, 30.30 tbr, 30303 tbn, 60.61 tbc (default)</span><br><span class="line">    Stream #0:1(und): Audio: aac (LC) (mp4a / 0x6134706D), 44100 Hz, stereo, fltp, 134 kb/s (default)</span><br><span class="line"></span><br><span class="line"># shaojiemike @ snode6 in ~/test/ffmpeg [17:15:29] C:1</span><br><span class="line">$ ffmpeg -i huawei_report_English_video.mp4 -hide_banner</span><br><span class="line">  Duration: 00:12:25.66, start: 0.000000, bitrate: 1330 kb/s</span><br><span class="line">    Stream #0:0(und): Video: h264 (Constrained Baseline) (avc1 / 0x31637661), yuv420p, 1280x720 [SAR 1:1 DAR 16:9], 1151 kb/s, 30.30 fps, 30.30 tbr, 30303 tbn, 60 tbc (default)</span><br></pre></td></tr></table></figure>
<h2 id="视频码率（视频比特率）"><a href="#视频码率（视频比特率）" class="headerlink" title="视频码率（视频比特率）"></a>视频码率（视频比特率）</h2><p>同样分辨率下，视频文件的码率越大，压缩比就越小，画面质量就越高。码率越高，精度就越高，处理出来的文件就越接近原始文件，图像质量越好，画质越清晰，要求播放设备的解码能力也越高。体积越大，说明压缩比小，越接近原文件。</p>
<p><strong>帧率与码率的关系：帧率多，则每秒图片数目多；码率越高，每张图片质量越清晰。</strong></p>
<h3 id="码率的甜品点"><a href="#码率的甜品点" class="headerlink" title="码率的甜品点"></a>码率的甜品点</h3><p><a target="_blank" rel="noopener" href="https://github.com/Netflix/vmaf">VMAF - Video Multi-Method Assessment Fusion</a> 视频多方法评估</p>
<p><img src="https://pic.shaojiemike.top/img/20230111122141.png"></p>
<p>3Mbps是1080p的甜品点。</p>
<p>其他标准</p>
<p><img src="https://pic.shaojiemike.top/img/20230111122313.png"></p>
<h2 id="视频压缩编码"><a href="#视频压缩编码" class="headerlink" title="视频压缩编码"></a>视频压缩编码</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19Y4113788/?spm_id_from=333.337.search-card.all.click&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3">视频压缩原理</a>看差评君的就懂了，讲的真好。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1nW4y1V7kR/?spm_id_from=333.851.b_62696c695f7265706f72745f6b6e6f776c65646765.44&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3">柴知道也行</a></p>
<p>为什么有这么多标准：</p>
<p>H26x的视频的编解码“贵”：</p>
<ul>
<li>视频编码由视频作者解决</li>
<li>使用H26x标准解码价格不菲</li>
</ul>
<h2 id="视频编码"><a href="#视频编码" class="headerlink" title="视频编码"></a>视频编码</h2><p>　　我们知道，其实视频就是一帧一帧的图片。计算一下，一部25帧每秒，90分钟，分辨率为1024*768，24位真彩色的视频，没有经过压缩，大小为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1Byte（字节） = 8bit（位）</span><br><span class="line">一帧大小 = 1024 * 768 * 24 = 18874368（bit） = 2359296（Byte）</span><br><span class="line">总帧数 = 90 * 60 * 25 = 135000</span><br><span class="line">总大小 = 一帧大小 * 总帧数 = 2359296 * 135000 = 318504960000（Byte）= 303750（MB）≈ 296（GB）</span><br></pre></td></tr></table></figure>
<p>　　从上面的计算可以看出，我们储存一部90分钟没压缩的电影需要296GB的，2部电影便可占满我们电脑整个硬盘。所以我们需要对视频进行压缩，这种视频压缩技术就是我们所说的编码。<br>　　视频编码方式：H.26X（H.261、H.262、…、H.264（目前最常用）、H.265）<br>　　音频编码方式：MP3、AAC等<br>　　通过视频压缩算法，减少了视频文件的大小。压缩比越大，解压缩还原后播放的视频越失真，这是因为压缩的同时不可避免的丢失了视频中原来图像的数据信息。</p>
<p>一般ITU(国际电信联盟)和ISO(国际标准化组织)来制定</p>
<ol>
<li>ISO主导的MPEG系列： MPEG-1 用于 VCD， MPEG-2用于DVD<img src="https://pic.shaojiemike.top/img/20230111121411.png"></li>
<li>h.26x由ITU主导，比如 H.261到H.263</li>
<li>两者联合制定了 H.264-H.265 <ol>
<li>各自别称 MPEG-4&#x2F;AVC(Advanced Video Coding)和 MPEG-4&#x2F;HEVC(High Efficiency Video Coding)<br><img src="https://pic.shaojiemike.top/img/20221225193754.png"></li>
</ol>
</li>
</ol>
<p>B站新支持的AOM联盟的AV1标准，免费而且没有潜在的版权问题。<br><img src="https://pic.shaojiemike.top/img/20221225195340.png"></p>
<p>画质不变时，编码标准越先进，码率越低.<br><img src="https://pic.shaojiemike.top/img/20221225200508.png"><br><img src="https://pic.shaojiemike.top/img/20221225201027.png"></p>
<p><del>相对于优酷等最高大约4000的码率，虽然B站码率低，但是以普通的动画素材为主的视频而言，因为动画以简单的单色大色块居多，一般来说1500左右的码率就足够了。</del></p>
<p>目前 AVC 依然是使用最广泛的编码标准，<strong>无论新老设备都可以播放 AVC 视频</strong>，因此保留 AVC 编码可以保证广泛的兼容性。</p>
<p>但是 AVC 在编码超高清视频时，<strong>输出码率较高，无法保证良好的观看体验</strong>；同时很多 AVC 解码器也不支持 HDR 和 8K 视频的解码。而 HEVC 和 AV1 对于超高清视频的压缩能力明显提升，对于 HDR 和 8K 视频的支持显著改善，因此 B 站使用更先进的编码标准为用户提供服务。</p>
<h2 id="H-261的关键两原理"><a href="#H-261的关键两原理" class="headerlink" title="H.261的关键两原理"></a>H.261的关键两原理</h2><h3 id="DCT变换"><a href="#DCT变换" class="headerlink" title="DCT变换"></a>DCT变换</h3><p>低频率部分是最重要的信息。<br><img src="https://pic.shaojiemike.top/img/20221225192611.png"></p>
<h3 id="视频帧分类-初版"><a href="#视频帧分类-初版" class="headerlink" title="视频帧分类(初版)"></a>视频帧分类(初版)</h3><p>先将视频分块，</p>
<ol>
<li>重用不变的色块</li>
<li>对于平移的色块只记录移动矢量</li>
</ol>
<p><img src="https://pic.shaojiemike.top/img/20221225192912.png"></p>
<p>帧间预测 &amp; 帧内预测<br><img src="https://pic.shaojiemike.top/img/20230111121011.png"><br><img src="https://pic.shaojiemike.top/img/20230111121048.png"><br>关键帧I帧 与 预测帧P帧<br><img src="https://pic.shaojiemike.top/img/20230101121209.png"></p>
<h2 id="MPEG-1"><a href="#MPEG-1" class="headerlink" title="MPEG-1"></a>MPEG-1</h2><p>在 H.261 的基础上加入</p>
<ol>
<li>双向预测帧B帧<ol>
<li>更省空间，但是视频编码解码需要算力更大</li>
</ol>
</li>
<li>帧序列的概念</li>
</ol>
<h2 id="BT文件命名概述"><a href="#BT文件命名概述" class="headerlink" title="BT文件命名概述"></a>BT文件命名概述</h2><p><img src="https://pic.shaojiemike.top/img/20230111122645.png"></p>
<ul>
<li>标 AVC &#x2F; H264 &#x2F; H.264 &#x2F; x264 的可以一律看作H264</li>
<li>标 HEVC &#x2F; HVC1 &#x2F; H265 &#x2F; H.265 &#x2F; x265 的可以一律看作H265</li>
<li>GB &#x2F; CHS &#x2F; SC &#x2F; zh-Hans 指简中</li>
<li>BIG5 &#x2F; CHT &#x2F; TC &#x2F; zh-Hant 指繁中</li>
<li>远离闲杂播放器，拥抱 Potplayer &#x2F; IINA &#x2F; VLC &#x2F; MPC-BE &#x2F; MPV</li>
<li>容器<ul>
<li>mkv，mp4</li>
<li>rmvb<ul>
<li>RealMedia可变比特率（RMVB）。在网速缓慢的时代，边下载边看是巨大优势</li>
<li>缺点：rm&#x2F;rmvb格式编解码都是要收费。压缩比和速度都远逊于H264</li>
</ul>
</li>
<li>avi<ul>
<li>AVI是英语Audio Video Interleave（“音频视频交织”或译为“音频视频交错”）的首字母缩写，由微软在1992年11月推出的一种多媒体文件格式，用于对抗苹果Quicktime的技术。 现在所说的AVI多是指一种封装格式。</li>
<li>图像数据和声音数据是交互存放的。从尾部的索引可以索引跳到自己想放的位置。</li>
<li>AVI與MP4本身只有聲音與影像沒有字幕</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="文字编码"><a href="#文字编码" class="headerlink" title="文字编码"></a>文字编码</h2><p><img src="https://pic.shaojiemike.top/img/20230111125846.png"></p>
<ul>
<li>ANSI 编码<ul>
<li>美国国家标准学会(American National Standards Institute)的缩写</li>
<li>ANSI并不是某一种特定的字符编码，而是在不同的系统中，ANSI表示不同的编码</li>
<li>在简体中文系统下，ANSI 编码代表 GB2312 编码，在日文操作系统下，ANSI 编码代表 JIS 编码。</li>
</ul>
</li>
<li>GB2312<ul>
<li>国家推出的常见6000汉字</li>
</ul>
</li>
<li>GBK <ul>
<li>微软拓展了繁体汉字的普通技术规范，所以windows上基本都是默认GBK</li>
<li><img src="https://pic.shaojiemike.top/img/20230111125204.png"></li>
</ul>
</li>
<li>UNICODE<ul>
<li>Universal Multiple-Octet Coded Character Set 统一码，初始就25种文字</li>
<li><img src="https://pic.shaojiemike.top/img/20230111125413.png"></li>
<li>采用了书写编码，导致会有长得像，但是完全不同的文字。导致很多钓鱼网站</li>
</ul>
</li>
<li>UTF-8编码<ul>
<li>UTF-8全称：8bit Unicode Transformation Format，8比特Unicode通用转换格式，是一种变长的编码方式。</li>
<li>其编码中的第一个字节仍然与ASCII兼容。</li>
</ul>
</li>
</ul>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a target="_blank" rel="noopener" href="https://bravoing.github.io/2020/02/14/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86%E3%80%81%E5%88%86%E8%BE%A8%E7%8E%87%E3%80%81%E5%B8%A7%E7%8E%87%E3%80%81%E7%A0%81%E7%8E%87/">https://bravoing.github.io/2020/02/14/%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%99%A8%E5%8E%9F%E7%90%86%E3%80%81%E5%88%86%E8%BE%A8%E7%8E%87%E3%80%81%E5%B8%A7%E7%8E%87%E3%80%81%E7%A0%81%E7%8E%87/</a></p>
<p>作者：哔哩哔哩技术 <a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv16198183">https://www.bilibili.com/read/cv16198183</a> 出处：bilibili</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=0LSHhatwTxM">https://www.youtube.com/watch?v=0LSHhatwTxM</a>  </p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1nW4y1V7kR/?spm_id_from=333.851.b_62696c695f7265706f72745f6b6e6f776c65646765.44&vd_source=5bbdecb1838c6f684e0b823d0d4f6db3">柴知道也行</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c23f3ea5443d">https://www.jianshu.com/p/c23f3ea5443d</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-12-31T00:54:56.000Z" title="12/31/2022, 12:54:56 AM">2022-12-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-10-16T09:21:31.353Z" title="10/16/2024, 9:21:31 AM">2024-10-16</time></span><span class="level-item"><a class="link-muted" href="/categories/toLearn/">toLearn</a></span><span class="level-item">13 minutes read (About 1989 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/12/31/Work/network/Protocol/streamProtocolCoding/">Streaming Protocol &amp; Streaming Coding</a></p><div class="content"><h2 id="流式传输-协议"><a href="#流式传输-协议" class="headerlink" title="流式传输 协议"></a>流式传输 协议</h2><p>常用的流媒体协议主要有两类：</p>
<ul>
<li>HTTP渐进下载</li>
<li>基于RTSP&#x2F;RTP的实时流媒体协议。</li>
</ul>
<p>在流式传输的实现方案中，一般采用</p>
<ol>
<li>HTTP&#x2F;TCP来传输控制信息，</li>
<li>用RTP&#x2F;UDP来传输实时多媒体数据。</li>
</ol>
<h3 id="RTP-、-RTCP-Real-time-Transport-Control-Protocol"><a href="#RTP-、-RTCP-Real-time-Transport-Control-Protocol" class="headerlink" title="RTP 、 RTCP (Real-time Transport Control Protocol)"></a>RTP 、 RTCP (Real-time Transport <del>Control</del> Protocol)</h3><ul>
<li>由IETF的多媒体传输工作小组1996年在RFC 1889中公布。</li>
<li>RTCP是RTP的一个姐妹协议</li>
<li>RTP协议的特点<ul>
<li>RTP协议是建立在UDP协议上的。</li>
<li>RTP并不保证传送或防止无序传送，也不确定底层网络的可靠性。</li>
<li>RTP实行有序传送，RTP中的序列号允许接收方重组发送方的包序列。</li>
<li>RTP不像http和ftp可完整的下載整個影視檔，它是以固定的資料率在網路上發送資料，用戶端也是按照這種速度觀看影視檔，<strong>當影視畫面播放過後，就不可以再重複播放，除非重新向伺服器端要求資料。</strong></li>
</ul>
</li>
<li>RTCP特点<ul>
<li>RTCP的主要功能是为RTP所提供的服务质量<strong>提供反馈来试图提高服务质量</strong>。RTCP收集相关媒体连接的统计信息，例如：传输字节数，传输分组数，丢失分组数，时延抖动，单向和双向网络延迟等等。来判断是否限制信息流量或改用压缩比较小的编解码器。</li>
<li>RTCP本身不提供数据加密或身份认证，其伴生协议<strong>SRTCP安全实时传输控制协议</strong>则可用于此类用途。</li>
</ul>
</li>
</ul>
<p><img src="https://pic.shaojiemike.top/img/20221231094108.png"></p>
<h3 id="SRTP-SRTCP（Secure-Real-time-Transport-Protocol）"><a href="#SRTP-SRTCP（Secure-Real-time-Transport-Protocol）" class="headerlink" title="SRTP &amp; SRTCP（Secure Real-time Transport Protocol）"></a>SRTP &amp; SRTCP（Secure Real-time Transport Protocol）</h3><ul>
<li>最早由IETF於2004年3月作為RFC3711發佈，提供加密、消息認證、完整性保證和重放保護。</li>
</ul>
<h3 id="RTSP-Realtime-Streaming-Protocol"><a href="#RTSP-Realtime-Streaming-Protocol" class="headerlink" title="RTSP(Realtime Streaming Protocol)"></a>RTSP(Realtime Streaming Protocol)</h3><ul>
<li>于1998年发布为RFC 2326。RTSP 2.0 于2016年发布为RFC 7826，作为RTSP 1.0的替代品。</li>
<li>专为娱乐和通信系统的使用，以<strong>控制</strong>流媒体服务器。<ul>
<li>媒体服务器的客户端发布VCR命令，例如播放，录制和暂停，以便于实时控制从服务器到客户端（视频点播）或从客户端到服务器（语音录音）的媒体流。</li>
</ul>
</li>
<li><strong>流数据本身的传输不是RTSP的任务</strong>。大多数RTSP服务器使用实时传输协议（RTP）和实时传输控制协议（RTCP）结合媒体流传输。</li>
<li>与RTP最大的区别在于：<ul>
<li>RTSP是一种双向实时数据传输协议，它<strong>允许客户端向服务器端发送请求</strong>，如回放、快进、倒退等操作</li>
<li>当然RTSP可基于RTP来传送数据，还可以选择TCP、UDP、组播UDP等通道来发送数据，具有很好的扩展性。</li>
<li>它是一种类似于HTTP协议的网络应用协议。</li>
</ul>
</li>
</ul>
<h3 id="RTMP-Real-Time-Messaging-Protocol"><a href="#RTMP-Real-Time-Messaging-Protocol" class="headerlink" title="RTMP(Real Time Messaging Protocol)"></a>RTMP(Real Time Messaging Protocol)</h3><ul>
<li>Adobe于2012年12月21日发布了该协议1.0版本的规范。</li>
<li>是 Adobe Systems 公司为 Flash 播放器和服务器之间音频、视频和数据传输开发的开放协议。</li>
<li>协议基于 TCP，是一个协议族，包括 RTMP 基本协议及 RTMPT&#x2F;RTMPS&#x2F;RTMPE 等多种变种。<ul>
<li>RTMPT封装在HTTP请求之中，可穿越防火墙；</li>
<li>RTMPS类似RTMPT，但使用的是HTTPS连接。</li>
<li>RTMPE，使用Adobe自有安全機制加密的RTMP。雖然實現上的細節是專有的，但該機制使用行業標準的密碼學加密演算法。</li>
</ul>
</li>
<li>RTMP 是<strong>目前主流</strong>的流媒体传输协议，广泛用于直播领域。</li>
<li>默认通信端口1935。RTMP URL格式：<code>rtmp://ip:[port]/appName/streamName</code></li>
<li>特点<ul>
<li>RTMP协议是采用实时的流式传输，所以不会缓存文件到客户端，这种特性说明用户想下载RTMP协议下的视频是比较难的；</li>
<li><strong>视频流可以随便拖动</strong>，既可以从任意时间点向服务器发送请求进行播放，并不需要视频有关键帧。相比而言，HTTP协议下视频需要有关键帧才可以随意拖动。</li>
<li>RTMP协议支持点播&#x2F;回放（通俗点将就是支持把flv,f4v,mp4文件放在RTMP服务器，客户端可以直接播放），直播（边录制视频边播放）。</li>
</ul>
</li>
</ul>
<h3 id="MMS（Microsoft-Media-Server-Protocol）"><a href="#MMS（Microsoft-Media-Server-Protocol）" class="headerlink" title="MMS（Microsoft Media Server Protocol）"></a>MMS（Microsoft Media Server Protocol）</h3><ul>
<li>访问并流式接收Window Media服务器中.asf文件的一种协议。</li>
<li>可以用Windows自带的Windows Media Player来观看</li>
</ul>
<h3 id="Web-RTC（Web-Real-Time-Communications）"><a href="#Web-RTC（Web-Real-Time-Communications）" class="headerlink" title="Web RTC（Web Real-Time Communications）"></a>Web RTC（Web Real-Time Communications）</h3><ul>
<li>于2011年6月1日开源并在Google、Mozilla、Opera支持下被纳入万维网联盟的W3C推荐标准。</li>
<li>是一个支持网页浏览器进行实时语音对话或视频对话的API。</li>
<li>目前主要应用于<strong>视频会议和连麦</strong>中。</li>
</ul>
<h3 id="HLS-Http-Live-Streaming-明显是基于HTTP"><a href="#HLS-Http-Live-Streaming-明显是基于HTTP" class="headerlink" title="HLS(Http Live Streaming, 明显是基于HTTP)"></a>HLS(Http Live Streaming, 明显是基于HTTP)</h3><ul>
<li>是由苹果提出基于HTTP的流媒体传输协议。</li>
<li>原理<ul>
<li>直播客户端获取到的并不是一个完整的数据流，HLS协议在服务器端将直播数据流存储为连续的、很短时长的媒体文件（MPEG-TS格式）（<strong>MPEG-2</strong> Transport Stream；又称MPEG-TS、MTS、TS），而客户端则不断的下载并播放这些小文件，因为服务器总是会将最新的直播数据生成新的小文件，这样客户端只要不停的按顺序播放从服务器获取到的文件，就实现了直播。</li>
</ul>
</li>
<li>特点<ul>
<li><strong>优点</strong>就是HTML5可以直接打开播放；分段文件的时长很短，客户端可以很快的选择和切换码率，以适应不同带宽条件下的播放。</li>
<li><strong>缺点</strong>就是延迟高。</li>
</ul>
</li>
</ul>
<h3 id="HTTP-FLV（明显是基于HTTP"><a href="#HTTP-FLV（明显是基于HTTP" class="headerlink" title="HTTP-FLV（明显是基于HTTP)"></a>HTTP-FLV（明显是基于HTTP)</h3><ul>
<li>将直播流模拟成FLV文件，通过HTTP协议进行下载的模式来实现流媒体传输的协议。</li>
</ul>
<h2 id="各种软件使用的流式协议"><a href="#各种软件使用的流式协议" class="headerlink" title="各种软件使用的流式协议"></a>各种软件使用的流式协议</h2><h3 id="moonlight"><a href="#moonlight" class="headerlink" title="moonlight"></a>moonlight</h3><p>官网写着</p>
<blockquote>
<p>Moonlight (formerly Limelight) is an open source implementation of NVIDIA’s GameStream protocol.</p>
</blockquote>
<p>那么 NVIDIA’s GameStream protocol是什么呢？</p>
<blockquote>
<p>NVIDIA uses high speed, low latency video encoders built into GeForce GTX or RTX GPUs along with an efficient streaming software protocol integrated into GeForce Experience.</p>
</blockquote>
<p>我只能说看上去像自研的~但是马上也要没了</p>
<blockquote>
<p>Nvidia isn’t just ending support for GameStream, it’s planning to fully remove the feature from existing Shield hardware in February 2023.<br>Nvidia is recommending that Shield users switch to Steam Link, which is a similar way of streaming PC games to a Shield device.</p>
</blockquote>
<h3 id="Steam-Link"><a href="#Steam-Link" class="headerlink" title="Steam Link"></a>Steam Link</h3><p>有<a target="_blank" rel="noopener" href="https://github.com/mariotaku/steamlink.py/tree/master/session">github老哥分析了</a>。但我只能说肯定不是上面常见的类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">  Client -&gt;&gt; Host: Discovery/Connect</span><br><span class="line">  Note over Client: Send client connection ID</span><br><span class="line">  Host -&gt;&gt; Client: Discovery/Connect ACK</span><br><span class="line">  Note over Client: Got host connection ID, start client handshake</span><br><span class="line">  Client -&gt;&gt; Host: Reliable/Control:ClientHandshake</span><br><span class="line">  par Discovery Channel</span><br><span class="line">    loop While True</span><br><span class="line">      Host -&gt;&gt; Client: Unconnected/Discovery:PingRequest</span><br><span class="line">      Client -&gt;&gt; Host: Unconnected/Discovery:PingResponse</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  Host -&gt;&gt; Client: Reliable/Control:ServerHandshake</span><br><span class="line">  Note over Client: Got mtu, start authentication</span><br><span class="line">  Client -&gt;&gt; Host: Reliable/Control:AuthenticationRequest</span><br><span class="line">  Host -&gt;&gt; Client: Reliable/Control:AuthenticationResponse</span><br><span class="line">  Host -&gt;&gt; Client: Reliable/Control:NegotiationInit</span><br><span class="line">  Note over Client: Got host supported audio/video codecs</span><br><span class="line">  Client -&gt;&gt; Host: Reliable/Control:NegotiationSetConfig</span><br><span class="line">  Note over Client: Send selected codecs and config</span><br><span class="line">  Host -&gt;&gt; Client: Reliable/Control:NegotiationSetConfig</span><br><span class="line">  Note over Client: Got final config, respond with complete</span><br><span class="line">  Client -&gt;&gt; Host: Reliable/Control:NegotiationComplete</span><br><span class="line">  par Audio Data Channel</span><br><span class="line">    Host -&gt;&gt; Client: Reliable/Control:StartAudioData</span><br><span class="line">    loop Not StopAudioData</span><br><span class="line">      Host -&gt;&gt; Client: Unreliable/Data:Packet </span><br><span class="line">    end</span><br><span class="line">  and Video Data Channel</span><br><span class="line">    Host -&gt;&gt; Client: Reliable/Control:StartVideoData</span><br><span class="line">    loop Not StopVideoData</span><br><span class="line">      Host -&gt;&gt; Client: Unreliable/Data:Packet </span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line">  Client -&gt;&gt; Host: Discovery/Disconnect</span><br></pre></td></tr></table></figure>

<h2 id="流式传输-视频压缩编码"><a href="#流式传输-视频压缩编码" class="headerlink" title="流式传输 视频压缩编码"></a>流式传输 视频压缩编码</h2><p>主流还是 H.264 或者 HEVC。 流式传输时为了保证帧率可能会牺牲画面。<br><img src="https://pic.shaojiemike.top/img/20221231094108.png"></p>
<p>Steam Link 的相关设置</p>
<p><img src="https://pic.shaojiemike.top/img/20221231100529.png"></p>
<h2 id="需要进一步的研究学习"><a href="#需要进一步的研究学习" class="headerlink" title="需要进一步的研究学习"></a>需要进一步的研究学习</h2><p>暂无</p>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>暂无</p>
<h2 id="开题缘由、总结、反思、吐槽"><a href="#开题缘由、总结、反思、吐槽" class="headerlink" title="开题缘由、总结、反思、吐槽~~"></a>开题缘由、总结、反思、吐槽~~</h2><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>山东布谷科技 <a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv9502267?from=search&amp;spm_id_from=333.337.0.0">https://www.bilibili.com/read/cv9502267?from=search&amp;spm_id_from=333.337.0.0</a> 出处：bilibili</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/toLearn/page/4/">Previous</a></div><div class="pagination-next"><a href="/categories/toLearn/page/6/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/toLearn/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/toLearn/page/4/">4</a></li><li><a class="pagination-link is-current" href="/categories/toLearn/page/5/">5</a></li><li><a class="pagination-link" href="/categories/toLearn/page/6/">6</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">𝘊𝘰𝘮𝘱𝘶𝘵𝘦𝘳 𝘈𝘳𝘤𝘩𝘪𝘵𝘦𝘤𝘵𝘶𝘳𝘦 &amp; 𝘏𝘗𝘊</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">426</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">35</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">516</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Camp/"><span class="level-start"><span class="level-item">Camp</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile" href="/categories/ProjectRecord/"><span class="level-start"><span class="level-item">ProjectRecord</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Thinking/"><span class="level-start"><span class="level-item">Thinking</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">116</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/love/"><span class="level-start"><span class="level-item">love</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/programming/"><span class="level-start"><span class="level-item">programming</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">55</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-10-11T03:04:55.000Z">2024-10-11</time></p><p class="title"><a href="/2024/10/11/Work/Programming/DebugProfile/DebugProfilePTA/">Debug/Profile Tools of PTA</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-22T09:19:48.000Z">2024-09-22</time></p><p class="title"><a href="/2024/09/22/Work/software/simulator/PC/VirtualBox/">VirtualBox</a></p><p class="categories"><a href="/categories/software/">software</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-13T07:08:55.000Z">2024-09-13</time></p><p class="title"><a href="/2024/09/13/Work/software/PC/macbook/">Macbook Config</a></p><p class="categories"><a href="/categories/software/">software</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-13T00:47:35.000Z">2024-09-13</time></p><p class="title"><a href="/2024/09/13/Work/Programming/2-languageGrammar/c/Types/">[C++ Basic] Types</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-09-12T14:41:50.000Z">2024-09-12</time></p><p class="title"><a href="/2024/09/12/Work/Programming/2-languageGrammar/c/Class/">[C++ Basic] User-Defined Types: Class</a></p><p class="categories"><a href="/categories/Programming/">Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/10/"><span class="level-start"><span class="level-item">October 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/09/"><span class="level-start"><span class="level-item">September 2024</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">August 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">April 2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">March 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">February 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/01/"><span class="level-start"><span class="level-item">January 2024</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/12/"><span class="level-start"><span class="level-item">December 2023</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">November 2023</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/10/"><span class="level-start"><span class="level-item">October 2023</span></span><span class="level-end"><span class="level-item tag">58</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/09/"><span class="level-start"><span class="level-item">September 2023</span></span><span class="level-end"><span class="level-item tag">37</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">August 2023</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/07/"><span class="level-start"><span class="level-item">July 2023</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/06/"><span class="level-start"><span class="level-item">June 2023</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/05/"><span class="level-start"><span class="level-item">May 2023</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">April 2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">March 2023</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">February 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">January 2023</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">November 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">October 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">September 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">June 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">February 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/07/"><span class="level-start"><span class="level-item">July 2021</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>