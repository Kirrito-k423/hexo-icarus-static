<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Tag: llvm - SHAOJIE&#039;S BOOK</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="SHAOJIE&#039;S BOOK"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="SHAOJIE&#039;S BOOK"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="SHAOJIE&#039;S BOOK"><meta property="og:url" content="http://icarus.shaojiemike.top/"><meta property="og:site_name" content="SHAOJIE&#039;S BOOK"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://icarus.shaojiemike.top/img/og_image.png"><meta property="article:author" content="Shaojie Tan"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://icarus.shaojiemike.top/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://icarus.shaojiemike.top"},"headline":"SHAOJIE'S BOOK","image":["http://icarus.shaojiemike.top/img/og_image.png"],"author":{"@type":"Person","name":"Shaojie Tan"},"publisher":{"@type":"Organization","name":"SHAOJIE'S BOOK","logo":{"@type":"ImageObject","url":"http://icarus.shaojiemike.top/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.1.1"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">Tags</a></li><li class="is-active"><a href="#" aria-current="page">llvm</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-07-25T16:00:00.000Z" title="7/25/2023, 4:00:00 PM">2023-07-25</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.264Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">15 minutes read (About 2206 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/07/25/Work/Programming/4-compile/llvm/">llvm</a></p><div class="content"><h2 id="llvm"><a href="#llvm" class="headerlink" title="llvm"></a>llvm</h2><p>LLVMé¡¹ç›®å¼€å§‹äºä¸€ç§æ¯”Javaå­—èŠ‚ç æ›´ä½å±‚çº§çš„IRï¼Œå› æ­¤ï¼Œåˆå§‹çš„é¦–å­—æ¯ç¼©ç•¥è¯æ˜¯Low Level Virtual Machineã€‚å®ƒçš„æƒ³æ³•æ˜¯å‘æ˜ä½å±‚ä¼˜åŒ–çš„æœºä¼šï¼Œé‡‡ç”¨é“¾æ¥æ—¶ä¼˜åŒ–ã€‚</p>
<p><img src="https://pic.shaojiemike.top/img/20230523164536.png"></p>
<h3 id="æ’ä¸€å˜´ï¼šé“¾æ¥æ—¶ä¼˜åŒ–"><a href="#æ’ä¸€å˜´ï¼šé“¾æ¥æ—¶ä¼˜åŒ–" class="headerlink" title="æ’ä¸€å˜´ï¼šé“¾æ¥æ—¶ä¼˜åŒ–"></a>æ’ä¸€å˜´ï¼šé“¾æ¥æ—¶ä¼˜åŒ–</h3><ul>
<li>GCCä¹Ÿæ”¯æŒé“¾æ¥æ—¶ä¼˜åŒ–ï¼Œç§°ä¸ºLTOï¼ˆLink Time Optimizationï¼‰ï¼Œé€šè¿‡æŠŠå¤šä¸ªç¼–è¯‘å•å…ƒä¸­åˆ†åˆ«ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶åœ¨é“¾æ¥æ—¶è¿›è¡Œå…¨å±€çš„ä¼˜åŒ–ï¼Œå¯ä»¥æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>å…·ä½“å†…å®¹ï¼šå¤§å¹…åº¦å‡å°‘å¯æ‰§è¡Œæ–‡ä»¶çš„ä½“ç§¯<ul>
<li>å†—ä½™ä»£ç å’Œå˜é‡&#x2F;å‡½æ•°çš„æ¶ˆé™¤ï¼šå¯¹äºåœ¨å¤šä¸ªæ¨¡å—ä¸­å‡ºç°çš„ç›¸åŒä»£ç &#x2F;å˜é‡&#x2F;å‡½æ•°ï¼Œé“¾æ¥æ—¶ä¼˜åŒ–å¯ä»¥å°†å®ƒä»¬åˆå¹¶ï¼Œä»è€Œå‡å°‘å¯æ‰§è¡Œæ–‡ä»¶çš„ä½“ç§¯ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>å†…è”å‡½æ•°ï¼šå°†å‡½æ•°è°ƒç”¨ç›´æ¥æ›¿æ¢ä¸ºå‡½æ•°æœ¬èº«çš„ä»£ç ï¼Œä»è€Œå‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>å¾ªç¯å±•å¼€å’Œå‘é‡åŒ–ï¼šå†…è”å‡½æ•°åï¼Œæˆ–è®¸èƒ½è¿›ä¸€æ­¥å°†å¾ªç¯å±•å¼€å’Œå‘é‡åŒ–ï¼Œä»è€Œå‡å°‘å¾ªç¯ä½“å†…çš„åˆ†æ”¯åˆ¤æ–­ï¼Œä¼˜åŒ–ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
</ul>
</li>
</ul>
<h3 id="IRï¼šgccä¸llvmçš„åŒºåˆ«"><a href="#IRï¼šgccä¸llvmçš„åŒºåˆ«" class="headerlink" title="IRï¼šgccä¸llvmçš„åŒºåˆ«"></a>IRï¼šgccä¸llvmçš„åŒºåˆ«</h3><p>å­¦è¿‡ç¼–è¯‘åŸç†çš„äººéƒ½çŸ¥é“ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸»è¦å¯ä»¥åˆ’åˆ†ä¸ºå‰ç«¯ä¸åç«¯ï¼š</p>
<ul>
<li>å‰ç«¯æŠŠæºä»£ç ç¿»è¯‘æˆä¸­é—´è¡¨ç¤º (IR)ã€‚</li>
<li>åç«¯æŠŠIRç¼–è¯‘æˆç›®æ ‡å¹³å°çš„æœºå™¨ç ã€‚å½“ç„¶ï¼ŒIRä¹Ÿå¯ä»¥ç»™è§£é‡Šå™¨è§£é‡Šæ‰§è¡Œã€‚</li>
</ul>
<p>ç»å…¸çš„ç¼–è¯‘å™¨å¦‚gccï¼šåœ¨è®¾è®¡ä¸Šå‰ç«¯åˆ°åç«¯ç¼–å†™æ˜¯å¼ºè€¦åˆçš„ï¼Œä½ ä¸éœ€è¦çŸ¥é“ï¼Œæ— æ³•çŸ¥é“ï¼Œä¹Ÿæ²¡æœ‰APIæ¥æ“ä½œå®ƒçš„IRã€‚</p>
<ul>
<li><p>å¥½å¤„æ˜¯ï¼šå› ä¸ºä¸éœ€è¦æš´éœ²ä¸­é—´è¿‡ç¨‹çš„æ¥å£ï¼Œç¼–è¯‘å™¨å¯ä»¥åœ¨å†…éƒ¨åšä»»ä½•æƒ³åšçš„å¹³å°ç›¸å…³çš„ä¼˜åŒ–ã€‚</p>
</li>
<li><p>åå¤„æ˜¯ï¼Œæ¯å½“ä¸€ä¸ªæ–°çš„å¹³å°å‡ºç°ï¼Œè¿™äº›ç¼–è¯‘å™¨éƒ½è¦å„è‡ªä¸ºæ”¿å®ç°ä¸€ä¸ªä»è‡ªå·±çš„IRåˆ°æ–°å¹³å°çš„åç«¯ã€‚</p>
<ul>
<li>ç”šè‡³å¦‚æœå½“ä¸€ç§æ–°è¯­è¨€å‡ºç°ï¼Œä¸”éœ€è¦å®ç°ä¸€ä¸ªæ–°çš„ç¼–è¯‘å™¨ï¼Œé‚£ä¹ˆå¯èƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªæ–°çš„IRï¼Œä»¥åŠé’ˆå¯¹å¤§éƒ¨åˆ†å¹³å°å®ç°è¿™ä¸ªIRçš„åç«¯ã€‚</li>
<li>å¦‚æœæœ‰Mç§è¯­è¨€ã€Nç§ç›®æ ‡å¹³å°ï¼Œé‚£ä¹ˆæœ€åæƒ…å†µä¸‹è¦å®ç° M*N ä¸ªå‰åç«¯ã€‚è¿™æ˜¯å¾ˆä½æ•ˆçš„ã€‚</li>
</ul>
</li>
<li><p>LLVMçš„æ ¸å¿ƒè®¾è®¡äº†ä¸€ä¸ªå« LLVM IR çš„é€šç”¨ä¸­é—´è¡¨ç¤ºï¼Œ å¹¶ä»¥åº“(Library) çš„æ–¹å¼æä¾›ä¸€ç³»åˆ—æ¥å£ï¼Œ ä¸ºä½ æä¾›è¯¸å¦‚æ“ä½œIRã€ç”Ÿæˆç›®æ ‡å¹³å°ä»£ç ç­‰ç­‰åç«¯çš„åŠŸèƒ½ã€‚</p>
</li>
<li><p>åœ¨ä½¿ç”¨é€šç”¨IRçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰Mç§è¯­è¨€ã€Nç§ç›®æ ‡å¹³å°ï¼Œé‚£ä¹ˆæœ€ä¼˜æƒ…å†µä¸‹æˆ‘ä»¬åªè¦å®ç° M+N ä¸ªå‰åç«¯ã€‚</p>
</li>
</ul>
<h2 id="llvm-IR"><a href="#llvm-IR" class="headerlink" title="llvm IR"></a>llvm IR</h2><ul>
<li>LLVM IR ä¸­é—´è¡¨ç¤ºæ˜¯é€‚ç”¨äºå¤šç§ç¼–ç¨‹è¯­è¨€çš„é€šç”¨ä¸­é—´è¡¨ç¤ºï¼Œæ”¯æŒCã€C++ã€Objective-Cã€Swiftã€Javaã€Pythonç­‰å¤šç§ç¼–ç¨‹è¯­è¨€ã€‚</li>
<li>å®ƒæ˜¯ä¸€ç§ä½çº§åˆ«çš„è¯­è¨€ï¼Œç±»ä¼¼äºæ±‡ç¼–è¯­è¨€ï¼Œä½†æ¯”æ±‡ç¼–è¯­è¨€æ›´é«˜çº§ï¼ŒåŒ…å«äº†ç±»å‹ã€å˜é‡ã€å‡½æ•°ã€æ§åˆ¶æµç­‰é«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚</li>
<li>LLVMç¼–è¯‘å™¨å¯ä»¥å°†å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–è¯‘æˆLLVM IRï¼Œä»è€Œå¯ä»¥åœ¨LLVM IRå±‚é¢è¿›è¡Œå„ç§ä¼˜åŒ–å¤„ç†ï¼Œå†å°†LLVM IRè½¬æ¢ä¸ºç›®æ ‡å¹³å°çš„æœºå™¨ç ã€‚<ul>
<li>æ¯”å¦‚è¦å°†Pythonè„šæœ¬ç¼–è¯‘æˆLLVM IRä¸­é—´è¡¨ç¤ºï¼Œå¯ä»¥ä½¿ç”¨Python LLVMç¼–è¯‘å™¨llvmliteå’Œnumbaã€‚</li>
</ul>
</li>
</ul>
<h3 id="LLVM-IRè¡¨ç¤ºä¸è½¬æ¢"><a href="#LLVM-IRè¡¨ç¤ºä¸è½¬æ¢" class="headerlink" title="LLVM IRè¡¨ç¤ºä¸è½¬æ¢"></a>LLVM IRè¡¨ç¤ºä¸è½¬æ¢</h3><p>LVM IRå®é™…ä¸Šæœ‰ä¸‰ç§è¡¨ç¤ºï¼š</p>
<ul>
<li>.ll æ ¼å¼ï¼šäººç±»å¯ä»¥é˜…è¯»çš„æ–‡æœ¬ã€‚</li>
<li>.bc æ ¼å¼ï¼šé€‚åˆæœºå™¨å­˜å‚¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li>å†…å­˜è¡¨ç¤º</li>
</ul>
<p>å„ç§æ ¼å¼æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶ç›¸äº’è½¬æ¢ï¼š</p>
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>è½¬æ¢å‘½ä»¤</th>
</tr>
</thead>
<tbody><tr>
<td>.c -&gt; .ll</td>
<td>clang -emit-llvm -S a.c -o a.ll</td>
</tr>
<tr>
<td>.c -&gt; .bc</td>
<td>clang -emit-llvm -c a.c -o a.bc</td>
</tr>
<tr>
<td>.ll -&gt; .bc</td>
<td>llvm-as a.ll -o a.bc</td>
</tr>
<tr>
<td>.bc -&gt; .ll</td>
<td>llvm-dis a.bc -o a.ll</td>
</tr>
<tr>
<td>.bc -&gt; .s</td>
<td>llc a.bc -o a.s</td>
</tr>
</tbody></table>
<p>å¯¹äºLLVM IRæ¥è¯´ï¼Œ<code>.ll</code>æ–‡ä»¶å°±ç›¸å½“äºæ±‡ç¼–ï¼Œ<code>.bc</code>æ–‡ä»¶å°±ç›¸å½“äºæœºå™¨ç ã€‚ è¿™ä¹Ÿæ˜¯llvm-aså’Œllvm-disæŒ‡ä»¤ä¸ºä»€ä¹ˆå«aså’Œdisçš„ç¼˜æ•…ã€‚</p>
<h2 id="llvm-å‰ç«¯"><a href="#llvm-å‰ç«¯" class="headerlink" title="llvm å‰ç«¯"></a>llvm å‰ç«¯</h2><p><img src="https://pic.shaojiemike.top/img/20230523162028.png" alt="å‰ç«¯"></p>
<p>clangå®ç°çš„å‰ç«¯åŒ…æ‹¬</p>
<ul>
<li>è¯æ³•åˆ†æ(è¯†åˆ«æ ‡è®°)<ul>
<li>å¤„ç†æºä»£ç çš„æ–‡æœ¬è¾“å…¥ï¼Œå°†è¯­è¨€ç»“æ„åˆ†è§£ä¸ºä¸€ç»„å•è¯å’Œæ ‡è®°ï¼Œå»é™¤æ³¨é‡Šã€ç©ºç™½ã€åˆ¶è¡¨ç¬¦ç­‰ã€‚æ¯ä¸ªå•è¯æˆ–è€…æ ‡è®°å¿…é¡»å±äºè¯­è¨€å­é›†ï¼Œè¯­è¨€çš„ä¿ç•™å­—è¢«å˜æ¢ä¸ºç¼–è¯‘å™¨å†…éƒ¨è¡¨ç¤ºã€‚</li>
<li>è¯æ³•åˆ†ææŠ¥é”™çš„ä¾‹å­åŒ…æ‹¬ï¼šæ‹¼å†™é”™è¯¯ã€æ³¨é‡Šæ²¡æœ‰æ­£ç¡®ç»“æŸã€å­—ç¬¦ä¸²æ²¡æœ‰æ­£ç¡®ç»“æŸç­‰ã€‚</li>
</ul>
</li>
<li>è¯­æ³•åˆ†æ(æ ‡è®°ç»“æ„å®Œæ•´)<ul>
<li>è¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™éªŒè¯ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œå¦‚ç¼ºå°‘å³æ‹¬å·ã€æ˜¯å¦ç¼ºå°‘å…³é”®å­—ã€å˜é‡æœªå®šä¹‰ã€å‡½æ•°åº”è¯¥æœ‰è¿”å›å€¼ç­‰ã€‚</li>
</ul>
</li>
<li>è¯­ä¹‰åˆ†æ(æœ‰æ— è¯­ä¹‰çŸ›ç›¾)<ul>
<li>å€ŸåŠ©ç¬¦å·è¡¨æ£€éªŒä»£ç æ²¡æœ‰è¿èƒŒè¯­è¨€ç±»å‹ç³»ç»Ÿã€‚è¿™ä¸ªè¡¨å­˜å‚¨æ ‡è¯†ç¬¦ï¼ˆç¬¦å·ï¼‰å’Œå®ƒä»¬å„è‡ªçš„ç±»å‹ä¹‹é—´çš„æ˜ å°„ï¼Œä»¥åŠå…¶å®ƒå†…å®¹ã€‚</li>
<li>ç±»å‹æ£€æŸ¥çš„ä¸€ç§ç›´è§‰çš„æ–¹æ³•æ˜¯ï¼Œåœ¨è§£æä¹‹åï¼Œéå†ASTçš„åŒæ—¶ä»ç¬¦å·è¡¨æ”¶é›†å…³äºç±»å‹çš„ä¿¡æ¯ã€‚</li>
<li>ä¾‹å­ï¼šå®šä¹‰äº†ä¸¤ä¸ªå˜é‡ a å†²çªã€‚</li>
</ul>
</li>
</ul>
<h2 id="llvm-åç«¯"><a href="#llvm-åç«¯" class="headerlink" title="llvm åç«¯"></a>llvm åç«¯</h2><p>è§ llvm Backend ä¸€æ–‡</p>
<h2 id="clang"><a href="#clang" class="headerlink" title="clang"></a>clang</h2><h3 id="clang-ä¸-llvmçš„å…³ç³»"><a href="#clang-ä¸-llvmçš„å…³ç³»" class="headerlink" title="clang ä¸ llvmçš„å…³ç³»"></a>clang ä¸ llvmçš„å…³ç³»</h3><p>Clang æ˜¯ LLVM é¡¹ç›®ä¸­çš„ä¸€ä¸ª C&#x2F;C++&#x2F;Objective-C ç¼–è¯‘å™¨ï¼Œå®ƒä½¿ç”¨ LLVM çš„å‰ç«¯å’Œåç«¯è¿›è¡Œä»£ç ç”Ÿæˆå’Œä¼˜åŒ–ã€‚å®ƒå¯ä»¥å°† C&#x2F;C++&#x2F;Objective-C ä»£ç ç¼–è¯‘ä¸º LLVM çš„ä¸­é—´è¡¨ç¤ºï¼ˆLLVM IRï¼‰ï¼Œç„¶åè¿›ä¸€æ­¥å°†å…¶è½¬æ¢ä¸ºç›®æ ‡å¹³å°çš„æœºå™¨ç ã€‚Clang æ‹¥æœ‰å¾ˆå¥½çš„é”™è¯¯ä¿¡æ¯å±•ç¤ºå’Œæç¤ºï¼Œæ”¯æŒå¤šå¹³å°ä½¿ç”¨ï¼Œæ˜¯è®¸å¤šå¼€å‘è€…çš„é¦–é€‰ç¼–è¯‘å™¨ä¹‹ä¸€ã€‚åŒæ—¶ï¼ŒClang ä¹Ÿä½œä¸º LLVM é¡¹ç›®çš„ä¸€ä¸ªå‰ç«¯ï¼Œä¸º LLVM çš„ç”Ÿæ€ç³»ç»Ÿæä¾›äº†å¹¿æ³›çš„æ”¯æŒå’Œåº”ç”¨ã€‚</p>
<h3 id="clang-çš„å¼€å‘ä¸è‹¹æœå…¬å¸çš„å…³ç³»"><a href="#clang-çš„å¼€å‘ä¸è‹¹æœå…¬å¸çš„å…³ç³»" class="headerlink" title="clang çš„å¼€å‘ä¸è‹¹æœå…¬å¸çš„å…³ç³»"></a>clang çš„å¼€å‘ä¸è‹¹æœå…¬å¸çš„å…³ç³»</h3><p>Clang çš„å¼€å‘èµ·æºäºè‹¹æœå…¬å¸çš„ä¸€ä¸ªé¡¹ç›®ï¼Œå³ LLVM&#x2F;Clang é¡¹ç›®ã€‚åœ¨ 2005 å¹´ï¼Œè‹¹æœå…¬å¸å¸Œæœ›èƒ½å¤Ÿä½¿ç”¨ä¸€ç§æ›´åŠ çµæ´»ã€å¯æ‰©å±•ã€ä¼˜åŒ–çš„ç¼–è¯‘å™¨æ¥æ›¿ä»£ GCC ä½œä¸ºå…¶æ“ä½œç³»ç»Ÿ macOS (Mac OS X) å¼€å‘ç¯å¢ƒçš„é»˜è®¤ç¼–è¯‘å™¨ã€‚ç”±äºå½“æ—¶çš„ GCC å¼€å‘è¢«å…¶ç»´æŠ¤è€…ä»¬è®¤ä¸ºå˜å¾—ç¼“æ…¢å’Œéš¾ä»¥ç»´æŠ¤ï¼Œè‹¹æœå…¬å¸å†³å®šå¼€å‘ä¸€æ¬¾æ–°çš„ç¼–è¯‘å™¨ï¼Œè¿™å°±æ˜¯ Clang è¯ç”Ÿçš„åŸå› ã€‚Clang çš„å¼€å‘å›¢é˜Ÿç”±è¯¥é¡¹ç›®çš„åˆ›ç«‹è€… Chris Lattner é¢†å¯¼ï¼Œä»–å¸¦é¢†å›¢é˜Ÿå°† Clang å‘å±•ä¸ºä¸€æ¬¾å¯æ‰©å±•ã€æ¨¡å—åŒ–ã€é«˜æ•ˆçš„ç¼–è¯‘å™¨ï¼Œå¹¶æˆåŠŸåœ°å°†å…¶åµŒå…¥åˆ°è‹¹æœå…¬å¸çš„å¼€å‘å·¥å…·é“¾ Xcode ä¸­ï¼Œæˆä¸ºäº† macOS å¼€å‘ç¯å¢ƒä¸­é»˜è®¤çš„ç¼–è¯‘å™¨ä¹‹ä¸€ã€‚</p>
<p>Clang æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œåœ¨è‹¹æœå…¬å¸çš„æ”¯æŒä¸‹ï¼ŒClang çš„å¼€å‘å¾—åˆ°äº†å…¨çƒå„åœ°çš„å¼€å‘è€…ä»¬çš„å¹¿æ³›å‚ä¸å’Œè´¡çŒ®ã€‚ç°åœ¨ï¼ŒClang æˆä¸ºäº† LLVM ç”Ÿæ€ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œè¢«å¹¿æ³›åœ°åº”ç”¨äºå¤šå¹³å°çš„ç¼–è¯‘å™¨å¼€å‘ä¸­ã€‚</p>
<h3 id="clang-cannot-find-iostream"><a href="#clang-cannot-find-iostream" class="headerlink" title="clang-cannot-find-iostream"></a>clang-cannot-find-iostream</h3><p><code>Clang</code> and <code>Clang++</code> â€œborrowâ€ the header files from <code>GCC</code> &amp; <code>G++</code>. It looks for the directories these usually live in and picks the latest one. If youâ€™ve installed a later GCC without the corresponding G++, Clang++ gets confused and canâ€™t find header files. In your instance, for example, if youâ€™ve installed gcc 11 or 12.</p>
<p>You can useÂ <code>clang-10 -v -E</code>Â orÂ <code>clang++-10 -v -E</code>Â to get details on what versions of header files itâ€™s trying to use.</p>
<p>å®‰è£…g++-12è§£å†³</p>
<h2 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a>å¸¸ç”¨å·¥å…·</h2><p><code>github/tools</code>ç›®å½•ä¸‹æœ‰è®¸å¤šå®ç”¨å·¥å…·</p>
<ul>
<li><code>llvm-as</code>ï¼šæŠŠLLVM IRä»äººç±»èƒ½çœ‹æ‡‚çš„æ–‡æœ¬æ ¼å¼æ±‡ç¼–æˆäºŒè¿›åˆ¶æ ¼å¼ã€‚æ³¨æ„ï¼šæ­¤å¤„å¾—åˆ°çš„ä¸æ˜¯ç›®æ ‡å¹³å°çš„æœºå™¨ç ã€‚</li>
<li><code>llvm-dis</code>ï¼šllvm-asçš„é€†è¿‡ç¨‹ï¼Œå³åæ±‡ç¼–ã€‚ ä¸è¿‡è¿™é‡Œçš„åæ±‡ç¼–çš„å¯¹è±¡æ˜¯LLVM IRçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œè€Œä¸æ˜¯æœºå™¨ç ã€‚</li>
<li><code>opt</code>ï¼šä¼˜åŒ–LLVM IRã€‚è¾“å‡ºæ–°çš„LLVM IRã€‚</li>
<li><code>llc</code>ï¼šæŠŠLLVM IRç¼–è¯‘æˆæ±‡ç¼–ç ã€‚éœ€è¦ç”¨asè¿›ä¸€æ­¥å¾—åˆ°æœºå™¨ç ã€‚</li>
<li><code>lli</code>ï¼šè§£é‡Šæ‰§è¡ŒLLVM IRã€‚</li>
</ul>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>æ–‡ç« éƒ¨åˆ†å†…å®¹<strong>æ¥è‡ªChatGPT-3.5</strong>ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122522485">https://zhuanlan.zhihu.com/p/122522485</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-30T16:00:00.000Z" title="5/30/2023, 4:00:00 PM">2023-05-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.260Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">24 minutes read (About 3665 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/30/Work/HPC/llvm-mca/LLVM-mca/">LLVM-MCA: docs</a></p><div class="content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>LLVM Machine Code Analyzer æ˜¯ä¸€ç§æ€§èƒ½åˆ†æå·¥å…·ï¼Œå®ƒä½¿ç”¨llvmä¸­å¯ç”¨çš„ä¿¡æ¯ï¼ˆå¦‚è°ƒåº¦æ¨¡å‹ï¼‰é™æ€æµ‹é‡ç‰¹å®šCPUä¸­æœºå™¨ä»£ç çš„æ€§èƒ½ã€‚</p>
<p>æ€§èƒ½æ˜¯æ ¹æ®<strong>ååé‡</strong>å’Œ<strong>å¤„ç†å™¨èµ„æºæ¶ˆè€—</strong>æ¥è¡¡é‡çš„ã€‚è¯¥å·¥å…·ç›®å‰é€‚ç”¨äºåœ¨åç«¯ä¸­ä½¿ç”¨LLVMè°ƒåº¦æ¨¡å‹çš„å¤„ç†å™¨ã€‚</p>
<p>è¯¥å·¥å…·çš„ä¸»è¦ç›®æ ‡ä¸ä»…æ˜¯é¢„æµ‹ä»£ç åœ¨ç›®æ ‡ä¸Šè¿è¡Œæ—¶çš„æ€§èƒ½ï¼Œè¿˜å¸®åŠ©è¯Šæ–­æ½œåœ¨çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ç»™å®šæ±‡ç¼–ä»£ç ï¼Œllvm-mcaå¯ä»¥ä¼°è®¡æ¯ä¸ªå‘¨æœŸçš„æŒ‡ä»¤æ•°ï¼ˆIPCï¼‰ä»¥åŠç¡¬ä»¶èµ„æºå‹åŠ›ã€‚åˆ†æå’ŒæŠ¥å‘Šé£æ ¼çš„çµæ„Ÿæ¥è‡ªè‹±ç‰¹å°”çš„IACAå·¥å…·ã€‚</p>
<h3 id="github"><a href="#github" class="headerlink" title="github"></a>github</h3><p><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca">https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca</a></p>
<h3 id="docs"><a href="#docs" class="headerlink" title="docs"></a>docs</h3><p><a target="_blank" rel="noopener" href="https://llvm.org/docs/CommandGuide/llvm-mca.html">https://llvm.org/docs/CommandGuide/llvm-mca.html</a></p>
<h2 id="options"><a href="#options" class="headerlink" title="options"></a>options</h2><h3 id="architecture"><a href="#architecture" class="headerlink" title="architecture"></a>architecture</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-mtriple=&lt;target triple&gt;</span><br><span class="line">    eg. -mtriple=x86_64-unknown-unknown</span><br><span class="line">-march=&lt;arch&gt;</span><br><span class="line">    Specify the architecture for which to analyze the code. It defaults to the host default target.</span><br><span class="line">-march=&lt;arch&gt;</span><br><span class="line">    Specify the architecture for which to analyze the code. It defaults to the host default target.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ”¯æŒçš„arch</span></span><br><span class="line">llc --version</span><br><span class="line"><span class="comment"># æŸ¥çœ‹å…·ä½“æ”¯æŒçš„CPU Architecture</span></span><br><span class="line">llc -march=x86 -mattr=<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h3 id="output-report"><a href="#output-report" class="headerlink" title="output-report"></a>output-report</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-output-asm-variant=&lt;variant id&gt;</span><br><span class="line">    ä¸ºå·¥å…·ç”Ÿæˆçš„æŠ¥å‘ŠæŒ‡å®šè¾“å‡ºç¨‹åºé›†å˜é‡ã€‚???</span><br><span class="line">-print-imm-hex</span><br><span class="line">    ä¼˜å…ˆ16è¿›åˆ¶è¾“å‡ºã€‚</span><br><span class="line">-json</span><br><span class="line">    é™¤äº†ç“¶é¢ˆåˆ†æï¼ŒåŸºæœ¬éƒ½æ”¯æŒjsonæ ¼å¼è¾“å‡ºè§†å›¾</span><br><span class="line">-timeline</span><br><span class="line">    æ‰“å°æŒ‡ä»¤æµæ°´çº¿æƒ…å†µ</span><br></pre></td></tr></table></figure>

<h3 id="runtime-options"><a href="#runtime-options" class="headerlink" title="runtime options"></a>runtime options</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-dispatch=&lt;width&gt;</span><br><span class="line">    ä¸ºå¤„ç†å™¨æŒ‡å®šä¸åŒçš„è°ƒåº¦å®½åº¦ã€‚è°ƒåº¦å®½åº¦é»˜è®¤ä¸ºå¤„ç†å™¨è°ƒåº¦æ¨¡å‹ä¸­çš„â€œIssueWidthâ€å­—æ®µã€‚</span><br><span class="line">-register-file-size=&lt;size&gt;</span><br><span class="line">    æŒ‡å®šå¯„å­˜å™¨æ–‡ä»¶çš„å¤§å°ã€‚æŒ‡å®šæ—¶ï¼Œè¯¥é¡¹ä¼šé™åˆ¶å¯ç”¨äºå¯„å­˜å™¨é‡å‘½åçš„ç‰©ç†å¯„å­˜å™¨çš„æ•°é‡ã€‚æ­¤æ ‡å¿—çš„å€¼ä¸ºé›¶æ„å‘³ç€â€œæ— é™æ•°é‡çš„ç‰©ç†å¯„å­˜å™¨â€ã€‚</span><br><span class="line">-iterations=&lt;number of iterations&gt;</span><br><span class="line">    æŒ‡å®šè¦è¿è¡Œçš„è¿­ä»£æ¬¡æ•°ã€‚å¦‚æœæ­¤æ ‡å¿—è®¾ç½®ä¸º 0ï¼Œåˆ™è¯¥å·¥å…·ä¼šå°†è¿­ä»£æ¬¡æ•°è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ˆå³ 100ï¼‰ã€‚</span><br><span class="line">-noalias=&lt;bool&gt;</span><br><span class="line">    loads and stores donâ€™t alias</span><br><span class="line">-lqueue=&lt;load queue size&gt;</span><br><span class="line">-squeue=&lt;store queue size&gt;</span><br><span class="line">    åœ¨å·¥å…·æ¨¡æ‹Ÿçš„åŠ è½½/å­˜å‚¨å•å…ƒä¸­æŒ‡å®šåŠ è½½é˜Ÿåˆ—çš„å¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å·¥å…·å‡å®šåŠ è½½é˜Ÿåˆ—ä¸­çš„æ¡ç›®æ•°é‡ä¸å—é™åˆ¶ã€‚æ­¤æ ‡å¿—çš„é›¶å€¼å°†è¢«å¿½ç•¥ï¼Œè€Œæ˜¯ä½¿ç”¨é»˜è®¤åŠ è½½é˜Ÿåˆ—å¤§å°ã€‚</span><br><span class="line">-disable-cb</span><br><span class="line">    å¼ºåˆ¶ä½¿ç”¨é€šç”¨çš„ CustomBehaviour å’Œ InstrPostProcess ç±»ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç›®æ ‡ç‰¹å®šçš„å®ç°ã€‚é€šç”¨ç±»ä»ä¸æ£€æµ‹ä»»ä½•è‡ªå®šä¹‰å±é™©æˆ–å¯¹æŒ‡ä»¤è¿›è¡Œä»»ä½•åå¤„ç†ä¿®æ”¹ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="more-values-Info"><a href="#more-values-Info" class="headerlink" title="more values&#x2F;Info"></a>more values&#x2F;Info</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-resource-pressure</span><br><span class="line">    Enable the resource pressure view. This is enabled by default.</span><br><span class="line">-register-file-stats</span><br><span class="line">    å¯ç”¨æ³¨å†Œæ–‡ä»¶ä½¿ç”¨ç»Ÿè®¡ã€‚</span><br><span class="line">-dispatch-stats</span><br><span class="line">-scheduler-stats</span><br><span class="line">-retire-stats</span><br><span class="line">-instruction-info</span><br><span class="line">    å¯ç”¨é¢å¤–çš„è°ƒåº¦/å‘å‡º/retire control unitç»Ÿè®¡ã€‚è¯¥è§†å›¾æ”¶é›†å’Œåˆ†ææŒ‡ä»¤åˆ†æ´¾äº‹ä»¶ï¼Œä»¥åŠé™æ€/åŠ¨æ€åˆ†æ´¾åœé¡¿äº‹ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤è§†å›¾ã€‚</span><br><span class="line">-show-encoding</span><br><span class="line">    æ‰“å°æŒ‡ä»¤16è¿›åˆ¶</span><br><span class="line">-all-stats</span><br><span class="line">-all-views</span><br><span class="line">-instruction-tables</span><br><span class="line">    è¿™ä¸èµ„æºå‹åŠ›è§†å›¾ä¸åŒï¼Œå› ä¸ºå®ƒä¸éœ€è¦æ¨¡æ‹Ÿä»£ç ã€‚ç›¸åï¼Œå®ƒæŒ‰é¡ºåºæ‰“å°æ¯ä¸ªæŒ‡ä»¤çš„èµ„æºå‹åŠ›çš„ç†è®ºå‡åŒ€åˆ†å¸ƒã€‚</span><br><span class="line">-bottleneck-analysis</span><br><span class="line">    æ‰“å°æœ‰å…³å½±å“ååé‡çš„ç“¶é¢ˆçš„ä¿¡æ¯ã€‚è¿™ç§åˆ†æå¯èƒ½å¾ˆæ˜‚è´µï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¦ç”¨çš„ã€‚ç“¶é¢ˆåœ¨æ‘˜è¦è§†å›¾ä¸­çªå‡ºæ˜¾ç¤ºã€‚å…·æœ‰æœ‰åºåç«¯çš„å¤„ç†å™¨ç›®å‰ä¸æ”¯æŒç“¶é¢ˆåˆ†æã€‚???</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h2><p><img src="https://pic.shaojiemike.top/img/38FD1039D93F746E0A45477E84CF74A0.png"></p>
<h2 id="æ ·ä¾‹åˆ†æ"><a href="#æ ·ä¾‹åˆ†æ" class="headerlink" title="æ ·ä¾‹åˆ†æ"></a>æ ·ä¾‹åˆ†æ</h2><h3 id="quick-overview-of-the-performance-throughput"><a href="#quick-overview-of-the-performance-throughput" class="headerlink" title="quick overview of the performance throughput"></a>quick overview of the performance throughput</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Iterations:        300</span><br><span class="line">Instructions:      900</span><br><span class="line">Total Cycles:      610</span><br><span class="line">Total uOps:        900</span><br><span class="line"></span><br><span class="line">Dispatch Width:    2</span><br><span class="line">uOps Per Cycle:    1.48</span><br><span class="line">IPC:               1.48</span><br><span class="line">Block RThroughput: 2.0</span><br></pre></td></tr></table></figure>

<ol>
<li>IPC<ol>
<li>ç†è®ºæœ€å¤§å€¼æ˜¯$$\frac{OneLoopInstructions}{Block_RThroughput}&#x3D;(OneLoopInstructions)*(Block_Throughput)$$</li>
</ol>
</li>
<li>uOps Per Cycle<ol>
<li>simulated micro opcodes (uOps)</li>
<li><strong>æ¯ä¸ªå‘¨æœŸçš„simulated micro opcodesæ•°</strong></li>
<li>åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šæœ€å¤§å€¼æ˜¯$$\frac{OneLoopUOps}{Block_RThroughput}&#x3D;(OneLoopUOps)*(Block_Throughput)$$</li>
<li>A delta between Dispatch Width and this field is an indicator of a performance issue.</li>
<li>The delta between the Dispatch Width (2.00), and the theoretical maximum uOp throughput (1.50) is an indicator of a performance bottleneck caused by the lack of hardware resources, and the Resource pressure view can help to identify the problematic resource usage.</li>
</ol>
</li>
<li>Dispatch Width<ol>
<li>å‘å°„åˆ°ä¹±åºåç«¯çš„æœ€å¤§å¾®æŒ‡ä»¤æ“ä½œæ•°(the maximum number of micro opcodes&#x2F;uOps)ï¼Ÿ</li>
</ol>
</li>
<li>Block RThroughput (Block Reciprocal Throughput)<ol>
<li>åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œç†è®ºä¸Šçš„<strong>æ¯æ¬¡å¾ªç¯çš„æœ€å¤§blockæˆ–è€…iterationsæ•°</strong></li>
<li>å—é™äºdispatch rateå’Œthe availability of hardware resources.</li>
</ol>
</li>
</ol>
<h3 id="Instruction-info-view"><a href="#Instruction-info-view" class="headerlink" title="Instruction info view"></a>Instruction info view</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Instruction Info:</span><br><span class="line">[1]: #uOps</span><br><span class="line">[2]: Latency</span><br><span class="line">[3]: RThroughput</span><br><span class="line">[4]: MayLoad</span><br><span class="line">[5]: MayStore</span><br><span class="line">[6]: HasSideEffects (U)</span><br><span class="line"></span><br><span class="line">[1]    [2]    [3]    [4]    [5]    [6]    Instructions:</span><br><span class="line"> 1      2     1.00                        vmulps      %xmm0, %xmm1, %xmm2</span><br><span class="line"> 1      3     1.00                        vhaddps     %xmm2, %xmm2, %xmm3</span><br><span class="line"> 1      3     1.00                        vhaddps     %xmm3, %xmm3, %xmm4</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºäº†æŒ‡ä»¤é‡Œé˜Ÿåˆ—æ¯æ¡æŒ‡ä»¤çš„<strong>å»¶è¿Ÿ</strong>å’Œ<strong>ååé‡çš„å€’æ•°</strong>ã€‚</p>
<p>RThroughputæ˜¯æŒ‡ä»¤ååé‡çš„å€’æ•°ã€‚åœ¨ä¸è€ƒè™‘å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œååé‡æ˜¯<strong>å•å‘¨æœŸèƒ½æ‰§è¡Œçš„åŒç±»å‹æŒ‡ä»¤çš„æœ€å¤§æ•°é‡</strong>ã€‚</p>
<h3 id="Resource-pressure-view"><a href="#Resource-pressure-view" class="headerlink" title="Resource pressure view"></a>Resource pressure view</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Resources:</span><br><span class="line">[0]   - JALU0</span><br><span class="line">[1]   - JALU1</span><br><span class="line">[2]   - JDiv</span><br><span class="line">[3]   - JFPA</span><br><span class="line">[4]   - JFPM</span><br><span class="line">[5]   - JFPU0</span><br><span class="line">[6]   - JFPU1</span><br><span class="line">[7]   - JLAGU</span><br><span class="line">[8]   - JMul</span><br><span class="line">[9]   - JSAGU</span><br><span class="line">[10]  - JSTC</span><br><span class="line">[11]  - JVALU0</span><br><span class="line">[12]  - JVALU1</span><br><span class="line">[13]  - JVIMUL</span><br><span class="line"></span><br><span class="line">Resource pressure per iteration:</span><br><span class="line">[0]    [1]    [2]    [3]    [4]    [5]    [6]    [7]    [8]    [9]    [10]   [11]   [12]   [13]</span><br><span class="line"> -      -      -     2.00   1.00   2.00   1.00    -      -      -      -      -      -      -</span><br><span class="line"></span><br><span class="line">Resource pressure by instruction:</span><br><span class="line">[0]    [1]    [2]    [3]    [4]    [5]    [6]    [7]    [8]    [9]    [10]   [11]   [12]   [13]   Instructions:</span><br><span class="line"> -      -      -      -     1.00    -     1.00    -      -      -      -      -      -      -     vmulps      %xmm0, %xmm1, %xmm2</span><br><span class="line"> -      -      -     1.00    -     1.00    -      -      -      -      -      -      -      -     vhaddps     %xmm2, %xmm2, %xmm3</span><br><span class="line"> -      -      -     1.00    -     1.00    -      -      -      -      -      -      -      -     vhaddps     %xmm3, %xmm3, %xmm4</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡å¾ªç¯æˆ–è€…æ¯æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œæ¶ˆè€—çš„èµ„æºå‘¨æœŸæ•°ã€‚ä»è€Œæ‰¾åˆ°é«˜èµ„æºå ç”¨çš„éƒ¨åˆ†ã€‚</p>
<h3 id="Timeline-View"><a href="#Timeline-View" class="headerlink" title="Timeline View"></a>Timeline View</h3><p>å¯æ‰“å°æµæ°´çº¿æƒ…å†µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Timeline view:</span><br><span class="line">                    012345</span><br><span class="line">Index     0123456789</span><br><span class="line"></span><br><span class="line">[0,0]     DeeER.    .    .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[0,1]     D==eeeER  .    .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[0,2]     .D====eeeER    .   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">[1,0]     .DeeE-----R    .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[1,1]     . D=eeeE---R   .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[1,2]     . D====eeeER   .   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">[2,0]     .  DeeE-----R  .   vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">[2,1]     .  D====eeeER  .   vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">[2,2]     .   D======eeeER   vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Average Wait times (based on the timeline view):</span><br><span class="line">[0]: Executions</span><br><span class="line">[1]: Average time spent waiting in a scheduler&#x27;s queue</span><br><span class="line">[2]: Average time spent waiting in a scheduler&#x27;s queue while ready</span><br><span class="line">[3]: Average time elapsed from WB until retire stage</span><br><span class="line"></span><br><span class="line">      [0]    [1]    [2]    [3]</span><br><span class="line">0.     3     1.0    1.0    3.3       vmulps   %xmm0, %xmm1, %xmm2</span><br><span class="line">1.     3     3.3    0.7    1.0       vhaddps  %xmm2, %xmm2, %xmm3</span><br><span class="line">2.     3     5.7    0.0    0.0       vhaddps  %xmm3, %xmm3, %xmm4</span><br><span class="line">       3     3.3    0.5    1.4       &lt;total&gt;</span><br></pre></td></tr></table></figure>

<p>å½±å“å› ç´ åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ•°æ®å†²çª&#x2F;ä¾èµ–ï¼šè¯»åå†™ï¼Œå†™åè¯»ä¾èµ– ã€‚æ— æ³•æŒ‡ä»¤çº§å¹¶è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯„å­˜å™¨é‡å‘½åè§£å†³</li>
<li>ç»“æ„å†²çªï¼šå ç”¨å‘å°„ä½ æˆ–è€… åŒä¸€ç¡¬ä»¶</li>
<li>æ§åˆ¶å†²çªï¼šåˆ†æ”¯ï¼Ÿ</li>
<li>instructions must retire in program order, so [1,0] has to wait for [0,2] to be retired first</li>
</ol>
<h3 id="Bottleneck-Analysis"><a href="#Bottleneck-Analysis" class="headerlink" title="Bottleneck Analysis"></a>Bottleneck Analysis</h3><ul>
<li>å¯ä»¥åˆ†æå‡ºæ•°æ®å†²çª&#x2F;ä¾èµ–å’Œç»“æ„å†²çªçš„å½±å“å¤§å°</li>
<li>å‡†ç¡®æ€§å–å†³äºæ¨¡æ‹Ÿå’Œæ˜¯å¦æœ‰å¯¹åº”CPUæ¨¡å‹ã€‚</li>
<li>æš‚æ—¶ä¸æ”¯æŒæœ‰åºåç«¯ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Cycles with backend pressure increase [ 91.52% ]</span><br><span class="line">Throughput Bottlenecks:</span><br><span class="line">  Resource Pressure       [ 0.01% ]</span><br><span class="line">  - SBPort0  [ 0.01% ]</span><br><span class="line">  - SBPort1  [ 0.01% ]</span><br><span class="line">  - SBPort5  [ 0.01% ]</span><br><span class="line">  Data Dependencies:      [ 91.51% ]</span><br><span class="line">  - Register Dependencies [ 91.51% ]</span><br><span class="line">  - Memory Dependencies   [ 10.76% ]</span><br></pre></td></tr></table></figure>

<ul>
<li>ç«¯å£ä¿¡æ¯æ¥è‡ªTableGen <code>llvm/lib/Target/X86/X86SchedSandyBridge.td</code></li>
<li>é²²é¹920çš„æ¥è‡ª <code>llvm/lib/Target/AArch64/AArch64SchedTSV110.td</code></li>
</ul>
<h3 id="é¢å¤–ä¿¡æ¯"><a href="#é¢å¤–ä¿¡æ¯" class="headerlink" title="é¢å¤–ä¿¡æ¯"></a>é¢å¤–ä¿¡æ¯</h3><ol>
<li>Dynamic Dispatch Stall Cycles</li>
<li>Dispatch Logic<ol>
<li>å¯ä»¥çœ‹å‡ºæµæ°´çº¿å‘å°„æ»¡å¸¦å®½æˆ–å‡ æ¡æŒ‡ä»¤çš„æ—¶é—´å æ¯”</li>
</ol>
</li>
<li>Schedulers<ol>
<li>æ¯ä¸ªå‘¨æœŸå¾®æŒ‡ä»¤å‘å°„æ•°å æ¯”</li>
</ol>
</li>
<li>Schedulerâ€™s queue usage<ol>
<li><p>æ‰§è¡Œæ—¶ä½¿ç”¨çš„å¹³å‡æˆ–æœ€å¤§buffer entries (i.e., scheduler queue entries)</p>
</li>
<li><p>AMD Jaguar</p>
</li>
<li><pre><code>  JALU01 - A scheduler for ALU instructions.
  JFPU01 - A scheduler floating point operations.
  JLSAGU - A scheduler for address generation.
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">5. Retire Control Unit</span><br><span class="line">   1. åœ¨ä¸€ä¸ªå‘¨æœŸé‡Œæœ‰å¤šå°‘æŒ‡ä»¤retiredçš„å æ¯”(å¥½å§ï¼Œæ„Ÿè§‰æœ‰è¯­ç—…)</span><br><span class="line">6. A re-order buffer (ROB) çš„ä½¿ç”¨æƒ…å†µ</span><br><span class="line">7. Register File statistics</span><br><span class="line">   1. physical register file (PRF)</span><br><span class="line">   2. floating-point registers (JFpuPRF)</span><br><span class="line">   3. integer registers (JIntegerPRF)</span><br><span class="line"></span><br><span class="line">## Instruction Flow</span><br><span class="line"></span><br><span class="line">llvm-mca å‡è®¾æŒ‡ä»¤åœ¨æ¨¡æ‹Ÿå¼€å§‹ä¹‹å‰å·²ç»å…¨éƒ¨è§£ç å¹¶æ”¾å…¥é˜Ÿåˆ—ä¸­ã€‚å› æ­¤ï¼ŒæŒ‡ä»¤æå–å’Œè§£ç é˜¶æ®µæ²¡æœ‰è¢«è®¡ç®—ã€‚æœªè€ƒè™‘å‰ç«¯çš„æ€§èƒ½ç“¶é¢ˆã€‚æ­¤å¤–ï¼Œllvm-mca ä¸æ¨¡æ‹Ÿåˆ†æ”¯é¢„æµ‹ã€‚</span><br><span class="line"></span><br><span class="line">### Instruction Dispatch</span><br><span class="line"></span><br><span class="line">å¤„ç†å™¨çš„é»˜è®¤ dispatch widthå€¼ç­‰äºLLVMâ€™s scheduling modelé‡Œçš„IssueWidthå€¼ã€‚</span><br><span class="line"></span><br><span class="line">An instruction can be dispatched if:</span><br><span class="line"></span><br><span class="line">* The size of the **dispatch group** is smaller than processorâ€™s dispatch width.</span><br><span class="line">* There are enough entries in the **reorder buffer**.</span><br><span class="line">* There are enough **physical registers** to do register renaming.</span><br><span class="line">* The schedulers are **not full**.</span><br><span class="line"></span><br><span class="line">reorder bufferè´Ÿè´£è·Ÿè¸ªå‘½ä»¤ï¼Œä½¿ä¹‹æŒ‰ç…§ç¨‹åºé¡ºåºretiredç»“æŸã€‚å…¶é»˜è®¤å€¼ä¸º MicroOpBufferSize ã€‚</span><br><span class="line"></span><br><span class="line">å„ç§Buffered resources è¢«è§†ä½œscheduler resources.</span><br><span class="line"></span><br><span class="line">### Instruction Issue</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªå¤„ç†å™¨è°ƒåº¦å™¨å®ç°ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºã€‚æŒ‡ä»¤å¿…é¡»åœ¨è°ƒåº¦ç¨‹åºçš„ç¼“å†²åŒºä¸­ç­‰å¾…ï¼Œç›´åˆ°è¾“å…¥å¯„å­˜å™¨æ“ä½œæ•°å¯ç”¨ã€‚åªæœ‰åœ¨é‚£ä¸ªæ—¶å€™ï¼ŒæŒ‡ä»¤æ‰ç¬¦åˆæ‰§è¡Œçš„æ¡ä»¶ï¼Œå¹¶ä¸”å¯èƒ½ä¼šè¢«å‘å‡ºï¼ˆå¯èƒ½æ˜¯ä¹±åºçš„ï¼‰ä»¥ä¾›æ‰§è¡Œã€‚ llvm-mca åœ¨è°ƒåº¦æ¨¡å‹çš„å¸®åŠ©ä¸‹è®¡ç®—æŒ‡ä»¤å»¶è¿Ÿã€‚</span><br><span class="line"></span><br><span class="line">llvm-mca çš„è°ƒåº¦å™¨æ—¨åœ¨æ¨¡æ‹Ÿå¤šå¤„ç†å™¨è°ƒåº¦å™¨ã€‚è°ƒåº¦å™¨è´Ÿè´£è·Ÿè¸ªæ•°æ®ä¾èµ–å…³ç³»ï¼Œå¹¶åŠ¨æ€é€‰æ‹©æŒ‡ä»¤æ¶ˆè€—å“ªäº›å¤„ç†å™¨èµ„æºã€‚å®ƒå°†å¤„ç†å™¨èµ„æºå•å…ƒå’Œèµ„æºç»„çš„ç®¡ç†å§”æ‰˜ç»™èµ„æºç®¡â€‹â€‹ç†å™¨ã€‚èµ„æºç®¡ç†å™¨è´Ÿè´£é€‰æ‹©æŒ‡ä»¤æ¶ˆè€—çš„èµ„æºå•å…ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€æ¡æŒ‡ä»¤æ¶ˆè€—äº†ä¸€ä¸ªèµ„æºç»„çš„1cyï¼Œåˆ™èµ„æºç®¡ç†å™¨ä»è¯¥ç»„ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨å•å…ƒï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œèµ„æºç®¡ç†å™¨ä½¿ç”¨å¾ªç¯é€‰æ‹©å™¨æ¥ä¿è¯èµ„æºä½¿ç”¨åœ¨ç»„çš„æ‰€æœ‰å•å…ƒä¹‹é—´å‡åŒ€åˆ†é…ã€‚</span><br><span class="line"></span><br><span class="line">llvm-mcaâ€™s scheduler internally groups instructions into three sets:</span><br><span class="line"></span><br><span class="line">* WaitSet: a set of instructions whose operands are not ready.</span><br><span class="line">* ReadySet: a set of instructions ready to execute.</span><br><span class="line">* IssuedSet: a set of instructions executing.</span><br><span class="line"></span><br><span class="line">### Write-Back and Retire Stage</span><br><span class="line"></span><br><span class="line"> retire control unit</span><br><span class="line"></span><br><span class="line">1. When instructions are executed,the flags the instruction as â€œready to retire.â€</span><br><span class="line">2. Instructions are retired in program order</span><br><span class="line">3. free the physical registers</span><br><span class="line"></span><br><span class="line">### Load/Store Unit and Memory Consistency Model</span><br><span class="line"></span><br><span class="line">load/store unit (LSUnit)ç”¨æ¥æ¨¡æ‹Ÿä¹±åºmemoryæ“ä½œ</span><br><span class="line"></span><br><span class="line">The rules are:</span><br><span class="line"></span><br><span class="line">1. A younger load is allowed to pass an older load only if there are no intervening stores or barriers between the two loads.</span><br><span class="line">2. A younger load is allowed to pass an older store provided that the load does not alias with the store.</span><br><span class="line">3. A younger store is not allowed to pass an older store.ä¸èƒ½äº¤æ¢é¡ºåºçš„æ„æ€</span><br><span class="line">4. A younger store is not allowed to pass an older load.</span><br><span class="line"></span><br><span class="line">å‡è®¾ loads do not alias (-noalias=true) store operations.Under this assumption, younger loads are always allowed to pass older stores. ???</span><br><span class="line"></span><br><span class="line">LSUnitä¸æ‰“ç®—è·‘alias analysisæ¥é¢„æµ‹ä½•æ—¶loadä¸storeä¸ç›¸äº’alias???</span><br><span class="line"></span><br><span class="line">in the case of write-combining memory, rule 3 could be relaxed to allow reordering of non-aliasing store operations.???</span><br><span class="line"></span><br><span class="line">LSUnitä¸ç®¡çš„å…¶ä½™ä¸‰ç‚¹ï¼š</span><br><span class="line"></span><br><span class="line">1. The LSUnit does not know when store-to-load forwarding may occur.</span><br><span class="line">2. The LSUnit does not know anything about cache hierarchy and memory types.</span><br><span class="line">3. The LSUnit does not know how to identify serializing operations and memory fences.</span><br><span class="line">4. The LSUnit does not attempt to predict if a load or store hits or misses the L1 cache(ä¸è€ƒè™‘cacheå‘½ä¸­ï¼Œé»˜è®¤æ˜¯å‘½ä¸­L1,äº§ç”Ÿthe load-to-use latencyçš„æœ€ä¹è§‚å¼€é”€)</span><br><span class="line"></span><br><span class="line">llvm-mca ä¸çŸ¥é“åºåˆ—åŒ–æ“ä½œæˆ–å†…å­˜å±éšœä¹‹ç±»çš„æŒ‡ä»¤ã€‚ LSUnit ä¿å®ˆåœ°å‡è®¾åŒæ—¶å…·æœ‰â€œMayLoadâ€å’Œæœªå»ºæ¨¡å‰¯ä½œç”¨çš„æŒ‡ä»¤çš„è¡Œä¸ºç±»ä¼¼äºâ€œè½¯â€load-barrierã€‚è¿™æ„å‘³ç€ï¼Œå®ƒåœ¨ä¸å¼ºåˆ¶åˆ·æ–°loadé˜Ÿåˆ—çš„æƒ…å†µä¸‹åºåˆ—åŒ–åŠ è½½ã€‚ç±»ä¼¼åœ°ï¼Œâ€œMayStoreâ€å’Œå…·æœ‰æœªå»ºæ¨¡å‰¯ä½œç”¨çš„æŒ‡ä»¤è¢«è§†ä¸ºstoreéšœç¢ã€‚å®Œæ•´çš„memory-barrieræ˜¯å…·æœ‰æœªå»ºæ¨¡å‰¯ä½œç”¨çš„â€œMayLoadâ€å’Œâ€œMayStoreâ€æŒ‡ä»¤ã€‚LLVMçš„å®ç°æ˜¯ä¸å‡†ç¡®çš„ï¼Œä½†è¿™æ˜¯æˆ‘ä»¬ç›®å‰ä½¿ç”¨ LLVM ä¸­å¯ç”¨çš„å½“å‰ä¿¡æ¯æ‰€èƒ½åšçš„æœ€å¥½çš„äº‹æƒ…ã€‚</span><br><span class="line"></span><br><span class="line">load/store barrierä¼šå ç”¨åœ¨load/store é˜Ÿåˆ—é‡Œå ç”¨ä¸€é¡¹ã€‚</span><br><span class="line">å½“load/store barrieræ˜¯å…¶é˜Ÿåˆ—é‡Œoldesté¡¹æ—¶ï¼Œå…¶ä¼šè¢«æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">![](https://pic.shaojiemike.top/img/440472FD7AB14BC3C1F29BD2D565ACDF.png)</span><br><span class="line"></span><br><span class="line">### In-order Issue and Execute</span><br><span class="line"></span><br><span class="line">æœ‰åºå¤„ç†å™¨è¢«å»ºæ¨¡ä¸ºå•ä¸ª InOrderIssueStage é˜¶æ®µã€‚å®ƒç»•è¿‡ Dispatchã€Scheduler å’Œ Load/Store å•å…ƒã€‚ä¸€æ—¦å®ƒä»¬çš„æ“ä½œæ•°å¯„å­˜å™¨å¯ç”¨å¹¶ä¸”æ»¡è¶³èµ„æºè¦æ±‚ï¼Œå°±ä¼šå‘å‡ºæŒ‡ä»¤ã€‚æ ¹æ®LLVMçš„è°ƒåº¦æ¨¡å‹ä¸­IssueWidthå‚æ•°çš„å€¼ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªå‘¨æœŸå†…å‘å‡ºå¤šæ¡æŒ‡ä»¤ã€‚ä¸€æ—¦å‘å‡ºï¼ŒæŒ‡ä»¤å°±ä¼šè¢«ç§»åˆ° IssuedInst é›†ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½retireã€‚ llvm-mca ç¡®ä¿æŒ‰é¡ºåºæäº¤å†™å…¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœ RetireOOO å±æ€§for at least one of its writesä¸ºçœŸï¼Œåˆ™å…è®¸æŒ‡ä»¤æäº¤å†™å…¥å¹¶æ— åºretire???</span><br><span class="line"></span><br><span class="line">## Custom Behaviour è‡ªå®šä¹‰è¡Œä¸º</span><br><span class="line"></span><br><span class="line">æŸäº›æŒ‡ä»¤åœ¨è¯¥æ¨¡å‹ä¸­å¹¶ä¸èƒ½è¢«å‡†ç¡®çš„æ¨¡æ‹Ÿã€‚ä¸ºäº†å‡ æ¡æŒ‡ä»¤è€Œä¿®æ”¹æ¨¡å‹ä¸æ˜¯ä¸ªå¥½çš„é€‰æ‹©ï¼Œä¸€èˆ¬é€šè¿‡**CustomBehaviour**ç±»å¯¹æŸäº›æŒ‡ä»¤è¿›è¡Œç‰¹æ®Šå»ºæ¨¡ï¼šè‡ªå®šä¹‰æ•°æ®ä¾èµ–ï¼Œä»¥åŠè§„é¿ã€å•ç‹¬å¤„ç†ç‰¹æ®Šæƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">ä¸ºæ­¤ï¼Œllvm-mcaè®¾ç½®äº†ä¸€ä¸ªé€šç”¨çš„ä»¥åŠå¤šä¸ªç‰¹æ®Šçš„**CustomBehaviour**ç±»ã€‚ä¸‹é¢ä¸¤ç§æƒ…å†µä¸‹ä¼šä½¿ç”¨é€šç”¨ç±»ï¼š</span><br><span class="line"></span><br><span class="line">1. å¼€å¯äº†`-disable-cb`é€‰é¡¹</span><br><span class="line">2. ä¸å­˜åœ¨é’ˆå¯¹æŸç›®æ ‡çš„ç‰¹æ®Šç±»(é€šç”¨ç±»ä¹Ÿåšä¸äº†ä»€ä¹ˆï¼Œæˆ‘ä»€ä¹ˆä¹Ÿåšä¸åˆ°ğŸ˜¥)</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯æ³¨æ„ç›®å‰åªæœ‰in-orderæµæ°´çº¿å®ç°äº†**CustomBehaviour**ç±»ï¼Œout-orderæµæ°´çº¿å°†æ¥ä¹Ÿä¼šæ”¯æŒã€‚</span><br><span class="line"></span><br><span class="line">è¯¥ç±»ä¸»è¦é€šè¿‡`checkCustomHazard()`å‡½æ•°æ¥å®ç°ï¼Œé€šè¿‡å½“å‰æŒ‡ä»¤å’ŒçœŸæ­£æµæ°´çº¿ä¸­æ‰§è¡Œçš„æŒ‡ä»¤ï¼Œæ¥åˆ¤æ–­å½“å‰æŒ‡ä»¤éœ€è¦ç­‰å¾…å‡ ä¸ªå‘¨æœŸæ‰èƒ½å‘å°„ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœæƒ³å¯¹æ²¡æœ‰å®ç°çš„ç›®æ ‡æ·»åŠ **CustomBehaviour**ç±»ï¼Œå¯ä»¥å‚è€ƒå·²æœ‰çš„å®ç°ï¼Œæ¯”å¦‚åœ¨`/llvm/lib/Target/AMDGPU/MCA/`ç›®å½•ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">## Custom Views è‡ªå®šä¹‰è§†å›¾</span><br><span class="line"></span><br><span class="line">å…³äºè‡ªå®šä¹‰çš„è§†å›¾çš„æ·»åŠ è·¯å¾„ï¼Œå¦‚æœ**æ²¡æœ‰è¾“å‡º**ä»æœªåœ¨MC layer classes (MCSubtargetInfo, MCInstrInfo, etc.)é‡Œå‡ºç°è¿‡çš„**æ–°åç«¯å€¼**ï¼Œè¯·æŠŠå®ç°åŠ å…¥`/tools/llvm-mca/View/`ã€‚ç›¸åï¼Œè¯·åŠ å…¥`/lib/Target/&lt;TargetName&gt;/MCA/`ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">å…³äºCustom Viewsæ‰€éœ€å†…å®¹ï¼Œéœ€è¦å†™ç‰¹æ®Šçš„**CustomBehaviour**ç±»æ¥è¦†å†™`CustomBehaviour::getViews()`å‡½æ•°ï¼Œæ ¹æ®ä½ç½®çš„ä¸åŒè¿˜æœ‰ä¸‰ç§å®ç°`getStartViews(), getPostInstrInfoViews(),getEndViews()`ã€‚</span><br><span class="line"></span><br><span class="line">## å½±å“å‡†ç¡®æ€§çš„å› ç´ </span><br><span class="line"></span><br><span class="line">è°ƒåº¦æ¨¡å‹ä¸ä»…ç”¨äºè®¡ç®—æŒ‡ä»¤å»¶è¿Ÿå’Œååé‡ï¼Œè¿˜ç”¨äºäº†è§£å¯ç”¨çš„å¤„ç†å™¨èµ„æºä»¥åŠå¦‚ä½•æ¨¡æ‹Ÿå®ƒä»¬ã€‚</span><br><span class="line"></span><br><span class="line">llvm mcaè¿›è¡Œåˆ†æçš„è´¨é‡ä¸å¯é¿å…åœ°å—åˆ°**llvmä¸­è°ƒåº¦æ¨¡å‹è´¨é‡**çš„å½±å“ã€‚</span><br><span class="line"></span><br><span class="line">## åŠŸèƒ½ï¼ˆèƒ½ä¼°è®¡çš„å€¼</span><br><span class="line"></span><br><span class="line">1. IPC</span><br><span class="line">2. ç¡¬ä»¶èµ„æºå‹åŠ›resource-pressure</span><br><span class="line">3. ä¸€äº›é¢å¤–Infoï¼Ÿ</span><br><span class="line">   1.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 register-file-stats
 -dispatch-stats
 -scheduler-stats
 -retire-stats
 -instruction-info
 instruction-tables
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ååé‡ç“¶é¢ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">### æ”¯æŒå¯¹ç‰¹å®šä»£ç å—çš„åˆ†æ</span><br><span class="line"></span><br><span class="line">1. æ±‡ç¼–ä»£ç ï¼Œæ”¯æŒå‘½åå’ŒåµŒå¥—</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ol>
<h1 id="LLVM-MCA-BEGIN-block-name"><a href="#LLVM-MCA-BEGIN-block-name" class="headerlink" title="LLVM-MCA-BEGIN block-name"></a>LLVM-MCA-BEGIN block-name</h1><p> add %eax, %eax</p>
<h1 id="LLVM-MCA-END"><a href="#LLVM-MCA-END" class="headerlink" title="LLVM-MCA-END"></a>LLVM-MCA-END</h1> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. é«˜çº§è¯­è¨€ï¼Œé€šè¿‡å†…è”æ±‡ç¼–å®ç°</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> int foo(int a, int b) {<br>     __asm volatile(â€œ# LLVM-MCA-BEGIN fooâ€);<br>     a +&#x3D; 42;<br>     __asm volatile(â€œ# LLVM-MCA-ENDâ€);<br>     a *&#x3D; b;<br>     return a;<br> }</p>
<pre><code>
ä½†æ˜¯ï¼Œè¿™ä¼šå¹²æ‰°å¾ªç¯çŸ¢é‡åŒ–ç­‰ä¼˜åŒ–ï¼Œå¹¶å¯èƒ½å¯¹ç”Ÿæˆçš„ä»£ç äº§ç”Ÿå½±å“ã€‚å…·ä½“å½±å“è¯·å¯¹æ¯”æ±‡ç¼–ä»£ç ã€‚
</code></pre>
</li>
</ol>
<h2 id="ç›¸å…³è®ºæ–‡"><a href="#ç›¸å…³è®ºæ–‡" class="headerlink" title="ç›¸å…³è®ºæ–‡"></a>ç›¸å…³è®ºæ–‡</h2><p>Googleå­¦æœ¯æœllvm-mcaï¼Œä¸€å †è®ºæ–‡ã€‚ä½†æ˜¯ä¸æ€¥ç€çœ‹ï¼Œå› ä¸ºæ²¡æœ‰é¢„å¤‡çŸ¥è¯†ï¼Œæ²¡æœ‰é—®é¢˜çš„å»çœ‹è®ºæ–‡ã€‚æ•ˆç‡å’Œæ”¶è·å¾ˆä½çš„ï¼Œè€Œä¸”ä¼šçœ‹ä¸æ‡‚ã€‚</p>
<h2 id="ç›¸å…³é¡¹ç›®"><a href="#ç›¸å…³é¡¹ç›®" class="headerlink" title="ç›¸å…³é¡¹ç›®"></a>ç›¸å…³é¡¹ç›®</h2><h3 id="mc-ruler"><a href="#mc-ruler" class="headerlink" title="mc-ruler"></a>mc-ruler</h3><p><a target="_blank" rel="noopener" href="https://github.com/jeremyong/mc_ruler#">mc-ruler</a>æ˜¯æ•´åˆäº†llvm-mcaçš„cmake,å¯ä»¥æ‰“å°æŒ‡å®šéƒ¨åˆ†çš„ä»£ç åˆ†æä¿¡æ¯ã€‚å¦‚æœä¹‹åè¦æµ‹è¯•å¯èƒ½ç”¨å¾—ä¸Šã€‚</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><ol>
<li>å…·ä½“åŠŸèƒ½</li>
<li>llvmå¦‚ä½•å®ç°çš„ï¼Œè¦çœ‹ä»£ç ã€‚</li>
</ol>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol>
<li>(llvm-mca detects Intel syntax by the presence of an <strong>.intel_syntax</strong> directive at the beginning of the input. By default its output syntax matches that of its input.)</li>
<li>ï¼Ÿï¼Ÿï¼Ÿçš„åœ°æ–¹</li>
<li>å¤§æ¦‚çœ‹äº†ä¸€ä¸‹åŠŸèƒ½ï¼Œä½†æ˜¯æ€§èƒ½æ€ä¹ˆå¯¹æ¯”å‘¢ã€‚å‡†ç¡®å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿ<ol>
<li>arm kunpeng pmu-tools å®ç°</li>
</ol>
</li>
<li>æ¯æ¬¡çš„ä¼°è®¡å€¼ä¼šæ³¢åŠ¨å—ï¼Ÿ</li>
</ol>
<p>å¦‚ä½•å’Œå¤§ç¥äº¤æµå‘¢+æé—®çš„è‰ºæœ¯</p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-30T16:00:00.000Z" title="5/30/2023, 4:00:00 PM">2023-05-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.264Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">11 minutes read (About 1699 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/30/Work/Programming/4-compile/llvmBackend/">llvm Backend</a></p><div class="content"><h2 id="llvm-åç«¯-æ¦‚è¿°"><a href="#llvm-åç«¯-æ¦‚è¿°" class="headerlink" title="llvm åç«¯ æ¦‚è¿°"></a>llvm åç«¯ æ¦‚è¿°</h2><ul>
<li>åç«¯ï¼ˆbackendï¼‰ç”±ä¸€å¥—<strong>åˆ†æ</strong>å’Œ<strong>è½¬æ¢</strong>Passç»„æˆï¼Œå®ƒä»¬çš„ä»»åŠ¡æ˜¯ä»£ç ç”Ÿæˆï¼Œå³å°†LLVMä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰å˜æ¢ä¸ºç›®æ ‡ä»£ç ï¼ˆæˆ–è€…æ±‡ç¼–ï¼‰ã€‚</li>
<li>LLVMæ”¯æŒå¹¿æ³›çš„ç›®æ ‡ï¼šARMï¼ŒAArch64ï¼ŒHexagonï¼ŒMSP430ï¼ŒMIPSï¼ŒNvidia PTXï¼ŒPowerPCï¼ŒR600ï¼ŒSPARCï¼ŒSystemZï¼ŒX86ï¼Œå’ŒXCoreã€‚</li>
<li>æ‰€æœ‰è¿™äº›åç«¯å…±äº«ä¸€å¥—å…±ç”¨çš„æ¥å£ï¼Œå®ƒæ˜¯ç›®æ ‡æ— å…³ä»£ç ç”Ÿæˆå™¨çš„ä¸€éƒ¨åˆ†ï¼Œä»¥é€šç”¨APIçš„æ–¹æ³•æŠ½è±¡åŒ–åç«¯ä»»åŠ¡ã€‚æ¯ä¸ªç›®æ ‡å¿…é¡»ç‰¹æ®ŠåŒ–ä»£ç ç”Ÿæˆé€šç”¨ç±»ï¼Œä»¥å®ç°ç›®æ ‡ç‰¹å®šçš„è¡Œä¸ºã€‚</li>
</ul>
<h3 id="åç«¯çš„åŸºæœ¬æµç¨‹"><a href="#åç«¯çš„åŸºæœ¬æµç¨‹" class="headerlink" title="åç«¯çš„åŸºæœ¬æµç¨‹"></a>åç«¯çš„åŸºæœ¬æµç¨‹</h3><ul>
<li>ä¸‹å›¾ç»™å‡ºäº†å°†LLVM IRè½¬æ¢ä¸ºç›®æ ‡æ±‡ç¼–ä»£ç å¿…éœ€çš„æ­¥éª¤</li>
</ul>
<p><img src="https://pic.shaojiemike.top/img/20230523160158.png" alt="Backend"></p>
<ul>
<li>æµ…ç°è‰²çš„ä¸­é—´æ¡†ï¼Œä¹Ÿå«super passï¼Œæ˜¯å¿…éœ€çš„ï¼Œå®ƒä»¬æ˜¯åç«¯çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</li>
<li>ç™½è‰²æ¡†æ‰€æŒ‡ç¤ºçš„ï¼Œå¯ä»¥æ‰§è¡Œéå¿…éœ€çš„ä¼˜åŒ–Passä»¥è¿›ä¸€æ­¥æ”¹è¿›ç¿»è¯‘çš„è´¨é‡ã€‚å¯¹äºæé«˜æ‰€ç”Ÿæˆçš„ä»£ç çš„æ•ˆç‡æ›´é‡è¦ã€‚<ul>
<li>æ¯”å¦‚<code>-O3</code>çš„ä¼˜åŒ–ï¼Œè€Œä¸”å…¶é¡ºåºå¯¹ç»“æœä¹Ÿæœ‰å½±å“ã€‚</li>
</ul>
</li>
</ul>
<p>è¯¦ç»†è§£é‡Šå„é˜¶æ®µï¼š</p>
<ol>
<li>æŒ‡ä»¤é€‰æ‹©ï¼ˆInstruction Selectionï¼‰ï¼šå°†ä¸‰åœ°å€ç»“æ„çš„LLVM IRå˜æ¢ä¸ºDAGï¼ˆDirected Acyclic Graphï¼‰<ul>
<li>æ¯ä¸ªDAGèƒ½å¤Ÿè¡¨ç¤ºå•ä¸€åŸºæœ¬å—çš„è®¡ç®—ã€‚DAGå†…èŠ‚ç‚¹è¡¨ç¤ºæœºå™¨æŒ‡ä»¤ï¼Œè¾¹è¡¨ç¤ºæ•°æ®ä¾èµ–å…³ç³»ã€‚</li>
</ul>
</li>
<li>ç¬¬1æ¬¡æŒ‡ä»¤è°ƒåº¦ï¼ˆInstruction Schedulingï¼‰ï¼Œä¹Ÿç§°ä¸ºå‰å¯„å­˜å™¨åˆ†é…ï¼ˆRAï¼‰è°ƒåº¦ï¼Œå¯¹æŒ‡ä»¤æ’åºï¼ŒåŒæ—¶å°è¯•å‘ç°å°½å¯èƒ½å¤šçš„æŒ‡ä»¤å±‚æ¬¡çš„å¹¶è¡Œã€‚ç„¶åè¿™äº›æŒ‡ä»¤è¢«å˜æ¢ä¸ºMachineInsträ¸‰åœ°å€è¡¨ç¤ºã€‚</li>
<li>å¯„å­˜å™¨åˆ†é…ï¼ˆRegister Allocationï¼‰ï¼Œå®ƒå°†æ— é™çš„è™šæ‹Ÿå¯„å­˜å™¨çš„å¼•ç”¨è½¬æ¢ä¸ºæœ‰é™çš„ç›®æ ‡ç‰¹å®šçš„å¯„å­˜å™¨é›†ï¼Œå¯„å­˜å™¨ä¸å¤Ÿæ—¶æŒ¤å‡ºï¼ˆspillï¼‰åˆ°å†…å­˜ã€‚</li>
<li>ç¬¬2æ¬¡æŒ‡ä»¤è°ƒåº¦ï¼Œä¹Ÿç§°ä¸ºåå¯„å­˜å™¨åˆ†é…ï¼ˆRAï¼‰è°ƒåº¦ã€‚å› ä¸ºæ­¤æ—¶åœ¨è¿™ä¸ªç‚¹å¯è·å¾—çœŸå®çš„å¯„å­˜å™¨ä¿¡æ¯ï¼ŒæŸäº›ç±»å‹å¯„å­˜å™¨å­˜åœ¨é¢å¤–çš„é£é™©å’Œå»¶è¿Ÿï¼Œå®ƒä»¬å¯è¢«ç”¨ä»¥æ”¹è¿›æŒ‡ä»¤é¡ºåºã€‚</li>
<li>ä»£ç è¾“å‡ºï¼ˆCode Emissionï¼‰é˜¶æ®µå°†æŒ‡ä»¤ä»MachineInstrè¡¨ç¤ºå˜æ¢ä¸ºMCInstå®ä¾‹ã€‚è¿™ç§æ–°çš„è¡¨ç¤ºæ›´é€‚åˆæ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼Œå®ƒæœ‰ä¸¤ç§é€‰æ‹©ï¼šè¾“å‡ºæ±‡ç¼–ä»£ç æˆ–è€…è¾“å‡ºäºŒè¿›åˆ¶å—ï¼ˆblobï¼‰åˆ°ä¸€ç§ç‰¹å®šçš„ç›®æ ‡ä»£ç æ ¼å¼ã€‚</li>
</ol>
<h3 id="åç«¯ä»£ç ç»“æ„"><a href="#åç«¯ä»£ç ç»“æ„" class="headerlink" title="åç«¯ä»£ç ç»“æ„"></a>åç«¯ä»£ç ç»“æ„</h3><p>åç«¯çš„å®ç°åˆ†æ•£åœ¨LLVMæºä»£ç æ ‘çš„ä¸åŒç›®å½•ä¸­ã€‚ä»£ç ç”ŸæˆèƒŒåçš„ä¸»è¦ç¨‹åºåº“ä½äºlibç›®å½•å’Œå®ƒçš„å­æ–‡ä»¶å¤¹CodeGenã€MCã€TableGenã€å’ŒTargetä¸­ï¼Œ å…·ä½“å‚è€ƒ<a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id4">æ–‡æ¡£</a></p>
<p>Tablegenä½ç½®åœ¨ç±»ä¼¼ <code>llvm/lib/Target/X86/X86.td</code>çš„åœ°æ–¹</p>
<h2 id="llvm-ç¼–è¯‘ä¼˜åŒ–"><a href="#llvm-ç¼–è¯‘ä¼˜åŒ–" class="headerlink" title="llvm ç¼–è¯‘ä¼˜åŒ–"></a>llvm ç¼–è¯‘ä¼˜åŒ–</h2><ul>
<li>é€šè¿‡llvmçš„åˆ†æå’Œè½¬æ¢Passç›¸ç»“åˆå®ç°çš„ã€‚</li>
<li>é¦–å…ˆï¼Œé€šè¿‡åˆ†æPassè·å–ç¨‹åºçš„ä¸€äº›ç‰¹æ€§å’Œæ•°æ®æµç­‰ä¿¡æ¯ï¼Œä¾‹å¦‚æ§åˆ¶æµåˆ†æã€æ•°æ®æµåˆ†æã€ä¾èµ–åˆ†æç­‰ã€‚</li>
<li>ç„¶åï¼Œæ ¹æ®æ‰€å¾—åˆ°çš„åˆ†æä¿¡æ¯ï¼Œllvmä¼šæ‰§è¡Œè½¬æ¢Passï¼Œå¯¹ç¨‹åºè¿›è¡Œä¸€ç³»åˆ—çš„é‡æ„ã€ä¼˜åŒ–å’Œå˜æ¢ï¼Œä¾‹å¦‚å¸¸é‡ä¼ æ’­ã€æ­»ä»£ç æ¶ˆé™¤ã€å†…è”å‡½æ•°ã€å¾ªç¯å±•å¼€ç­‰ã€‚</li>
</ul>
<h3 id="ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°"><a href="#ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°" class="headerlink" title="ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°"></a>ä¸¾ä¾‹ï¼šO3ä¼˜åŒ–å®ç°</h3><p>ç¨‹åºä¼˜åŒ–é€‰é¡¹ -O3 æ˜¯é€šè¿‡å¯ç”¨ LLVM Pass Manager å¹¶æŒ‰ç…§é¡ºåºæ‰§è¡ŒåŒ…å«å¤šä¸ªå…·ä½“ä¼˜åŒ– Pass çš„è¿‡ç¨‹å®ç°çš„ã€‚åŒ…æ‹¬ï¼š</p>
<ol>
<li>å‡½æ•°å†…éƒ¨ä¼˜åŒ– Passï¼Œå¦‚å†…è”ã€å‡½æ•°å†…è”ã€æ— ç”¨å‡½æ•°æ¸…ç†ã€æ§åˆ¶æµæ‰å¹³åŒ–ï¼›</li>
<li>å‡½æ•°é—´ä¼˜åŒ– Passï¼Œå¦‚åŸºäºé™æ€å•èµ°è¾¹åˆ†æçš„é—´æ¥è°ƒç”¨ç›®æ ‡æ¨å¯¼ã€å‡½æ•°æ¯æ¬¡è°ƒç”¨çš„å‚æ•°çš„é‡å¤è®¡ç®—æ¶ˆé™¤ã€é€šè¿‡ç¬¦å·è§£ææ‰§è¡Œçš„å‡½æ•°ç®€ä»‹åŒ–ç­‰ã€‚</li>
<li>æ¨¡å—ä¼˜åŒ– Passï¼Œå¦‚æ­»ä»£ç æ¶ˆé™¤ã€å…¨å±€ä¼˜åŒ–ã€å¸¸é‡ä¼ æ’­ã€æ•°å€¼å®½åŒ–å’Œçª„åŒ–ã€æ•´é™¤ä¼˜åŒ–ç­‰ï¼›</li>
<li>ç‰¹å®šäºæ¶æ„çš„ä¼˜åŒ– Passï¼ŒåŒ…æ‹¬æŒ‡ä»¤è°ƒåº¦å’Œå¯„å­˜å™¨åˆ†é…ç­‰ã€‚</li>
</ol>
<p>è¿™äº› Pass çš„æ‰§è¡ŒèŒƒå›´æ¶µç›– LLVM IR ä¸ LLVM åç«¯ã€‚</p>
<h2 id="TableGen"><a href="#TableGen" class="headerlink" title="TableGen"></a>TableGen</h2><ul>
<li>LLVMçš„TableGenæ˜¯ä¸€ç§è¡¨æ ¼é©±åŠ¨ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸»è¦ç”¨äºç”Ÿæˆæ±‡ç¼–å™¨ã€åæ±‡ç¼–å™¨ã€æŒ‡ä»¤é€‰æ‹©å™¨ã€è°ƒåº¦å™¨ç­‰ä»£ç ã€‚</li>
<li>å®ƒä½¿ç”¨åŸºäºLLVM IRçš„DSL(Domain-Specific Language)æ¥æè¿°ç›®æ ‡æŒ‡ä»¤é›†çš„ç‰¹æ€§å’Œè§„åˆ™ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯è½¬æ¢ä¸ºC++ä»£ç ã€‚</li>
<li>ä½¿ç”¨TableGenå¯ä»¥å°†ç›®æ ‡æŒ‡ä»¤é›†çš„å®ç°ä¸æºä»£ç åˆ†ç¦»ï¼Œä»è€Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ul>
<p>TableGençš„è¾“å…¥æ–‡ä»¶ä½¿ç”¨æ‰©å±•åâ€œ<code>.td</code>â€ï¼ˆTableGençš„ç¼©å†™ï¼‰ï¼Œå®ƒä»¬å¯ä»¥æè¿°å¦‚ä¸‹å†…å®¹ï¼š</p>
<ol>
<li>Instruction Set Architecture (ISA) - æè¿°ç›®æ ‡æœºçš„æŒ‡ä»¤é›†ç‰¹æ€§ï¼Œä¾‹å¦‚æŒ‡ä»¤é›†æ¶æ„ã€å¯„å­˜å™¨ã€å¯„å­˜å™¨ç±»ã€æ“ä½œæ•°ç±»å‹ã€åœ°å€æ¨¡å‹ã€ç«¯å¯¹é½æ€§ç­‰ã€‚</li>
<li>Selection DAG - æè¿°äº†å¦‚ä½•å°†LLVM IRèŠ‚ç‚¹æ˜ å°„åˆ°ç›®æ ‡æœºæŒ‡ä»¤é›†çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚æŒ‡ä»¤çš„æ“ä½œç ã€æ“ä½œæ•°ã€è°ƒç”¨çº¦å®šã€æŒ‡ä»¤å»¶è¿Ÿç­‰ã€‚</li>
<li>Pattern Matching - å¯¹åŒ¹é…åˆ°çš„æŒ‡ä»¤æ¨¡æ¿åšå‡ºç”Ÿæˆæƒ³è¦çš„IRèŠ‚ç‚¹çš„é€‰æ‹©ã€‚</li>
<li>Instruction Scheduling - æè¿°è°ƒåº¦å™¨è¡Œä¸ºã€æŒ‡ä»¤ä¹‹é—´çš„æ—¶é—´å…³ç³»ï¼Œä»¥åŠå¦‚ä½•å°†æŒ‡ä»¤æ’å…¥åˆ°è°ƒåº¦å›¾ä¸­çš„è§„åˆ™ç­‰ã€‚</li>
</ol>
<ul>
<li>TableGenè‡ªåŠ¨åŒ–äº†ç›®æ ‡æœºæŒ‡ä»¤é›†çš„å¤§éƒ¨åˆ†å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿä½¿å¾—è‡ªå®šä¹‰ç›®æ ‡æœºå˜å¾—ç›¸å¯¹å®¹æ˜“ã€‚</li>
<li>è¯¥å·¥å…·æ”¯æŒé’ˆå¯¹å¤šç§å¹³å°å’Œç¼–è¯‘å™¨çš„åç«¯ä»£ç ç”Ÿæˆã€‚</li>
<li>å¯¹äºåµŒå…¥å¼ç³»ç»Ÿå’Œéæ ‡å‡†æŒ‡ä»¤é›†æ¶æ„ç­‰é¢†åŸŸï¼ŒTableGenæœ‰ç€å¹¿æ³›çš„åº”ç”¨ã€‚</li>
</ul>
<h3 id="ç›¸å…³çš„æ¦‚å¿µ"><a href="#ç›¸å…³çš„æ¦‚å¿µ" class="headerlink" title="ç›¸å…³çš„æ¦‚å¿µ"></a>ç›¸å…³çš„æ¦‚å¿µ</h3><ul>
<li>ç›®æ ‡æè¿°è¯­è¨€ï¼ˆTarget Description Languageï¼ŒTDLï¼‰æ¥å®šä¹‰ç›®æ ‡æ¶æ„ç‰¹å®šçš„æŒ‡ä»¤å’Œå¯„å­˜å™¨ã€‚å…¶ä¸­ï¼ŒTDLå¯ç”¨äºç›®æ ‡æ¶æ„ä¸­æŒ‡ä»¤å®šä¹‰å’Œå¯„å­˜å™¨å®šä¹‰çš„æ˜ å°„å…³ç³»å’ŒåŠ¨æ€ç”Ÿæˆæœºå™¨æŒ‡ä»¤çš„è§„åˆ™ã€‚</li>
</ul>
<h2 id="å®è·µï¼šllvm-IR-åç«¯"><a href="#å®è·µï¼šllvm-IR-åç«¯" class="headerlink" title="å®è·µï¼šllvm IR åç«¯"></a>å®è·µï¼šllvm IR åç«¯</h2><p>å®ç°ä¸€ä¸ªç®€å•çš„LLVM IRåç«¯ï¼Œå°†LLVM IRè½¬æ¢ä¸ºx86æ±‡ç¼–ä»£ç ï¼Œèƒ½line by lineçš„è¾“å‡ºã€‚</p>
<p>å‚è€ƒLLVMå®˜æ–¹æ–‡æ¡£ä¸­çš„â€œWriting an LLVM Backendâ€ä»¥åŠâ€œTableGen Backendsâ€</p>
<!-- ä¸‹é¢å›ç­”éƒ¨åˆ†**æ¥è‡ªChatGPT-3.5**ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚ -->

<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id2">https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html#id2</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-05-22T16:00:00.000Z" title="5/22/2023, 4:00:00 PM">2023-05-22</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.264Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">11 minutes read (About 1584 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/22/Work/Programming/4-compile/llvmPass/">llvm Pass</a></p><div class="content"><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><ul>
<li>Passå°±æ˜¯â€œéå†ä¸€éIRï¼Œå¯ä»¥åŒæ—¶å¯¹å®ƒåšä¸€äº›æ“ä½œâ€çš„æ„æ€ã€‚ç¿»è¯‘æˆä¸­æ–‡åº”è¯¥å«â€œä¼ é€’â€ã€‚</li>
<li>åœ¨å®ç°ä¸Šï¼ŒLLVMçš„æ ¸å¿ƒåº“ä¸­ä¼šç»™ä½ ä¸€äº› Passç±» å»ç»§æ‰¿ã€‚ä½ éœ€è¦å®ç°å®ƒçš„ä¸€äº›æ–¹æ³•ã€‚<ul>
<li>ModulePass , CallGraphSCCPass, FunctionPass , or LoopPass, or RegionPass</li>
</ul>
</li>
<li>æœ€åä½¿ç”¨LLVMçš„ç¼–è¯‘å™¨ä¼šæŠŠå®ƒç¿»è¯‘å¾—åˆ°çš„IRä¼ å…¥Passé‡Œï¼Œç»™ä½ éå†å’Œä¿®æ”¹ã€‚</li>
</ul>
<h3 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h3><ol>
<li>æ’æ¡©ï¼š åœ¨Passéå†LLVM IRçš„åŒæ—¶ï¼Œè‡ªç„¶å°±å¯ä»¥å¾€é‡Œé¢æ’å…¥æ–°çš„ä»£ç ã€‚</li>
<li>æœºå™¨æ— å…³çš„ä»£ç ä¼˜åŒ–ï¼šç¼–è¯‘åŸç†ä¸€è¯¾è¯´ï¼šIRåœ¨è¢«ç¿»è¯‘æˆæœºå™¨ç å‰ä¼šåšä¸€äº›æœºå™¨æ— å…³çš„ä¼˜åŒ–ã€‚ ä½†æ˜¯ä¸åŒçš„ä¼˜åŒ–æ–¹æ³•ä¹‹é—´éœ€è¦è§£è€¦ï¼Œæ‰€ä»¥è‡ªç„¶è¦å„è‡ªéå†ä¸€éIRï¼Œå®ç°æˆäº†ä¸€ä¸ªä¸ªLLVM Passã€‚ æœ€ç»ˆï¼ŒåŸºäºLLVMçš„ç¼–è¯‘å™¨ä¼šåœ¨å‰ç«¯ç”ŸæˆLLVM IRåè°ƒç”¨ä¸€äº›LLVM Passåšæœºå™¨æ— å…³ä¼˜åŒ–ï¼Œ ç„¶åå†è°ƒç”¨LLVMåç«¯ç”Ÿæˆç›®æ ‡å¹³å°ä»£ç ã€‚</li>
<li>é™æ€åˆ†æï¼š åƒVSCodeçš„C&#x2F;C++æ’ä»¶å°±ä¼šç”¨LLVM Passæ¥åˆ†æä»£ç ï¼Œæç¤ºå¯èƒ½çš„é”™è¯¯ (æ— ç”¨çš„å˜é‡ã€æ— æ³•åˆ°è¾¾çš„ä»£ç ç­‰ç­‰)ã€‚</li>
</ol>
<h2 id="ç†è§£-llvm-Pass"><a href="#ç†è§£-llvm-Pass" class="headerlink" title="ç†è§£ llvm Pass"></a>ç†è§£ llvm Pass</h2><h3 id="ç†è§£Pass-API"><a href="#ç†è§£Pass-API" class="headerlink" title="ç†è§£Pass API"></a>ç†è§£Pass API</h3><p>ã€€ã€€Passç±»æ˜¯å®ç°ä¼˜åŒ–çš„ä¸»è¦èµ„æºã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ä¸ç›´æ¥ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯é€šè¿‡æ¸…æ¥šçš„å­ç±»ä½¿ç”¨å®ƒã€‚å½“å®ç°ä¸€ä¸ªPassæ—¶ï¼Œä½ åº”è¯¥é€‰æ‹©é€‚åˆä½ çš„Passçš„æœ€ä½³ç²’åº¦ï¼Œé€‚åˆæ­¤ç²’åº¦çš„æœ€ä½³å­ç±»ï¼Œä¾‹å¦‚åŸºäºå‡½æ•°ã€æ¨¡å—ã€å¾ªç¯ã€å¼ºè”é€šåŒºåŸŸï¼Œç­‰ç­‰ã€‚å¸¸è§çš„è¿™äº›å­ç±»å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>ModulePass</code>ï¼šè¿™æ˜¯æœ€é€šç”¨çš„Passï¼›å®ƒä¸€æ¬¡åˆ†ææ•´ä¸ªæ¨¡å—ï¼Œå‡½æ•°çš„æ¬¡åºä¸ç¡®å®šã€‚å®ƒä¸é™å®šä½¿ç”¨è€…çš„è¡Œä¸ºï¼Œå…è®¸åˆ é™¤å‡½æ•°å’Œå…¶å®ƒä¿®æ”¹ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œä½ éœ€è¦å†™ä¸€ä¸ªç±»ç»§æ‰¿ModulePassï¼Œå¹¶é‡è½½runOnModule()æ–¹æ³•ã€‚</li>
<li><code>FunctionPass</code>ï¼šè¿™ä¸ªå­ç±»å…è®¸ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå‡½æ•°ï¼Œå¤„ç†å‡½æ•°çš„æ¬¡åºä¸ç¡®å®šã€‚è¿™æ˜¯åº”ç”¨æœ€å¤šçš„Passç±»å‹ã€‚å®ƒç¦æ­¢ä¿®æ”¹å¤–éƒ¨å‡½æ•°ã€åˆ é™¤å‡½æ•°ã€åˆ é™¤å…¨å±€å˜é‡ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œéœ€è¦å†™ä¸€ä¸ªå®ƒçš„å­ç±»ï¼Œé‡è½½runOnFunction()æ–¹æ³•ã€‚</li>
<li><code>BasicBlockPass</code>ï¼šè¿™ä¸ªç±»çš„ç²’åº¦æ˜¯åŸºæœ¬å—ã€‚FunctionPassç±»ç¦æ­¢çš„ä¿®æ”¹åœ¨è¿™é‡Œä¹Ÿæ˜¯ç¦æ­¢çš„ã€‚å®ƒè¿˜ç¦æ­¢ä¿®æ”¹æˆ–è€…åˆ é™¤å¤–éƒ¨åŸºæœ¬å—ã€‚ä½¿ç”¨è€…éœ€è¦å†™ä¸€ä¸ªç±»ç»§æ‰¿BasicBlockPassï¼Œå¹¶é‡è½½å®ƒçš„runOnBasicBlock()æ–¹æ³•ã€‚</li>
</ul>
<p>ã€€ã€€è¢«é‡è½½çš„å…¥å£å‡½æ•°runOnModule()ã€runOnFunction()ã€runOnBasicBlock()è¿”å›å¸ƒå°”å€¼falseï¼Œå¦‚æœè¢«åˆ†æçš„å•å…ƒï¼ˆæ¨¡å—ã€å‡½æ•°å’ŒåŸºæœ¬å—ï¼‰ä¿æŒä¸å˜ï¼Œå¦åˆ™è¿”å›å¸ƒå°”å€¼trueã€‚</p>
<h3 id="Passçš„æ‰§è¡Œé¡ºåº-ä¾èµ–"><a href="#Passçš„æ‰§è¡Œé¡ºåº-ä¾èµ–" class="headerlink" title="Passçš„æ‰§è¡Œé¡ºåº&#x2F;ä¾èµ–"></a>Passçš„æ‰§è¡Œé¡ºåº&#x2F;ä¾èµ–</h3><ul>
<li>ChatGPTè¯´é»˜è®¤é¡ºåºæ˜¯ï¼šFunctionPass -&gt; Module Pass -&gt; LoopPass ?</li>
<li>å½“ç„¶æˆ‘ä»¬æ˜¯å¯ä»¥ä¿®æ”¹æ’å…¥Passçš„æ‰§è¡Œé¡ºåºçš„ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> PIMProf::AnnotationInjection::ID = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ³¨å†Œ llvm pass</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterPass&lt;PIMProf::AnnotationInjection&gt; <span class="title">RegisterMyPass</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="string">&quot;AnnotationInjection&quot;</span>, <span class="string">&quot;Inject annotators to uniquely identify each basic block.&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">loadPass</span><span class="params">(<span class="type">const</span> PassManagerBuilder &amp;,</span></span></span><br><span class="line"><span class="params"><span class="function">                           legacy::PassManagerBase &amp;PM)</span> </span>&#123;</span><br><span class="line">    PM.<span class="built_in">add</span>(<span class="keyword">new</span> PIMProf::<span class="built_in">AnnotationInjection</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ox çš„ä»£ç  llvm pass åœ¨EP_OptimizerLast ä½ç½®load</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">clangtoolLoader_Ox</span><span class="params">(PassManagerBuilder::EP_OptimizerLast, loadPass)</span></span>;</span><br><span class="line"><span class="comment">// O0 çš„ä»£ç  llvm pass EP_EnabledOnOptLevel0 ä½ç½®load</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">clangtoolLoader_O0</span><span class="params">(PassManagerBuilder::EP_EnabledOnOptLevel0, loadPass)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><ol>
<li>ç¼–å†™LLVM passä»£ç </li>
<li>é…ç½®ç¼–è¯‘ç¯å¢ƒ(cmake or make)</li>
<li>è¿è¡Œ(opt or clang)</li>
</ol>
<h2 id="1-ä»£ç æ¡†æ¶"><a href="#1-ä»£ç æ¡†æ¶" class="headerlink" title="1 ä»£ç æ¡†æ¶"></a>1 ä»£ç æ¡†æ¶</h2><p>æœ€ç®€å•æ¡†æ¶hello.cppå¦‚ä¸‹ï¼Œæ³¨æ„<code>Important</code>ä¸€å®šéœ€è¦ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Pass.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/IR/Function.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Support/raw_ostream.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/IR/LegacyPassManager.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;llvm/Transforms/IPO/PassManagerBuilder.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"> <span class="comment">// Important</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Hello</span> : <span class="keyword">public</span> FunctionPass &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ID;</span><br><span class="line">    <span class="built_in">Hello</span>() : <span class="built_in">FunctionPass</span>(ID) &#123;&#125;</span><br><span class="line"> <span class="comment">// Important</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">runOnFunction</span><span class="params">(Function &amp;F)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">      <span class="built_in">errs</span>() &lt;&lt; <span class="string">&quot;Hello: &quot;</span>;</span><br><span class="line">      <span class="built_in">errs</span>().<span class="built_in">write_escaped</span>(F.<span class="built_in">getName</span>()) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> Hello::ID = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Important:Register for opt</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterPass&lt;Hello&gt; <span class="title">X</span><span class="params">(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;Hello World Pass&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Important:Register for clang</span></span><br><span class="line"><span class="function"><span class="type">static</span> RegisterStandardPasses <span class="title">Y</span><span class="params">(PassManagerBuilder::EP_EarlyAsPossible,</span></span></span><br><span class="line"><span class="params"><span class="function">  [](<span class="type">const</span> PassManagerBuilder &amp;Builder, legacy::PassManagerBase &amp;PM) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    PM.add(<span class="keyword">new</span> Hello());</span></span></span><br><span class="line"><span class="params"><span class="function">  &#125;)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-ç¼–è¯‘åŠ¨æ€åº“"><a href="#2-ç¼–è¯‘åŠ¨æ€åº“" class="headerlink" title="2 ç¼–è¯‘åŠ¨æ€åº“"></a>2 ç¼–è¯‘åŠ¨æ€åº“</h2><h3 id="ä½¿ç”¨cmake"><a href="#ä½¿ç”¨cmake" class="headerlink" title="ä½¿ç”¨cmake"></a>ä½¿ç”¨cmake</h3><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://llvm.org/docs/CMake.html#cmake-out-of-source-pass">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>An example of a project layout is provided below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;project <span class="built_in">dir</span>&gt;/</span><br><span class="line">    |</span><br><span class="line">    CMakeLists.txt</span><br><span class="line">    &lt;pass name&gt;/</span><br><span class="line">        |</span><br><span class="line">        CMakeLists.txt</span><br><span class="line">        Pass.cpp</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>Contents of <code>&lt;project dir&gt;/CMakeLists.txt</code>:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(LLVM REQUIRED CONFIG)</span><br><span class="line"></span><br><span class="line"><span class="keyword">separate_arguments</span>(LLVM_DEFINITIONS_LIST NATIVE_COMMAND <span class="variable">$&#123;LLVM_DEFINITIONS&#125;</span>)</span><br><span class="line"><span class="keyword">add_definitions</span>(<span class="variable">$&#123;LLVM_DEFINITIONS_LIST&#125;</span>)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;LLVM_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(&lt;pass name&gt;)</span><br></pre></td></tr></table></figure>

<p>Contents of <code>&lt;project dir&gt;/&lt;pass name&gt;/CMakeLists.txt</code>:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(LLVMPassname MODULE Pass.cpp)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œcmakeç¼–è¯‘ã€‚äº§ç”Ÿ<code>LLVMPassname.so</code>æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake .. &amp;&amp; make</span><br></pre></td></tr></table></figure>

<!-- ä¸‹é¢å›ç­”éƒ¨åˆ†**æ¥è‡ªChatGPT-3.5**ï¼Œæš‚æ—¶æ²¡æœ‰æ ¡éªŒå…¶å¯é æ€§(çœ‹ä¸Šå»è²Œä¼¼è¯´å¾—é€š)ã€‚ -->

<h3 id="ä½¿ç”¨å‘½ä»¤è¡Œ"><a href="#ä½¿ç”¨å‘½ä»¤è¡Œ" class="headerlink" title="ä½¿ç”¨å‘½ä»¤è¡Œ"></a>ä½¿ç”¨å‘½ä»¤è¡Œ</h3><p>è¯·é˜…è¯»<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122522485">çŸ¥ä¹çš„æ–‡ç« </a></p>
<h2 id="3-ä½¿ç”¨"><a href="#3-ä½¿ç”¨" class="headerlink" title="3 ä½¿ç”¨"></a>3 ä½¿ç”¨</h2><h3 id="optåŠ è½½Pass"><a href="#optåŠ è½½Pass" class="headerlink" title="optåŠ è½½Pass"></a>optåŠ è½½Pass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clang -c -emit-llvm main.c -o main.bc <span class="comment"># éšæ„å†™ä¸€ä¸ªCä»£ç å¹¶ç¼–è¯‘åˆ°bcæ ¼å¼</span></span><br><span class="line">opt -load path/to/LLVMHello.so -hello main.bc -o /dev/null</span><br></pre></td></tr></table></figure>

<p>æŠŠæºä»£ç ç¼–è¯‘æˆIRä»£ç ï¼Œç„¶åç”¨optè¿è¡ŒPasså®åœ¨éº»çƒ¦ä¸”æ— è¶£ã€‚</p>
<h3 id="clangåŠ è½½Pass"><a href="#clangåŠ è½½Pass" class="headerlink" title="clangåŠ è½½Pass"></a>clangåŠ è½½Pass</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">clang -Xclang -load -Xclang path/to/LLVMHello.so main.c -o main</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">clang++ -Xclang -load -Xclang ./build/hello/libLLVMPassname.so test.cpp -o main</span><br></pre></td></tr></table></figure>

<h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><h3 id="æ’å…¥ä»£ç "><a href="#æ’å…¥ä»£ç " class="headerlink" title="æ’å…¥ä»£ç "></a>æ’å…¥ä»£ç </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">InjectSimMagic2</span><span class="params">(Module &amp;M, Instruction *insertPt, <span class="type">uint64_t</span> arg0, <span class="type">uint64_t</span> arg1, <span class="type">uint64_t</span> arg2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LLVMContext &amp;ctx = M.<span class="built_in">getContext</span>();</span><br><span class="line">    std::vector&lt;Type *&gt; argtype &#123;</span><br><span class="line">        Type::<span class="built_in">getInt64Ty</span>(ctx), Type::<span class="built_in">getInt64Ty</span>(ctx), Type::<span class="built_in">getInt64Ty</span>(ctx)</span><br><span class="line">    &#125;;</span><br><span class="line">    FunctionType *ty = FunctionType::<span class="built_in">get</span>(</span><br><span class="line">        Type::<span class="built_in">getVoidTy</span>(ctx), argtype, <span class="literal">false</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// template of Sniper&#x27;s SimMagic0</span></span><br><span class="line">    InlineAsm *ia = InlineAsm::<span class="built_in">get</span>(</span><br><span class="line">        ty,</span><br><span class="line">        <span class="string">&quot;\tmov $0, %rax \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\tmov $1, %rbx \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\tmov $2, %rcx \n&quot;</span></span><br><span class="line">        <span class="string">&quot;\txchg %bx, %bx\n&quot;</span>,</span><br><span class="line">        <span class="string">&quot;imr,imr,imr,~&#123;rax&#125;,~&#123;rbx&#125;,~&#123;rcx&#125;,~&#123;dirflag&#125;,~&#123;fpsr&#125;,~&#123;flags&#125;&quot;</span>,</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    );</span><br><span class="line">    Value *val0 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg0);</span><br><span class="line">    Value *val1 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg1);</span><br><span class="line">    Value *val2 = ConstantInt::<span class="built_in">get</span>(IntegerType::<span class="built_in">get</span>(ctx, <span class="number">64</span>), arg2);</span><br><span class="line">    std::vector&lt;Value *&gt; arglist &#123;val0, val1, val2&#125;;</span><br><span class="line">    CallInst::<span class="built_in">Create</span>(</span><br><span class="line">            ia, arglist, <span class="string">&quot;&quot;</span>, insertPt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä½¿ç”¨å†…è”æ±‡ç¼–åµŒå…¥åˆ° LLVM IR ä¸­ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov $0, %rax</span><br><span class="line">mov $1, %rbx</span><br><span class="line">mov $2, %rcx</span><br><span class="line">xchg %bx, %bx</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼š</p>
<ul>
<li>mov $0, %rax å°†ç«‹å³æ•° arg0 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rax ä¸­ã€‚</li>
<li>mov $1, %rbx å°†ç«‹å³æ•° arg1 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rbx ä¸­ã€‚</li>
<li>mov $2, %rcx å°†ç«‹å³æ•° arg2 è£…è½½åˆ°é€šç”¨å¯„å­˜å™¨ %rcx ä¸­ã€‚</li>
<li>xchg %bx, %bx æ˜¯ä¸€æ¡æ— æ“ä½œæŒ‡ä»¤ï¼Œç”¨äºä¿è¯è¯¥æ±‡ç¼–ä»£ç çš„åŸå­æ€§ã€‚</li>
</ul>
<h3 id="æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤"><a href="#æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤" class="headerlink" title="æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤"></a>æ‰“å°æ¯ä¸ªBBLå†…çš„æ±‡ç¼–æŒ‡ä»¤</h3><p>ç”±äºç›´æ¥æ‰“å°çš„æ˜¯llvm IRçš„è¡¨ç¤ºï¼Œæƒ³è¦æ‰“å°ç‰¹å®šæ¶æ„æ¯”å¦‚x86çš„æ±‡ç¼–ä»£ç ï¼Œå…¶å®éœ€è¦è¿›è¡Œllvmåç«¯çš„è½¬æ¢ã€‚ï¼ˆå–å·§ï¼Œå¯æ‰§è¡Œæ–‡ä»¶åæ±‡ç¼–ï¼Œç„¶åæ ¹æ®æ’å…¥çš„æ±‡ç¼–æ¡©åˆ’åˆ†ï¼‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><p>å¤ç°PIMProfè®ºæ–‡æ—¶ï¼Œç”¨åˆ°äº†ä½¿ç”¨ llvm passæ¥æ’å…¥ç‰¹æ®Šæ±‡ç¼–</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://www.llvm.org/docs/WritingAnLLVMPass.html">https://www.llvm.org/docs/WritingAnLLVMPass.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/122522485">https://zhuanlan.zhihu.com/p/122522485</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-10-20T16:00:00.000Z" title="10/20/2021, 4:00:00 PM">2021-10-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.260Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">4 minutes read (About 563 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/20/Work/HPC/llvm-mca/LLVM-mca3/">LLVM Mca : huawei HiSilicon&#039;s TSV110 work</a></p><div class="content"><h2 id="å‡ ä¸ªå¯¹æ¯”å›¾"><a href="#å‡ ä¸ªå¯¹æ¯”å›¾" class="headerlink" title="å‡ ä¸ªå¯¹æ¯”å›¾"></a>å‡ ä¸ªå¯¹æ¯”å›¾</h2><p><img src="https://pic.shaojiemike.top/img/20210918160557.png"></p>
<p>xè½´çš„å«ä¹‰æ˜¯æ”¹å˜portå€¼çš„æ„æ€ï¼Œæ¯”å¦‚<code>tsv110alu2</code>æ˜¯åœ¨<code>tsv110</code>çš„åŸºç¡€ä¸Šå°†aluçš„å€¼æ”¹æˆ2</p>
<h2 id="ç›¸å…³çš„-git-commit"><a href="#ç›¸å…³çš„-git-commit" class="headerlink" title="ç›¸å…³çš„ git commit"></a>ç›¸å…³çš„ git commit</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">commit c9ca3a3c66a493d72cf7afc7ee975e2de399f2e5</span><br><span class="line">Author: Elvina Yakubova &lt;elvina.yakubova@huawei.com&gt;</span><br><span class="line">Date:   Sat Nov 7 01:50:43 2020 +0300</span><br><span class="line"></span><br><span class="line">    [AArch64] Add driver tests for HiSilicon&#x27;s TSV110</span><br><span class="line"></span><br><span class="line">commit 93b99728b1676d23ab5dabc606344230d25e7f4b</span><br><span class="line">Author: Elvina Yakubova &lt;elvina.yakubova@huawei.com&gt;</span><br><span class="line">Date:   Sat Nov 7 01:22:35 2020 +0300</span><br><span class="line"></span><br><span class="line">    [AArch64] Add pipeline model for HiSilicon&#x27;s TSV110</span><br><span class="line"></span><br><span class="line">    This patch adds the scheduling and cost model for TSV110.</span><br><span class="line"></span><br><span class="line">    Reviewed by: SjoerdMeijer, bryanpkc</span><br><span class="line"></span><br><span class="line">    Differential Revision: https://reviews.llvm.org/D89972</span><br><span class="line"></span><br><span class="line">commit 123553921f86ac0fad7b742740aa45e8d380be02</span><br><span class="line">Author: Bryan Chan &lt;bryan.chan@huawei.com&gt;</span><br><span class="line">Date:   Fri Nov 9 19:32:08 2018 +0000</span><br><span class="line"></span><br><span class="line">    [AArch64] Support HiSilicon&#x27;s TSV110 processor</span><br><span class="line"></span><br><span class="line">    Reviewers: t.p.northover, SjoerdMeijer, kristof.beyls</span><br><span class="line"></span><br><span class="line">    Reviewed By: kristof.beyls</span><br><span class="line"></span><br><span class="line">    Subscribers: olista01, javed.absar, kristof.beyls, kristina, llvm-commits</span><br><span class="line"></span><br><span class="line">    Differential Revision: https://reviews.llvm.org/D53908</span><br><span class="line"></span><br><span class="line">    llvm-svn: 346546	</span><br></pre></td></tr></table></figure>
<p>åªæœ‰3ä¸ªï¼Œæ„Ÿè§‰å’Œ2ä¸ªåŠŸèƒ½å¾ˆç›¸å…³ã€‚</p>
<h2 id="æœ€è¿‘-Driver-commit"><a href="#æœ€è¿‘-Driver-commit" class="headerlink" title="æœ€è¿‘ Driver commit"></a>æœ€è¿‘ Driver commit</h2><p><a target="_blank" rel="noopener" href="https://shaojiemike.notion.site/Huawei-work-on-llvm-mca-recur-e338f3133a10416ebdaa596e27e5c5b7">ç±»ä¼¼çš„llvm checkçš„è®¾ç½®</a></p>
<h2 id="å¤ç°ä¸Šé¢çš„å›¾"><a href="#å¤ç°ä¸Šé¢çš„å›¾" class="headerlink" title="å¤ç°ä¸Šé¢çš„å›¾"></a>å¤ç°ä¸Šé¢çš„å›¾</h2><h3 id="è¦æ”¹çš„åœ°æ–¹"><a href="#è¦æ”¹çš„åœ°æ–¹" class="headerlink" title="è¦æ”¹çš„åœ°æ–¹"></a>è¦æ”¹çš„åœ°æ–¹</h3><p>åº”è¯¥æ¯æ¬¡éƒ½è¦é‡æ–°ç¼–è¯‘å®‰è£…<br><img src="https://pic.shaojiemike.top/img/20210923203642.png"></p>
<h3 id="æµ‹è¯•çš„æ±‡ç¼–ä»£ç "><a href="#æµ‹è¯•çš„æ±‡ç¼–ä»£ç " class="headerlink" title="æµ‹è¯•çš„æ±‡ç¼–ä»£ç "></a>æµ‹è¯•çš„æ±‡ç¼–ä»£ç </h3><ol>
<li>åˆ¤æ–­<code>llvm/test/MC/AArch64</code>ä¸‹çš„æ±‡ç¼–èƒ½ç”¨å—?é€‰ä¸ªæœ€å¤§çš„ï¼Œneon ä¸æ”¯æŒï¼Œ armv8.2ä¹Ÿå¹¶ä¸æ”¯æŒã€‚æ„Ÿè§‰æœ‰ç‰¹åˆ«è¦æ±‚<img src="https://pic.shaojiemike.top/img/20211021152612.png"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat neon-diagnostics.s|llvm-mca -timeline -show-encoding -all-stats -all-views</span><br></pre></td></tr></table></figure></li>
<li>é€‰æ‹©osacaçš„benchmarké‡Œçš„add.c</li>
</ol>
<h2 id="AArch64SchedTSV110-td"><a href="#AArch64SchedTSV110-td" class="headerlink" title="AArch64SchedTSV110.td"></a>AArch64SchedTSV110.td</h2><p>locate at llvm&#x2F;lib&#x2F;Target&#x2F;AArch64&#x2F;AArch64SchedTSV110.td</p>
<h3 id="td-file"><a href="#td-file" class="headerlink" title="td file"></a>td file</h3><p>tablegen(LLVM class) definitions</p>
<h3 id="éƒ¨åˆ†æŒ‡ä»¤è§£é‡Š"><a href="#éƒ¨åˆ†æŒ‡ä»¤è§£é‡Š" class="headerlink" title="éƒ¨åˆ†æŒ‡ä»¤è§£é‡Š"></a>éƒ¨åˆ†æŒ‡ä»¤è§£é‡Š</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def : InstRW&lt;[TSV110Wr_2cyc_1MDU],   (instregex <span class="string">&quot;^(AND|BIC|EON|EOR|ORN|ORR)[WX]rs$&quot;</span>)&gt;;</span><br></pre></td></tr></table></figure>
<p>BIC (bit clear) EON (Exclusive OR) ORR (OR operations on the values in Rn and Operand2)</p>
<p>InstRWçš„å®šä¹‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map a set of opcodes to a list of SchedReadWrite types. This allows</span></span><br><span class="line"><span class="comment">// the subtarget to easily override specific operations.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// SchedModel ties this opcode mapping to a processor.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InstRW</span>&lt;list&lt;SchedReadWrite&gt; rw, dag instrlist&gt; &#123;</span><br><span class="line">  list&lt;SchedReadWrite&gt; OperandReadWrites = rw;</span><br><span class="line">  dag Instrs = instrlist;</span><br><span class="line">  SchedMachineModel SchedModel = ?;</span><br><span class="line">  <span class="comment">// Allow a subtarget to mark some instructions as unsupported.</span></span><br><span class="line">  bit Unsupported = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TSV110Wr_2cyc_1MDUçš„å®šä¹‰</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def TSV110Wr_2cyc_1MDU   : SchedWriteRes&lt;[TSV110UnitMDU]&gt;   &#123; let Latency = <span class="number">2</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SchedWriteRes</span>&lt;list&lt;ProcResourceKind&gt; resources&gt; : SchedWrite,</span><br><span class="line">  ProcWriteResources&lt;resources&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šä¹‰TSV110ä¸Šå¯ç”¨çš„æ¯ç§å¤„ç†å™¨èµ„æºå’Œæ•°é‡ï¼Œ</span></span><br><span class="line"><span class="comment">//å®ƒæœ‰8æ¡pipelineç®¡é“ï¼Œæ¯ä¸ªç®¡é“éƒ½æœ‰è‡ªå·±çš„é˜Ÿåˆ—ï¼Œå¾®æ“ä½œåœ¨é‚£é‡Œç­‰å¾…</span></span><br><span class="line"><span class="comment">//å®ƒä»¬çš„operandså’Œissueå°†æ— åºåœ°å‘é€åˆ°å…«ä¸ªæ‰§è¡Œç®¡é“ä¹‹ä¸€ã€‚</span></span><br><span class="line">def TSV110UnitMDU  : ProcResource&lt;<span class="number">1</span>&gt;; <span class="comment">// Multi-Cycle</span></span><br></pre></td></tr></table></figure>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-10-09T16:00:00.000Z" title="10/9/2021, 4:00:00 PM">2021-10-09</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.260Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">28 minutes read (About 4164 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/09/Work/HPC/llvm-mca/LLVM-mca4/">LLVM Mca ï¼šwith BHive (2019)</a></p><div class="content"><h2 id="BHive"><a href="#BHive" class="headerlink" title="BHive"></a>BHive</h2><p>ä¸€ç§æ–°çš„profilerï¼Œå¯ä»¥profileæ²¡æœ‰ç”¨æˆ·å¹²é¢„çš„å†…å­˜è®¿é—®çš„åŸºæœ¬å—ã€‚</p>
<p>åŸºäºè¿™ç§profileråˆ›å»ºäº†BHive,æ¥éªŒè¯llvm-mcaç­‰æ¨¡å‹ã€‚</p>
<p>BHiveæ˜¯ç”¨æ¥è¯„ä»·llvm-mcaè¿™äº›æ¨¡å‹çš„ï¼Œå®éªŒåŸºäºå„ç§æ”¶é›†æ¥çš„<strong>ä¸€ä¸ªåŸºæœ¬å—</strong>å„ç§è¯„ä»·</p>
<h2 id="I-INTRODUCTION"><a href="#I-INTRODUCTION" class="headerlink" title="I. INTRODUCTION"></a>I. INTRODUCTION</h2><h3 id="Automatically-Profiling-Basic-Blocks"><a href="#Automatically-Profiling-Basic-Blocks" class="headerlink" title="Automatically Profiling Basic Blocks"></a>Automatically Profiling Basic Blocks</h3><p>å›°éš¾åœ¨äºç°æœ‰çš„ æ²¡æœ‰è€ƒè™‘ memory crash ??? .é»˜è®¤å‘½ä¸­L1 cache</p>
<p>A <strong>key technical challenge</strong> with collecting a large basic block dataset is that there is no existing approach to profile an arbitrary basic block that has been removed from its program<br>context.</p>
<p>(æ²¡æ‡‚ï¼Ÿé‚£ä¸ºä»€ä¹ˆè¦removed from its program<br>context) å› ä¸ºè¦æŠŠå¸¸ç”¨çš„åº”ç”¨æ‹†æˆå°ä¾‹å­æ¥è¯„åˆ¤ï¼Œè¿™äº›æ¨¡å‹çš„å‡†ç¡®æ€§ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è¿ç”¨éšå«ç‹„åˆ©å…‹é›·åˆ†å¸ƒLDA,åŸºäºcpuèµ„æºçš„åˆ©ç”¨ç‡ï¼Œæ¥cluster benchmark suiteé‡Œçš„åŸºæœ¬å—</p>
<p>é€šè¿‡å¯¹å„ç§ç±»å‹æœ€åŸºæœ¬çš„ä»£ç å—æ¥è¿›è¡Œprofileï¼Œä»è€Œå½¢æˆé’ˆå¯¹å„ç§performance modelçš„æ•°æ®åº“ã€‚</p>
<p>ç°åœ¨å·²ç»æœ‰è¶…è¿‡30ä¸‡çš„åŸºæœ¬å—åˆ†æï¼Œæ¥æºäºå„ç§æ–¹å‘çš„åº”ç”¨ï¼ŒåŒ…æ‹¬æ•°å€¼è®¡ç®—OpenBLAS,æ•°æ®åº“SQLite,æœºå™¨å­¦ä¹ TensorFlowï¼Œå¯†ç å­¦OpenSSLã€‚</p>
<p>è¿™ä¹ˆå¤šçš„æ•°æ®äº§ç”Ÿäº†ä¸€ä¸ªç”¨äºè¯„ä¼°performance modelçš„æ–°benchmarkã€‚</p>
<p>ä½œè€…è¯´<strong>performance modeling ç ”ç©¶çš„æœªæ¥åœ¨äºä¸å…¶ä»–å…ˆè¿›æŠ€æœ¯çš„å¤§è§„æ¨¡å®šé‡æ¯”è¾ƒ</strong></p>
<h3 id="å†…å­˜è®¿é—®çš„å¤„ç†"><a href="#å†…å­˜è®¿é—®çš„å¤„ç†" class="headerlink" title="å†…å­˜è®¿é—®çš„å¤„ç†"></a>å†…å­˜è®¿é—®çš„å¤„ç†</h3><p>é€šè¿‡æŠŠè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°<strong>å•ä¸ª</strong>ç‰©ç†é¡µé¢ï¼Œæ¥åˆæ³•å†…å­˜è®¿é—®åŒæ—¶é¿å…cache miss</p>
<h2 id="II-èƒŒæ™¯"><a href="#II-èƒŒæ™¯" class="headerlink" title="II. èƒŒæ™¯"></a>II. èƒŒæ™¯</h2><h3 id="Existing-Performance-Models"><a href="#Existing-Performance-Models" class="headerlink" title="Existing Performance Models"></a>Existing Performance Models</h3><p>æœ‰ä¸¤ç§model</p>
<ol>
<li>äº§ç”Ÿå¯ä»¥è¯¦ç»†æè¿°æŒ‡ä»¤ä½•æ—¶å‘å°„å’Œé€€ä¼‘çš„å¯è§£é‡Šæ‰§è¡Œè·¯å¾„çš„å¾®æ¶æ„æ¨¡æ‹Ÿå™¨ï¼Œé™„å¸¦ååé‡é¢„æµ‹ã€‚</li>
<li>æ¯æ¡æŒ‡ä»¤éƒ½æœ‰å»¶è¿Ÿã€ååé‡æŸ¥æ‰¾è¡¨ï¼Œç›¸å½“äºä¸€ä¸ªè¢«å¯„å­˜å™¨åˆ†é…å™¨ä½¿ç”¨çš„é¢å¤–å¼€é”€ä¼°è®¡å™¨</li>
</ol>
<p>å„ç§model, å†™åˆ°å¦ä¸€ç¯‡é‡Œäº†</p>
<ol>
<li>IACA</li>
<li>llvm-mca</li>
<li>OSACA</li>
<li>Ithemal</li>
</ol>
<h3 id="Machine-Code-Profilers"><a href="#Machine-Code-Profilers" class="headerlink" title="Machine Code Profilers"></a>Machine Code Profilers</h3><ol>
<li>é€šè¿‡ Agner Fogâ€™s script æµ‹é‡çœŸå®çš„ï¼Œæœ‰å‘¨æœŸï¼Œcache miss ç­‰ç­‰ã€‚<a target="_blank" rel="noopener" href="https://www.agner.org/optimize/testp.zip">https://www.agner.org/optimize/testp.zip</a></li>
<li>nanoBenchä¹Ÿæ˜¯ã€‚<a target="_blank" rel="noopener" href="https://github.com/andreas-abel/nanoBench">https://github.com/andreas-abel/nanoBench</a> å¯ä»¥æŒ‡å®šprocessor?å’Œ kernelæ¨¡å¼ã€‚</li>
<li><strong>Unrolling</strong><ol>
<li>æµ‹é‡ååé‡çš„åŸºæœ¬æ–¹æ³•å°±æ˜¯å±•å¼€ä¸€ä¸ªåŸºæœ¬å—çš„ä»£ç å¤šæ¬¡ï¼Œç„¶åæµ‹é‡å¤å¤šæ¬¡çš„ä»£ç ã€‚æŠŠå±•å¼€çš„åŸºæœ¬å—latencyé™¤ä»¥<code>unroll factor</code>(å…¸å‹å€¼æ˜¯100)</li>
<li>ç›®çš„ï¼š<ol>
<li>è¾¹ç¼˜åŒ–å‰å‡ æ¬¡warm upçš„latencyå€¼çš„å½±å“ã€‚</li>
<li>å‡å°‘æ”¶èµ·æ•°æ®çš„å¼€é”€å½±å“</li>
</ol>
</li>
<li><code>unroll factor</code>å°±æ˜¯å¾ªç¯å±•å¼€æ¬¡æ•°ã€‚</li>
</ol>
</li>
<li><strong>å±€é™æ€§</strong>æ˜¯ï¼Œå¿…é¡»äººå·¥ç»™ä»£ç å—ï¼Œä¸èƒ½è‡ªåŠ¨profileä¸€å †ä»»æ„çš„åŸºæœ¬å—æ¥ç³»ç»Ÿæ€§éªŒè¯ã€‚???</li>
</ol>
<h2 id="III-PROFILING-ARBITRARY-BASIC-BLOCKS"><a href="#III-PROFILING-ARBITRARY-BASIC-BLOCKS" class="headerlink" title="III.  PROFILING ARBITRARY BASIC BLOCKS"></a>III.  PROFILING ARBITRARY BASIC BLOCKS</h2><p>ç›®æ ‡æ˜¯åœ¨<strong>ä¸éœ€è¦æ‰‹åŠ¨å¹²é¢„</strong>çš„æƒ…å†µä¸‹åˆ†æä»»æ„åŸºæœ¬å—ï¼Œä»¥ä¾¿æµ‹é‡çš„<strong>ååé‡</strong>ä¸æ€§èƒ½æ¨¡å‹é€šå¸¸å‡å®šçš„<strong>å®šä¹‰å’Œä¸å˜é‡</strong>ç›¸å¯¹åº”ã€‚å…³é”®çš„æŒ‘æˆ˜æ˜¯ä½¿è¿™äº›åŸºæœ¬å—èƒ½å¤Ÿåœ¨ä¸å´©æºƒçš„æƒ…å†µä¸‹<strong>è®¿é—®ä»»æ„å†…å­˜åœ°å€</strong>ã€‚</p>
<p>ç”±äºåŸºæœ¬å—åªæ˜¯æ­£å¸¸ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´æ ¹æœ¬ä¸èƒ½å•ç‹¬æ­£å¸¸è¿è¡Œã€‚BHiveåšçš„äº‹æƒ…å°±æ˜¯ï¼Œè®©ä»–æ­£å¸¸è¿è¡Œã€‚</p>
<h3 id="Handling-Arbitrary-Memory-Accesses"><a href="#Handling-Arbitrary-Memory-Accesses" class="headerlink" title="Handling Arbitrary Memory Accesses"></a>Handling Arbitrary Memory Accesses</h3><p><img src="https://pic.shaojiemike.top/img/20211007210352.png"><br>è¿™ä¸ªä»£ç å—åªæœ‰æ‰§è¡Œä»£ç åˆ†é…åœ¨<code>0x4110a</code>æ—¶ï¼Œæ‰èƒ½æ­£å¸¸è¿è¡Œ</p>
<ol>
<li>Remapping Virtual Pages.<ol>
<li>ä¸€ä¸ªåŸºæœ¬å—çš„æ‰€æœ‰è™šæ‹Ÿå†…å­˜é¡µé‡æ–°æ˜ å°„åˆ°ä¸€ä¸ªç‰©ç†é¡µä¸Šï¼Œæ‰€ä»¥å…¨éƒ¨æ•°æ®è®¿é—®éƒ½å‘½ä¸­L1ã€‚è¿™æ ·å°±å¯ä»¥æ‰§è¡Œ97%çš„åŸºæœ¬å—ã€‚</li>
<li>æ­¥éª¤<ol>
<li>æŠŠåŸæœ¬è™šæ‹Ÿé¡µå…¨éƒ¨unmap<ol>
<li>è¿™ä¼šå¯¼è‡´é™¤äº†åŒ…å«åŸºæœ¬å—æŒ‡ä»¤çš„é¡µä¹‹å¤–çš„å…¨éƒ¨çš„è¿ç»­çš„å†…å­˜è®¿é—®å‡ºé—®é¢˜ï¼Ÿï¼Ÿï¼Ÿ</li>
<li>åœ¨å­è¿›ç¨‹é‡Œè¿è¡Œå±•å¼€çš„åŸºæœ¬å—æŒ‡ä»¤ã€‚<ol>
<li>è¿™æ—¶å¯¹æ¯ä¸ªunmapçš„è™šæ‹Ÿé¡µçš„è®¿é—®éƒ½ä¼šå‡ºé”™ï¼Œä½†æ˜¯ä¸»è¿›ç¨‹ä¸€ç§ç›‘è§†ç€ã€‚ä¸€æ—¦ä¸­æ–­å°±é‡æ–°æ˜ å°„å‡ºé”™åœ°å€ï¼Œç„¶åé‡æ–°å¼€å§‹è·‘ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>Memory Initialization<ol>
<li>åˆå§‹åŒ–ä¸€ä¸ªä¸­ç­‰å¤§å°0x12345600çš„ç‰©ç†é¡µï¼Œå…è®¸éƒ½è™šæ‹Ÿé¡µéƒ½æ˜ å°„</li>
</ol>
</li>
<li>Virtual page aliasing<ol>
<li>å› ä¸ºä¸åŒçš„è™šæ‹Ÿé¡µæ˜ å°„åœ¨åŒä¸€ä¸ªç‰©ç†é¡µçš„åŒä¸€é¡¹å¯¼è‡´memory dependencesï¼Œè¦ç­‰å¾…</li>
<li><strong>å‰”é™¤</strong>6.28%çš„åŸºæœ¬å—</li>
<li>å¯ä»¥é€šè¿‡å¢å¤§ç‰©ç†é¡µï¼Œæ¥å‡å°å‘ç”Ÿçš„æ¦‚ç‡ã€‚</li>
</ol>
</li>
</ol>
<h3 id="Overall-Profiling-Workflow"><a href="#Overall-Profiling-Workflow" class="headerlink" title="Overall Profiling Workflow"></a>Overall Profiling Workflow</h3><p>é€šè¿‡é‡å¤è¿è¡ŒåŸºæœ¬å—æ¥è®¡ç®—ååé‡</p>
<ol>
<li>Raw Measurement<ol>
<li>å…ˆä»åŸºæœ¬å—é‡Œï¼Œäº§ç”Ÿä¸ä¼šmemory crashçš„å¯æ‰§è¡Œéƒ¨åˆ†ã€‚</li>
<li>unroll factorçš„é€‰å–ã€‚It uses 100 and 200 as the unroll factors for basic blocks <strong>smaller than 100 bytes</strong>; 50 and 100 for basic blocks <strong>between 100 bytes and 200 bytes</strong>; and finally 16 and 32 for basic blocks <strong>larger than 200 bytes</strong></li>
</ol>
</li>
<li>Filtering<ol>
<li>ç­›é€‰æ‰§è¡Œä»£ç æ»¡è¶³ç†æƒ³åŒ–æ¨¡å‹çš„æ‰§è¡Œç»“æœï¼Œæ¯”å¦‚å‘½ä¸­L1cache</li>
<li>L1 Cache Misses<ol>
<li>å·¥å…·å¯ä»¥ç”¨ç¡¬ä»¶è®¡æ•°å™¨ç›‘æ§æŒ‡ä»¤å’Œæ•°æ®cache missesã€‚æ‹’ç»æ‰€æœ‰cache missçš„æƒ…å†µã€‚</li>
</ol>
</li>
<li>Unaligned Loads<ol>
<li>ä¸è¿ç»­çš„è®¿å­˜ä¼šå¾ˆæ…¢ï¼Œè§£å†³æ–¹æ³•å°±æ˜¯å»é™¤æ‰€æœ‰æœ‰ä¸è¿ç»­çš„è®¿å­˜çš„ã€‚å¤§çº¦åˆ é™¤äº†0.18%çš„åŸºæœ¬å—</li>
</ol>
</li>
<li>Subnormal Floating Point<ol>
<li>ä¸€äº›ç‰¹æ®Šçš„æµ®ç‚¹æ•°è®¡ç®—ä¼šæ¯”æ­£å¸¸çš„æµ®ç‚¹æ•°è®¡ç®—æ…¢20å€ï¼Œå»é™¤äº†ä¸MXCSRå¯„å­˜å™¨æœ‰å…³çš„0.1%çš„åŸºæœ¬å—ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8341395/what-is-a-subnormal-floating-point-number">https://stackoverflow.com/questions/8341395/what-is-a-subnormal-floating-point-number</a></li>
</ol>
</li>
<li>Context Switches<ol>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢(è‹±è¯­ï¼šcontext switch)ï¼Œåˆç§°ç¯å¢ƒåˆ‡æ¢ï¼Œç”µè„‘æœ¯è¯­ï¼Œæ˜¯ä¸€ä¸ªå­˜å‚¨å’Œé‡å»ºCPUçš„çŠ¶æ€ (å†…æ–‡)ï¼Œå› æ­¤ä»¤å¤šä¸ªè¿›ç¨‹(process)å¯ä»¥åˆ†äº«å•ä¸€CPUèµ„æºçš„è®¡ç®—è¿‡ç¨‹ã€‚è¦åˆ‡æ¢CPUä¸Šçš„è¿›ç¨‹æ—¶ï¼Œå¿…éœ€å…ˆè¡Œå­˜å‚¨ç›®å‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œå†å°†æ¬²è¿è¡Œçš„è¿›ç¨‹ä¹‹çŠ¶æ€è¯»å›CPUä¸­ã€‚</li>
</ol>
</li>
<li>å¯æ¥å—çš„è¯„ä¼°å…¬å¼ 10%çš„è¯¯å·®ï¼Ÿï¼Ÿï¼Ÿ</li>
</ol>
</li>
<li>Throughput Calculation<ol>
<li>å¦‚æœé€šè¿‡äº†åŸºæœ¬å—çš„ç­›é€‰ï¼Œç”¨æœ‰è®°å½•çš„æœ€å°å»¶è¿Ÿè®¡ç®—ååé‡<img src="https://pic.shaojiemike.top/img/20210920154432.png"></li>
</ol>
</li>
<li>Environment Variance<ol>
<li>ç”±äºç¯å¢ƒçš„å½±å“ï¼Œå¯¼è‡´ç»“æœæœ‰ä¸ªç¨³å®šçš„åç§»ã€‚è‡³å°‘æ‰§è¡Œ5æ¬¡ï¼Œå±•å¼€16æ¬¡çš„åŸºæœ¬å—ã€‚å–æœ€å°çš„5æ¬¡ä½œä¸ºç»“æœã€‚</li>
</ol>
</li>
</ol>
<h3 id="Portability-to-Other-Architectures"><a href="#Portability-to-Other-Architectures" class="headerlink" title="Portability to Other Architectures"></a>Portability to Other Architectures</h3><p>åªè¦æ¶æ„æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹è¦æ±‚</p>
<ol>
<li>æœ‰å°†å¤šä¸ªè™šæ‹Ÿé¡µé¢æ˜ å°„åˆ°å‡ ä¸ªç‰©ç†é¡µé¢çš„APIã€‚map<br>multiple virtual pages to a few physical pages <ol>
<li><strong>without</strong> incurring a performance <strong>penalty</strong> due to unnecessary cache invalidation. We therefore require that the target processor has a **physically tagged data cache(VIPT)**ï¼Ÿï¼Ÿï¼Ÿ</li>
<li>we additionally require that the page size is small enough so the indexing bits are<br>not affected by address translation.</li>
</ol>
</li>
<li>detecting cache misses, </li>
<li>and detecting or disabling floating-point underflow.</li>
</ol>
<h2 id="IV-BASIC-BLOCK-DATASET"><a href="#IV-BASIC-BLOCK-DATASET" class="headerlink" title="IV. BASIC BLOCK DATASET"></a>IV. BASIC BLOCK DATASET</h2><p><img src="https://pic.shaojiemike.top/img/20210921190750.png"></p>
<p>åº”ç”¨çš„é€‰æ‹©</p>
<ol>
<li>å°½å¯èƒ½è¿˜åŸç°å®ç”Ÿæ´»çš„å„ä¸ªæ–¹é¢ï¼Œ</li>
<li>è€Œä¸”æ˜¯ç”¨æˆ·çš„å…¸å‹ç”¨æ³•ã€‚</li>
<li>Clang&#x2F;LLVM (compiler), Redis (inmemory database), SQLite (database), and Gzip æ˜¯ç”¨é«˜çº§è¯­è¨€Cæˆ–è€…C++ç¼–å†™çš„ï¼Œç®—æ³•å’Œæ•°æ®ç»“æ„æœ‰å¤æ‚çš„è®¾è®¡ã€‚</li>
<li>OpenSSL (cryptography), OpenBLAS , Eigen (scientific computing),TensorFlow (machine learning) ä»£è¡¨çš„æ˜¯æ ¸å¿ƒå¾ªç¯æ˜¯æ‰‹åŠ¨æ±‡ç¼–ä¼˜åŒ–è¿‡çš„é«˜æ€§èƒ½åº“ã€‚<ol>
<li>å…¶ä¸­Embreeæ˜¯ ç”¨Intel ispc (a data-parallel language)ç¼–å†™çš„ã€‚</li>
</ol>
</li>
</ol>
<p>We compiled all applications with the <strong>highest optimization</strong> settings defined by their build systems. å¦‚æœå¯ä»¥ç”¨ä¸Šäº†AVX2ã€‚</p>
<p>ä½¿ç”¨DynamoRIOåŠ¨æ€åˆ†ææ¥æç‚¼åŸºæœ¬å—ã€‚å¯ä»¥å®ç°åœ¨è¿è¡Œæ—¶è®°å½•æ¯ä¸ªè¿è¡Œçš„åŸºæœ¬å—ã€‚æˆ‘ä»¬é‡‡ç”¨åŠ¨æ€åˆ†æï¼Œè€Œä¸æ˜¯é™æ€åæ±‡ç¼–ã€‚å› ä¸ºé™æ€åæ±‡ç¼–æ— æ³•åŒºåˆ«padding bytes from instructionsã€‚???</p>
<p>åº”ç”¨çš„ä¾‹å­é™¤äº†FFmpeg and Gzipéƒ½æ˜¯é€‰æ‹©çš„å®˜æ–¹çš„benchmarkã€‚<br>Eigen é‡‡ç”¨çš„æ˜¯ two sparse linear algebra workloads: sparse matrix-matrix multiplication (SpMM) and sparse matrix-vector multiplication (SpMV).</p>
<h2 id="V-BASIC-BLOCK-CLUSTERING"><a href="#V-BASIC-BLOCK-CLUSTERING" class="headerlink" title="V. BASIC BLOCK CLUSTERING"></a>V. BASIC BLOCK CLUSTERING</h2><p>ä¸€äº›åŸºæœ¬å—æ¯”å…¶ä»–çš„æ›´éš¾å»ºæ¨¡ï¼Œ???(å»ºä»€ä¹ˆæ¨¡ï¼ŒVI-Bè¯´æ˜äº†ä»€ä¹ˆ)æœ‰å†…å­˜ä¾èµ–çš„åŸºæœ¬å—é¢„æµ‹é”™è¯¯ç‡æ›´é«˜ã€‚</p>
<p>é‡‡ç”¨äº†ä¸€ç§æŠ€æœ¯???(æ˜¯åº”ç”¨åœ¨æå–ä¸Š) åŸºäºå¤„ç†å™¨çš„ä½¿ç”¨èšç±»åŸºæœ¬å—ã€‚<br>è¿™ä¸ªæŠ€æœ¯æœ‰åŠ©äºæ€§èƒ½æ¨¡å‹çš„è®¾è®¡å’Œä½¿ç”¨è€…<strong>æ›´ç»†ç²’åº¦äº†è§£</strong>performance model,è®©ä»–ä»¬èƒ½é›†ä¸­ä»¥åæ–°æ·»åŠ çš„èµ„æºåœ¨æœ‰å›°éš¾çš„é‚£ä¸€ç±»åŸºæœ¬å—ã€‚</p>
<ol>
<li>Methodology<ol>
<li>å…·ä½“æ–¹æ³•<ol>
<li>æ‰¾åˆ°æ¯ä¸ªåŸºæœ¬å—çš„ç¡¬ä»¶ä½¿ç”¨ç‡çš„è¡¨ç¤º port-mapping representation</li>
<li>æ ¹æ®å…¶èšç±»</li>
</ol>
</li>
<li>å¯¹æ¯æ¡æŒ‡ä»¤ç»“åˆportä½¿ç”¨<ol>
<li>è¿ç”¨ Abel and Reineke A. Abel and J. Reineke, â€œuops.info: Characterizing latency, throughput, and port usage of instructions on intel microarchitectures,â€ in ASPLOS, 2019çš„ç»“æœ ???</li>
<li>ä¾‹å¦‚???<ol>
<li><code>xor %rax, %rbx</code> in Haswell is <code>&#123;p0156 â†’ 1&#125;</code></li>
</ol>
</li>
</ol>
</li>
<li>ä½¿ç”¨<strong>Latent Dirichlet Allocation</strong> (LDA)æ¥æ„å»ºtopic model æ¨¡å‹(python è®­ç»ƒæ¨¡å‹)<ol>
<li>åœ¨è¯­è¨€å¤„ç†ä¸Šçš„åº”ç”¨æ˜¯åŸºäºç»Ÿè®¡è¯é¢‘</li>
<li>åœ¨å®é™…è¿ç”¨çš„æ—¶å€™ï¼Œå¾®æŒ‡ä»¤æ“ä½œä¼šæ ¹æ®ä½¿ç”¨çš„portè€Œæœ‰å°ä¸åŒã€‚<ol>
<li>topicsæ˜¯åˆ†ç±»çš„ç±»åˆ«,6ç±»</li>
<li>documentsæ˜¯åŸºæœ¬å—</li>
<li>Î± &#x3D; 1&#x2F;6 and Î² &#x3D; 1&#x2F;13.</li>
</ol>
</li>
<li>ä¸ºäº†æ¨æ–­æ¯ä¸ªå¾®æŒ‡ä»¤æ“ä½œæ‰€å±çš„ç±»åˆ«ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†SciKit Learn transformå¯¹äºLDAçš„éšæœºå˜åŒ–æ¨æ–­çš„é»˜è®¤å®ç°</li>
<li>è®¡ç®—æ¯ä¸ªåŸºæœ¬å—çš„æœ€æœ‰å¯èƒ½çš„ç±»åˆ«ä½œä¸ºå…¶åˆ†ç±»ç»“æœ</li>
</ol>
</li>
</ol>
</li>
<li>Results<ol>
<li>LDAå°†ç»“æœèšç±»åï¼Œæ ¹æ®åŸºæœ¬å—çš„å†…å®¹ï¼Œæ‰‹åŠ¨è¿›è¡Œæ³¨åä»¥åŠè¯´æ˜<img src="https://pic.shaojiemike.top/img/20211009165208.png"></li>
<li>example<img src="https://pic.shaojiemike.top/img/20211009165630.png"></li>
<li>æ ¹æ®è¿è¡Œæ—¶é¢‘ç‡ç¡®å®šå…¶æƒé‡ï¼Œ åŸºäºsample-based profiler??? (A portable sampling-based profiler for java virtual machines,)ç¡®å®šã€‚</li>
<li>é«˜æ€§èƒ½çš„åº“å¦‚é¢„æœŸä¸€æ ·ï¼Œå‘é‡åŒ–çš„åŸºæœ¬å—å æ¯”è¾ƒå¤šã€‚</li>
<li>å…¶ä½™çš„æ— å‘é‡åŒ–çš„è¾ƒå¤šã€‚OpenSSL and Gzipæœ‰è®¸å¤šä½æ“ä½œçš„ã€‚</li>
</ol>
</li>
<li>Case Study on Data-Center Applications<ol>
<li>ç›®çš„ï¼šä½œä¸ºæµ‹è¯•ä¾‹å­ï¼Œçœ‹è¿™ä¸ªèšç±»æ–¹æ³•èƒ½ä¸èƒ½æ‰¾å¾—åˆ°éšè—çš„çƒ­ç‚¹ã€å·¥ä½œè´Ÿè½½</li>
<li>Methodology<ol>
<li>ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆå°†å…¶åŸºæœ¬å—åˆ†æˆä¹‹å‰çš„å‡ ç±»ï¼Œè¿˜æ˜¯ä½¿ç”¨LDA</li>
<li>ç¬¬äºŒæ­¥ï¼šåˆ†ç±»ç»“æœæ ‡æ³¨</li>
<li>ç¬¬ä¸‰æ­¥ï¼šæ¯”è¾ƒèšç±»ç»“æœçš„perplexityå€¼???</li>
<li>ï¼Ÿï¼Ÿï¼Ÿæœ‰æ²¡æœ‰ç»“åˆgoogleçš„åº”ç”¨<img src="https://pic.shaojiemike.top/img/20211009173926.png"></li>
</ol>
</li>
<li>Results<ol>
<li>æ·»åŠ æ–°åº”ç”¨åï¼Œè¯¥å€¼åªæ˜¯ç•¥å¾®å¢é•¿ã€‚è¯´æ˜æ¨¡å‹çš„ä»£è¡¨æ€§å¥½ã€‚???</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="VI-PERFORMANCE-MODEL-EVALUATION"><a href="#VI-PERFORMANCE-MODEL-EVALUATION" class="headerlink" title="VI. PERFORMANCE MODEL EVALUATION"></a>VI. PERFORMANCE MODEL EVALUATION</h2><p>åœ¨3ç§Intelæ¶æ„ä¸ŠéªŒè¯4ç§å·²æœ‰çš„æ€§èƒ½æ¨¡å‹</p>
<ol>
<li>Methodology<ol>
<li>è¯´æ˜å„ä¸ªæµ‹è¯•è½¯ä»¶çš„ç‰ˆæœ¬ã€‚</li>
<li>Dataset<ol>
<li>basic block dataset discussed in Section IV</li>
</ol>
</li>
<li>Platform<ol>
<li>balabala 3ç§æ¶æ„çš„ Intel cpus</li>
</ol>
</li>
<li>Evaluation Metrics<ol>
<li>æµ‹é‡ååé‡tå’Œé¢„æµ‹ååé‡tâ€™$$err(t,tâ€™)&#x3D;|\frac{t-tâ€™}{t}|$$</li>
<li>ä¸ä»¥é¢„æµ‹ç²¾åº¦ï¼Œè€Œæ˜¯ä»¥é¢„æµ‹ç»“æœçš„ç›¸å¯¹å…³ç³»ä¸ºè¯„åˆ†æ ‡å‡†ã€‚</li>
</ol>
</li>
<li>é¢å¤–èƒ½è¯„ä¼°æ¯ä¸ªæ¨¡å‹å¦‚ä½•ä¿æŒåŸºæœ¬å—ååé‡çš„é¡ºåºã€‚ä½¿ç”¨Kendallâ€™s tauç³»æ•°(è¶Šå¤§æ•ˆæœè¶Šå¥½)ï¼Œè€Œä¸æ˜¯ç›¸å¯¹è¯¯å·®ã€‚æµ‹é‡çš„åŸå› æ˜¯ä½¿ç”¨è€…å¯èƒ½å…³å¿ƒçš„ä¸æ˜¯ç»å¯¹çš„æ•°å€¼ç²¾åº¦ï¼Œè€Œæ˜¯ç›¸å¯¹å…³ç³»çš„å‡†ç¡®ç‡ã€‚æ¯”å¦‚ä¼˜åŒ–è½¯ä»¶çš„æ—¶å€™å…³å¿ƒçš„ä¸æ˜¯å…·ä½“è€—æ—¶ï¼Œè€Œæ˜¯å“ªä¸ªä¼˜åŒ–ç­–ç•¥è€—æ—¶æ›´çŸ­ã€‚</li>
</ol>
</li>
<li>Results<ol>
<li><img src="https://pic.shaojiemike.top/img/20211010154102.png"></li>
<li><strong>IACA</strong> ç¬¬äºŒå¥½çš„ï¼Œåœ¨å‘é‡åŒ–ç±»æ¨¡æ‹Ÿçš„æœ€å¥½</li>
<li><strong>llvm-mca</strong> æœ€å·®çš„ï¼Œå°¤å…¶æ˜¯å’Œloadsæœ‰å…³æ—¶ã€‚</li>
<li><strong>Ithemal</strong>  é™¤äº†å‘é‡åŸºæœ¬å—éƒ½æ˜¯æœ€å¥½çš„ã€‚åœ¨memory dependence (Ld&#x2F;St)å°¤å…¶å¥½ï¼Œä½†æ˜¯å‘é‡åŸºæœ¬å—ä¸å¥½ï¼Œå¯èƒ½ä¸è®­ç»ƒé›†æ²¡æœ‰å‘é‡åŸºæœ¬å—æœ‰å…³ã€‚</li>
<li><strong>OSACA</strong> ç¬¬ä¸‰ã€‚ç”±äºè¿˜åœ¨å¼€å‘ä¸­ï¼Œä½¿ç”¨è¿˜é‡åˆ°5ä¸ªbugã€‚åœ¨é‡åˆ°ä¸€äº›ä¸è®¤è¯†çš„æŒ‡ä»¤çš„æ—¶å€™ï¼Œä¼šç›´æ¥æŒ‰ç…§nopsç©ºæŒ‡ä»¤å¤„ç†ã€‚</li>
</ol>
</li>
<li>Examples of Modeling Bugs<img src="https://pic.shaojiemike.top/img/20211010155758.png"><ol>
<li>æœ€åä¸€ä¸ªä¾‹å­æ˜¯ç”±äºæ¨¡å‹<strong>é”™è¯¯è°ƒåº¦å¾®æŒ‡ä»¤</strong>å¯¼è‡´çš„</li>
<li>Modeling bug due to unsigned division<ol>
<li>ä¾‹å­æ˜¯ a 64-bit by 32-bit unsigned division.<img src="https://pic.shaojiemike.top/img/20211010162409.png"><img src="https://pic.shaojiemike.top/img/20211010163913.png"><img src="https://pic.shaojiemike.top/img/20211010164039.png"><img src="https://pic.shaojiemike.top/img/20211010164455.png"></li>
<li>???<img src="https://pic.shaojiemike.top/img/20211010164745.png"></li>
</ol>
</li>
<li>Modeling bug due to zero-idioms<ol>
<li><img src="https://pic.shaojiemike.top/img/20211010165301.png"></li>
<li>å¯¹è¿™ç§ç»“æœå›ºå®šçš„ç‰¹æ®ŠæŒ‡ä»¤çš„å¿«é€Ÿå¤„ç†ã€‚</li>
</ol>
</li>
<li>Modeling bug due to mis-scheduling<ol>
<li>å¯¹äºæ•°æ®ä¾èµ–ï¼Œä¸Šä¸‹æŒ‡ä»¤çš„å¯„å­˜å™¨æœ‰å†™åè¯»ã€‚</li>
<li>Ithemalâ€™s and OSACAå¿½ç•¥äº†è¯¥ä¾èµ–</li>
<li><img src="https://pic.shaojiemike.top/img/20211010170051.png"></li>
<li>llvm-mca æ²¡æœ‰æ³¨æ„åˆ°(%rcx)æ˜¯memoryï¼Œæ²¡æœ‰ä¾èµ–å¯ä»¥æå‰å‘å°„ã€‚</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="CONCLUSION"><a href="#CONCLUSION" class="headerlink" title="CONCLUSION"></a>CONCLUSION</h2><p>ç°æœ‰çš„é™æ€åˆ†æå™¨å¯¹<strong>å†…å­˜ä¾èµ–</strong>å’Œ<strong>å‘é‡åŒ–å—</strong>çš„å»ºæ¨¡è¿˜æœ‰å›°éš¾ã€‚</p>
<h2 id="githubä»£ç è¯´æ˜"><a href="#githubä»£ç è¯´æ˜" class="headerlink" title="githubä»£ç è¯´æ˜"></a>githubä»£ç è¯´æ˜</h2><ol>
<li><code>benchmark/sources</code>ä¸‹æ˜¯å„ç§è½¯ä»¶çš„å„ä¸ªéƒ¨åˆ†çš„16è¿›åˆ¶åŸºæœ¬ä»£ç å—å’Œå…¶å‡ºç°æ¦‚ç‡ï¼Œç”¨csvæ ¼å¼(é€—å·åˆ†éš”å€¼ (Comma-separated values))å­˜å‚¨</li>
<li><code>benchmark/throughput</code>æ˜¯åœ¨å„ç§æ¶æ„ä¸‹çš„å„åŸºæœ¬å—çš„æµ‹é‡ååé‡ï¼Œå•ä½cycles per hundred-iterations.<br><img src="https://pic.shaojiemike.top/img/20210920151028.png"><img src="https://pic.shaojiemike.top/img/20210920154432.png"></li>
<li><code>benchmark/disasm</code>å¯ä»¥æŠŠ16è¿›åˆ¶ä»£ç é€šè¿‡<code>nasm</code>å˜æˆæ±‡ç¼–ï¼Œ<img src="https://pic.shaojiemike.top/img/20210920151258.png"></li>
<li><code>timing-harness</code><img src="https://pic.shaojiemike.top/img/20210920153113.png"><br><img src="https://pic.shaojiemike.top/img/20210921143255.png"><br>ååé‡çš„è®¡ç®—(çŒœçš„)Skylake microarchitecture$$\frac{6632-1030}{2333-100}*100&#x3D;250.8 (cyc&#x2F;hundred\ iters)$$</li>
</ol>
<h2 id="BHive-è¢«è´¨ç–‘çš„å±€é™æ€§"><a href="#BHive-è¢«è´¨ç–‘çš„å±€é™æ€§" class="headerlink" title="BHive è¢«è´¨ç–‘çš„å±€é™æ€§"></a>BHive è¢«è´¨ç–‘çš„å±€é™æ€§</h2><p>uops çš„æ–‡ç« ï¼Œ Accurate Throughput Prediction of Basic Blocks on Recent Intel Microarchitectures</p>
<p>4.2 Extending BHive</p>
<h2 id="BHive-è¿è¡Œé€»è¾‘"><a href="#BHive-è¿è¡Œé€»è¾‘" class="headerlink" title="BHive è¿è¡Œé€»è¾‘"></a>BHive è¿è¡Œé€»è¾‘</h2><ol>
<li>è¯»å…¥16è¿›åˆ¶ä»£ç å’Œå¾ªç¯æ¬¡æ•°</li>
<li><code>hhex2bin</code>è½¬æ¢ä¸ºäºŒè¿›åˆ¶</li>
<li><code>create_shm_fd</code><img src="https://pic.shaojiemike.top/img/20210922150852.png"><img src="https://pic.shaojiemike.top/img/20210922151143.png"><ol>
<li><p><code>shm_open, shm_unlink</code>creates and opens a new, or opens or unlink an existing, POSIX shared memory object. <code>O_RDWR</code> Open the object for read-write access.<code>O_CREAT</code>  the shared memory object if it does not exist. <code>777</code>æ˜¯ç±»ä¼¼æ–‡ä»¶è¯»å†™æ‰§è¡Œç»„æƒé™çš„ä¸œè¥¿ On success, shm_open() <code>returns</code> a file descriptor (a nonnegative integer)</p>
</li>
<li><p><code>POSIX</code>å¯ç§»æ¤æ“ä½œç³»ç»Ÿæ¥å£The Portable Operating System Interface æ˜¯IEEEä¸ºè¦åœ¨å„ç§UNIXæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œè½¯ä»¶ï¼Œè€Œå®šä¹‰APIçš„ä¸€ç³»åˆ—äº’ç›¸å…³è”çš„æ ‡å‡†çš„æ€»ç§°ã€‚</p>
</li>
<li><p><code>ftruncate</code> â€” truncateæˆªçŸ­ a file to a specified length</p>
</li>
<li><p>#define SIZE_OF_HARNESS_MEM (4096 * 3)</p>
</li>
</ol>
</li>
<li><code>measure</code>å¼€å§‹æµ‹é‡<ol>
<li>int fds[2] ???</li>
<li><code>pipe</code>ç”¨äºåˆ›å»ºpipe,ç”¨æ¥<strong>è¿›ç¨‹é—´</strong>é€šä¿¡çš„<strong>å•å‘</strong>æ•°æ®é€šè·¯ï¼Œä¼ å…¥å˜é‡ç”¨æ¥è¿”å›å¼•ç”¨è‡ªpipeæœ«ç«¯çš„æ–‡ä»¶æè¿°ç¬¦file descriptorsã€‚<strong>ç¬¬ä¸€ä¸ª</strong>æŒ‡å‘the read end of the pipeï¼Œ<strong>ç¬¬äºŒä¸ª</strong>æŒ‡å‘the write end of the pipe</li>
<li><code>mmap(void *addr, size_t length, int prot, int flags,int fd, off_t offset); munmap(void *addr, size_t length);</code>- map or unmap files or devices into memory åœ¨è°ƒç”¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´é‡Œcreate a new mapping.</li>
<li>fork()äº§ç”Ÿå­è¿›ç¨‹<ol>
<li>fork()åŸç†è¯¦è§£<ol>
<li>å¤åˆ¶ä¹‹å‰çš„ä¸€æ¨¡ä¸€æ ·ã€‚</li>
<li>fork() returns a zero to the newly created child process.</li>
<li>fork() returns a positive value, the process ID of the child process, to the parent.</li>
</ol>
</li>
<li>çˆ¶è¿›ç¨‹<ol>
<li>#define OFFSET_TO_COUNTERS 32</li>
<li>ä¸ºä»€ä¹ˆå£°æ˜ä¸€ä¸ªåç§»åœ°å€æŒ‡é’ˆ???<ol>
<li>struct pmc_counters ç”±5ä¸ªuint64_tç»„æˆã€‚ uint64 will always take 8 bytesã€‚ä¸€ä¸ªç»“æ„ä½“40bytes</li>
</ol>
</li>
<li><code>attach_to_child(pid, fds[1]);</code> pidæ˜¯å­è¿›ç¨‹pid<ol>
<li><code>ptrace(enum __ptrace_request request, pid_t pid,void *addr, void *data)</code> - process trace æä¾›ä¸€ç§è¿›ç¨‹tracerè·Ÿè¸ªæ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹traceeçš„æ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹è¢«æ§åˆ¶è€…çš„memory and registers.<ol>
<li><code>PTRACE_SEIZE</code> Attach to the process specified in pid, making it a tracee of the calling process.  Unlike PTRACE_ATTACH, PTRACE_SEIZE does <strong>not</strong> stop the process</li>
</ol>
</li>
<li>å­è¿›ç¨‹ä»fds[0]é‡Œè¯»åˆ°xé‡Œï¼Œçˆ¶è¿›ç¨‹æŠŠxçš„å€¼å†™å…¥ fds[1] ???</li>
</ol>
</li>
<li>check Performance Monitoring Counters (PMCs) supports<ol>
<li><code>rdpmc_open_attr</code> initialize a raw ring 3 ReaDable PerforMance Counter</li>
</ol>
</li>
<li>last_failing_inst å’Œ mapping_done</li>
<li>To kill child<ol>
<li>#define MAX_FAULTS 1024 # å­è¿›ç¨‹äº§ç”Ÿçš„é”™è¯¯éœ€è¦è§£å†³ï¼Ÿ</li>
<li><code>wait</code>æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªchildrenç»“æŸï¼Œè¿”å›å…¶PID</li>
<li><code>WIFEXITED</code>Wait_IF_EXITED åˆ¤æ–­æ˜¯å¦æ­£å¸¸ç»“æŸ<img src="https://pic.shaojiemike.top/img/20210922185030.png"></li>
<li>å¦‚æœé”™è¯¯æ‰“å°å‡ºé”™ä¿¡å·(eg.11)æŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨RIP,æŒ‡é’ˆå¯„å­˜å™¨RSP<img src="https://pic.shaojiemike.top/img/20210922190632.png"><img src="https://pic.shaojiemike.top/img/20210922191039.png"><img src="https://pic.shaojiemike.top/img/20210922191252.png"></li>
<li>å‡½æ•°æ˜¯ç”¨æ±‡ç¼–å†™çš„å°±ç¦»è°±<img src="https://pic.shaojiemike.top/img/20210922191507.png"><img src="https://pic.shaojiemike.top/img/20210922193149.png"><img src="https://pic.shaojiemike.top/img/20210922192559.png"><img src="https://pic.shaojiemike.top/img/20210922191801.png"><img src="https://pic.shaojiemike.top/img/20210922191931.png">what is aux mem?</li>
<li>ä¿®æ”¹å‡ºé”™åœ°æ–¹çš„å¯„å­˜å™¨ï¼Œé‡æ–°è¿è¡Œ<code>PTRACE_CONT</code> Restart the stopped tracee process</li>
<li>æœ€å¤šæ‰§è¡ŒMAX_FAULTSæ¬¡</li>
</ol>
</li>
<li>æœ€åçˆ¶è¿›ç¨‹æ€æ­»å­è¿›ç¨‹</li>
</ol>
</li>
<li>å­è¿›ç¨‹<ol>
<li>çˆ¶è¿›ç¨‹æµ‹è¯•æ˜¯å¦æ”¯æŒPMCs,å­è¿›ç¨‹ä½¿ç”¨<img src="https://pic.shaojiemike.top/img/20210922194738.png"><img src="https://pic.shaojiemike.top/img/20210922195030.png"></li>
<li>harness.c ï¼š277</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/from-zero/p/13750852.html">https://www.cnblogs.com/from-zero/p/13750852.html</a></p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol>
<li>time æ€ä¹ˆç®—çš„the latency of the basic blockï¼Ÿä¸ºä»€ä¹ˆæ‰“å°15ä¸ªå‘¢ï¼Ÿ</li>
<li>è¿˜æœ‰ä¸­é—´çš„é”™è¯¯æ˜¯æ€ä¹ˆå›äº‹?</li>
<li>è®ºæ–‡é‡Œçš„è¯¯å·®æ€ä¹ˆç®—çš„ï¼Ÿ<ol>
<li>BHiveæ•´åˆäº†å‡ ä¸ªè½¯ä»¶ï¼ˆæ•´åˆäº†ä»€ä¹ˆå‘¢ï¼‰ï¼Œåº”è¯¥æ˜¯çœŸå®æµ‹é‡äº†å¾—å‡ºçœŸå®ååé‡ï¼Ÿè¿˜æ˜¯ä¹Ÿæ˜¯æ¨¡æ‹Ÿçš„ï¼Ÿ</li>
<li>å’Œuopsæ¯”æ€ä¹ˆæ ·</li>
</ol>
</li>
<li>å“ªä¸ªæ•°æ®æ˜¯å‡†ç¡®çš„ï¼Œæ˜¯BHiveæ¨¡æ‹Ÿçš„ï¼Œè¿˜æ˜¯çœŸå®æµ‹é‡çš„ã€‚<ol>
<li>é€šè¿‡ Agner Fogâ€™s script æµ‹é‡çœŸå®çš„ï¼Œæœ‰å‘¨æœŸï¼Œcache miss ç­‰ç­‰ã€‚<a target="_blank" rel="noopener" href="https://www.agner.org/optimize/testp.zip">https://www.agner.org/optimize/testp.zip</a></li>
<li>nanoBenchä¹Ÿæ˜¯ã€‚<a target="_blank" rel="noopener" href="https://github.com/andreas-abel/nanoBench">https://github.com/andreas-abel/nanoBench</a> å¯ä»¥æŒ‡å®šprocessor?å’Œ kernelæ¨¡å¼ã€‚</li>
<li>å±€é™æ€§æ˜¯ï¼Œå¿…é¡»äººå·¥ç»™ä»£ç å—ï¼Œä¸èƒ½è‡ªåŠ¨profileä¸€å †ä»»æ„çš„åŸºæœ¬å—æ¥ç³»ç»Ÿæ€§éªŒè¯ã€‚???</li>
</ol>
</li>
<li>BHvieçš„ä»£ç å®ç°ï¼Œç§»æ¤åˆ°é²²é¹ï¼Œç„¶åæ ¹æ®PMUè°ƒå‡†ã€‚</li>
</ol>
<p>é—®é¢˜æ˜¯x86çš„äºŒè¿›åˆ¶æˆ–è€…æ±‡ç¼–ä¸èƒ½å˜æˆaarm64çš„äºŒè¿›åˆ¶æˆ–è€…æ±‡ç¼–ã€‚</p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://github.com/ithemal/bhive">https://github.com/ithemal/bhive</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-09-18T15:01:13.000Z" title="9/18/2021, 3:01:13 PM">2021-09-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.252Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Architecture/">Architecture</a></span><span class="level-item">2 minutes read (About 332 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/18/Work/Architecture/companySpecificDesign/kunpeng/">Kunpeng</a></p><div class="content"><p><img src="https://pic.shaojiemike.top/img/20220706191616.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706191804.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194535.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706192133.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706192208.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706192401.png"></p>
<p>å¤šçº¿ç¨‹SMT (Simultaneous multithreading)</p>
<p><img src="https://pic.shaojiemike.top/img/20220706192649.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706192925.png"><br>ç»Ÿä¸€çš„è°ƒåº¦å™¨å¤æ‚åº¦è¶…çº§é«˜ï¼Œåªæœ‰Intelå®ç°äº†ï¼Œä½†æ˜¯æ•ˆæœå¾ˆå¥½ã€‚</p>
<p><img src="https://pic.shaojiemike.top/img/20220706193012.png"></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/51354994">ä»€ä¹ˆæ˜¯CPU Die</a></p>
<p><img src="https://pic.shaojiemike.top/img/20220706193217.png"><br>è‰¯å“ç‡ä¼šæ›´é«˜</p>
<p><img src="https://pic.shaojiemike.top/img/20220706193253.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706193414.png"><br>è‡ªç ”OpenBLAS+ ï¼Œæ¯•ç”³ç¼–è¯‘å™¨ï¼Œè‡ªç ”MPI</p>
<p><img src="https://pic.shaojiemike.top/img/20220706193501.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706193531.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706193559.png"></p>
<p>ç‰‡é—´ä¸€è‡´æ€§å¯ä»¥åˆ°è¾¾4Påˆ°16Pï¼Ÿï¼Ÿï¼Ÿã€‚Intelå¯ä»¥è¾¾åˆ°8P</p>
<p><img src="https://pic.shaojiemike.top/img/20220706194215.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194305.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194356.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194744.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195047.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194818.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194901.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706194929.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195017.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195134.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195252.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195417.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195438.png"></p>
<p><img src="https://pic.shaojiemike.top/img/20220706195506.png"></p>
<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ol>
<li>è™½ç„¶è¯´æ˜¯ä¿å¯†çš„ï¼Œä½†æ˜¯é²²é¹930,950åº”è¯¥å·²ç»å‡ºæ¥äº†<ol>
<li>930ï¼Œ950æ˜¯å¼‚æ„çš„æ ¸(æ˜¯å¤§å°æ ¸å—ï¼Ÿ)</li>
</ol>
</li>
</ol>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><p>æš‚æ— </p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æš‚æ— </p>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/268031">https://bbs.huaweicloud.com/blogs/268031</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-09-15T02:29:03.000Z" title="9/15/2021, 2:29:03 AM">2021-09-15</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-01-28T14:04:36.260Z" title="1/28/2024, 2:04:36 PM">2024-01-28</time></span><span class="level-item"><a class="link-muted" href="/categories/Tutorials/">Tutorials</a></span><span class="level-item">6 minutes read (About 895 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/15/Work/HPC/llvm-mca/LLVM-mca2/">LLVM-MCA: Install&amp;RunTests</a></p><div class="content"><h2 id="github"><a href="#github" class="headerlink" title="github"></a>github</h2><p><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca">https://github.com/llvm/llvm-project/tree/main/llvm/tools/llvm-mca</a></p>
<p><img src="https://pic.shaojiemike.top/img/20210910210630.png"></p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><a target="_blank" rel="noopener" href="https://github.com/llvm/llvm-project/releases/tag/llvmorg-12.0.1">ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶</a>ä¸Šä¼ æœåŠ¡å™¨ï¼Œè§£å‹</p>
<h3 id="å®‰è£…é‡åˆ°çš„é—®é¢˜"><a href="#å®‰è£…é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å®‰è£…é‡åˆ°çš„é—®é¢˜"></a>å®‰è£…é‡åˆ°çš„é—®é¢˜</h3><ol>
<li>cannot find libtinfo.so.5<ol>
<li>sudo apt install libncurses5</li>
<li>ln -s &#x2F;usr&#x2F;lib&#x2F;libncursesw.so.6 &#x2F;usr&#x2F;lib&#x2F;libtinfo.so.5 æˆ–è€…ç±»ä¼¼çš„ ln -s &#x2F;usr&#x2F;lib&#x2F;libncurses.so.5 &#x2F;usr&#x2F;lib&#x2F;libtinfo.so.5 </li>
<li>åœ¨&#x2F;snap&#x2F;coreä¸‹æ‰¾åˆ°äº†ï¼Œä½†æ˜¯è¿™æ˜¯ä»€ä¹ˆç›®å½•ï¼Ÿæ˜¯ä¹‹å‰Ubuntuçš„åŒ…ç®¡ç†å·¥å…·ï¼Œä½†æ˜¯å·²ç»ä¸ç”¨äº†ã€‚</li>
</ol>
</li>
</ol>
<h3 id="ä»æºç å®‰è£…"><a href="#ä»æºç å®‰è£…" class="headerlink" title="ä»æºç å®‰è£…"></a>ä»æºç å®‰è£…</h3><h3 id="node5"><a href="#node5" class="headerlink" title="node5"></a>node5</h3><p>ç”±äºä¹‹åè¦å†™ä»£ç çš„ï¼Œè¿˜æ˜¯ä»å¤´å®‰è£…æ›´å¥½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd llvm-project</span><br><span class="line">mkdir build</span><br><span class="line">cmake -S llvm -B build -G &quot;Unix Makefiles&quot; -DLLVM_ENABLE_PROJECTS=&quot;clang;llvm-mca&quot; -DCMAKE_INSTALL_PREFIX=&quot;~/Install/llvm&quot; -DCMAKE_BUILD_TYPE=Debug -DLLVM_ENABLE_ASSERTIONS=On</span><br><span class="line">cd build</span><br><span class="line">make -j32</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<h3 id="kunpeng"><a href="#kunpeng" class="headerlink" title="kunpeng"></a>kunpeng</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmake -S llvm -B build -G &quot;Unix Makefiles&quot; -DLLVM_ENABLE_PROJECTS=all -DCMAKE_INSTALL_PREFIX=&quot;~/Install/llvm&quot; -DCMAKE_BUILD_TYPE=Debug -DLLVM_ENABLE_ASSERTIONS=On</span><br><span class="line">#change cmake or -DLLVM_ENABLE_PROJECTS=&quot;all&quot;</span><br></pre></td></tr></table></figure>
<p>error</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g++: error: unrecognized command line option â€˜-mllvmâ€™</span><br><span class="line">g++: error: unrecognized command line option â€˜--tail-merge-threshold=0â€™</span><br><span class="line">g++: error: unrecognized command line option â€˜-combiner-global-alias-analysisâ€™</span><br></pre></td></tr></table></figure>
<p>change</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake -S llvm -B build -G &quot;Unix Makefiles&quot; -DLLVM_ENABLE_PROJECTS=&quot;clang;llvm-mca&quot; -DCMAKE_INSTALL_PREFIX=&quot;~/Install/llvm&quot; -DLLVM_TARGETS_TO_BUILD=AArch64 -DCMAKE_BUILD_TYPE=Debug -DLLVM_ENABLE_ASSERTIONS=On</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang foo.c -O2 -target x86_64-unknown-unknown -S -o - | llvm-mca -mcpu=btver2</span><br></pre></td></tr></table></figure>
<p>ç”±äºä¸æ˜¯X86,<code>llc --version</code> æŸ¥çœ‹åˆ°targetæ˜¯ <code>aarch64-unknown-linux-gnu</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang /home/shaojiemike/Download/llvm-project-main/lldb/test/API/lang/c/forward/foo.c -O2 -target aarch64-unknown-linux-gnu -S -o -|llvm-mca -timeline -show-encoding -all-stats -all-views</span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œå¹¶é»˜è®¤ç®¡é“åˆ°llvm-mca,å¹¶å¼€å¯æ‰€æœ‰è¾“å‡ºã€‚</p>
<p>å¯ä»¥çœ‹å‡ºæ˜¯ç”¨TSV110Unitçš„port,é»˜è®¤cpuæ˜¯tsv110</p>
<h2 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h2><h3 id="ALU-BRU"><a href="#ALU-BRU" class="headerlink" title="ALU&#x2F;BRU"></a>ALU&#x2F;BRU</h3><p> ç®—æ•°é€»è¾‘å•å…ƒ ALU è´Ÿè´£å¤„ç†æ•´æ•°è¿ç®—æŒ‡ä»¤. è·³è½¬å¤„ç†å•å…ƒBRU è´Ÿè´£å¤„ç†è·³è½¬æŒ‡ä»¤. BRU å¯ä»¥ä¸ ALU åˆå¹¶, å¤ç”¨ ALU çš„é€»è¾‘æ¥è®¡ç®—è·³è½¬æŒ‡ä»¤çš„æ¡ä»¶å’Œè·³è½¬åœ°å€, ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„åŠŸèƒ½å•å…ƒæ¥å…¥åˆ°æµæ°´çº¿ä¸­.</p>
<h3 id="MDU"><a href="#MDU" class="headerlink" title="MDU"></a>MDU</h3><p>ä¹˜é™¤æ³•å•å…ƒ MDU (mult-divide unit)</p>
<h2 id="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "><a href="#éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ " class="headerlink" title="éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ "></a>éœ€è¦è¿›ä¸€æ­¥çš„ç ”ç©¶å­¦ä¹ </h2><ol>
<li>llvm-mcaå¾®æŒ‡ä»¤æ€ä¹ˆå®ç°çš„,æ€ä¹ˆæŠŠæ±‡ç¼–å˜æˆå¾®æŒ‡ä»¤</li>
<li>åœ¨viewé‡ŒåŠ memoryçš„å®ç°</li>
<li>è€ƒè™‘äº†cacheå‘½ä¸­ç­‰å½±å“ <a target="_blank" rel="noopener" href="https://github.com/andreas-abel/uiCA">https://github.com/andreas-abel/uiCA</a> uops</li>
<li>é²²é¹æ¶æ„ <a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/community/usersnew/id_1513665626477516">https://bbs.huaweicloud.com/community/usersnew/id_1513665626477516</a></li>
</ol>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol>
<li><code>llvm-mca -mcpu=help</code>ç«Ÿç„¶ä¼šå¡ä½ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆ</li>
<li>æ‰€ä»¥è¯´æ˜¯åä¸ºå·²ç»å†™äº†ä¸€ä¸ªå«tsv110çš„ï¼Œå®ç°2ä¸ªåŠŸèƒ½ï¼Ÿ</li>
</ol>
<h2 id="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½"><a href="#å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½" class="headerlink" title="å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~"></a>å¼€é¢˜ç¼˜ç”±ã€æ€»ç»“ã€åæ€ã€åæ§½~~</h2><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><div id='refer-anchor'></div>
æ— 

<h2 id="æ ·ä¾‹è¾“å‡º"><a href="#æ ·ä¾‹è¾“å‡º" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">Iterations:        100</span><br><span class="line">Instructions:      200</span><br><span class="line">Total Cycles:      70</span><br><span class="line">Total uOps:        200</span><br><span class="line"></span><br><span class="line">Dispatch Width:    4</span><br><span class="line">uOps Per Cycle:    2.86</span><br><span class="line">IPC:               2.86</span><br><span class="line">Block RThroughput: 0.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">No resource or data dependency bottlenecks discovered.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Instruction Info:</span><br><span class="line">[1]: #uOps</span><br><span class="line">[2]: Latency</span><br><span class="line">[3]: RThroughput</span><br><span class="line">[4]: MayLoad</span><br><span class="line">[5]: MayStore</span><br><span class="line">[6]: HasSideEffects (U)</span><br><span class="line">[7]: Encoding Size</span><br><span class="line"></span><br><span class="line">[1]    [2]    [3]    [4]    [5]    [6]    [7]    Encodings:                    Instructions:</span><br><span class="line"> 1      1     0.33                         4     20 00 80 52                   mov	w0, #1</span><br><span class="line"> 1      1     0.50                  U      4     c0 03 5f d6                   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dynamic Dispatch Stall Cycles:</span><br><span class="line">RAT     - Register unavailable:                      0</span><br><span class="line">RCU     - Retire tokens unavailable:                 0</span><br><span class="line">SCHEDQ  - Scheduler full:                            0</span><br><span class="line">LQ      - Load queue full:                           0</span><br><span class="line">SQ      - Store queue full:                          0</span><br><span class="line">GROUP   - Static restrictions on the dispatch group: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dispatch Logic - number of cycles where we saw N micro opcodes dispatched:</span><br><span class="line">[# dispatched], [# cycles]</span><br><span class="line"> 0,              20  (28.6%)</span><br><span class="line"> 4,              50  (71.4%)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Schedulers - number of cycles where we saw N micro opcodes issued:</span><br><span class="line">[# issued], [# cycles]</span><br><span class="line"> 0,          3  (4.3%)</span><br><span class="line"> 2,          1  (1.4%)</span><br><span class="line"> 3,          66  (94.3%)</span><br><span class="line"></span><br><span class="line">Scheduler&#x27;s queue usage:</span><br><span class="line">No scheduler resources used.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Retire Control Unit - number of cycles where we saw N instructions retired:</span><br><span class="line">[# retired], [# cycles]</span><br><span class="line"> 0,           3  (4.3%)</span><br><span class="line"> 2,           1  (1.4%)</span><br><span class="line"> 3,           66  (94.3%)</span><br><span class="line"></span><br><span class="line">Total ROB Entries:                128</span><br><span class="line">Max Used ROB Entries:             59  ( 46.1% )</span><br><span class="line">Average Used ROB Entries per cy:  32  ( 25.0% )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Register File statistics:</span><br><span class="line">Total number of mappings created:    100</span><br><span class="line">Max number of mappings used:         29</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Resources:</span><br><span class="line">[0.0] - TSV110UnitAB</span><br><span class="line">[0.1] - TSV110UnitAB</span><br><span class="line">[1]   - TSV110UnitALU</span><br><span class="line">[2]   - TSV110UnitFSU1</span><br><span class="line">[3]   - TSV110UnitFSU2</span><br><span class="line">[4.0] - TSV110UnitLdSt</span><br><span class="line">[4.1] - TSV110UnitLdSt</span><br><span class="line">[5]   - TSV110UnitMDU</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Resource pressure per iteration:</span><br><span class="line">[0.0]  [0.1]  [1]    [2]    [3]    [4.0]  [4.1]  [5]    </span><br><span class="line">0.66   0.67   0.67    -      -      -      -      -     </span><br><span class="line"></span><br><span class="line">Resource pressure by instruction:</span><br><span class="line">[0.0]  [0.1]  [1]    [2]    [3]    [4.0]  [4.1]  [5]    Instructions:</span><br><span class="line">0.33    -     0.67    -      -      -      -      -     mov	w0, #1</span><br><span class="line">0.33   0.67    -      -      -      -      -      -     ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Timeline view:</span><br><span class="line">Index     0123456789</span><br><span class="line"></span><br><span class="line">[0,0]     DeER .   .   mov	w0, #1</span><br><span class="line">[0,1]     DeER .   .   ret</span><br><span class="line">[1,0]     DeER .   .   mov	w0, #1</span><br><span class="line">[1,1]     D=eER.   .   ret</span><br><span class="line">[2,0]     .DeER.   .   mov	w0, #1</span><br><span class="line">[2,1]     .DeER.   .   ret</span><br><span class="line">[3,0]     .D=eER   .   mov	w0, #1</span><br><span class="line">[3,1]     .D=eER   .   ret</span><br><span class="line">[4,0]     . DeER   .   mov	w0, #1</span><br><span class="line">[4,1]     . D=eER  .   ret</span><br><span class="line">[5,0]     . D=eER  .   mov	w0, #1</span><br><span class="line">[5,1]     . D=eER  .   ret</span><br><span class="line">[6,0]     .  D=eER .   mov	w0, #1</span><br><span class="line">[6,1]     .  D=eER .   ret</span><br><span class="line">[7,0]     .  D=eER .   mov	w0, #1</span><br><span class="line">[7,1]     .  D==eER.   ret</span><br><span class="line">[8,0]     .   D=eER.   mov	w0, #1</span><br><span class="line">[8,1]     .   D=eER.   ret</span><br><span class="line">[9,0]     .   D==eER   mov	w0, #1</span><br><span class="line">[9,1]     .   D==eER   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Average Wait times (based on the timeline view):</span><br><span class="line">[0]: Executions</span><br><span class="line">[1]: Average time spent waiting in a scheduler&#x27;s queue</span><br><span class="line">[2]: Average time spent waiting in a scheduler&#x27;s queue while ready</span><br><span class="line">[3]: Average time elapsed from WB until retire stage</span><br><span class="line"></span><br><span class="line">      [0]    [1]    [2]    [3]</span><br><span class="line">0.     10    1.7    1.7    0.0       mov	w0, #1</span><br><span class="line">1.     10    2.0    2.0    0.0       ret</span><br><span class="line">       10    1.9    1.9    0.0       &lt;total&gt;</span><br></pre></td></tr></table></figure>

</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://octodex.github.com/images/hula_loop_octodex03.gif" alt="Shaojie Tan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Shaojie Tan</p><p class="is-size-6 is-block">ğ˜Šğ˜°ğ˜®ğ˜±ğ˜¶ğ˜µğ˜¦ğ˜³ ğ˜ˆğ˜³ğ˜¤ğ˜©ğ˜ªğ˜µğ˜¦ğ˜¤ğ˜µğ˜¶ğ˜³ğ˜¦ &amp; ğ˜ğ˜—ğ˜Š</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Anhui, Hefei, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">388</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">487</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Kirrito-k423" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Kirrito-k423"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Algorithms/"><span class="level-start"><span class="level-item">Algorithms</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/categories/Artificial-Intelligence/"><span class="level-start"><span class="level-item">Artificial Intelligence</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/Databases/"><span class="level-start"><span class="level-item">Databases</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/HPC/"><span class="level-start"><span class="level-item">HPC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Math/"><span class="level-start"><span class="level-item">Math</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Network/"><span class="level-start"><span class="level-item">Network</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/categories/Operating-system/"><span class="level-start"><span class="level-item">Operating system</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/categories/Programming/"><span class="level-start"><span class="level-item">Programming</span></span><span class="level-end"><span class="level-item tag">24</span></span></a></li><li><a class="level is-mobile" href="/categories/Software/"><span class="level-start"><span class="level-item">Software</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Thinking/"><span class="level-start"><span class="level-item">Thinking</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Tips/"><span class="level-start"><span class="level-item">Tips</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/Treasure/"><span class="level-start"><span class="level-item">Treasure</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Tutorials/"><span class="level-start"><span class="level-item">Tutorials</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li><li><a class="level is-mobile" href="/categories/Values/"><span class="level-start"><span class="level-item">Values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/architecture/"><span class="level-start"><span class="level-item">architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/diary/"><span class="level-start"><span class="level-item">diary</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/english/"><span class="level-start"><span class="level-item">english</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/hardware/"><span class="level-start"><span class="level-item">hardware</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/math/"><span class="level-start"><span class="level-item">math</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/network/"><span class="level-start"><span class="level-item">network</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/categories/operating-system/"><span class="level-start"><span class="level-item">operating system</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/security/"><span class="level-start"><span class="level-item">security</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/software/"><span class="level-start"><span class="level-item">software</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/thinking/"><span class="level-start"><span class="level-item">thinking</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/thinking/OOW/"><span class="level-start"><span class="level-item">OOW</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/tips/"><span class="level-start"><span class="level-item">tips</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/toLearn/"><span class="level-start"><span class="level-item">toLearn</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/categories/values/"><span class="level-start"><span class="level-item">values</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://ibug.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ibugs</span></span><span class="level-right"><span class="level-item tag">ibug.io</span></span></a></li><li><a class="level is-mobile" href="https://jia.je/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">jiegec</span></span><span class="level-right"><span class="level-item tag">jia.je</span></span></a></li><li><a class="level is-mobile" href="https://leimao.github.io/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leimao</span></span><span class="level-right"><span class="level-item tag">leimao.github.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-27T08:35:33.000Z">2024-01-27</time></p><p class="title"><a href="/2024/01/27/Work/Artificial%20Intelligence/Basic/AIComputeMachine/">AI Compute Machine</a></p><p class="categories"><a href="/categories/Artificial-Intelligence/">Artificial Intelligence</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-25T03:20:42.000Z">2024-01-25</time></p><p class="title"><a href="/2024/01/25/OutOfWork/5-VideoEntertainment/AnimeSuperResolutionFrame/">Anime Super Resolution to 4K &amp; Interpolation to 120 fps</a></p><p class="categories"><a href="/categories/OOW/">OOW</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T14:32:40.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Thinking/2-courage2move/SocialScience/">Social Science</a></p><p class="categories"><a href="/categories/Thinking/">Thinking</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T12:15:22.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/FPGA/">FPGA</a></p><p class="categories"><a href="/categories/toLearn/">toLearn</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-01-13T08:02:52.000Z">2024-01-13</time></p><p class="title"><a href="/2024/01/13/Work/Architecture/workloadPriority/">Workload Characterization &amp; Priority &amp; Scheduler to CPU/GPU/PIM</a></p><p class="categories"><a href="/categories/Architecture/">Architecture</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/"><span class="level-start"><span class="level-item">2024</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">235</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">67</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">72</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/5G/"><span class="tag">5G</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/64bits-vs-32bits/"><span class="tag">64bits vs 32bits</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AI/"><span class="tag">AI</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMAT/"><span class="tag">AMAT</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AMD/"><span class="tag">AMD</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ASPLOS/"><span class="tag">ASPLOS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ATI/"><span class="tag">ATI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AVX/"><span class="tag">AVX</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Algorithm/"><span class="tag">Algorithm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Alpha/"><span class="tag">Alpha</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Analysis/"><span class="tag">Analysis</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Apt/"><span class="tag">Apt</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BFS/"><span class="tag">BFS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BHive/"><span class="tag">BHive</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BT/"><span class="tag">BT</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BTL/"><span class="tag">BTL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Baka-Mitai/"><span class="tag">Baka Mitai</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Bash/"><span class="tag">Bash</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Big-Endian/"><span class="tag">Big-Endian</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="SHAOJIE&#039;S BOOK" height="28"></a><p class="is-size-7"><span>&copy; 2024 Shaojie Tan</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Kirrito-k423/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>